# Buildsheet autogenerated by ravenadm tool -- Do not edit.

NAMEBASE=		transmission
VERSION=		2.94
KEYWORDS=		net_p2p
VARIANTS=		standard daemon gtk qt web
SDESC[web]=		Lightweight BitTorrent client (web client)
SDESC[qt]=		Lightweight BitTorrent client (Qt GUI)
SDESC[standard]=	Lightweight BitTorrent client (CLI client)
SDESC[gtk]=		Lightweight BitTorrent client (GTK+ GUI)
SDESC[daemon]=		Lightweight BitTorrent client (daemon)
HOMEPAGE=		https://transmissionbt.com/
CONTACT=		nobody

DOWNLOAD_GROUPS=	main
SITES[main]=		https://github.com/transmission/transmission-releases/raw/master/
DISTFILE[1]=		transmission-2.94.tar.xz:main
DF_INDEX=		1
SPKGS[web]=		single
SPKGS[qt]=		single
SPKGS[standard]=	single
SPKGS[gtk]=		single
SPKGS[daemon]=		single

OPTIONS_AVAILABLE=	NOTSTD DAEMON GTK QT WEB
OPTIONS_STANDARD=	none
VOPTS[web]=		NOTSTD=ON DAEMON=OFF GTK=OFF QT=OFF WEB=ON
VOPTS[qt]=		NOTSTD=ON DAEMON=OFF GTK=OFF QT=ON WEB=OFF
VOPTS[gtk]=		NOTSTD=ON DAEMON=OFF GTK=ON QT=OFF WEB=OFF
VOPTS[daemon]=		NOTSTD=ON DAEMON=ON GTK=OFF QT=OFF WEB=OFF

LICENSE=		GPLv2:single GPLv3:single
LICENSE_TERMS=		single:{{WRKSRC}}/COPYING
LICENSE_FILE=		GPLv2:stock
			GPLv3:stock
LICENSE_SCHEME=		dual

CPE_VENDOR=		transmissionbt
FPC_EQUIVALENT=		net-p2p/transmission

CMAKE_ARGS=		-DENABLE_NLS:BOOL=ON
			-DUSE_SYSTEM_EVENT2:BOOL=ON
			-DUSE_SYSTEM_DHT:BOOL=ON
			-DUSE_SYSTEM_MINIUPNPC:BOOL=ON
			-DUSE_SYSTEM_NATPMP:BOOL=ON
			-DUSE_SYSTEM_UTP:BOOL=ON
			-DUSE_SYSTEM_B64:BOOL=ON

[NOTSTD].DESCRIPTION=			Don't build CLI version
[NOTSTD].CMAKE_ARGS_OFF=		-DENABLE_CLI:BOOL=ON
					-DENABLE_UTILS:BOOL=ON
[NOTSTD].CMAKE_ARGS_ON=			-DENABLE_CLI:BOOL=OFF
					-DENABLE_UTILS:BOOL=OFF

[WEB].DESCRIPTION=			Build transmission web interface
[WEB].BUILDRUN_DEPENDS_OFF=		curl:primary:standard
					libevent:single:standard
					dht:single:standard
					libb64:single:standard
					libnatpmp:single:standard
					libutp:single:standard
					miniupnpc:single:standard
[WEB].USES_OFF=				cpe
					cmake
					iconv
					pkgconfig
					ssl
					zlib
					gettext-runtime

[DAEMON].DESCRIPTION=			Build daemon version of transmission
[DAEMON].CMAKE_ARGS_OFF=		-DENABLE_DAEMON:BOOL=OFF
[DAEMON].CMAKE_ARGS_ON=			-DENABLE_DAEMON:BOOL=ON

[QT].DESCRIPTION=			Build Qt version of transmission
[QT].BUILDRUN_DEPENDS_ON=		qt5-qtbase:primary:standard
[QT].BUILD_DEPENDS_ON=			qt5-qttools:single:standard
[QT].CMAKE_ARGS_OFF=			-DENABLE_QT:BOOL=OFF
[QT].CMAKE_ARGS_ON=			-DENABLE_QT:BOOL=ON
					-DUSE_QT5:BOOL=ON
					-DCMAKE_PREFIX_PATH:PATH="{{PREFIX}}/lib/qt5/cmake/"
[QT].MAKE_ARGS_ON=			DESTDIR="{{STAGEDIR}}"
[QT].USES_ON=				qt5

[GTK].DESCRIPTION=			Build GTK+ version of transmission
[GTK].BUILDRUN_DEPENDS_ON=		dbus-glib:primary:standard
					libnotify:primary:standard
[GTK].CMAKE_ARGS_OFF=			-DENABLE_GTK:BOOL=OFF
[GTK].CMAKE_ARGS_ON=			-DENABLE_GTK:BOOL=ON
[GTK].GNOME_COMPONENTS_ON=		cairo
					gdkpixbuf
					gtk3
					pango
					intltool
[GTK].RUN_DEPENDS_ON=			xdg-utils:single:standard
[GTK].USES_ON=				gettext-tools:build
					desktop-utils:single

post-patch:
	# allow use of dht 0.26 (tranmission expects older 0.24)
	${REINPLACE_CMD} -e 's|dht/dht.h|dht.h|' \
		${WRKSRC}/cmake/FindDHT.cmake \
		${WRKSRC}/libtransmission/tr-dht.c

post-install-DAEMON-ON:
	${MKDIR} ${STAGEDIR}${PREFIX}/etc/transmission/home

post-patch-WEB-ON:
	${FIND} ${WRKSRC}/web \( \
		-name '*.am' \
		-o -name '*.in' \
		-o -name '*.scss' \
	\) -delete

do-install-WEB-ON:
	(cd ${WRKSRC} && \
	${COPYTREE_SHARE} web ${STAGEDIR}${PREFIX}/share/transmission)
	${RM} ${STAGEDIR}${PREFIX}/share/transmission/web/LICENSE

post-install-WEB-OFF:
	${RM} -r ${STAGEDIR}${STD_DOCDIR}
	${STRIP_CMD} ${STAGEDIR}${PREFIX}/bin/*

[FILE:168:descriptions/desc.single.standard]
Transmission is a cross-platform BitTorrent client that is opensource,
easy, lean, native and powerful.

This package contains the Command-Line Interface (CLI) client.


[FILE:354:descriptions/desc.single.daemon]
Transmission is a cross-platform BitTorrent client that is opensource,
easy, lean, native and powerful.

This package contains the Transmission daemon.

The transmission-daemon is a daemon-based Transmission session that can
be controlled via RPC by transmission-remote (included) and other
Transmission BiTtorrent client such as GTK+ and CLI interface.


[FILE:148:descriptions/desc.single.gtk]
Transmission is a cross-platform BitTorrent client that is opensource,
easy, lean, native and powerful.

This package contains the GTK+ GUI client.


[FILE:370:descriptions/desc.single.qt]
Transmission is a cross-platform BitTorrent client that is opensource,
easy, lean, native and powerful.

This package contains the Qt GUI client.

This is the only Transmission client that can act as its own self-contained
session (as the GTK+ and Mac clients do), and can also connect to a remote
session (as the web client and transmission-remote terminal client do).


[FILE:523:descriptions/desc.single.web]
Transmission is a cross-platform BitTorrent client that is opensource,
easy, lean, native and powerful.

This package contains the Transmission Web Interface.

Transmission Web Interface (Clutch) is a WebUI for the Transmission
BitTorrent client. It allows you to manage your torrents from anywhere you
can access the internet, and runs on OS X and various flavors of *nix. It
provides most of the basic features of the desktop client, including
torrent upload, torrent start/stop, file path selection, speed limiting,
etc.

[FILE:103:distinfo]
35442cc849f91f8df982c3d0d479d650c6ca19310a994eccdaa79a4af3916b7d      3365952 transmission-2.94.tar.xz


[FILE:195:manifests/plist.single.standard]
bin/
 transmission-cli
 transmission-create
 transmission-edit
 transmission-show
share/man/man1/
 transmission-cli.1.gz
 transmission-create.1.gz
 transmission-edit.1.gz
 transmission-show.1.gz


[FILE:142:manifests/plist.single.daemon]
bin/
 transmission-daemon
 transmission-remote
share/man/man1/
 transmission-daemon.1.gz
 transmission-remote.1.gz
@dir etc/transmission/home


[FILE:4708:manifests/plist.single.gtk]
bin/transmission-gtk
share/applications/transmission-gtk.desktop
share/icons/hicolor/16x16/apps/transmission.png
share/icons/hicolor/22x22/apps/transmission.png
share/icons/hicolor/24x24/apps/transmission.png
share/icons/hicolor/256x256/apps/transmission.png
share/icons/hicolor/32x32/apps/transmission.png
share/icons/hicolor/48x48/apps/transmission.png
share/icons/hicolor/scalable/apps/transmission.svg
share/locale/an/LC_MESSAGES/transmission-gtk.mo
share/locale/ar/LC_MESSAGES/transmission-gtk.mo
share/locale/ast/LC_MESSAGES/transmission-gtk.mo
share/locale/az/LC_MESSAGES/transmission-gtk.mo
share/locale/be/LC_MESSAGES/transmission-gtk.mo
share/locale/be@latin/LC_MESSAGES/transmission-gtk.mo
share/locale/bg/LC_MESSAGES/transmission-gtk.mo
share/locale/bn/LC_MESSAGES/transmission-gtk.mo
share/locale/bo/LC_MESSAGES/transmission-gtk.mo
share/locale/br/LC_MESSAGES/transmission-gtk.mo
share/locale/bs/LC_MESSAGES/transmission-gtk.mo
share/locale/ca/LC_MESSAGES/transmission-gtk.mo
share/locale/ca@valencia/LC_MESSAGES/transmission-gtk.mo
share/locale/ceb/LC_MESSAGES/transmission-gtk.mo
share/locale/ckb/LC_MESSAGES/transmission-gtk.mo
share/locale/cs/LC_MESSAGES/transmission-gtk.mo
share/locale/da/LC_MESSAGES/transmission-gtk.mo
share/locale/de/LC_MESSAGES/transmission-gtk.mo
share/locale/el/LC_MESSAGES/transmission-gtk.mo
share/locale/en_AU/LC_MESSAGES/transmission-gtk.mo
share/locale/en_CA/LC_MESSAGES/transmission-gtk.mo
share/locale/en_GB/LC_MESSAGES/transmission-gtk.mo
share/locale/eo/LC_MESSAGES/transmission-gtk.mo
share/locale/es/LC_MESSAGES/transmission-gtk.mo
share/locale/et/LC_MESSAGES/transmission-gtk.mo
share/locale/eu/LC_MESSAGES/transmission-gtk.mo
share/locale/fa/LC_MESSAGES/transmission-gtk.mo
share/locale/fi/LC_MESSAGES/transmission-gtk.mo
share/locale/fil/LC_MESSAGES/transmission-gtk.mo
share/locale/fo/LC_MESSAGES/transmission-gtk.mo
share/locale/fr/LC_MESSAGES/transmission-gtk.mo
share/locale/ga/LC_MESSAGES/transmission-gtk.mo
share/locale/gl/LC_MESSAGES/transmission-gtk.mo
share/locale/gv/LC_MESSAGES/transmission-gtk.mo
share/locale/he/LC_MESSAGES/transmission-gtk.mo
share/locale/hi/LC_MESSAGES/transmission-gtk.mo
share/locale/hr/LC_MESSAGES/transmission-gtk.mo
share/locale/hu/LC_MESSAGES/transmission-gtk.mo
share/locale/hy/LC_MESSAGES/transmission-gtk.mo
share/locale/ia/LC_MESSAGES/transmission-gtk.mo
share/locale/id/LC_MESSAGES/transmission-gtk.mo
share/locale/is/LC_MESSAGES/transmission-gtk.mo
share/locale/it/LC_MESSAGES/transmission-gtk.mo
share/locale/ja/LC_MESSAGES/transmission-gtk.mo
share/locale/ka/LC_MESSAGES/transmission-gtk.mo
share/locale/kk/LC_MESSAGES/transmission-gtk.mo
share/locale/ko/LC_MESSAGES/transmission-gtk.mo
share/locale/ku/LC_MESSAGES/transmission-gtk.mo
share/locale/ky/LC_MESSAGES/transmission-gtk.mo
share/locale/li/LC_MESSAGES/transmission-gtk.mo
share/locale/lt/LC_MESSAGES/transmission-gtk.mo
share/locale/lv/LC_MESSAGES/transmission-gtk.mo
share/locale/mk/LC_MESSAGES/transmission-gtk.mo
share/locale/ml/LC_MESSAGES/transmission-gtk.mo
share/locale/mr/LC_MESSAGES/transmission-gtk.mo
share/locale/ms/LC_MESSAGES/transmission-gtk.mo
share/locale/mt/LC_MESSAGES/transmission-gtk.mo
share/locale/my/LC_MESSAGES/transmission-gtk.mo
share/locale/nb/LC_MESSAGES/transmission-gtk.mo
share/locale/nds/LC_MESSAGES/transmission-gtk.mo
share/locale/nl/LC_MESSAGES/transmission-gtk.mo
share/locale/nn/LC_MESSAGES/transmission-gtk.mo
share/locale/oc/LC_MESSAGES/transmission-gtk.mo
share/locale/pa/LC_MESSAGES/transmission-gtk.mo
share/locale/pl/LC_MESSAGES/transmission-gtk.mo
share/locale/pt/LC_MESSAGES/transmission-gtk.mo
share/locale/pt_BR/LC_MESSAGES/transmission-gtk.mo
share/locale/ro/LC_MESSAGES/transmission-gtk.mo
share/locale/ru/LC_MESSAGES/transmission-gtk.mo
share/locale/si/LC_MESSAGES/transmission-gtk.mo
share/locale/sk/LC_MESSAGES/transmission-gtk.mo
share/locale/sl/LC_MESSAGES/transmission-gtk.mo
share/locale/sq/LC_MESSAGES/transmission-gtk.mo
share/locale/sr/LC_MESSAGES/transmission-gtk.mo
share/locale/sv/LC_MESSAGES/transmission-gtk.mo
share/locale/sw/LC_MESSAGES/transmission-gtk.mo
share/locale/ta_LK/LC_MESSAGES/transmission-gtk.mo
share/locale/te/LC_MESSAGES/transmission-gtk.mo
share/locale/th/LC_MESSAGES/transmission-gtk.mo
share/locale/tl/LC_MESSAGES/transmission-gtk.mo
share/locale/tr/LC_MESSAGES/transmission-gtk.mo
share/locale/ug/LC_MESSAGES/transmission-gtk.mo
share/locale/uk/LC_MESSAGES/transmission-gtk.mo
share/locale/ur/LC_MESSAGES/transmission-gtk.mo
share/locale/uz/LC_MESSAGES/transmission-gtk.mo
share/locale/vi/LC_MESSAGES/transmission-gtk.mo
share/locale/zh_CN/LC_MESSAGES/transmission-gtk.mo
share/locale/zh_TW/LC_MESSAGES/transmission-gtk.mo
share/man/man1/transmission-gtk.1.gz


[FILE:464:manifests/plist.single.qt]
bin/transmission-qt
share/applications/transmission-qt.desktop
share/man/man1/transmission-qt.1.gz
share/transmission/translations/
 transmission_de.qm
 transmission_en.qm
 transmission_es.qm
 transmission_eu.qm
 transmission_fr.qm
 transmission_hu.qm
 transmission_id.qm
 transmission_it_IT.qm
 transmission_kk.qm
 transmission_ko.qm
 transmission_lt.qm
 transmission_pl_PL.qm
 transmission_pt_BR.qm
 transmission_ru.qm
 transmission_uk.qm
 transmission_zh_CN.qm


[FILE:1648:manifests/plist.single.web]
share/transmission/web/index.html
share/transmission/web/images/
 favicon.ico
 favicon.png
 webclip-icon.png
share/transmission/web/javascript/
 common.js
 dialog.js
 file-row.js
 formatter.js
 inspector.js
 notifications.js
 prefs-dialog.js
 remote.js
 torrent-row.js
 torrent.js
 transmission.js
share/transmission/web/javascript/jquery/
 jquery-migrate.min.js
 jquery-ui.min.js
 jquery.min.js
 jquery.transmenu.min.js
 jquery.ui-contextmenu.min.js
 json2.min.js
share/transmission/web/style/jqueryui/jquery-ui.min.css
share/transmission/web/style/jqueryui/images/
 ui-bg_flat_0_aaaaaa_40x100.png
 ui-bg_flat_75_ffffff_40x100.png
 ui-bg_glass_55_fbf9ee_1x400.png
 ui-bg_glass_65_ffffff_1x400.png
 ui-bg_glass_75_dadada_1x400.png
 ui-bg_glass_75_e6e6e6_1x400.png
 ui-bg_glass_95_fef1ec_1x400.png
 ui-bg_highlight-soft_75_cccccc_1x100.png
 ui-icons_222222_256x240.png
 ui-icons_2e83ff_256x240.png
 ui-icons_454545_256x240.png
 ui-icons_888888_256x240.png
 ui-icons_cd0a0a_256x240.png
share/transmission/web/style/transmission/
 common.css
 mobile.css
share/transmission/web/style/transmission/images/
 arrow-down.png
 arrow-up.png
 blue-turtle.png
 compact.png
 file-priority-high.png
 file-priority-low.png
 file-priority-normal.png
 filter_bar.png
 filter_icon.png
 inspector-files.png
 inspector-info.png
 inspector-peers.png
 inspector-trackers.png
 lock_icon.png
 logo.png
 progress.png
 settings.png
 toolbar-close.png
 toolbar-folder.png
 toolbar-info.png
 toolbar-pause-all.png
 toolbar-pause.png
 toolbar-start-all.png
 toolbar-start.png
 turtle.png
 wrench.png
share/transmission/web/style/transmission/images/buttons/torrent_buttons.png


[FILE:768:patches/patch-CMakeLists.txt]
--- CMakeLists.txt.orig	2018-07-09 22:28:43 UTC
+++ CMakeLists.txt
@@ -511,9 +511,9 @@ endif()
 # endif()
 
 if(ENABLE_NLS)
-    check_library_exists(intl libintl_gettext "" HAVE_LIBINTL)
-    if(HAVE_LIBINTL)
-        set(LIBINTL_LIBRARY intl)
+    find_package(Intl)
+    if(Intl_FOUND)
+        set(LIBINTL_LIBRARY ${Intl_LIBRARIES})
     endif()
 endif()
 
@@ -536,13 +536,6 @@ foreach(P daemon cli utils gtk qt)
     endif()
 endforeach()
 
-if(ENABLE_DAEMON OR ENABLE_GTK OR ENABLE_QT)
-    install(DIRECTORY web DESTINATION ${CMAKE_INSTALL_DATAROOTDIR}/${TR_NAME}
-        PATTERN *.am EXCLUDE
-        PATTERN *.in EXCLUDE
-        PATTERN *.scss EXCLUDE)
-endif()
-
 if(ENABLE_GTK AND ENABLE_NLS)
     find_package(Gettext REQUIRED)
     add_subdirectory(po)


[FILE:1560:patches/patch-gtk_CMakeLists.txt]
--- gtk/CMakeLists.txt.orig	2018-05-01 17:18:29 UTC
+++ gtk/CMakeLists.txt
@@ -48,15 +48,22 @@ add_custom_command(
         ${CMAKE_CURRENT_SOURCE_DIR}
 )
 
+set(${PROJECT_NAME}_DESKTOP_FILE "${PROJECT_BINARY_DIR}/${TR_NAME}-gtk.desktop")
 if(ENABLE_NLS)
     find_program(INTLTOOL_MERGE_EXECUTABLE intltool-merge REQUIRED)
-    set(${PROJECT_NAME}_DESKTOP_FILE "${PROJECT_BINARY_DIR}/${TR_NAME}-gtk.desktop")
     add_custom_command(
         OUTPUT ${${PROJECT_NAME}_DESKTOP_FILE}
         COMMAND ${INTLTOOL_MERGE_EXECUTABLE} --desktop-style --utf8 ${CMAKE_SOURCE_DIR}/po ${PROJECT_SOURCE_DIR}/transmission-gtk.desktop.in ${${PROJECT_NAME}_DESKTOP_FILE}
         DEPENDS ${PROJECT_SOURCE_DIR}/transmission-gtk.desktop.in
         VERBATIM
     )
+else()
+    add_custom_command(
+        OUTPUT ${${PROJECT_NAME}_DESKTOP_FILE}
+        COMMAND sed s/^_// ${PROJECT_SOURCE_DIR}/transmission-gtk.desktop.in > ${${PROJECT_NAME}_DESKTOP_FILE}
+        DEPENDS ${PROJECT_SOURCE_DIR}/transmission-gtk.desktop.in
+        VERBATIM
+    )
 endif()
 
 set(${PROJECT_NAME}_SOURCES
@@ -186,8 +193,4 @@ if(INSTALL_DOC)
     install(FILES ${TR_NAME}-gtk.1 DESTINATION ${CMAKE_INSTALL_MANDIR}/man1)
 endif()
 
-if(ENABLE_NLS)
-    install(FILES ${${PROJECT_NAME}_DESKTOP_FILE} DESTINATION ${CMAKE_INSTALL_DATADIR}/applications)
-else()
-    install(FILES transmission-gtk.desktop.in DESTINATION ${CMAKE_INSTALL_DATADIR}/applications RENAME ${TR_NAME}-gtk.desktop)
-endif()
+install(FILES ${${PROJECT_NAME}_DESKTOP_FILE} DESTINATION ${CMAKE_INSTALL_DATADIR}/applications)


[FILE:571:patches/patch-libtransmission_CMakeLists.txt]
--- libtransmission/CMakeLists.txt.orig	2018-07-10 05:34:13 UTC
+++ libtransmission/CMakeLists.txt
@@ -281,7 +281,7 @@ if(ENABLE_TESTS)
             set(${TP}_TEST_BASENAME "${T}")
         endif()
         add_executable(${TP} ${${TP}_TEST_BASENAME}-test.c ${${T}-test_ADD_SOURCES})
-        target_link_libraries(${TP} ${TR_NAME} ${TR_NAME}-test)
+        target_link_libraries(${TP} ${TR_NAME} ${TR_NAME}-test ${DHT_LIBRARIES})
         if(DEFINED ${T}-test_DEFINITIONS)
             target_compile_definitions(${TP} PRIVATE ${${T}-test_DEFINITIONS})
         endif()


[FILE:1343:patches/patch-libtransmission_platform-quota.c]
--- libtransmission/platform-quota.c.orig	2015-03-27 12:44:20 UTC
+++ libtransmission/platform-quota.c
@@ -18,6 +18,8 @@
  #include <sys/types.h> /* types needed by quota.h */
  #if defined(__FreeBSD__) || defined(__OpenBSD__)
   #include <ufs/ufs/quota.h> /* quotactl() */
+ #elif defined (__DragonFly__)
+  #include <vfs/ufs/quota.h> /* quotactl() */
  #elif defined (__NetBSD__)
   #include <sys/param.h>
   #ifndef statfs
@@ -244,12 +246,17 @@ getquota (const char * device)
 static int64_t
 getquota (const char * device)
 {
+#ifdef __DragonFly__
+  struct ufs_dqblk dq;
+#else
   struct dqblk dq;
+#endif
   int64_t limit;
   int64_t freespace;
   int64_t spaceused;
 
-#if defined(__FreeBSD__) || defined(__OpenBSD__) || defined(__APPLE__)
+#if defined(__FreeBSD__) || defined(__OpenBSD__) || defined(__APPLE__) \
+ || defined(__DragonFly__)
   if (quotactl(device, QCMD(Q_GETQUOTA, USRQUOTA), getuid(), (caddr_t) &dq) == 0)
     {
 #elif defined(__sun)
@@ -281,7 +288,7 @@ getquota (const char * device)
           /* No quota enabled for this user */
           return -1;
         }
-#if defined(__FreeBSD__) || defined(__OpenBSD__)
+#if defined(__FreeBSD__) || defined(__OpenBSD__) || defined(__DragonFly__)
       spaceused = (int64_t) dq.dqb_curblocks >> 1;
 #elif defined(__APPLE__)
       spaceused = (int64_t) dq.dqb_curbytes;


[FILE:456:patches/patch-libtransmission_tr-dht.c]
--- libtransmission/tr-dht.c.orig	2018-12-27 04:04:08 UTC
+++ libtransmission/tr-dht.c
@@ -694,6 +694,11 @@ dht_random_bytes (void * buf, size_t size)
     return size;
 }
 
+int dht_sendto(int sockfd, void const* buf, int len, int flags, struct sockaddr const* to, int tolen)
+{
+    return sendto(sockfd, buf, len, flags, to, tolen);
+}
+
 #if defined (_WIN32) && !defined (__MINGW32__)
 int
 dht_gettimeofday (struct timeval * tv, struct timezone * tz)


[FILE:198:patches/patch-qt_Application.h]
--- qt/Application.h.orig	2018-07-04 17:44:30 UTC
+++ qt/Application.h
@@ -15,6 +15,7 @@
 #include <QTimer>
 #include <QTranslator>
 
+#include <time.h>
 #include "FaviconCache.h"
 
 class AddData;


[FILE:129:files/special.mk]
.if "${VARIANT}" == "web"
do-build:
	@echo "Skipping build of the Transmission web interface."

do-install:
	# do nothing
.endif


[FILE:2779:files/transmission.in]
#!/bin/sh
#
# $FreeBSD$
#
# PROVIDE: transmission
# REQUIRE: DAEMON
# KEYWORD: shutdown
#
# Add the following lines to /etc/rc.conf to enable this service:
#
# transmission_enable:	     Set to NO by default. Set it to YES to enable it.
# transmission_watch_dir:    Directory for torrent files to download
#			     automatically. Off by default unless you add
#			     a path.
# transmission_conf_dir:     Directory where transmission configuration
#			     data is stored.
#			     Default: %%PREFIX%%/etc/transmission/home
# transmission_download_dir: Directory to store downloaded data.
#			     Default: %%PREFIX%%/etc/transmission/home/Downloads
# transmission_user:	     The user account transmission daemon runs as what
#			     you want it to be. It uses 'transmission' user by
#			     default.
# transmission_web_home:     Use alternative directory for the web interface
#			     files, such as javascript, html and graphics.
# transmission_chown:	     By default, transmission checks and fixes the
#			     permissions for its home directory.  If this
#			     causes problems, set this variable to no.
#

. /etc/rc.subr

name=transmission
rcvar=transmission_enable

load_rc_config $name

: ${transmission_enable:=NO}
: ${transmission_conf_dir=%%PREFIX%%/etc/transmission/home}
: ${transmission_download_dir=%%PREFIX%%/etc/transmission/home/Downloads}
: ${transmission_user:=transmission}
transmission_group=${transmission_group:-$transmission_user}
: ${transmission_chown:=yes}

command=%%PREFIX%%/bin/transmission-daemon
pidfile=/var/run/transmission/daemon.pid
extra_commands=reload
start_precmd=transmission_prestart

transmission_flags=" \
	${transmission_watch_dir:+-c ${transmission_watch_dir}} \
	${transmission_conf_dir:+-g ${transmission_conf_dir}} \
	${transmission_download_dir:+-w ${transmission_download_dir}} \
	${pidfile:+-x $pidfile} \
	${transmission_flags}"

transmission_prestart()
{
	install -d -o $transmission_user ${pidfile%/*}
	if checkyesno transmission_chown; then
		mkdir -p $transmission_conf_dir $transmission_download_dir
		chown $transmission_user:$transmission_group $transmission_download_dir
		chown -R $transmission_user:$transmission_group $transmission_conf_dir
		chgrp $transmission_group $transmission_conf_dir
		chmod 750 $transmission_conf_dir
	fi
	if [ -n "$transmission_web_home" ]; then
		TRANSMISSION_WEB_HOME=$transmission_web_home
		export TRANSMISSION_WEB_HOME
	fi
}

# Unfortunately there was a typo in a previous version, which may have
# left some people with /var/run/transmission/damon.pid .  Deal with
# this for a few months at least, until everyone will have restarted
# transmission
if [ ! -f $pidfile -a -f /var/run/transmission/damon.pid ]; then
	pidfile=/var/run/transmission/damon.pid
fi

run_rc_command $1

