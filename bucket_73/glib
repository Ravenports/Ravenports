# Buildsheet autogenerated by ravenadm tool -- Do not edit.

NAMEBASE=		glib
VERSION=		2.54.0
KEYWORDS=		devel
VARIANTS=		standard
SDESC[standard]=	Some useful routines of C programming
HOMEPAGE=		https://www.gtk.org/
CONTACT=		nobody

DOWNLOAD_GROUPS=	main
SITES[main]=		GNOME/glib/2.54
DISTFILE[1]=		glib-2.54.0.tar.xz:main
DIST_SUBDIR=		gnome2
DF_INDEX=		1
SPKGS[standard]=	single

OPTIONS_AVAILABLE=	none
OPTIONS_STANDARD=	none

BUILDRUN_DEPENDS=	pcre:static:standard
			pcre:shared:standard
			libffi:single:standard

USES=			gettext-tools gettext-runtime gmake libtool
			perl:build pkgconfig python:build shebangfix zlib

FPC_EQUIVALENT=		devel/glib20
SHEBANG_FILES=		*/*.pl

MUST_CONFIGURE=		gnu
CONFIGURE_ARGS=		--disable-gtk-doc
			--with-html-dir={{PREFIX}}/share/doc
			--disable-man
			--without-xml-catalog
			--enable-static=yes
			--with-pcre=system
			--disable-fam
			--disable-dtrace
			--disable-libmount
			--with-libiconv=gnu
CONFIGURE_ENV=		ac_cv_header_sys_inotify_h=

INSTALL_TARGET=		install-strip
INSTALL_REQ_TOOLCHAIN=	yes
PLIST_SUB=		LIBVERSION=0.5200.3
			RESETPREFIX={{PREFIX}}

post-patch:
	@${REINPLACE_CMD} -e 's|/usr/local|${LOCALBASE}|g ; \
		s|/usr/share/locale/locale|${LOCALBASE}/share/locale/locale|g' \
			${WRKSRC}/glib/gutils.c
	@${REINPLACE_CMD} -e 's|inotify_support=yes|inotify_support=no| ; \
		s|-Werror|| ; \
		s|#define HAVE_SYS_INOTIFY_H 1||' ${WRKSRC}/configure

post-install:
	@${MKDIR} ${STAGEDIR}${PREFIX}/share/GConf/gsettings
	@${MKDIR} ${STAGEDIR}${PREFIX}/lib/gio/modules
.for m in glib gio gobject
	${INSTALL_MAN} ${${m}_MAN:S|^|${WRKSRC}/docs/reference/${m}/|} \
		${STAGEDIR}${MANPREFIX}/man/man1
.endfor

[FILE:205:descriptions/desc.single]
GLib provides a simple, abstract, and highly portable set of C support
routines such as lists, trees, hashes, memory allocation, and much, much
more.  It is a foundation for writing portable applications.


[FILE:104:distinfo]
fe22998ff0394ec31e6e5511c379b74011bee61a4421bca7fcab223dfbe0fc6a      7822508 gnome2/glib-2.54.0.tar.xz


[FILE:10055:manifests/plist.single]
bin/
 gapplication
 gdbus
 gdbus-codegen
 gio
 gio-querymodules
 glib-compile-resources
 glib-compile-schemas
 glib-genmarshal
 glib-gettextize
 glib-mkenums
 gobject-query
 gresource
 gsettings
 gtester
 gtester-report
share/bash-completion/completions/
 gdbus
 gsettings
 gresource
include/gio-unix-2.0/gio/
 gdesktopappinfo.h
 gfiledescriptorbased.h
 gunixconnection.h
 gunixcredentialsmessage.h
 gunixfdlist.h
 gunixfdmessage.h
 gunixinputstream.h
 gunixmounts.h
 gunixoutputstream.h
 gunixsocketaddress.h
include/glib-2.0/gio/
 gaction.h
 gactiongroup.h
 gactiongroupexporter.h
 gactionmap.h
 gappinfo.h
 gapplication.h
 gapplicationcommandline.h
 gasyncinitable.h
 gasyncresult.h
 gbufferedinputstream.h
 gbufferedoutputstream.h
 gbytesicon.h
 gcancellable.h
 gcharsetconverter.h
 gcontenttype.h
 gconverter.h
 gconverterinputstream.h
 gconverteroutputstream.h
 gcredentials.h
 gdatagrambased.h
 gdatainputstream.h
 gdataoutputstream.h
 gdbusactiongroup.h
 gdbusaddress.h
 gdbusauthobserver.h
 gdbusconnection.h
 gdbuserror.h
 gdbusinterface.h
 gdbusinterfaceskeleton.h
 gdbusintrospection.h
 gdbusmenumodel.h
 gdbusmessage.h
 gdbusmethodinvocation.h
 gdbusnameowning.h
 gdbusnamewatching.h
 gdbusobject.h
 gdbusobjectmanager.h
 gdbusobjectmanagerclient.h
 gdbusobjectmanagerserver.h
 gdbusobjectproxy.h
 gdbusobjectskeleton.h
 gdbusproxy.h
 gdbusserver.h
 gdbusutils.h
 gdrive.h
 gdtlsclientconnection.h
 gdtlsconnection.h
 gdtlsserverconnection.h
 gemblem.h
 gemblemedicon.h
 gfile.h
 gfileattribute.h
 gfileenumerator.h
 gfileicon.h
 gfileinfo.h
 gfileinputstream.h
 gfileiostream.h
 gfilemonitor.h
 gfilenamecompleter.h
 gfileoutputstream.h
 gfilterinputstream.h
 gfilteroutputstream.h
 gicon.h
 ginetaddress.h
 ginetaddressmask.h
 ginetsocketaddress.h
 ginitable.h
 ginputstream.h
 gio-autocleanups.h
 gio.h
 gioenums.h
 gioenumtypes.h
 gioerror.h
 giomodule.h
 gioscheduler.h
 giostream.h
 giotypes.h
 glistmodel.h
 gliststore.h
 gloadableicon.h
 gmemoryinputstream.h
 gmemoryoutputstream.h
 gmenu.h
 gmenuexporter.h
 gmenumodel.h
 gmount.h
 gmountoperation.h
 gnativevolumemonitor.h
 gnetworkaddress.h
 gnetworking.h
 gnetworkmonitor.h
 gnetworkservice.h
 gnotification.h
 goutputstream.h
 gpermission.h
 gpollableinputstream.h
 gpollableoutputstream.h
 gpollableutils.h
 gpropertyaction.h
 gproxy.h
 gproxyaddress.h
 gproxyaddressenumerator.h
 gproxyresolver.h
 gremoteactiongroup.h
 gresolver.h
 gresource.h
 gseekable.h
 gsettings.h
 gsettingsbackend.h
 gsettingsschema.h
 gsimpleaction.h
 gsimpleactiongroup.h
 gsimpleasyncresult.h
 gsimpleiostream.h
 gsimplepermission.h
 gsimpleproxyresolver.h
 gsocket.h
 gsocketaddress.h
 gsocketaddressenumerator.h
 gsocketclient.h
 gsocketconnectable.h
 gsocketconnection.h
 gsocketcontrolmessage.h
 gsocketlistener.h
 gsocketservice.h
 gsrvtarget.h
 gsubprocess.h
 gsubprocesslauncher.h
 gtask.h
 gtcpconnection.h
 gtcpwrapperconnection.h
 gtestdbus.h
 gthemedicon.h
 gthreadedsocketservice.h
 gtlsbackend.h
 gtlscertificate.h
 gtlsclientconnection.h
 gtlsconnection.h
 gtlsdatabase.h
 gtlsfiledatabase.h
 gtlsinteraction.h
 gtlspassword.h
 gtlsserverconnection.h
 gvfs.h
 gvolume.h
 gvolumemonitor.h
 gzlibcompressor.h
 gzlibdecompressor.h
include/glib-2.0/
 glib-object.h
 glib-unix.h
 glib.h
include/glib-2.0/glib/deprecated/
 gallocator.h
 gcache.h
 gcompletion.h
 gmain.h
 grel.h
 gthread.h
include/glib-2.0/glib/
 galloca.h
 garray.h
 gasyncqueue.h
 gatomic.h
 gbacktrace.h
 gbase64.h
 gbitlock.h
 gbookmarkfile.h
 gbytes.h
 gcharset.h
 gchecksum.h
 gconvert.h
 gdataset.h
 gdate.h
 gdatetime.h
 gdir.h
 genviron.h
 gerror.h
 gfileutils.h
 ggettext.h
 ghash.h
 ghmac.h
 ghook.h
 ghostutils.h
 gi18n-lib.h
 gi18n.h
 giochannel.h
 gkeyfile.h
 glib-autocleanups.h
 glist.h
 gmacros.h
 gmain.h
 gmappedfile.h
 gmarkup.h
 gmem.h
 gmessages.h
 gnode.h
 goption.h
 gpattern.h
 gpoll.h
 gprimes.h
 gprintf.h
 gqsort.h
 gquark.h
 gqueue.h
 grand.h
 gregex.h
 gscanner.h
 gsequence.h
 gshell.h
 gslice.h
 gslist.h
 gspawn.h
 gstdio.h
 gstrfuncs.h
 gstring.h
 gstringchunk.h
 gtestutils.h
 gthread.h
 gthreadpool.h
 gtimer.h
 gtimezone.h
 gtrashstack.h
 gtree.h
 gtypes.h
 gunicode.h
 gurifuncs.h
 gutils.h
 guuid.h
 gvariant.h
 gvarianttype.h
 gversion.h
 gversionmacros.h
 gwin32.h
include/glib-2.0/
 gmodule.h
include/glib-2.0/gobject/
 gbinding.h
 gboxed.h
 gclosure.h
 genums.h
 glib-types.h
 gmarshal.h
 gobject-autocleanups.h
 gobject.h
 gobjectnotifyqueue.c
 gparam.h
 gparamspecs.h
 gsignal.h
 gsourceclosure.h
 gtype.h
 gtypemodule.h
 gtypeplugin.h
 gvalue.h
 gvaluearray.h
 gvaluecollector.h
 gvaluetypes.h
lib/glib-2.0/include/glibconfig.h
lib/
 libgio-2.0.a
 libgio-2.0.so
 libgio-2.0.so.0
 libgio-2.0.so.%%LIBVERSION%%
 libglib-2.0.a
 libglib-2.0.so
 libglib-2.0.so.0
 libglib-2.0.so.%%LIBVERSION%%
 libgmodule-2.0.a
 libgmodule-2.0.so
 libgmodule-2.0.so.0
 libgmodule-2.0.so.%%LIBVERSION%%
 libgobject-2.0.a
 libgobject-2.0.so
 libgobject-2.0.so.0
 libgobject-2.0.so.%%LIBVERSION%%
 libgthread-2.0.a
 libgthread-2.0.so
 libgthread-2.0.so.0
 libgthread-2.0.so.%%LIBVERSION%%
lib/pkgconfig/
 gio-2.0.pc
 gio-unix-2.0.pc
 glib-2.0.pc
 gmodule-2.0.pc
 gmodule-export-2.0.pc
 gmodule-no-export-2.0.pc
 gobject-2.0.pc
 gthread-2.0.pc
share/man/man1/
 gapplication.1.gz
 gdbus-codegen.1.gz
 gdbus.1.gz
 gio-querymodules.1.gz
 glib-compile-resources.1.gz
 glib-compile-schemas.1.gz
 glib-genmarshal.1.gz
 glib-gettextize.1.gz
 glib-mkenums.1.gz
 gobject-query.1.gz
 gresource.1.gz
 gsettings.1.gz
 gtester-report.1.gz
 gtester.1.gz
share/aclocal/
 glib-2.0.m4
 glib-gettext.m4
 gsettings.m4
share/bash-completion/completions/
 gapplication
share/gdb/auto-load%%RESETPREFIX%%/lib/
 libglib-2.0.so.%%LIBVERSION%%-gdb.py
 libgobject-2.0.so.%%LIBVERSION%%-gdb.py
share/gettext/its/
 gschema.its
 gschema.loc
@comment share/glib-2.0/codegen auto-generated
share/glib-2.0/gdb/
 glib_gdb.py
 gobject_gdb.py
share/glib-2.0/gettext/po/Makefile.in.in
share/glib-2.0/schemas/gschema.dtd
share/glib-2.0/valgrind/glib.supp
share/locale/af/LC_MESSAGES/glib20.mo
share/locale/am/LC_MESSAGES/glib20.mo
share/locale/an/LC_MESSAGES/glib20.mo
share/locale/ar/LC_MESSAGES/glib20.mo
share/locale/as/LC_MESSAGES/glib20.mo
share/locale/ast/LC_MESSAGES/glib20.mo
share/locale/az/LC_MESSAGES/glib20.mo
share/locale/be/LC_MESSAGES/glib20.mo
share/locale/be@latin/LC_MESSAGES/glib20.mo
share/locale/bg/LC_MESSAGES/glib20.mo
share/locale/bn/LC_MESSAGES/glib20.mo
share/locale/bn_IN/LC_MESSAGES/glib20.mo
share/locale/bs/LC_MESSAGES/glib20.mo
share/locale/ca/LC_MESSAGES/glib20.mo
share/locale/ca@valencia/LC_MESSAGES/glib20.mo
share/locale/cs/LC_MESSAGES/glib20.mo
share/locale/cy/LC_MESSAGES/glib20.mo
share/locale/da/LC_MESSAGES/glib20.mo
share/locale/de/LC_MESSAGES/glib20.mo
share/locale/dz/LC_MESSAGES/glib20.mo
share/locale/el/LC_MESSAGES/glib20.mo
share/locale/en@shaw/LC_MESSAGES/glib20.mo
share/locale/en_CA/LC_MESSAGES/glib20.mo
share/locale/en_GB/LC_MESSAGES/glib20.mo
share/locale/eo/LC_MESSAGES/glib20.mo
share/locale/es/LC_MESSAGES/glib20.mo
share/locale/et/LC_MESSAGES/glib20.mo
share/locale/eu/LC_MESSAGES/glib20.mo
share/locale/fa/LC_MESSAGES/glib20.mo
share/locale/fi/LC_MESSAGES/glib20.mo
share/locale/fr/LC_MESSAGES/glib20.mo
share/locale/fur/LC_MESSAGES/glib20.mo
share/locale/ga/LC_MESSAGES/glib20.mo
share/locale/gd/LC_MESSAGES/glib20.mo
share/locale/gl/LC_MESSAGES/glib20.mo
share/locale/gu/LC_MESSAGES/glib20.mo
share/locale/he/LC_MESSAGES/glib20.mo
share/locale/hi/LC_MESSAGES/glib20.mo
share/locale/hr/LC_MESSAGES/glib20.mo
share/locale/hu/LC_MESSAGES/glib20.mo
share/locale/hy/LC_MESSAGES/glib20.mo
share/locale/id/LC_MESSAGES/glib20.mo
share/locale/is/LC_MESSAGES/glib20.mo
share/locale/it/LC_MESSAGES/glib20.mo
share/locale/ja/LC_MESSAGES/glib20.mo
share/locale/ka/LC_MESSAGES/glib20.mo
share/locale/kk/LC_MESSAGES/glib20.mo
share/locale/kn/LC_MESSAGES/glib20.mo
share/locale/ko/LC_MESSAGES/glib20.mo
share/locale/ku/LC_MESSAGES/glib20.mo
share/locale/lt/LC_MESSAGES/glib20.mo
share/locale/lv/LC_MESSAGES/glib20.mo
share/locale/mai/LC_MESSAGES/glib20.mo
share/locale/mg/LC_MESSAGES/glib20.mo
share/locale/mk/LC_MESSAGES/glib20.mo
share/locale/ml/LC_MESSAGES/glib20.mo
share/locale/mn/LC_MESSAGES/glib20.mo
share/locale/mr/LC_MESSAGES/glib20.mo
share/locale/ms/LC_MESSAGES/glib20.mo
share/locale/nb/LC_MESSAGES/glib20.mo
share/locale/nds/LC_MESSAGES/glib20.mo
share/locale/ne/LC_MESSAGES/glib20.mo
share/locale/nl/LC_MESSAGES/glib20.mo
share/locale/nn/LC_MESSAGES/glib20.mo
share/locale/oc/LC_MESSAGES/glib20.mo
share/locale/or/LC_MESSAGES/glib20.mo
share/locale/pa/LC_MESSAGES/glib20.mo
share/locale/pl/LC_MESSAGES/glib20.mo
share/locale/ps/LC_MESSAGES/glib20.mo
share/locale/pt/LC_MESSAGES/glib20.mo
share/locale/pt_BR/LC_MESSAGES/glib20.mo
share/locale/ro/LC_MESSAGES/glib20.mo
share/locale/ru/LC_MESSAGES/glib20.mo
share/locale/rw/LC_MESSAGES/glib20.mo
share/locale/si/LC_MESSAGES/glib20.mo
share/locale/sk/LC_MESSAGES/glib20.mo
share/locale/sl/LC_MESSAGES/glib20.mo
share/locale/sq/LC_MESSAGES/glib20.mo
share/locale/sr/LC_MESSAGES/glib20.mo
share/locale/sr@ije/LC_MESSAGES/glib20.mo
share/locale/sr@latin/LC_MESSAGES/glib20.mo
share/locale/sv/LC_MESSAGES/glib20.mo
share/locale/ta/LC_MESSAGES/glib20.mo
share/locale/te/LC_MESSAGES/glib20.mo
share/locale/tg/LC_MESSAGES/glib20.mo
share/locale/th/LC_MESSAGES/glib20.mo
share/locale/tl/LC_MESSAGES/glib20.mo
share/locale/tr/LC_MESSAGES/glib20.mo
share/locale/tt/LC_MESSAGES/glib20.mo
share/locale/ug/LC_MESSAGES/glib20.mo
share/locale/uk/LC_MESSAGES/glib20.mo
share/locale/vi/LC_MESSAGES/glib20.mo
share/locale/wa/LC_MESSAGES/glib20.mo
share/locale/xh/LC_MESSAGES/glib20.mo
share/locale/yi/LC_MESSAGES/glib20.mo
share/locale/zh_CN/LC_MESSAGES/glib20.mo
share/locale/zh_HK/LC_MESSAGES/glib20.mo
share/locale/zh_TW/LC_MESSAGES/glib20.mo
@dir lib/gio/modules
@dir share/GConf/gsettings
@postexec %D/bin/glib-compile-schemas %D/share/glib-2.0/schemas 2>/dev/null || /usr/bin/true
@postunexec /bin/rm -f %D/share/glib-2.0/schemas/gschemas.compiled || /usr/bin/true
@postexec %D/bin/gio-querymodules %D/lib/gio/modules 2>/dev/null || /usr/bin/true


[FILE:1895:patches/patch-bug739424]
From 22656f16c29591207c667362e2a42fd348fe8494 Mon Sep 17 00:00:00 2001
From: Martin Pieuchot <mpi@openbsd.org>
Date: Fri, 28 Apr 2017 15:06:52 +0200
Subject: [PATCH] kqueue: fix use-after-free of ``kqueue_sub''.

Since ``kqueue_sub'' are not refcounted it is common to see a thread
freeing one of them while another thread is manipulating them.  This
leads to crashs reported in:
	https://bugzilla.gnome.org/show_bug.cgi?id=739424

To prevent such crash, make sure the threads are holding ``hash_lock''
when manipulating such items.
---
 gio/kqueue/kqueue-helper.c | 6 ++++--
 1 file changed, 4 insertions(+), 2 deletions(-)

diff --git a/gio/kqueue/kqueue-helper.c b/gio/kqueue/kqueue-helper.c
index d4e66cd4d..84b9ef164 100644
--- gio/kqueue/kqueue-helper.c
+++ gio/kqueue/kqueue-helper.c
@@ -291,10 +291,10 @@ process_kqueue_notifications (GIOChannel   *gioc,
 
   G_LOCK (hash_lock);
   sub = (kqueue_sub *) g_hash_table_lookup (subs_hash_table, GINT_TO_POINTER (n.fd));
-  G_UNLOCK (hash_lock);
 
   if (sub == NULL)
     {
+      G_UNLOCK (hash_lock);
       KH_W ("Got a notification for a deleted or non-existing subscription %d",
              n.fd);
       return TRUE;
@@ -336,6 +336,7 @@ process_kqueue_notifications (GIOChannel   *gioc,
         g_file_monitor_source_handle_event (source, mask, NULL, NULL, NULL, g_get_monotonic_time ());
     }
 
+  G_UNLOCK (hash_lock);
   return TRUE;
 }
 
@@ -451,13 +452,14 @@ _kh_start_watching (kqueue_sub *sub)
 
   G_LOCK (hash_lock);
   g_hash_table_insert (subs_hash_table, GINT_TO_POINTER (sub->fd), sub);
-  G_UNLOCK (hash_lock);
 
   _kqueue_thread_push_fd (sub->fd);
   
   /* Bump the kqueue thread. It will pick up a new sub entry to monitor */
   if (!_ku_write (kqueue_socket_pair[0], "A", 1))
     KH_W ("Failed to bump the kqueue thread (add fd, error %d)", errno);
+  G_UNLOCK (hash_lock);
+
   return TRUE;
 }
 
-- 
2.12.2



[FILE:400:patches/patch-config.h.in]
--- config.h.in.orig	2008-03-18 18:24:24.000000000 -0400
+++ config.h.in	2008-03-18 18:24:59.000000000 -0400
@@ -197,6 +197,9 @@
 /* Define to 1 if you have the `getpwuid' function. */
 #undef HAVE_GETPWUID
 
+/* Define to 1 if you have the `sysctlbyname' function. */
+#undef HAVE_SYSCTLBYNAME
+
 /* Define if the GNU gettext() function is already present or preinstalled. */
 #undef HAVE_GETTEXT
 


[FILE:458:patches/patch-configure]
--- configure.orig	2014-09-28 09:31:41.079343419 +0200
+++ configure	2014-09-28 09:31:41.243342071 +0200
@@ -26730,9 +26728,12 @@
   *android*)
     G_THREAD_LIBS_FOR_GTHREAD="$G_THREAD_LIBS"
     ;;
-  *-*-freebsd*|*-*-linux*)
+  *-*-linux*)
     G_THREAD_LIBS_FOR_GTHREAD="`echo $G_THREAD_LIBS | sed s/-pthread/-lpthread/`"
     ;;
+  *-*-freebsd*)
+    LDFLAGS="$LDFLAGS -pthread"
+    ;;    
   *)
     G_THREAD_LIBS_FOR_GTHREAD="$G_THREAD_LIBS"
     ;;


[FILE:347:patches/patch-docs_reference_Makefile.in]
--- docs/reference/Makefile.in.orig	2013-09-26 18:08:36.000000000 +0200
+++ docs/reference/Makefile.in	2013-09-26 18:08:53.000000000 +0200
@@ -422,7 +422,7 @@
 top_build_prefix = @top_build_prefix@
 top_builddir = @top_builddir@
 top_srcdir = @top_srcdir@
-SUBDIRS = glib gobject gio
+SUBDIRS = #glib gobject gio
 all: all-recursive
 
 .SUFFIXES:


[FILE:670:patches/patch-gio_glib-compile-schemas.c]
--- gio/glib-compile-schemas.c.orig	2012-06-14 16:39:22.000000000 +0200
+++ gio/glib-compile-schemas.c	2012-06-14 16:39:55.000000000 +0200
@@ -1204,11 +1204,13 @@
       return;
     }
 
+#if 0
   if (path && (g_str_has_prefix (path, "/apps/") ||
                g_str_has_prefix (path, "/desktop/") ||
                g_str_has_prefix (path, "/system/")))
     g_printerr ("warning: Schema '%s' has path '%s'.  Paths starting with "
                 "'/apps/', '/desktop/' or '/system/' are deprecated.\n", id, path);
+#endif
 
   state->schema_state = schema_state_new (path, gettext_domain,
                                           extends, extends_name, list_of);


[FILE:661:patches/patch-gio_gunixmount.c]
--- gio/gunixmount.c.orig	2014-09-21 13:00:08.875162804 +0200
+++ gio/gunixmount.c	2014-09-21 13:00:14.327163623 +0200
@@ -353,12 +353,17 @@
                     gpointer             user_data)
 {
   GUnixMount *unix_mount = G_UNIX_MOUNT (mount);
+#if ! defined(__FreeBSD__) && ! defined(__DragonFly__)
   char *argv[] = {"eject", NULL, NULL};
 
   if (unix_mount->mount_path != NULL)
     argv[1] = unix_mount->mount_path;
   else
     argv[1] = unix_mount->device_path;
+#else
+   char *argv[] = {"cdcontrol", "-f", NULL, "eject", NULL};
+   argv[2] = unix_mount->device_path;
+#endif
 
   eject_unmount_do (mount, cancellable, callback, user_data, argv);
 }


[FILE:590:patches/patch-gio_gunixvolume.c]
--- gio/gunixvolume.c.orig	2014-03-20 04:50:45.000000000 +0100
+++ gio/gunixvolume.c	2014-03-24 20:44:40.000000000 +0100
@@ -356,9 +356,14 @@
                      gpointer             user_data)
 {
   GUnixVolume *unix_volume = G_UNIX_VOLUME (volume);
+#if defined(__FreeBSD__) || defined(__DragonFly__)
+  const gchar *argv[] = {"cdcontrol", "-f", NULL, "eject", NULL};
+  argv[2] = unix_volume->device_path;
+#else
   const gchar *argv[] = { "eject", NULL, NULL };
 
   argv[1] = unix_volume->device_path;
+#endif
 
   eject_mount_do (volume, cancellable, callback, user_data, argv);
 }


[FILE:279:patches/patch-gio_tests_include.c]
--- glib/tests/include.c.orig	2012-03-06 12:11:39.000000000 +0100
+++ glib/tests/include.c	2012-03-06 12:13:17.000000000 +0100
@@ -3,6 +3,7 @@
 #define _POSIX_C_SOURCE 0
 #undef _GNU_SOURCE
 #undef _XOPEN_SOURCE
+#include <sys/types.h>
 #include <pthread.h>
 #include <glib.h>
 


[FILE:328:patches/patch-gio_xdgmime_xdgmime.c]
--- gio/xdgmime/xdgmime.c.orig	Mon Nov  8 22:25:27 2004
+++ gio/xdgmime/xdgmime.c	Sat Nov 13 10:27:22 2004
@@ -204,7 +204,7 @@
 
   xdg_data_dirs = getenv ("XDG_DATA_DIRS");
   if (xdg_data_dirs == NULL)
-    xdg_data_dirs = "/usr/local/share/:/usr/share/";
+    xdg_data_dirs = "/usr/local/share/";
 
   ptr = xdg_data_dirs;
 


[FILE:814:patches/patch-gio_xdgmime_xdgmimecache.h]
--- gio/xdgmime/xdgmimecache.h.orig	2008-06-12 10:25:40.000000000 -0400
+++ gio/xdgmime/xdgmimecache.h	2008-06-14 00:49:59.000000000 -0400
@@ -46,6 +46,9 @@ typedef struct _XdgMimeCache XdgMimeCach
 #define _xdg_mime_cache_get_icon                      XDG_RESERVED_ENTRY(cache_get_icon)
 #define _xdg_mime_cache_get_generic_icon              XDG_RESERVED_ENTRY(cache_get_generic_icon)
 #define _xdg_mime_cache_glob_dump                     XDG_RESERVED_ENTRY(cache_glob_dump)
+#define _xdg_mime_cache_is_valid_mime_type            XDG_RESERVED_ENTRY(cache_is_valid_mime_type)
+#define _xdg_mime_cache_mime_type_equal               XDG_RESERVED_ENTRY(cache_mime_type_equal)
+#define _xdg_mime_cache_media_type_equal              XDG_RESERVED_ENTRY(cache_media_type_equal)
 #endif
 
 extern XdgMimeCache **_caches;


[FILE:257:patches/patch-glib_fix_hidden]
--- glib/gmem.c.orig	2011-02-10 00:31:42.000000000 +0100
+++ glib/gmem.c	2011-12-07 00:21:38.000000000 +0100
@@ -39,6 +39,7 @@
 #include "gbacktrace.h"
 #include "gtestutils.h"
 #include "gthread.h"
+#include "gthreadprivate.h"
 #include "glib_trace.h"
 
 


[FILE:582:patches/patch-glib_gconvert.c]
Work around our situation of having both libiconv in libc and libiconv from
ports installed.

--- glib/gconvert.c.orig	2014-02-08 10:15:50.000000000 +0100
+++ glib/gconvert.c	2014-02-08 10:16:52.000000000 +0100
@@ -62,7 +62,7 @@
 #error GNU libiconv in use but included iconv.h not from libiconv
 #endif
 #if !defined(USE_LIBICONV_GNU) && defined (_LIBICONV_H) \
-     && !defined (__APPLE_CC__) && !defined (__LP_64__)
+  && !defined (LIBICONV_PLUG) && !defined (__APPLE_CC__) && !defined (__LP_64__)
 #error GNU libiconv not in use but included iconv.h is from libiconv
 #endif
 


[FILE:762:patches/patch-glib_gutils.c]
--- glib/gutils.c.orig	Wed Mar 23 09:55:02 2005
+++ glib/gutils.c	Thu Apr  7 01:06:16 2005
@@ -1929,7 +1929,7 @@ g_get_system_data_dirs (void)
       data_dirs = (gchar *) g_getenv ("XDG_DATA_DIRS");
 
       if (!data_dirs || !data_dirs[0])
-          data_dirs = "/usr/local/share/:/usr/share/";
+          data_dirs = "/usr/local/share/";
 
       data_dir_vector = g_strsplit (data_dirs, G_SEARCHPATH_SEPARATOR_S, 0);
 #endif
@@ -1983,7 +1983,7 @@ g_get_system_config_dirs (void)
       conf_dirs = (gchar *) g_getenv ("XDG_CONFIG_DIRS");
 
       if (!conf_dirs || !conf_dirs[0])
-          conf_dirs = "/etc/xdg";
+          conf_dirs = "/usr/local/etc/xdg:/etc/xdg";
 
       conf_dir_vector = g_strsplit (conf_dirs, G_SEARCHPATH_SEPARATOR_S, 0);
 #endif


[FILE:321:patches/patch-glib_libcharset_Makefile.in]
--- glib/libcharset/Makefile.in.orig	2010-08-08 12:46:01.000000000 +0200
+++ glib/libcharset/Makefile.in	2010-08-08 12:46:01.000000000 +0200
@@ -566,7 +566,7 @@ install-dvi: install-dvi-am
 
 install-dvi-am:
 
-install-exec-am: install-exec-local
+install-exec-am: # install-exec-local
 
 install-html: install-html-am
 


[FILE:613:patches/patch-glib_tests_gdatetime.c]
--- glib/tests/gdatetime.c.orig	2014-03-09 10:29:13.925231275 +0000
+++ glib/tests/gdatetime.c	2014-03-09 10:30:18.235227107 +0000
@@ -1322,7 +1322,7 @@
   gint i1, i2;
 
 #ifdef G_OS_UNIX
-  tz = g_time_zone_new ("America/Toronto");
+  tz = g_time_zone_new ("America/Toronto Eastern");
 #elif defined G_OS_WIN32
   tz = g_time_zone_new ("Eastern Standard Time");
 #endif
@@ -1355,7 +1355,7 @@
   gint i1, i2;
 
 #ifdef G_OS_UNIX
-  tz = g_time_zone_new ("America/Toronto");
+  tz = g_time_zone_new ("America/Toronto Eastern");
 #elif defined G_OS_WIN32
   tz = g_time_zone_new ("Eastern Standard Time");
 #endif


[FILE:314:patches/patch-glib_tests_utils.c]
--- glib/tests/utils.c.orig	2012-09-24 02:19:54.000000000 +0000
+++ glib/tests/utils.c	2012-09-24 02:20:48.000000000 +0000
@@ -416,7 +416,7 @@
 
   xdg = (gchar *)g_getenv ("XDG_CONFIG_DIRS");
   if (!xdg)
-    xdg = "/etc/xdg";
+    xdg = "/usr/local/etc/xdg:/etc/xdg";
 
   dirs = g_get_system_config_dirs ();
 


[FILE:464:patches/patch-gmodule_gmodule-dl.c]
--- gmodule/gmodule-dl.c.orig	Sat Feb 17 08:28:07 2001
+++ gmodule/gmodule-dl.c	Fri Jan 18 09:48:45 2002
@@ -104,6 +104,7 @@
 static gpointer
 _g_module_self (void)
 {
+#if ! defined(__FreeBSD__) && ! defined(__DragonFly__)
   gpointer handle;
   
   /* to query symbols from the program itself, special link options
@@ -115,6 +116,9 @@
     g_module_set_error (fetch_dlerror (TRUE));
   
   return handle;
+#else
+  return RTLD_DEFAULT;
+#endif
 }
 
 static void


[FILE:460:files/special.mk]
glib_MAN=	gtester.1 gtester-report.1 glib-gettextize.1
gio_MAN=	gdbus.1 gsettings.1 gio-querymodules.1 \
		glib-compile-schemas.1 gapplication.1 \
		glib-compile-resources.1 gresource.1 gdbus-codegen.1
gobject_MAN=	glib-genmarshal.1 glib-mkenums.1 gobject-query.1

POST_PLIST_TARGET=	my-autolist

my-autolist:
	(cd ${STAGEDIR}${PREFIX} && ${FIND} share/glib-2.0/codegen \
	\( -type f -o -type l \) 2>/dev/null | ${SORT}) \
	>> ${WRKDIR}/.manifest.single.mktmp


[FILE:426:dragonfly/patch-configure]
--- configure.orig	2014-11-19 18:13:44.754895000 +0100
+++ configure	2014-11-19 18:13:51.674905000 +0100
@@ -23261,7 +23261,7 @@
 fi
 done
 
-for ac_func in getmntent_r setmntent endmntent hasmntopt getfsstat getvfsstat fallocate
+for ac_func in getmntent_r setmntent endmntent hasmntopt getfsstat fallocate
 do :
   as_ac_var=`$as_echo "ac_cv_func_$ac_func" | $as_tr_sh`
 ac_fn_c_check_func "$LINENO" "$ac_func" "$as_ac_var"

