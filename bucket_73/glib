# Buildsheet autogenerated by ravenadm tool -- Do not edit.

NAMEBASE=		glib
VERSION=		2.62.2
KEYWORDS=		devel
VARIANTS=		standard
SDESC[standard]=	Some useful routines of C programming
HOMEPAGE=		https://www.gtk.org/
CONTACT=		nobody

DOWNLOAD_GROUPS=	main
SITES[main]=		GNOME/glib/2.62
DISTFILE[1]=		glib-2.62.2.tar.xz:main
DIST_SUBDIR=		gnome2
DF_INDEX=		1
SPKGS[standard]=	single

OPTIONS_AVAILABLE=	none
OPTIONS_STANDARD=	none

BUILD_DEPENDS=		xmlto:single:standard
BUILDRUN_DEPENDS=	pcre:static:standard
			pcre:shared:standard
			libffi:single:standard
RUN_DEPENDS=		zlib:static:standard

USES=			gettext-tools gettext-runtime gmake libtool
			perl:build pkgconfig python:build shebangfix zlib
			meson iconv

LICENSE=		LGPL21+:single
LICENSE_TERMS=		single:{{WRKDIR}}/TERMS
LICENSE_FILE=		LGPL21+:{{WRKSRC}}/COPYING
LICENSE_AWK=		TERMS:"__G_LIB_H__"
LICENSE_SOURCE=		TERMS:{{WRKSRC}}/glib/glib.h
LICENSE_SCHEME=		solo

FPC_EQUIVALENT=		devel/glib20
MESON_ARGS=		-Diconv=external
			-Dselinux=disabled
			-Dxattr=false
			-Dlibmount=false
			-Ddtrace=false
			-Dman=true
			-Dgtk_doc=false
			-Dfam=false
			-Dinternal_pcre=false
			-Db_lundef=false
SHEBANG_FILES=		*/*.pl
			{{pyscripts}}

INSTALL_TARGET=		install-strip
INSTALL_REQ_TOOLCHAIN=	yes
PLIST_SUB=		LIBVERSION=0.6200.2
			RESETPREFIX={{PREFIX}}

SET_DEBUGGING_ON=	yes
OPTIMIZER_LEVEL=	0
VAR_OPSYS[darwin]=	MAKE_ENV=DYLD_FALLBACK_LIBRARY_PATH="$$DYLD_FALLBACK_LIBRARY_PATH:{{WRKSRC}}/_build/glib:{{WRKSRC}}/_build/gio:{{WRKSRC}}/_build/gobject:{{WRKSRC}}/_build/gmodule"

post-patch:
	${REINPLACE_CMD} -e 's|/usr/local|${LOCALBASE}|g ; \
		s|/usr/share/locale/locale|${LOCALBASE}/share/locale/locale|g' \
			${WRKSRC}/glib/gutils.c
	${REINPLACE_CMD} -e 's|/usr/local|${LOCALBASE}|g' \
		${WRKSRC}/gio/gunixmounts.c \
		${WRKSRC}/gio/xdgmime/xdgmime.c \
		${WRKSRC}/glib/tests/utils.c
	${REINPLACE_CMD} -e "s|python3|python${PYTHON_VER}|g" \
		-e 's|/docbook.sourceforge.net/|/cdn.docbook.org/|' \
		-e "/'_XOPEN_SOURCE'/d" \
		-e "/-Werror=/d" \
		${WRKSRC}/meson.build
	${REINPLACE_CMD} -e '/_XOPEN_SOURCE/d' \
		${WRKSRC}/glib/tests/strfuncs.c
	for F in ${pyscripts}; do \
		${CHMOD} ${BINMODE} ${WRKSRC}/$$F; \
	done

post-install:
	@${MKDIR} ${STAGEDIR}${PREFIX}/share/GConf/gsettings
	@${MKDIR} ${STAGEDIR}${PREFIX}/lib/gio/modules
	${RM} -r ${STAGEDIR}${PREFIX}/libexec

[FILE:205:descriptions/desc.single]
GLib provides a simple, abstract, and highly portable set of C support
routines such as lists, trees, hashes, memory allocation, and much, much
more.  It is a foundation for writing portable applications.


[FILE:104:distinfo]
698824a413f76df039739c2a78f45b10939d526ae7495bab4e694e6730deb3f1      4682000 gnome2/glib-2.62.2.tar.xz


[FILE:10167:manifests/plist.single]
@comment share/glib-2.0/codegen auto-generated
%%EXCLUDE-DARWIN%%lib/
 libgio-2.0.so.%%LIBVERSION%%
 libglib-2.0.so.%%LIBVERSION%%
 libgmodule-2.0.so.%%LIBVERSION%%
 libgobject-2.0.so.%%LIBVERSION%%
 libgthread-2.0.so.%%LIBVERSION%%
%%ONLY-LINUX%%share/bash-completion/completions/
 gapplication
 gdbus
 gio
 gresource
 gsettings
%%ONLY-SUNOS%%share/bash-completion/completions/
 gapplication
 gdbus
 gio
 gresource
 gsettings
bin/
 gapplication
 gdbus
 gdbus-codegen
 gio
 gio-launch-desktop
 gio-querymodules
 glib-compile-resources
 glib-compile-schemas
 glib-genmarshal
 glib-gettextize
 glib-mkenums
 gobject-query
 gresource
 gsettings
 gtester
 gtester-report
include/gio-unix-2.0/gio/
 gdesktopappinfo.h
 gfiledescriptorbased.h
 gunixconnection.h
 gunixcredentialsmessage.h
 gunixfdlist.h
 gunixfdmessage.h
 gunixinputstream.h
 gunixmounts.h
 gunixoutputstream.h
 gunixsocketaddress.h
include/glib-2.0/
 glib-object.h
 glib-unix.h
 glib.h
 gmodule.h
include/glib-2.0/gio/
 gaction.h
 gactiongroup.h
 gactiongroupexporter.h
 gactionmap.h
 gappinfo.h
 gapplication.h
 gapplicationcommandline.h
 gasyncinitable.h
 gasyncresult.h
 gbufferedinputstream.h
 gbufferedoutputstream.h
 gbytesicon.h
 gcancellable.h
 gcharsetconverter.h
 gcontenttype.h
 gconverter.h
 gconverterinputstream.h
 gconverteroutputstream.h
 gcredentials.h
 gdatagrambased.h
 gdatainputstream.h
 gdataoutputstream.h
 gdbusactiongroup.h
 gdbusaddress.h
 gdbusauthobserver.h
 gdbusconnection.h
 gdbuserror.h
 gdbusinterface.h
 gdbusinterfaceskeleton.h
 gdbusintrospection.h
 gdbusmenumodel.h
 gdbusmessage.h
 gdbusmethodinvocation.h
 gdbusnameowning.h
 gdbusnamewatching.h
 gdbusobject.h
 gdbusobjectmanager.h
 gdbusobjectmanagerclient.h
 gdbusobjectmanagerserver.h
 gdbusobjectproxy.h
 gdbusobjectskeleton.h
 gdbusproxy.h
 gdbusserver.h
 gdbusutils.h
 gdrive.h
 gdtlsclientconnection.h
 gdtlsconnection.h
 gdtlsserverconnection.h
 gemblem.h
 gemblemedicon.h
 gfile.h
 gfileattribute.h
 gfileenumerator.h
 gfileicon.h
 gfileinfo.h
 gfileinputstream.h
 gfileiostream.h
 gfilemonitor.h
 gfilenamecompleter.h
 gfileoutputstream.h
 gfilterinputstream.h
 gfilteroutputstream.h
 gicon.h
 ginetaddress.h
 ginetaddressmask.h
 ginetsocketaddress.h
 ginitable.h
 ginputstream.h
 gio-autocleanups.h
 gio.h
 gioenums.h
 gioenumtypes.h
 gioerror.h
 giomodule.h
 gioscheduler.h
 giostream.h
 giotypes.h
 glistmodel.h
 gliststore.h
 gloadableicon.h
 gmemoryinputstream.h
 gmemoryoutputstream.h
 gmenu.h
 gmenuexporter.h
 gmenumodel.h
 gmount.h
 gmountoperation.h
 gnativesocketaddress.h
 gnativevolumemonitor.h
 gnetworkaddress.h
 gnetworking.h
 gnetworkmonitor.h
 gnetworkservice.h
 gnotification.h
 goutputstream.h
 gpermission.h
 gpollableinputstream.h
 gpollableoutputstream.h
 gpollableutils.h
 gpropertyaction.h
 gproxy.h
 gproxyaddress.h
 gproxyaddressenumerator.h
 gproxyresolver.h
 gremoteactiongroup.h
 gresolver.h
 gresource.h
 gseekable.h
 gsettings.h
 gsettingsbackend.h
 gsettingsschema.h
 gsimpleaction.h
 gsimpleactiongroup.h
 gsimpleasyncresult.h
 gsimpleiostream.h
 gsimplepermission.h
 gsimpleproxyresolver.h
 gsocket.h
 gsocketaddress.h
 gsocketaddressenumerator.h
 gsocketclient.h
 gsocketconnectable.h
 gsocketconnection.h
 gsocketcontrolmessage.h
 gsocketlistener.h
 gsocketservice.h
 gsrvtarget.h
 gsubprocess.h
 gsubprocesslauncher.h
 gtask.h
 gtcpconnection.h
 gtcpwrapperconnection.h
 gtestdbus.h
 gthemedicon.h
 gthreadedsocketservice.h
 gtlsbackend.h
 gtlscertificate.h
 gtlsclientconnection.h
 gtlsconnection.h
 gtlsdatabase.h
 gtlsfiledatabase.h
 gtlsinteraction.h
 gtlspassword.h
 gtlsserverconnection.h
 gvfs.h
 gvolume.h
 gvolumemonitor.h
 gzlibcompressor.h
 gzlibdecompressor.h
include/glib-2.0/glib/
 galloca.h
 garray.h
 gasyncqueue.h
 gatomic.h
 gbacktrace.h
 gbase64.h
 gbitlock.h
 gbookmarkfile.h
 gbytes.h
 gcharset.h
 gchecksum.h
 gconvert.h
 gdataset.h
 gdate.h
 gdatetime.h
 gdir.h
 genviron.h
 gerror.h
 gfileutils.h
 ggettext.h
 ghash.h
 ghmac.h
 ghook.h
 ghostutils.h
 gi18n-lib.h
 gi18n.h
 giochannel.h
 gkeyfile.h
 glib-autocleanups.h
 glist.h
 gmacros.h
 gmain.h
 gmappedfile.h
 gmarkup.h
 gmem.h
 gmessages.h
 gnode.h
 goption.h
 gpattern.h
 gpoll.h
 gprimes.h
 gprintf.h
 gqsort.h
 gquark.h
 gqueue.h
 grand.h
 grcbox.h
 grefcount.h
 grefstring.h
 gregex.h
 gscanner.h
 gsequence.h
 gshell.h
 gslice.h
 gslist.h
 gspawn.h
 gstdio.h
 gstrfuncs.h
 gstring.h
 gstringchunk.h
 gtestutils.h
 gthread.h
 gthreadpool.h
 gtimer.h
 gtimezone.h
 gtrashstack.h
 gtree.h
 gtypes.h
 gunicode.h
 gurifuncs.h
 gutils.h
 guuid.h
 gvariant.h
 gvarianttype.h
 gversion.h
 gversionmacros.h
 gwin32.h
include/glib-2.0/glib/deprecated/
 gallocator.h
 gcache.h
 gcompletion.h
 gmain.h
 grel.h
 gthread.h
include/glib-2.0/gobject/
 gbinding.h
 gboxed.h
 gclosure.h
 genums.h
 glib-enumtypes.h
 glib-types.h
 gmarshal.h
 gobject-autocleanups.h
 gobject.h
 gobjectnotifyqueue.c
 gparam.h
 gparamspecs.h
 gsignal.h
 gsourceclosure.h
 gtype.h
 gtypemodule.h
 gtypeplugin.h
 gvalue.h
 gvaluearray.h
 gvaluecollector.h
 gvaluetypes.h
lib/
 libgio-2.0.so
 libgio-2.0.so.0
 libglib-2.0.so
 libglib-2.0.so.0
 libgmodule-2.0.so
 libgmodule-2.0.so.0
 libgobject-2.0.so
 libgobject-2.0.so.0
 libgthread-2.0.so
 libgthread-2.0.so.0
lib/glib-2.0/include/glibconfig.h
lib/pkgconfig/
 gio-2.0.pc
 gio-unix-2.0.pc
 glib-2.0.pc
 gmodule-2.0.pc
 gmodule-export-2.0.pc
 gmodule-no-export-2.0.pc
 gobject-2.0.pc
 gthread-2.0.pc
share/aclocal/
 glib-2.0.m4
 glib-gettext.m4
 gsettings.m4
share/gdb/auto-load%%RESETPREFIX%%/lib/
 libglib-2.0.so.%%LIBVERSION%%-gdb.py
 libgobject-2.0.so.%%LIBVERSION%%-gdb.py
share/gettext/its/
 gschema.its
 gschema.loc
share/glib-2.0/gdb/
 glib_gdb.py
 gobject_gdb.py
share/glib-2.0/gettext/po/Makefile.in.in
share/glib-2.0/schemas/gschema.dtd
share/glib-2.0/valgrind/glib.supp
share/locale/af/LC_MESSAGES/glib20.mo
share/locale/am/LC_MESSAGES/glib20.mo
share/locale/an/LC_MESSAGES/glib20.mo
share/locale/ar/LC_MESSAGES/glib20.mo
share/locale/as/LC_MESSAGES/glib20.mo
share/locale/ast/LC_MESSAGES/glib20.mo
share/locale/az/LC_MESSAGES/glib20.mo
share/locale/be/LC_MESSAGES/glib20.mo
share/locale/be@latin/LC_MESSAGES/glib20.mo
share/locale/bg/LC_MESSAGES/glib20.mo
share/locale/bn/LC_MESSAGES/glib20.mo
share/locale/bn_IN/LC_MESSAGES/glib20.mo
share/locale/bs/LC_MESSAGES/glib20.mo
share/locale/ca/LC_MESSAGES/glib20.mo
share/locale/ca@valencia/LC_MESSAGES/glib20.mo
share/locale/cs/LC_MESSAGES/glib20.mo
share/locale/cy/LC_MESSAGES/glib20.mo
share/locale/da/LC_MESSAGES/glib20.mo
share/locale/de/LC_MESSAGES/glib20.mo
share/locale/dz/LC_MESSAGES/glib20.mo
share/locale/el/LC_MESSAGES/glib20.mo
share/locale/en@shaw/LC_MESSAGES/glib20.mo
share/locale/en_CA/LC_MESSAGES/glib20.mo
share/locale/en_GB/LC_MESSAGES/glib20.mo
share/locale/eo/LC_MESSAGES/glib20.mo
share/locale/es/LC_MESSAGES/glib20.mo
share/locale/et/LC_MESSAGES/glib20.mo
share/locale/eu/LC_MESSAGES/glib20.mo
share/locale/fa/LC_MESSAGES/glib20.mo
share/locale/fi/LC_MESSAGES/glib20.mo
share/locale/fr/LC_MESSAGES/glib20.mo
share/locale/fur/LC_MESSAGES/glib20.mo
share/locale/ga/LC_MESSAGES/glib20.mo
share/locale/gd/LC_MESSAGES/glib20.mo
share/locale/gl/LC_MESSAGES/glib20.mo
share/locale/gu/LC_MESSAGES/glib20.mo
share/locale/he/LC_MESSAGES/glib20.mo
share/locale/hi/LC_MESSAGES/glib20.mo
share/locale/hr/LC_MESSAGES/glib20.mo
share/locale/hu/LC_MESSAGES/glib20.mo
share/locale/hy/LC_MESSAGES/glib20.mo
share/locale/id/LC_MESSAGES/glib20.mo
share/locale/is/LC_MESSAGES/glib20.mo
share/locale/it/LC_MESSAGES/glib20.mo
share/locale/ja/LC_MESSAGES/glib20.mo
share/locale/ka/LC_MESSAGES/glib20.mo
share/locale/kk/LC_MESSAGES/glib20.mo
share/locale/kn/LC_MESSAGES/glib20.mo
share/locale/ko/LC_MESSAGES/glib20.mo
share/locale/ku/LC_MESSAGES/glib20.mo
share/locale/lt/LC_MESSAGES/glib20.mo
share/locale/lv/LC_MESSAGES/glib20.mo
share/locale/mai/LC_MESSAGES/glib20.mo
share/locale/mg/LC_MESSAGES/glib20.mo
share/locale/mk/LC_MESSAGES/glib20.mo
share/locale/ml/LC_MESSAGES/glib20.mo
share/locale/mn/LC_MESSAGES/glib20.mo
share/locale/mr/LC_MESSAGES/glib20.mo
share/locale/ms/LC_MESSAGES/glib20.mo
share/locale/nb/LC_MESSAGES/glib20.mo
share/locale/nds/LC_MESSAGES/glib20.mo
share/locale/ne/LC_MESSAGES/glib20.mo
share/locale/nl/LC_MESSAGES/glib20.mo
share/locale/nn/LC_MESSAGES/glib20.mo
share/locale/oc/LC_MESSAGES/glib20.mo
share/locale/or/LC_MESSAGES/glib20.mo
share/locale/pa/LC_MESSAGES/glib20.mo
share/locale/pl/LC_MESSAGES/glib20.mo
share/locale/ps/LC_MESSAGES/glib20.mo
share/locale/pt/LC_MESSAGES/glib20.mo
share/locale/pt_BR/LC_MESSAGES/glib20.mo
share/locale/ro/LC_MESSAGES/glib20.mo
share/locale/ru/LC_MESSAGES/glib20.mo
share/locale/rw/LC_MESSAGES/glib20.mo
share/locale/si/LC_MESSAGES/glib20.mo
share/locale/sk/LC_MESSAGES/glib20.mo
share/locale/sl/LC_MESSAGES/glib20.mo
share/locale/sq/LC_MESSAGES/glib20.mo
share/locale/sr/LC_MESSAGES/glib20.mo
share/locale/sr@ije/LC_MESSAGES/glib20.mo
share/locale/sr@latin/LC_MESSAGES/glib20.mo
share/locale/sv/LC_MESSAGES/glib20.mo
share/locale/ta/LC_MESSAGES/glib20.mo
share/locale/te/LC_MESSAGES/glib20.mo
share/locale/tg/LC_MESSAGES/glib20.mo
share/locale/th/LC_MESSAGES/glib20.mo
share/locale/tl/LC_MESSAGES/glib20.mo
share/locale/tr/LC_MESSAGES/glib20.mo
share/locale/tt/LC_MESSAGES/glib20.mo
share/locale/ug/LC_MESSAGES/glib20.mo
share/locale/uk/LC_MESSAGES/glib20.mo
share/locale/vi/LC_MESSAGES/glib20.mo
share/locale/wa/LC_MESSAGES/glib20.mo
share/locale/xh/LC_MESSAGES/glib20.mo
share/locale/yi/LC_MESSAGES/glib20.mo
share/locale/zh_CN/LC_MESSAGES/glib20.mo
share/locale/zh_HK/LC_MESSAGES/glib20.mo
share/locale/zh_TW/LC_MESSAGES/glib20.mo
share/man/man1/
 gapplication.1.gz
 gdbus-codegen.1.gz
 gdbus.1.gz
 gio-querymodules.1.gz
 gio.1.gz
 glib-compile-resources.1.gz
 glib-compile-schemas.1.gz
 glib-genmarshal.1.gz
 glib-gettextize.1.gz
 glib-mkenums.1.gz
 gobject-query.1.gz
 gresource.1.gz
 gsettings.1.gz
 gtester-report.1.gz
 gtester.1.gz
@dir lib/gio/modules
@dir share/GConf/gsettings
@postexec %D/bin/gio-querymodules %D/lib/gio/modules 2>/dev/null || /usr/bin/true
@postexec %D/bin/glib-compile-schemas %D/share/glib-2.0/schemas 2>/dev/null || /usr/bin/true
@postunexec /bin/rm -f %D/share/glib-2.0/schemas/gschemas.compiled || /usr/bin/true


[FILE:631:patches/patch-gio_glib-compile-schemas.c]
--- gio/glib-compile-schemas.c.orig	2019-10-21 17:18:40 UTC
+++ gio/glib-compile-schemas.c
@@ -1232,6 +1232,7 @@ parse_state_start_schema (ParseState  *s
       return;
     }
 
+#if 0
   if (path && (g_str_has_prefix (path, "/apps/") ||
                g_str_has_prefix (path, "/desktop/") ||
                g_str_has_prefix (path, "/system/")))
@@ -1244,6 +1245,7 @@ parse_state_start_schema (ParseState  *s
       g_printerr ("%s\n", message);
       g_free (message);
     }
+#endif
 
   state->schema_state = schema_state_new (path, gettext_domain,
                                           extends, extends_name, list_of);


[FILE:232:patches/patch-gio_glocalfileinfo.c]
--- gio/glocalfileinfo.c.orig	2019-10-21 17:18:40 UTC
+++ gio/glocalfileinfo.c
@@ -22,6 +22,10 @@
 
 #include "config.h"
 
+#ifdef __sun__
+#  define	_POSIX_PTHREAD_SEMANTICS 1
+#endif
+
 #include <glib.h>
 
 #ifdef HAVE_SYS_TIME_H


[FILE:285:patches/patch-gio_gsocket.c]
--- gio/gsocket.c.orig	2019-10-21 17:18:40 UTC
+++ gio/gsocket.c
@@ -56,6 +56,10 @@
 #include <sys/uio.h>
 #endif
 
+#ifdef __sun__
+#define _XPG4_2	1
+#endif
+
 #define GOBJECT_COMPILATION
 #include "gobject/gtype-private.h" /* For _PRELUDE type define */
 #undef GOBJECT_COMPILATION


[FILE:654:patches/patch-gio_gunixmount.c]
--- gio/gunixmount.c.orig	2019-10-21 17:18:40 UTC
+++ gio/gunixmount.c
@@ -356,12 +356,17 @@ g_unix_mount_eject (GMount             *
                     gpointer             user_data)
 {
   GUnixMount *unix_mount = G_UNIX_MOUNT (mount);
+#if ! defined(__FreeBSD__) && ! defined(__DragonFly__)
   char *argv[] = {"eject", NULL, NULL};
 
   if (unix_mount->mount_path != NULL)
     argv[1] = unix_mount->mount_path;
   else
     argv[1] = unix_mount->device_path;
+#else
+   char *argv[] = {"cdcontrol", "-f", NULL, "eject", NULL};
+   argv[2] = unix_mount->device_path;
+#endif
 
   eject_unmount_do (mount, cancellable, callback, user_data, argv);
 }


[FILE:256:patches/patch-gio_gunixmounts.c]
--- gio/gunixmounts.c.orig	2019-10-21 17:18:40 UTC
+++ gio/gunixmounts.c
@@ -63,6 +63,10 @@
 #define O_BINARY 0
 #endif
 
+#ifdef __sun__
+#define mnt_opts	mnt_mntopts
+#endif
+
 #include "gunixmounts.h"
 #include "glocalfileprivate.h"
 #include "gfile.h"


[FILE:571:patches/patch-gio_gunixvolume.c]
--- gio/gunixvolume.c.orig	2019-10-21 17:18:40 UTC
+++ gio/gunixvolume.c
@@ -365,9 +365,14 @@ g_unix_volume_eject (GVolume
                      gpointer             user_data)
 {
   GUnixVolume *unix_volume = G_UNIX_VOLUME (volume);
+#if defined(__FreeBSD__) || defined(__DragonFly__)
+  const gchar *argv[] = {"cdcontrol", "-f", NULL, "eject", NULL};
+  argv[2] = unix_volume->device_path;
+#else
   const gchar *argv[] = { "eject", NULL, NULL };
 
   argv[1] = unix_volume->device_path;
+#endif
 
   eject_mount_do (volume, cancellable, callback, user_data, argv);
 }


[FILE:237:patches/patch-gio_tests_include.c]
--- glib/tests/include.c.orig	2019-10-21 17:18:40 UTC
+++ glib/tests/include.c
@@ -3,6 +3,7 @@
 #define _POSIX_C_SOURCE 199309L
 #undef _GNU_SOURCE
 #undef _XOPEN_SOURCE
+#include <sys/types.h>
 #include <pthread.h>
 #include <glib.h>
 


[FILE:397:patches/patch-gio_xdgmime_xdgmime.c]
--- gio/xdgmime/xdgmime.c.orig	2019-10-21 17:18:40 UTC
+++ gio/xdgmime/xdgmime.c
@@ -235,7 +235,7 @@ xdg_init_dirs (void)
   xdg_data_dirs = getenv ("XDG_DATA_DIRS");
 
   if (xdg_data_dirs == NULL)
-    xdg_data_dirs = "/usr/local/share/:/usr/share/";
+    xdg_data_dirs = "/usr/local/share/";
 
   /* Work out how many dirs weâ€™re dealing with. */
   if (xdg_data_home != NULL || home != NULL)


[FILE:766:patches/patch-gio_xdgmime_xdgmimecache.h]
--- gio/xdgmime/xdgmimecache.h.orig	2019-10-21 17:18:40 UTC
+++ gio/xdgmime/xdgmimecache.h
@@ -44,6 +44,9 @@ typedef struct _XdgMimeCache XdgMimeCach
 #define _xdg_mime_cache_get_icon                      XDG_RESERVED_ENTRY(cache_get_icon)
 #define _xdg_mime_cache_get_generic_icon              XDG_RESERVED_ENTRY(cache_get_generic_icon)
 #define _xdg_mime_cache_glob_dump                     XDG_RESERVED_ENTRY(cache_glob_dump)
+#define _xdg_mime_cache_is_valid_mime_type            XDG_RESERVED_ENTRY(cache_is_valid_mime_type)
+#define _xdg_mime_cache_mime_type_equal               XDG_RESERVED_ENTRY(cache_mime_type_equal)
+#define _xdg_mime_cache_media_type_equal              XDG_RESERVED_ENTRY(cache_media_type_equal)
 #endif
 
 extern XdgMimeCache **_caches;


[FILE:228:patches/patch-glib_fix_hidden]
--- glib/gmem.c.orig	2019-10-21 17:18:40 UTC
+++ glib/gmem.c
@@ -38,6 +38,7 @@
 #include "gbacktrace.h"
 #include "gtestutils.h"
 #include "gthread.h"
+#include "gthreadprivate.h"
 #include "glib_trace.h"
 
 /* notes on macros:


[FILE:803:patches/patch-glib_gutils.c]
--- glib/gutils.c.orig	2019-10-21 17:18:40 UTC
+++ glib/gutils.c
@@ -28,6 +28,10 @@
 
 #include "config.h"
 
+#ifdef __sun__
+#  define	_POSIX_PTHREAD_SEMANTICS 1
+#  undef	HAVE_SYS_AUXV_H
+#endif
 #include "gutils.h"
 #include "gutilsprivate.h"
 
@@ -2067,7 +2071,7 @@ g_build_system_data_dirs (void)
    */
 #ifndef G_OS_WIN32
   if (!data_dirs || !data_dirs[0])
-    data_dirs = "/usr/local/share/:/usr/share/";
+    data_dirs = "/usr/local/share/";
 
   data_dir_vector = g_strsplit (data_dirs, G_SEARCHPATH_SEPARATOR_S, 0);
 #else
@@ -2161,7 +2165,7 @@ g_build_system_config_dirs (void)
     }
 #else
   if (!conf_dirs || !conf_dirs[0])
-    conf_dirs = "/etc/xdg";
+    conf_dirs = "/usr/local/etc/xdg:/etc/xdg";
 
   conf_dir_vector = g_strsplit (conf_dirs, G_SEARCHPATH_SEPARATOR_S, 0);
 #endif


[FILE:615:patches/patch-glib_tests_gdatetime.c]
--- glib/tests/gdatetime.c.orig	2019-10-21 17:18:40 UTC
+++ glib/tests/gdatetime.c
@@ -2267,7 +2267,7 @@ test_find_interval (void)
   gint i1, i2;
 
 #ifdef G_OS_UNIX
-  tz = g_time_zone_new ("America/Toronto");
+  tz = g_time_zone_new ("America/Toronto Eastern");
 #elif defined G_OS_WIN32
   tz = g_time_zone_new ("Eastern Standard Time");
 #endif
@@ -2300,7 +2300,7 @@ test_adjust_time (void)
   gint i1, i2;
 
 #ifdef G_OS_UNIX
-  tz = g_time_zone_new ("America/Toronto");
+  tz = g_time_zone_new ("America/Toronto Eastern");
 #elif defined G_OS_WIN32
   tz = g_time_zone_new ("Eastern Standard Time");
 #endif


[FILE:287:patches/patch-glib_tests_utils.c]
--- glib/tests/utils.c.orig	2019-10-21 17:18:40 UTC
+++ glib/tests/utils.c
@@ -480,7 +480,7 @@ test_xdg_dirs (void)
 
   xdg = (gchar *)g_getenv ("XDG_CONFIG_DIRS");
   if (!xdg)
-    xdg = "/etc/xdg";
+    xdg = "/usr/local/etc/xdg:/etc/xdg";
 
   dirs = g_get_system_config_dirs ();
 


[FILE:500:patches/patch-gmodule_gmodule-dl.c]
--- gmodule/gmodule-dl.c.orig	2019-10-21 17:18:40 UTC
+++ gmodule/gmodule-dl.c
@@ -106,6 +106,7 @@ _g_module_open (const gchar *file_name,
 static gpointer
 _g_module_self (void)
 {
+#if ! defined(__FreeBSD__) && ! defined(__DragonFly__)
   gpointer handle;
   
   /* to query symbols from the program itself, special link options
@@ -128,6 +129,9 @@ _g_module_self (void)
     g_module_set_error (fetch_dlerror (TRUE));
   
   return handle;
+#else
+  return RTLD_DEFAULT;
+#endif
 }
 
 static void


[FILE:638:patches/patch-m4macros_attributes.m4]
--- m4macros/attributes.m4.orig	2019-10-21 17:18:40 UTC
+++ m4macros/attributes.m4
@@ -86,7 +86,7 @@ AC_DEFUN([CC_NOUNDEFINED], [
      dnl FreeBSD (et al.) does not complete linking for shared objects when pthreads
      dnl are requested, as different implementations are present; to avoid problems
      dnl use -Wl,-z,defs only for those platform not behaving this way.
-     *-freebsd* | *-openbsd*) ;;
+     *-freebsd* | *-openbsd* | *-dragonfly*) ;;
      *)
         dnl First of all check for the --no-undefined variant of GNU ld. This allows
         dnl for a much more readable commandline, so that people can understand what


[FILE:624:files/special.mk]
glib_MAN=	gtester.1 gtester-report.1 glib-gettextize.1
gio_MAN=	gdbus.1 gsettings.1 gio-querymodules.1 \
		glib-compile-schemas.1 gapplication.1 \
		glib-compile-resources.1 gresource.1 gdbus-codegen.1
gobject_MAN=	glib-genmarshal.1 glib-mkenums.1 gobject-query.1
pyscripts=	gio/tests/gengiotypefuncs.py \
		gio/gio-querymodules-wrapper.py \
		glib/update-gtranslit.py \
		tests/gen-casefold-txt.py \
		tests/gen-casemap-txt.py

POST_PLIST_TARGET=	my-autolist

my-autolist:
	(cd ${STAGEDIR}${PREFIX} && ${FIND} share/glib-2.0/codegen \
	\( -type f -o -type l \) 2>/dev/null | ${SORT}) \
	>> ${WRKDIR}/.manifest.single.mktmp


[FILE:837:dragonfly/patch-meson.build]
--- meson.build.orig	2019-10-21 17:18:40 UTC
+++ meson.build
@@ -1838,10 +1838,6 @@ endif
 # proxy-libintl subproject.
 # FIXME: glib-gettext.m4 has much more checks to detect broken/uncompatible
 # implementations. This could be extended if issues are found in some platforms.
-if cc.has_function('ngettext')
-  libintl = []
-  have_bind_textdomain_codeset = cc.has_function('bind_textdomain_codeset')
-else
   libintl = cc.find_library('intl', required : false)
   if not libintl.found()
     libintl = subproject('proxy-libintl').get_variable('intl_dep')
@@ -1850,7 +1846,6 @@ else
     have_bind_textdomain_codeset = cc.has_function('bind_textdomain_codeset',
                                                    dependencies : libintl)
   endif
-endif
 
 glib_conf.set('HAVE_BIND_TEXTDOMAIN_CODESET', have_bind_textdomain_codeset)
 


[FILE:837:freebsd/patch-meson.build]
--- meson.build.orig	2019-10-21 17:18:40 UTC
+++ meson.build
@@ -1838,10 +1838,6 @@ endif
 # proxy-libintl subproject.
 # FIXME: glib-gettext.m4 has much more checks to detect broken/uncompatible
 # implementations. This could be extended if issues are found in some platforms.
-if cc.has_function('ngettext')
-  libintl = []
-  have_bind_textdomain_codeset = cc.has_function('bind_textdomain_codeset')
-else
   libintl = cc.find_library('intl', required : false)
   if not libintl.found()
     libintl = subproject('proxy-libintl').get_variable('intl_dep')
@@ -1850,7 +1846,6 @@ else
     have_bind_textdomain_codeset = cc.has_function('bind_textdomain_codeset',
                                                    dependencies : libintl)
   endif
-endif
 
 glib_conf.set('HAVE_BIND_TEXTDOMAIN_CODESET', have_bind_textdomain_codeset)
 


[FILE:1695:sunos/patch-gio_tests_meson.build]
--- gio/tests/meson.build.orig	2018-12-18 14:51:13 UTC
+++ gio/tests/meson.build
@@ -25,6 +25,8 @@ giotypefuncs_inc = custom_target(
   input : gio_headers + [gioenumtypes_h] + gobject_install_headers,
   command: [gengiotypefuncs_prog, '@OUTPUT@', '@INPUT@'])
 
+sun_socket = cc.find_library('socket')
+
 #  Test programs buildable on all platforms
 # FIXME: We are using list of dictionnaries until we can depend on Meson 0.48.0
 # that supports '+=' operator on dictionnaries.
@@ -67,7 +69,7 @@ gio_tests = [{
   'simple-async-result' : {},
   'simple-proxy' : {},
   'sleepy-stream' : {},
-  'socket' : {},
+  'socket' : { 'dependencies' : [sun_socket] },
   'socket-listener' : {},
   'socket-service' : {},
   'srvtarget' : {},
@@ -129,11 +131,11 @@ if host_machine.system() != 'windows'
       'dependencies' : [libgdbus_example_objectmanager_dep],
       'install_rpath' : installed_tests_execdir
     },
-    'gdbus-peer-object-manager' : {},
+    'gdbus-peer-object-manager' : {'dependencies' : [sun_socket]},
     'live-g-file' : {},
     'socket-address' : {},
-    'stream-rw_all' : {},
-    'unix-fd' : {},
+    'stream-rw_all' : {'dependencies' : [sun_socket]},
+    'unix-fd' : {'dependencies' : [sun_socket]},
     'unix-mounts' : {},
     'unix-streams' : {},
     'g-file-info-filesystem-readonly' : {},
@@ -285,7 +287,7 @@ if host_machine.system() != 'windows'
   # This test is currently unreliable
   executable('gdbus-overflow', 'gdbus-overflow.c',
       c_args : test_c_args,
-      dependencies : common_gio_tests_deps,
+      dependencies : [common_gio_tests_deps, sun_socket],
       install_dir : installed_tests_execdir,
       install : installed_tests_enabled)
 


[FILE:837:sunos/patch-meson.build]
--- meson.build.orig	2018-12-18 14:51:14 UTC
+++ meson.build
@@ -1771,10 +1771,6 @@ endif
 # proxy-libintl subproject.
 # FIXME: glib-gettext.m4 has much more checks to detect broken/uncompatible
 # implementations. This could be extended if issues are found in some platforms.
-if cc.has_function('ngettext')
-  libintl = []
-  have_bind_textdomain_codeset = cc.has_function('bind_textdomain_codeset')
-else
   libintl = cc.find_library('intl', required : false)
   if not libintl.found()
     libintl = subproject('proxy-libintl').get_variable('intl_dep')
@@ -1783,7 +1779,6 @@ else
     have_bind_textdomain_codeset = cc.has_function('bind_textdomain_codeset',
                                                    dependencies : libintl)
   endif
-endif
 
 glib_conf.set('HAVE_BIND_TEXTDOMAIN_CODESET', have_bind_textdomain_codeset)
 


[FILE:368:sunos/patch-tests_meson.build]
--- tests/meson.build.orig	2018-12-18 14:51:14 UTC
+++ tests/meson.build
@@ -45,10 +45,6 @@ tests = [{
   'type-test' : {},
   'unicode-caseconv' : {},
   'unicode-encoding' : {},
-  'module-test' : {
-    'dependencies' : [libgmodule_dep],
-    'export_dynamic' : true,
-  },
   'cxx-test' : {
     'source' : 'cxx-test.cpp',
     'include_directories' : gmoduleinc,


[FILE:2798:darwin/patch-meson.build]
--- meson.build.orig	2018-12-18 14:51:14 UTC
+++ meson.build
@@ -609,42 +609,23 @@ glib_have_os_x_9_or_later = false
 glib_have_carbon = false
 glib_have_cocoa = false
 if host_system == 'darwin'
-  add_languages('objc')
-  objcc = meson.get_compiler('objc')
 
   osx_ldflags += ['-Wl,-framework,CoreFoundation']
 
-  # Mac OS X Carbon support
-  glib_have_carbon = objcc.compiles('''#include <Carbon/Carbon.h>
-                                       #include <CoreServices/CoreServices.h>''',
-                                    name : 'Mac OS X Carbon support')
+  glib_have_carbon = false
+  glib_have_cocoa = false 
+  glib_have_os_x_9_or_later = true
 
   if glib_have_carbon
     glib_conf.set('HAVE_CARBON', true)
     osx_ldflags += '-Wl,-framework,Carbon'
-    glib_have_os_x_9_or_later = objcc.compiles('''#include <AvailabilityMacros.h>
-                                                  #if MAC_OS_X_VERSION_MIN_REQUIRED < 1090
-                                                  #error Compiling for minimum OS X version before 10.9
-                                                  #endif''',
-                                               name : 'OS X 9 or later')
   endif
 
-  # Mac OS X Cocoa support
-  glib_have_cocoa = objcc.compiles('''#include <Cocoa/Cocoa.h>
-                                      #ifdef GNUSTEP_BASE_VERSION
-                                      #error "Detected GNUstep, not Cocoa"
-                                      #endif''',
-                                   name : 'Mac OS X Cocoa support')
-
   if glib_have_cocoa
     glib_conf.set('HAVE_COCOA', true)
     osx_ldflags += ['-Wl,-framework,Foundation', '-Wl,-framework,AppKit']
   endif
 
-  # FIXME: libgio mix C and objC source files and there is no way to reliably
-  # know which language flags it's going to use to link. Add to both languages
-  # for now. See https://github.com/mesonbuild/meson/issues/3585.
-  add_project_link_arguments(osx_ldflags, language : ['objc', 'c'])
 endif
 
 # Check for futex(2)
@@ -1771,10 +1752,6 @@ endif
 # proxy-libintl subproject.
 # FIXME: glib-gettext.m4 has much more checks to detect broken/uncompatible
 # implementations. This could be extended if issues are found in some platforms.
-if cc.has_function('ngettext')
-  libintl = []
-  have_bind_textdomain_codeset = cc.has_function('bind_textdomain_codeset')
-else
   libintl = cc.find_library('intl', required : false)
   if not libintl.found()
     libintl = subproject('proxy-libintl').get_variable('intl_dep')
@@ -1783,7 +1760,6 @@ else
     have_bind_textdomain_codeset = cc.has_function('bind_textdomain_codeset',
                                                    dependencies : libintl)
   endif
-endif
 
 glib_conf.set('HAVE_BIND_TEXTDOMAIN_CODESET', have_bind_textdomain_codeset)
 

