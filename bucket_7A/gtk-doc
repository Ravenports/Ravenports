# Buildsheet autogenerated by ravenadm tool -- Do not edit.

NAMEBASE=		gtk-doc
VERSION=		1.26
REVISION=		1
KEYWORDS=		textproc
VARIANTS=		standard
SDESC[standard]=	GTK+ DocBook Documentation Generator
HOMEPAGE=		https://www.gtk.org/gtk-doc/
CONTACT=		nobody

DOWNLOAD_GROUPS=	main
SITES[main]=		GNOME/gtk-doc/1.26
DISTFILE[1]=		gtk-doc-1.26.tar.xz:main
DF_INDEX=		1
SPKGS[standard]=	single

OPTIONS_AVAILABLE=	none
OPTIONS_STANDARD=	none

BUILD_DEPENDS=		itstool:single:standard
BUILDRUN_DEPENDS=	jade:primary:standard
			docbook-xml:single:standard
			docbook-xsl:primary:standard
			rarian:single:standard

USES=			gmake gettext-tools perl pkgconfig python
GNOME_COMPONENTS=	libxslt

FPC_EQUIVALENT=		textproc/gtk-doc

MUST_CONFIGURE=		gnu
CONFIGURE_ARGS=		--with-xml-catalog={{LOCALBASE}}/share/xml/catalog.ports
			--localstatedir={{PREFIX}}/share
CONFIGURE_ENV=		GTKDOC="false"

MAKE_ARGS=		pkgconfigdir={{PREFIX}}/lib/pkgconfig

post-patch:
	${REINPLACE_CMD} -e 's/docbook.sourceforge.net/cdn.docbook.org/' \
		${WRKSRC}/configure
	# itstool segfaults on french and chinese documentation
	${REINPLACE_CMD} \
		-e '/HELP_LINGUAS =/ s/ fr / /' \
		-e '/HELP_LINGUAS =/ s/ zh_CN//' \
		${WRKSRC}/help/manual/Makefile.in

[FILE:129:descriptions/desc.single]
This package automatically generates DocBook documentation for GTK+ and
Gnome, and converts the DocBook documentation into HTML.


[FILE:98:distinfo]
bff3f44467b1d39775e94fad545f050faa7e8d68dc6a31aef5024ba3c2d7f2b7       706432 gtk-doc-1.26.tar.xz


[FILE:1608:manifests/plist.single]
bin/
 gtkdoc-check
 gtkdoc-depscan
 gtkdoc-fixxref
 gtkdoc-mkdb
 gtkdoc-mkhtml
 gtkdoc-mkman
 gtkdoc-mkpdf
 gtkdoc-rebase
 gtkdoc-scan
 gtkdoc-scangobj
 gtkdocize
lib/cmake/GtkDoc/
 GtkDocConfig.cmake
 GtkDocConfigVersion.cmake
 GtkDocScanGObjWrapper.cmake
lib/pkgconfig/gtk-doc.pc
share/aclocal/gtk-doc.m4
share/gtk-doc/data/
 devhelp2.xsd
 devhelp2.xsl
 gtk-doc.flat.make
 gtk-doc.make
 gtk-doc.xsl
 home.png
 left-insensitive.png
 left.png
 right-insensitive.png
 right.png
 style.css
 up-insensitive.png
 up.png
 version-greater-or-equal.xsl
share/gtk-doc/python/gtkdoc/
 __init__.py
 check.py
 common.py
 config.py
 fixxref.py
 md_to_db.py
 mkdb.py
 mkhtml.py
 mkman.py
 mkpdf.py
 rebase.py
 scan.py
 scangobj.py
share/help/C/gtk-doc-manual/
 fdl-appendix.xml
 index.docbook
share/help/bn_IN/gtk-doc-manual/
 fdl-appendix.xml
 index.docbook
share/help/cs/gtk-doc-manual/
 fdl-appendix.xml
 index.docbook
share/help/de/gtk-doc-manual/
 fdl-appendix.xml
 index.docbook
share/help/el/gtk-doc-manual/
 fdl-appendix.xml
 index.docbook
share/help/en_GB/gtk-doc-manual/
 fdl-appendix.xml
 index.docbook
share/help/es/gtk-doc-manual/
 fdl-appendix.xml
 index.docbook
share/help/gl/gtk-doc-manual/
 fdl-appendix.xml
 index.docbook
share/help/gu/gtk-doc-manual/
 fdl-appendix.xml
 index.docbook
share/help/pt_BR/gtk-doc-manual/
 fdl-appendix.xml
 index.docbook
share/help/sl/gtk-doc-manual/
 fdl-appendix.xml
 index.docbook
share/help/sv/gtk-doc-manual/
 fdl-appendix.xml
 index.docbook
share/help/ta/gtk-doc-manual/
 fdl-appendix.xml
 index.docbook
share/help/te/gtk-doc-manual/
 fdl-appendix.xml
 index.docbook


[FILE:2730:patches/patch-dont-choke-on-utf8]
From f4e102a45feb94030002f102f3ef6474401bcd1a Mon Sep 17 00:00:00 2001
Message-Id: <f4e102a45feb94030002f102f3ef6474401bcd1a.1502882026.git.jan.steffens@gmail.com>
From: "Jan Alexander Steffens (heftig)" <jan.steffens@gmail.com>
Date: Wed, 16 Aug 2017 13:00:09 +0200
Subject: [PATCH] gtkdoc: Don't immediately choke on non-UTF-8 files

---
 gtkdoc/mkdb.py | 13 +++++++++++--
 gtkdoc/scan.py | 12 ++++++++++--
 2 files changed, 21 insertions(+), 4 deletions(-)

diff --git gtkdoc/mkdb.py gtkdoc/mkdb.py
index e103138f3dc6ede4..382195df6348c6a5 100644
--- gtkdoc/mkdb.py
+++ gtkdoc/mkdb.py
@@ -24,7 +24,7 @@ Creates the DocBook files from the source comments.
 """
 
 from __future__ import print_function
-from six import iteritems, iterkeys
+from six import iteritems, iterkeys, PY2
 
 from collections import OrderedDict
 import logging
@@ -3665,18 +3665,27 @@ def ScanSourceFile(ifile, ignore_files):
 
     logging.info("Scanning source file: %s", ifile)
 
-    SRCFILE = open(ifile)
+    SRCFILE = open(ifile, 'rb')
     in_comment_block = False
     symbol = None
     in_part = ''
     description = ''
     return_desc = ''
     since_desc = stability_desc = deprecated_desc = ''
     params = OrderedDict()
     param_name = None
     line_number = 0
     for line in SRCFILE:
         line_number += 1
+
+        # FIXME Make a better effort at scanning non-UTF-8 files
+        if not PY2:
+            try:
+                line = line.decode()
+            except UnicodeDecodeError:
+                logging.warn('Skipping non-UTF-8 line: %r', line)
+                continue
+
         # Look for the start of a comment block.
         if not in_comment_block:
             if re.search(r'^\s*/\*.*\*/', line):
diff --git gtkdoc/scan.py gtkdoc/scan.py
index 084351959ba9c700..e8b88e8e88bda7ee 100644
--- gtkdoc/scan.py
+++ gtkdoc/scan.py
@@ -34,7 +34,7 @@ organized into sections ready to output the XML pages.
 """
 
 from __future__ import print_function
-from six import iteritems, iterkeys
+from six import iteritems, iterkeys, PY2
 
 import logging
 import os
@@ -226,7 +226,15 @@ def ScanHeader(input_file, section_list, decl_list, get_types, options):
 
     logging.info('Scanning %s', input_file)
 
-    for line in open(input_file):
+    for line in open(input_file, 'rb'):
+        # FIXME Make a better effort at scanning non-UTF-8 files
+        if not PY2:
+            try:
+                line = line.decode()
+            except UnicodeDecodeError:
+                logging.warn('Skipping non-UTF-8 line: %r', line)
+                continue
+
         # If this is a private header, skip it.
         if re.search(r'%^\s*/\*\s*<\s*private_header\s*>\s*\*/', line):
             return
-- 
2.14.1


