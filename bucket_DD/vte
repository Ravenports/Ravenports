# Buildsheet autogenerated by ravenadm tool -- Do not edit.

NAMEBASE=		vte
VERSION=		0.76.2
KEYWORDS=		x11_toolkits
VARIANTS=		standard
SDESC[standard]=	Virtual Terminal Emulator widget
HOMEPAGE=		https://wiki.gnome.org/Apps/Terminal/VTE
CONTACT=		nobody

DOWNLOAD_GROUPS=	main
SITES[main]=		https://gitlab.gnome.org/GNOME/vte/-/archive/0.76.2/
DISTFILE[1]=		vte-0.76.2.tar.bz2:main
DIST_SUBDIR=		gnome3
DF_INDEX=		1
SPKGS[standard]=	complete
			primary
			dev
			docs
			nls

OPTIONS_AVAILABLE=	INTROSPECTION
OPTIONS_STANDARD=	INTROSPECTION

BUILD_DEPENDS=		bash:primary:standard
			cmake:primary:standard
			gnutls:dev:standard
			harfbuzz:dev:standard
			icu:dev:standard
			lz4:dev:standard
			nettle:dev:standard
			vala:single:standard
BUILDRUN_DEPENDS=	gnutls:primary:standard
			icu:primary:standard
			lz4:primary:standard

USES=			meson pkgconfig pcre2
GNOME_COMPONENTS=	cairo gdkpixbuf gtk3 gtk4 intltool

LICENSE=		LGPL3+:primary
LICENSE_TERMS=		primary:{{WRKDIR}}/TERMS
LICENSE_FILE=		LGPL3+:{{WRKSRC}}/COPYING.LGPL3
LICENSE_AWK=		TERMS:"^$$"
LICENSE_SOURCE=		TERMS:{{WRKSRC}}/src/vte.cc
LICENSE_SCHEME=		solo

FPC_EQUIVALENT=		x11-toolkits/vte3
MESON_ARGS=		-D_systemd=false

INSTALL_TARGET=		install-strip
INSTALL_REQ_TOOLCHAIN=	yes
SOVERSION=		0.7600.2
PLIST_SUB=		VERSION=2.91

VAR_OPSYS[sunos]=	LDFLAGS=-lintl

[INTROSPECTION].DESCRIPTION=		Build vala bindings with introspection
[INTROSPECTION].CONFIGURE_ARGS_OFF=	-Dgir=false
					-Dvapi=false
[INTROSPECTION].CONFIGURE_ARGS_ON=	-Dgir=true
					-Dvapi=true
[INTROSPECTION].GNOME_COMPONENTS_ON=	introspection

pre-configure:
	${REINPLACE_CMD} -e '/fstack-prot/d' ${WRKSRC}/meson.build
	${REINPLACE_CMD} -e 's|linux|skipx|' ${WRKSRC}/src/pty.cc

pre-configure-sunos:
	${REINPLACE_CMD} \
		-e 's|sys/ioctl\.h|sys/termios.h|' \
		-e '/Bsymbolic-functions/d' \
		${WRKSRC}/meson.build

[FILE:108:descriptions/desc.primary]
Terminal widget with improved font, internationalisation and accessibility
support for the GNOME 3 desktop.


[FILE:104:distinfo]
a6bd96e4ff2b8f21ce8627c554627077b9b24f4cb84bc2465cbe9625e6a657fc       564560 gnome3/vte-0.76.2.tar.bz2


[FILE:592:manifests/plist.primary]
%%INTROSPECTION-ON%%lib/girepository-1.0/Vte-%%VERSION%%.typelib
%%INTROSPECTION-ON%%share/gir-1.0/Vte-%%VERSION%%.gir
%%INTROSPECTION-ON%%share/vala/vapi/
 vte-%%VERSION%%.deps
 vte-%%VERSION%%.vapi
bin/
 vte-%%VERSION%%
 vte-%%VERSION%%-gtk4
etc/profile.d/
 vte.csh
 vte.sh
lib/
 libvte-%%VERSION%%-gtk4.so.%%SOMAJOR%%
 libvte-%%VERSION%%.so.%%SOMAJOR%%
 libvte-%%VERSION%%.so.%%SOVERSION%%
libexec/vte-urlencode-cwd
share/glade/catalogs/vte-%%VERSION%%.xml
share/glade/pixmaps/hicolor/16x16/actions/widget-vte-terminal.png
share/glade/pixmaps/hicolor/22x22/actions/widget-vte-terminal.png


[FILE:493:manifests/plist.dev]
include/vte-%%VERSION%%-gtk4/vte/
 vte.h
 vtedeprecated.h
 vteenums.h
 vteglobals.h
 vtemacros.h
 vtepty.h
 vteregex.h
 vteterminal.h
 vtetypebuiltins-gtk4.h
 vtetypebuiltins.h
 vteversion.h
include/vte-%%VERSION%%/vte/
 vte.h
 vtedeprecated.h
 vteenums.h
 vteglobals.h
 vtemacros.h
 vtepty.h
 vteregex.h
 vteterminal.h
 vtetypebuiltins-gtk3.h
 vtetypebuiltins.h
 vteversion.h
lib/
 libvte-%%VERSION%%-gtk4.so
 libvte-%%VERSION%%.so
lib/pkgconfig/
 vte-%%VERSION%%-gtk4.pc
 vte-%%VERSION%%.pc


[FILE:4669:manifests/plist.nls]
share/locale/ab/LC_MESSAGES/vte-%%VERSION%%.mo
share/locale/am/LC_MESSAGES/vte-%%VERSION%%.mo
share/locale/an/LC_MESSAGES/vte-%%VERSION%%.mo
share/locale/ang/LC_MESSAGES/vte-%%VERSION%%.mo
share/locale/ar/LC_MESSAGES/vte-%%VERSION%%.mo
share/locale/as/LC_MESSAGES/vte-%%VERSION%%.mo
share/locale/ast/LC_MESSAGES/vte-%%VERSION%%.mo
share/locale/az/LC_MESSAGES/vte-%%VERSION%%.mo
share/locale/be/LC_MESSAGES/vte-%%VERSION%%.mo
share/locale/be@latin/LC_MESSAGES/vte-%%VERSION%%.mo
share/locale/bg/LC_MESSAGES/vte-%%VERSION%%.mo
share/locale/bn/LC_MESSAGES/vte-%%VERSION%%.mo
share/locale/bn_IN/LC_MESSAGES/vte-%%VERSION%%.mo
share/locale/bs/LC_MESSAGES/vte-%%VERSION%%.mo
share/locale/ca/LC_MESSAGES/vte-%%VERSION%%.mo
share/locale/ca@valencia/LC_MESSAGES/vte-%%VERSION%%.mo
share/locale/ckb/LC_MESSAGES/vte-%%VERSION%%.mo
share/locale/cs/LC_MESSAGES/vte-%%VERSION%%.mo
share/locale/cy/LC_MESSAGES/vte-%%VERSION%%.mo
share/locale/da/LC_MESSAGES/vte-%%VERSION%%.mo
share/locale/de/LC_MESSAGES/vte-%%VERSION%%.mo
share/locale/dz/LC_MESSAGES/vte-%%VERSION%%.mo
share/locale/el/LC_MESSAGES/vte-%%VERSION%%.mo
share/locale/en@shaw/LC_MESSAGES/vte-%%VERSION%%.mo
share/locale/en_CA/LC_MESSAGES/vte-%%VERSION%%.mo
share/locale/en_GB/LC_MESSAGES/vte-%%VERSION%%.mo
share/locale/eo/LC_MESSAGES/vte-%%VERSION%%.mo
share/locale/es/LC_MESSAGES/vte-%%VERSION%%.mo
share/locale/et/LC_MESSAGES/vte-%%VERSION%%.mo
share/locale/eu/LC_MESSAGES/vte-%%VERSION%%.mo
share/locale/fa/LC_MESSAGES/vte-%%VERSION%%.mo
share/locale/fi/LC_MESSAGES/vte-%%VERSION%%.mo
share/locale/fr/LC_MESSAGES/vte-%%VERSION%%.mo
share/locale/fur/LC_MESSAGES/vte-%%VERSION%%.mo
share/locale/ga/LC_MESSAGES/vte-%%VERSION%%.mo
share/locale/gd/LC_MESSAGES/vte-%%VERSION%%.mo
share/locale/gl/LC_MESSAGES/vte-%%VERSION%%.mo
share/locale/gu/LC_MESSAGES/vte-%%VERSION%%.mo
share/locale/he/LC_MESSAGES/vte-%%VERSION%%.mo
share/locale/hi/LC_MESSAGES/vte-%%VERSION%%.mo
share/locale/hr/LC_MESSAGES/vte-%%VERSION%%.mo
share/locale/hu/LC_MESSAGES/vte-%%VERSION%%.mo
share/locale/id/LC_MESSAGES/vte-%%VERSION%%.mo
share/locale/is/LC_MESSAGES/vte-%%VERSION%%.mo
share/locale/it/LC_MESSAGES/vte-%%VERSION%%.mo
share/locale/ja/LC_MESSAGES/vte-%%VERSION%%.mo
share/locale/ka/LC_MESSAGES/vte-%%VERSION%%.mo
share/locale/kk/LC_MESSAGES/vte-%%VERSION%%.mo
share/locale/kn/LC_MESSAGES/vte-%%VERSION%%.mo
share/locale/ko/LC_MESSAGES/vte-%%VERSION%%.mo
share/locale/ku/LC_MESSAGES/vte-%%VERSION%%.mo
share/locale/ky/LC_MESSAGES/vte-%%VERSION%%.mo
share/locale/li/LC_MESSAGES/vte-%%VERSION%%.mo
share/locale/lt/LC_MESSAGES/vte-%%VERSION%%.mo
share/locale/lv/LC_MESSAGES/vte-%%VERSION%%.mo
share/locale/mai/LC_MESSAGES/vte-%%VERSION%%.mo
share/locale/mi/LC_MESSAGES/vte-%%VERSION%%.mo
share/locale/mjw/LC_MESSAGES/vte-%%VERSION%%.mo
share/locale/mk/LC_MESSAGES/vte-%%VERSION%%.mo
share/locale/ml/LC_MESSAGES/vte-%%VERSION%%.mo
share/locale/mn/LC_MESSAGES/vte-%%VERSION%%.mo
share/locale/mr/LC_MESSAGES/vte-%%VERSION%%.mo
share/locale/ms/LC_MESSAGES/vte-%%VERSION%%.mo
share/locale/nb/LC_MESSAGES/vte-%%VERSION%%.mo
share/locale/nds/LC_MESSAGES/vte-%%VERSION%%.mo
share/locale/ne/LC_MESSAGES/vte-%%VERSION%%.mo
share/locale/nl/LC_MESSAGES/vte-%%VERSION%%.mo
share/locale/nn/LC_MESSAGES/vte-%%VERSION%%.mo
share/locale/oc/LC_MESSAGES/vte-%%VERSION%%.mo
share/locale/or/LC_MESSAGES/vte-%%VERSION%%.mo
share/locale/pa/LC_MESSAGES/vte-%%VERSION%%.mo
share/locale/pl/LC_MESSAGES/vte-%%VERSION%%.mo
share/locale/pt/LC_MESSAGES/vte-%%VERSION%%.mo
share/locale/pt_BR/LC_MESSAGES/vte-%%VERSION%%.mo
share/locale/ro/LC_MESSAGES/vte-%%VERSION%%.mo
share/locale/ru/LC_MESSAGES/vte-%%VERSION%%.mo
share/locale/rw/LC_MESSAGES/vte-%%VERSION%%.mo
share/locale/si/LC_MESSAGES/vte-%%VERSION%%.mo
share/locale/sk/LC_MESSAGES/vte-%%VERSION%%.mo
share/locale/sl/LC_MESSAGES/vte-%%VERSION%%.mo
share/locale/sq/LC_MESSAGES/vte-%%VERSION%%.mo
share/locale/sr/LC_MESSAGES/vte-%%VERSION%%.mo
share/locale/sr@latin/LC_MESSAGES/vte-%%VERSION%%.mo
share/locale/sv/LC_MESSAGES/vte-%%VERSION%%.mo
share/locale/ta/LC_MESSAGES/vte-%%VERSION%%.mo
share/locale/te/LC_MESSAGES/vte-%%VERSION%%.mo
share/locale/tg/LC_MESSAGES/vte-%%VERSION%%.mo
share/locale/th/LC_MESSAGES/vte-%%VERSION%%.mo
share/locale/tr/LC_MESSAGES/vte-%%VERSION%%.mo
share/locale/ug/LC_MESSAGES/vte-%%VERSION%%.mo
share/locale/uk/LC_MESSAGES/vte-%%VERSION%%.mo
share/locale/uz@cyrillic/LC_MESSAGES/vte-%%VERSION%%.mo
share/locale/vi/LC_MESSAGES/vte-%%VERSION%%.mo
share/locale/wa/LC_MESSAGES/vte-%%VERSION%%.mo
share/locale/xh/LC_MESSAGES/vte-%%VERSION%%.mo
share/locale/zh_CN/LC_MESSAGES/vte-%%VERSION%%.mo
share/locale/zh_HK/LC_MESSAGES/vte-%%VERSION%%.mo
share/locale/zh_TW/LC_MESSAGES/vte-%%VERSION%%.mo


[FILE:345:patches/patch-meson.build]
--- meson.build.orig	2024-05-24 22:08:22 UTC
+++ meson.build
@@ -239,6 +239,10 @@ elif system == 'darwin'
     ['_DARWIN_C_SOURCE', '1'],
   ]
 
+elif system == 'dragonfly'
+  libc_feature_defines = []
+elif system == 'midnightbsd'
+  libc_feature_defines = []
 elif system == 'netbsd'
   libc_feature_defines += [
     ['_NETBSD_SOURCE', '1'],


[FILE:703:patches/patch-src_app_app.cc]
--- src/app/app.cc.orig	2024-05-24 22:08:22 UTC
+++ src/app/app.cc
@@ -3862,7 +3862,15 @@ main(int argc,
                struct termios tcattr;
                if (tcgetattr(STDIN_FILENO, &tcattr) == 0) {
                        saved_tcattr = tcattr;
+#ifdef __sun__
+	tcattr.c_iflag &= ~(IMAXBEL|IGNBRK|BRKINT|PARMRK|ISTRIP|INLCR|IGNCR|ICRNL|IXON);
+	tcattr.c_oflag &= ~OPOST;
+	tcattr.c_lflag &= ~(ECHO|ECHONL|ICANON|ISIG|IEXTEN);
+	tcattr.c_cflag &= ~(CSIZE|PARENB);
+	tcattr.c_cflag |= CS8;
+#else
                        cfmakeraw(&tcattr);
+#endif
                        if (tcsetattr(STDIN_FILENO, TCSANOW, &tcattr) == 0)
                                reset_termios = true;
                }


[FILE:549:patches/patch-src_dumpkeys.c]
--- src/dumpkeys.c.orig	2024-05-24 22:08:22 UTC
+++ src/dumpkeys.c
@@ -162,7 +162,15 @@ main(int argc, char **argv)
 	}
 	original = tcattr;
 	signal(SIGINT, sigint_handler);
+#ifdef __sun__
+	tcattr.c_iflag &= ~(IMAXBEL|IGNBRK|BRKINT|PARMRK|ISTRIP|INLCR|IGNCR|ICRNL|IXON);
+	tcattr.c_oflag &= ~OPOST;
+	tcattr.c_lflag &= ~(ECHO|ECHONL|ICANON|ISIG|IEXTEN);
+	tcattr.c_cflag &= ~(CSIZE|PARENB);
+	tcattr.c_cflag |= CS8;
+#else
 	cfmakeraw(&tcattr);
+#endif
 	if (tcsetattr(STDIN_FILENO, TCSANOW, &tcattr) != 0) {
 		perror("tcsetattr");
 		return 1;


[FILE:453:patches/patch-src_libc-glue.hh]
--- src/libc-glue.hh.orig	2024-05-24 22:08:22 UTC
+++ src/libc-glue.hh
@@ -220,7 +220,13 @@ fd_dup_cloexec(int oldfd,
 {
         auto r = int{};
         do {
+#ifdef F_DUPFD_CLOEXEC
                 r = fcntl(oldfd, F_DUPFD_CLOEXEC, newfd);
+#else
+                r = fcntl(oldfd, F_DUPFD, 0);
+                newfd = r;
+                fcntl(newfd, F_SETFD, FD_CLOEXEC);
+#endif
         } while (r == -1 && errno == EINTR);
         return r;
 }


[FILE:537:patches/patch-src_mev.c]
--- src/mev.c.orig	2024-05-24 22:08:22 UTC
+++ src/mev.c
@@ -358,7 +358,15 @@ main(int argc, char **argv)
 
 	original = tcattr;
 	signal(SIGINT, sigint_handler);
+#ifdef __sun__
+	tcattr.c_iflag &= ~(IMAXBEL|IGNBRK|BRKINT|PARMRK|ISTRIP|INLCR|IGNCR|ICRNL|IXON);
+	tcattr.c_oflag &= ~OPOST;
+	tcattr.c_lflag &= ~(ECHO|ECHONL|ICANON|ISIG|IEXTEN);
+	tcattr.c_cflag &= ~(CSIZE|PARENB);
+	tcattr.c_cflag |= CS8;
+#else
 	cfmakeraw(&tcattr);
+#endif
 	if (tcsetattr(STDIN_FILENO, TCSANOW, &tcattr) != 0) {
 		perror("tcsetattr");
 		return 1;


[FILE:1402:patches/patch-src_pty.cc]
--- src/pty.cc.orig	2024-05-24 22:08:22 UTC
+++ src/pty.cc
@@ -77,6 +77,10 @@
 
 #include "missing.hh"
 
+#ifndef O_CLOEXEC
+#define O_CLOEXEC 0
+#endif
+
 namespace vte::base {
 
 Pty*
@@ -340,6 +344,7 @@ Pty::get_size(int* rows,
         return false;
 }
 
+#ifndef __sun__
 static int
 fd_set_cpkt(vte::libc::FD& fd)
 {
@@ -356,6 +361,7 @@ fd_set_cpkt(vte::libc::FD& fd)
 #endif
         return ret;
 }
+#endif
 
 static int
 fd_setup(vte::libc::FD& fd)
@@ -390,6 +396,7 @@ fd_setup(vte::libc::FD& fd)
                 return -1;
         }
 
+#ifndef __sun__
         if (fd_set_cpkt(fd) < 0) {
                 auto errsv = vte::libc::ErrnoSaver{};
                 _vte_debug_print(VTE_DEBUG_PTY,
@@ -397,6 +404,7 @@ fd_setup(vte::libc::FD& fd)
                                  "Setting packet mode", g_strerror(errsv));
                 return -1;
         }
+#endif
 
         return 0;
 }
@@ -478,6 +486,7 @@ _vte_pty_open_posix(void)
         }
 #endif /* !linux */
 
+#ifndef __sun__
         if (fd_set_cpkt(fd) < 0) {
                 auto errsv = vte::libc::ErrnoSaver{};
                 _vte_debug_print(VTE_DEBUG_PTY,
@@ -485,6 +494,7 @@ _vte_pty_open_posix(void)
                                  "Setting packet mode", g_strerror(errsv));
                 return {};
         }
+#endif
 
         if (grantpt(fd.get()) != 0) {
                 auto errsv = vte::libc::ErrnoSaver{};


[FILE:324:patches/patch-src_vte.cc]
--- src/vte.cc.orig	2024-05-24 22:08:22 UTC
+++ src/vte.cc
@@ -34,6 +34,13 @@
 #if __has_include(<sys/stream.h>)
 #include <sys/stream.h>
 #endif
+#ifdef HAVE_TERMIOS_H
+#include <termios.h>
+#endif
+#if defined(__sun__)
+#include <sys/ioccom.h>
+#include <sys/ptyvar.h>
+#endif
 
 #include <glib.h>
 #include <glib-unix.h>


[FILE:270:patches/patch-src_widget.cc]
--- src/widget.cc.orig	2024-05-24 22:08:22 UTC
+++ src/widget.cc
@@ -22,6 +22,10 @@
 
 #include <sys/wait.h> // for W_EXITCODE
 
+#ifndef W_EXITCODE
+#define W_EXITCODE(ret, sig)	((ret) << 8 | (sig))
+#endif
+
 #include <exception>
 #include <new>
 #include <stdexcept>

