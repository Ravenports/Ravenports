# Buildsheet autogenerated by ravenadm tool -- Do not edit.

NAMEBASE=		keepassxc
VERSION=		2.6.0
KEYWORDS=		security
VARIANTS=		standard
SDESC[standard]=	Community fork of the KeePassX password manager
HOMEPAGE=		https://keepassxc.org
CONTACT=		Michael_Reim[kraileth@elderlinux.org]

DOWNLOAD_GROUPS=	main
SITES[main]=		https://github.com/keepassxreboot/keepassxc/releases/download/2.6.0/
DISTFILE[1]=		keepassxc-2.6.0-src.tar.xz:main
DF_INDEX=		1
SPKGS[standard]=	complete
			primary
			nls
			docs

OPTIONS_AVAILABLE=	none
OPTIONS_STANDARD=	none

BUILD_DEPENDS=		ruby-asciidoctor:single:ruby_default
BUILDRUN_DEPENDS=	argon2:single:standard
			libsodium:single:standard
			qrencode:single:standard
			qt5-qtbase:primary:standard
			qt5-qttools:single:standard
			qt5-qtsvg:single:standard
			qt5-qtx11extras:single:standard
			quazip:single:standard

USES=			cmake pkgconfig qt5 desktop-utils:primary
			mime-info:primary

LICENSE=		GPLv2:primary GPLv3:primary BSD3CLAUSE:primary
			MIT:primary LGPL20:primary LGPL21:primary
			LGPL3+:primary CUSTOM1:primary CUSTOM2:primary
LICENSE_TERMS=		primary:{{WRKSRC}}/COPYING
LICENSE_NAME=		CUSTOM1:"Boost Software License 1.0"
			CUSTOM2:"Nokia LGPL exception"
LICENSE_FILE=		GPLv2:{{WRKSRC}}/LICENSE.GPL-2
			GPLv3:{{WRKSRC}}/LICENSE.GPL-3
			BSD3CLAUSE:{{WRKSRC}}/LICENSE.BSD
			MIT:{{WRKSRC}}/LICENSE.MIT
			LGPL20:stock
			LGPL21:{{WRKSRC}}/LICENSE.LGPL-2.1
			LGPL3+:{{WRKSRC}}/LICENSE.LGPL-3
			CUSTOM1:{{WRKSRC}}/LICENSE.BOOST-1.0
			CUSTOM2:{{WRKSRC}}/LICENSE.NOKIA-LGPL-EXCEPTION
LICENSE_SCHEME=		multi

FPC_EQUIVALENT=		security/keepassxc

CMAKE_ARGS=		-DKEEPASSXC_BUILD_TYPE:STRING=Release
			-DWITH_XC_BROWSER:BOOL=ON
			-DWITH_XC_KEESHARE:BOOL=ON
			-DWITH_XC_NETWORKING:BOOL=ON
			-DWITH_XC_SSHAGENT:BOOL=ON
			-DWITH_XC_UPDATECHECK:BOOL=OFF
			-Wno-dev

post-patch:
	${REINPLACE_CMD} -e "s|__PREFIX__|${PREFIX}|" \
		${WRKSRC}/CMakeLists.txt \
		${WRKSRC}/src/autotype/CMakeLists.txt

do-install:
	(cd ${WRKDIR}/.build ; \
	${MAKE_CMD} DESTDIR=${STAGEDIR} install)
	${STRIP_CMD} ${STAGEDIR}${PREFIX}/bin/keepassxc
	${STRIP_CMD} ${STAGEDIR}${PREFIX}/bin/keepassxc-cli
	${STRIP_CMD} ${STAGEDIR}${PREFIX}/lib/keepassxc/libkeepassx-autotype-xcb.so
	# relocate docs
	${MKDIR} ${STAGEDIR}${STD_DOCDIR}
	${MV} ${STAGEDIR}${PREFIX}/share/keepassxc/docs/* \
		${STAGEDIR}${STD_DOCDIR}/
	${RMDIR} ${STAGEDIR}${PREFIX}/share/keepassxc/docs

[FILE:260:descriptions/desc.primary]
KeePassXC is a community fork of KeePassX, a native cross-platform port of 
KeePass Password Safe, with the goal to extend and improve it with new 
features and bugfixes to provide a feature-rich, fully cross-platform and 
modern open-source password manager.


[FILE:105:distinfo]
d0d23d97a73ac1cbf59bfca2f5d1506ae36dfcd4fbfb4225efe19931f035fd3a      5628800 keepassxc-2.6.0-src.tar.xz


[FILE:734:manifests/plist.primary]
bin/
 keepassxc
 keepassxc-cli
 keepassxc-proxy
lib/keepassxc/libkeepassx-autotype-xcb.so
share/applications/org.keepassxc.KeePassXC.desktop
share/icons/hicolor/256x256/apps/keepassxc.png
share/icons/hicolor/scalable/apps/
 keepassxc-locked.svg
 keepassxc-monochrome-dark-locked.svg
 keepassxc-monochrome-dark.svg
 keepassxc-monochrome-light-locked.svg
 keepassxc-monochrome-light.svg
 keepassxc-unlocked.svg
 keepassxc.svg
share/icons/hicolor/scalable/mimetypes/application-x-keepassxc.svg
share/keepassxc/icons/application/256x256/apps/keepassxc.png
share/keepassxc/wordlists/eff_large.wordlist
share/man/man1/
 keepassxc-cli.1.gz
 keepassxc.1.gz
share/metainfo/org.keepassxc.KeePassXC.appdata.xml
share/mime/packages/keepassxc.xml


[FILE:576:manifests/plist.nls]
share/keepassxc/translations/
 keepassx_ar.qm
 keepassx_bg.qm
 keepassx_ca.qm
 keepassx_cs.qm
 keepassx_da.qm
 keepassx_de.qm
 keepassx_en.qm
 keepassx_en_US.qm
 keepassx_es.qm
 keepassx_et.qm
 keepassx_fi.qm
 keepassx_fr.qm
 keepassx_hu.qm
 keepassx_id.qm
 keepassx_it.qm
 keepassx_ja.qm
 keepassx_ko.qm
 keepassx_lt.qm
 keepassx_nb.qm
 keepassx_nl_NL.qm
 keepassx_pl.qm
 keepassx_pt.qm
 keepassx_pt_BR.qm
 keepassx_pt_PT.qm
 keepassx_ro.qm
 keepassx_ru.qm
 keepassx_sk.qm
 keepassx_sv.qm
 keepassx_th.qm
 keepassx_tr.qm
 keepassx_uk.qm
 keepassx_zh_CN.qm
 keepassx_zh_TW.qm


[FILE:112:manifests/plist.docs]
share/doc/keepassxc/
 KeePassXC_GettingStarted.html
 KeePassXC_KeyboardShortcuts.html
 KeePassXC_UserGuide.html


[FILE:655:patches/patch-CMakeLists.txt]
--- CMakeLists.txt.orig	2020-07-07 01:13:28 UTC
+++ CMakeLists.txt
@@ -400,7 +400,7 @@ include(CLangFormat)
 
 set(QT_COMPONENTS Core Network Concurrent Gui Svg Widgets Test LinguistTools)
 if(UNIX AND NOT APPLE)
-    find_package(Qt5 COMPONENTS ${QT_COMPONENTS} DBus REQUIRED)
+    find_package(Qt5 COMPONENTS ${QT_COMPONENTS} DBus REQUIRED HINTS /__PREFIX__/lib/qt5/cmake ENV PATH)
 elseif(APPLE)
     find_package(Qt5 COMPONENTS ${QT_COMPONENTS} REQUIRED HINTS /usr/local/opt/qt/lib/cmake /usr/local/Cellar/qt/*/lib/cmake ENV PATH)
     find_package(Qt5 COMPONENTS MacExtras HINTS /usr/local/opt/qt/lib/cmake /usr/local/Cellar/qt/*/lib/cmake ENV PATH)


[FILE:568:patches/patch-src_autotype_CMakeLists.txt]
--- src/autotype/CMakeLists.txt.orig	2020-07-07 01:13:28 UTC
+++ src/autotype/CMakeLists.txt
@@ -1,7 +1,7 @@
 if(WITH_XC_AUTOTYPE)
     if(UNIX AND NOT APPLE AND NOT HAIKU)
         find_package(X11)
-        find_package(Qt5X11Extras 5.2)
+        find_package(Qt5X11Extras 5.2 HINTS /__PREFIX__/lib/qt5/cmake ENV PATH)
         if(PRINT_SUMMARY)
             add_feature_info(libXi X11_Xi_FOUND "The X11 Xi Protocol library is required for auto-type")
             add_feature_info(libXtst X11_XTest_FOUND "The X11 XTEST Protocol library is required for auto-type")


[FILE:299:patches/patch-src_core_Alloc.cpp]
--- src/core/Alloc.cpp.orig	2020-07-07 01:13:28 UTC
+++ src/core/Alloc.cpp
@@ -21,7 +21,7 @@
 #include <sodium.h>
 #if defined(Q_OS_MACOS)
 #include <malloc/malloc.h>
-#elif defined(Q_OS_FREEBSD)
+#elif defined(__FreeBSD__)
 #include <malloc_np.h>
 #elif defined(HAVE_MALLOC_H)
 #include <malloc.h>

