# Buildsheet autogenerated by ravenadm tool -- Do not edit.

NAMEBASE=		kf5-kdbusaddons
VERSION=		5.115.0
KEYWORDS=		devel
VARIANTS=		standard
SDESC[standard]=	KF5 add-ons to QtDBus
HOMEPAGE=		https://api.kde.org/frameworks/kdbusaddons/html/index.html
CONTACT=		Michael_Reim[kraileth@elderlinux.org]

DOWNLOAD_GROUPS=	main
SITES[main]=		https://download.kde.org/stable/frameworks/5.115/
DISTFILE[1]=		kdbusaddons-5.115.0.tar.xz:main
DIST_SUBDIR=		kde5
DF_INDEX=		1
SPKGS[standard]=	complete
			primary
			tools
			dev
			nls

OPTIONS_AVAILABLE=	none
OPTIONS_STANDARD=	none

BUILD_DEPENDS=		kf5-extra-cmake-modules:primary:standard
			qt5-qtx11extras:dev:standard
BUILDRUN_DEPENDS=	qt5-qtx11extras:primary:standard
EXRUN[tools]=		qt5-qtbase:primary:standard

USES=			cmake
XORG_COMPONENTS=	xcb

DISTNAME=		kdbusaddons-5.115.0

LICENSE=		LGPL20+:primary LGPL21:primary LGPL3:primary
LICENSE_TERMS=		primary:{{WRKDIR}}/TERMS
LICENSE_FILE=		LGPL20+:{{WRKSRC}}/LICENSES/LGPL-2.0-or-later.txt
			LGPL21:{{WRKSRC}}/LICENSES/LGPL-2.1-only.txt
			LGPL3:{{WRKSRC}}/LICENSES/LGPL-3.0-only.txt
LICENSE_SCHEME=		multi

FPC_EQUIVALENT=		devel/kf5-kdbusaddons

SOVERSION=		5.115.0

CMAKE_ARGS=		-DCMAKE_PREFIX_PATH:PATH={{PREFIX}}/lib/qt5/cmake

post-stage:
	(cd ${STAGEDIR}${PREFIX} && ${STRIP_CMD} bin/kquitapp5 \
		lib/libKF5DBusAddons.so)

post-extract:
	${ECHO} "Terms extracted from 'src/kdedmodule.h':" > ${WRKDIR}/TERMS
	${SED} -n '/ifndef/!p;//q' ${WRKSRC}/src/kdedmodule.h >> ${WRKDIR}/TERMS
	${ECHO} "Terms extracted from 'src/kdbusservice.h':" >> ${WRKDIR}/TERMS
	${SED} -n '/ifndef/!p;//q' ${WRKSRC}/src/kdbusservice.h >> ${WRKDIR}/TERMS

[FILE:101:descriptions/desc.primary]
KDBusAddons provides convenience classes on top of QtDBus as well as an 
API to create KDED modules.


[FILE:44:descriptions/desc.tools]
This package contains the KF5 quitapp tool.


[FILE:110:distinfo]
ecc71d8c9b3f23255a6ae6d7b8de0e3adbd10054f3a8b62b00bee73808d79b74        48924 kde5/kdbusaddons-5.115.0.tar.xz


[FILE:155:manifests/plist.primary]
lib/
 libKF5DBusAddons.so.%%SOMAJOR%%
 libKF5DBusAddons.so.%%SOVERSION%%
share/qlogging-categories5/
 kdbusaddons.categories
 kdbusaddons.renamecategories


[FILE:14:manifests/plist.tools]
bin/kquitapp5


[FILE:578:manifests/plist.dev]
include/KF5/KDBusAddons/
 KDBusConnectionPool
 KDBusInterProcessLock
 KDBusService
 KDEDModule
 KDEInitInterface
 UpdateLaunchEnvironmentJob
 kdbusaddons_export.h
 kdbusaddons_version.h
 kdbusconnectionpool.h
 kdbusinterprocesslock.h
 kdbusservice.h
 kdedmodule.h
 kdeinitinterface.h
 updatelaunchenvironmentjob.h
lib/libKF5DBusAddons.so
lib/cmake/KF5DBusAddons/
 KF5DBusAddonsConfig.cmake
 KF5DBusAddonsConfigVersion.cmake
 KF5DBusAddonsMacros.cmake
 KF5DBusAddonsTargets-release.cmake
 KF5DBusAddonsTargets.cmake
 KF5dbus.service.in
lib/qt5/mkspecs/modules/qt_KDBusAddons.pri


[FILE:2544:manifests/plist.nls]
share/locale/ar/LC_MESSAGES/kdbusaddons5_qt.qm
share/locale/az/LC_MESSAGES/kdbusaddons5_qt.qm
share/locale/bg/LC_MESSAGES/kdbusaddons5_qt.qm
share/locale/bs/LC_MESSAGES/kdbusaddons5_qt.qm
share/locale/ca/LC_MESSAGES/kdbusaddons5_qt.qm
share/locale/ca@valencia/LC_MESSAGES/kdbusaddons5_qt.qm
share/locale/cs/LC_MESSAGES/kdbusaddons5_qt.qm
share/locale/da/LC_MESSAGES/kdbusaddons5_qt.qm
share/locale/de/LC_MESSAGES/kdbusaddons5_qt.qm
share/locale/el/LC_MESSAGES/kdbusaddons5_qt.qm
share/locale/en_GB/LC_MESSAGES/kdbusaddons5_qt.qm
share/locale/eo/LC_MESSAGES/kdbusaddons5_qt.qm
share/locale/es/LC_MESSAGES/kdbusaddons5_qt.qm
share/locale/et/LC_MESSAGES/kdbusaddons5_qt.qm
share/locale/eu/LC_MESSAGES/kdbusaddons5_qt.qm
share/locale/fi/LC_MESSAGES/kdbusaddons5_qt.qm
share/locale/fr/LC_MESSAGES/kdbusaddons5_qt.qm
share/locale/gd/LC_MESSAGES/kdbusaddons5_qt.qm
share/locale/gl/LC_MESSAGES/kdbusaddons5_qt.qm
share/locale/hi/LC_MESSAGES/kdbusaddons5_qt.qm
share/locale/hu/LC_MESSAGES/kdbusaddons5_qt.qm
share/locale/ia/LC_MESSAGES/kdbusaddons5_qt.qm
share/locale/id/LC_MESSAGES/kdbusaddons5_qt.qm
share/locale/is/LC_MESSAGES/kdbusaddons5_qt.qm
share/locale/it/LC_MESSAGES/kdbusaddons5_qt.qm
share/locale/ja/LC_MESSAGES/kdbusaddons5_qt.qm
share/locale/ka/LC_MESSAGES/kdbusaddons5_qt.qm
share/locale/ko/LC_MESSAGES/kdbusaddons5_qt.qm
share/locale/lt/LC_MESSAGES/kdbusaddons5_qt.qm
share/locale/ml/LC_MESSAGES/kdbusaddons5_qt.qm
share/locale/nb/LC_MESSAGES/kdbusaddons5_qt.qm
share/locale/nds/LC_MESSAGES/kdbusaddons5_qt.qm
share/locale/nl/LC_MESSAGES/kdbusaddons5_qt.qm
share/locale/nn/LC_MESSAGES/kdbusaddons5_qt.qm
share/locale/pa/LC_MESSAGES/kdbusaddons5_qt.qm
share/locale/pl/LC_MESSAGES/kdbusaddons5_qt.qm
share/locale/pt/LC_MESSAGES/kdbusaddons5_qt.qm
share/locale/pt_BR/LC_MESSAGES/kdbusaddons5_qt.qm
share/locale/ro/LC_MESSAGES/kdbusaddons5_qt.qm
share/locale/ru/LC_MESSAGES/kdbusaddons5_qt.qm
share/locale/se/LC_MESSAGES/kdbusaddons5_qt.qm
share/locale/sk/LC_MESSAGES/kdbusaddons5_qt.qm
share/locale/sl/LC_MESSAGES/kdbusaddons5_qt.qm
share/locale/sr/LC_MESSAGES/kdbusaddons5_qt.qm
share/locale/sr@ijekavian/LC_MESSAGES/kdbusaddons5_qt.qm
share/locale/sr@ijekavianlatin/LC_MESSAGES/kdbusaddons5_qt.qm
share/locale/sr@latin/LC_MESSAGES/kdbusaddons5_qt.qm
share/locale/sv/LC_MESSAGES/kdbusaddons5_qt.qm
share/locale/tg/LC_MESSAGES/kdbusaddons5_qt.qm
share/locale/tr/LC_MESSAGES/kdbusaddons5_qt.qm
share/locale/uk/LC_MESSAGES/kdbusaddons5_qt.qm
share/locale/zh_CN/LC_MESSAGES/kdbusaddons5_qt.qm
share/locale/zh_TW/LC_MESSAGES/kdbusaddons5_qt.qm


[FILE:277:patches/patch-metainfo.yaml]
--- metainfo.yaml.orig	2023-01-07 00:25:53 UTC
+++ metainfo.yaml
@@ -5,6 +5,9 @@ type: functional
 platforms:
     - name: Linux
     - name: FreeBSD
+    - name: DragonFly
+    - name: NetBSD
+    - name: MidnightBSD
     - name: Windows
     - name: macOS
 portingAid: false


[FILE:721:freebsd/patch-src_kdbusservice.cpp]
diff --git a/src/kdbusservice.cpp b/src/kdbusservice.cpp
--- src/kdbusservice.cpp
+++ src/kdbusservice.cpp
@@ -129,6 +130,18 @@
             } else {
                 d->serviceName += QLatin1Char('-') + QString::number(QCoreApplication::applicationPid());
             }
+        } else if (options & KDBusService::Unique) {
+            auto reply = bus->registeredServiceNames();
+            if (!reply.isValid()) {
+                return;
+            }
+
+            for (const auto& serviceName : reply.value()) {
+                if (serviceName.startsWith(d->serviceName)) {
+                    d->serviceName = serviceName;
+                    return;
+                }
+            }
         }
     }
 


