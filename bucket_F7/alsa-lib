# Buildsheet autogenerated by ravenadm tool -- Do not edit.

NAMEBASE=		alsa-lib
VERSION=		1.2.4
REVISION=		1
KEYWORDS=		audio
VARIANTS=		standard
SDESC[standard]=	Advanced Linux Sound Architecture (ALSA)
HOMEPAGE=		https://www.alsa-project.org/main/index.php/Main_Page
CONTACT=		Leonid_Bobrov[goleo@disroot.org]

DOWNLOAD_GROUPS=	main
SITES[main]=		GITHUB/alsa-project:alsa-lib:v1.2.4
DISTFILE[1]=		generated:main
DF_INDEX=		1
SPKGS[standard]=	single

OPTIONS_AVAILABLE=	LINUX
OPTIONS_STANDARD=	LINUX
OPT_ON[linux]=		LINUX

USES=			autoreconf cpe libtool:keepla python:build

LICENSE=		LGPL21+:single
LICENSE_TERMS=		single:{{WRKSRC}}/TERMS
LICENSE_FILE=		LGPL21+:{{WRKSRC}}/COPYING
LICENSE_AWK=		TERMS:"^\#include"
LICENSE_SOURCE=		TERMS:{{WRKSRC}}/src/input.c
LICENSE_SCHEME=		solo

CPE_PRODUCT=		alsa
CPE_VENDOR=		alsa-project
FPC_EQUIVALENT=		audio/alsa-lib

MUST_CONFIGURE=		gnu
CONFIGURE_ARGS=		--with-pkgconfdir="{{PREFIX}}/lib/pkgconfig"

INSTALL_TARGET=		install-strip
INSTALL_REQ_TOOLCHAIN=	yes
SOVERSION=		2.0.0

VAR_OPSYS[freebsd]=	CONFIGURE_ARGS=	ac_cv_header_endian_h=no
VAR_OPSYS[dragonfly]=	CONFIGURE_ARGS=	ac_cv_header_endian_h=no

[LINUX].DESCRIPTION=			Indicates built for Linux

post-patch:
	${REINPLACE_CMD} 's|/etc|${PREFIX}&|g' ${WRKSRC}/src/conf/alsa.conf

post-patch-LINUX-OFF:
	${MKDIR} ${WRKSRC}/include/linux
	${CP} ${FILESDIR}/byteswap.h ${WRKSRC}/include/
	${CP} ${FILESDIR}/endian.h ${WRKSRC}/include/
	${CP} ${FILESDIR}/malloc.h ${WRKSRC}/include/
	${CP} ${FILESDIR}/ioctl.h ${WRKSRC}/include/linux/
	${CP} ${FILESDIR}/types.h ${WRKSRC}/include/linux/
	${REINPLACE_CMD} -E -e 's/__s([[:digit:]]+)/int\1_t/g' \
		-e 's/__kernel_long_t/long/g' \
		${WRKSRC}/include/sound/uapi/asound.h

[FILE:574:descriptions/desc.single]
The Advanced Linux Sound Architecture (ALSA) provides audio and MIDI
functionality to the Linux operating system. ALSA has the following
significant features:

* Efficient support for all types of audio interfaces, from consumer
  sound cards to professional multichannel audio interfaces.
* Fully modularized sound drivers.
* SMP and thread-safe design.
* User space library (alsa-lib) to simplify application programming
  and provide higher level functionality.
* Support for the older Open Sound System (OSS) API, providing binary
  compatibility for most OSS programs.


[FILE:113:distinfo]
0c6ab052d7ea980a01d0208da5e5e10849bd16c4c9961bbd5d2665083b74a6c0       793478 alsa-project-alsa-lib-1.2.4.tar.gz


[FILE:2043:manifests/plist.single]
bin/aserver
include/asoundlib.h
include/alsa/
 asoundef.h
 asoundlib.h
 conf.h
 control.h
 control_external.h
 error.h
 global.h
 hwdep.h
 input.h
 mixer.h
 mixer_abst.h
 output.h
 pcm.h
 pcm_external.h
 pcm_extplug.h
 pcm_ioplug.h
 pcm_old.h
 pcm_plugin.h
 pcm_rate.h
 rawmidi.h
 seq.h
 seq_event.h
 seq_midi_event.h
 seqmid.h
 timer.h
 topology.h
 use-case.h
 version.h
include/alsa/sound/
include/alsa/sound/
 asoc.h
 asound_fm.h
 emu10k1.h
 hdsp.h
 hdspm.h
 sb16_csp.h
 sscape_ioctl.h
 tlv.h
 type_compat.h
include/alsa/sound/uapi/
 asoc.h
 asound_fm.h
 emu10k1.h
 hdsp.h
 hdspm.h
 sb16_csp.h
 sscape_ioctl.h
 tlv.h
include/sys/asoundlib.h
lib/
 libasound.la
 libasound.so
 libasound.so.%%SOMAJOR%%
 libasound.so.%%SOVERSION%%
 libatopology.la
 libatopology.so
 libatopology.so.%%SOMAJOR%%
 libatopology.so.%%SOVERSION%%
lib/pkgconfig/
 alsa-topology.pc
 alsa.pc
share/aclocal/alsa.m4
share/alsa/alsa.conf
share/alsa/cards/
 AACI.conf
 ATIIXP-MODEM.conf
 ATIIXP-SPDMA.conf
 ATIIXP.conf
 AU8810.conf
 AU8820.conf
 AU8830.conf
 Audigy.conf
 Audigy2.conf
 Aureon51.conf
 Aureon71.conf
 CA0106.conf
 CMI8338-SWIEC.conf
 CMI8338.conf
 CMI8738-MC6.conf
 CMI8738-MC8.conf
 CMI8788.conf
 CS46xx.conf
 EMU10K1.conf
 EMU10K1X.conf
 ENS1370.conf
 ENS1371.conf
 ES1968.conf
 Echo_Echo3G.conf
 FM801.conf
 FWSpeakers.conf
 FireWave.conf
 GUS.conf
 HDA-Intel.conf
 HdmiLpeAudio.conf
 ICE1712.conf
 ICE1724.conf
 ICH-MODEM.conf
 ICH.conf
 ICH4.conf
 Loopback.conf
 Maestro3.conf
 NFORCE.conf
 PC-Speaker.conf
 PMac.conf
 PMacToonie.conf
 PS3.conf
 RME9636.conf
 RME9652.conf
 SB-XFi.conf
 SI7018.conf
 TRID4DWAVENX.conf
 USB-Audio.conf
 VIA686A.conf
 VIA8233.conf
 VIA8233A.conf
 VIA8237.conf
 VX222.conf
 VXPocket.conf
 VXPocket440.conf
 YMF744.conf
 aliases.conf
 pistachio-card.conf
 vc4-hdmi.conf
share/alsa/pcm/
 center_lfe.conf
 default.conf
 dmix.conf
 dpl.conf
 dsnoop.conf
 front.conf
 hdmi.conf
 iec958.conf
 modem.conf
 rear.conf
 side.conf
 surround21.conf
 surround40.conf
 surround41.conf
 surround50.conf
 surround51.conf
 surround71.conf


[FILE:270:patches/patch-include_pcm.h]
--- include/pcm.h.orig	2020-06-29 10:51:08 UTC
+++ include/pcm.h
@@ -29,6 +29,13 @@
 #ifndef __ALSA_PCM_H
 #define __ALSA_PCM_H
 
+#ifndef ESTRPIPE
+#define ESTRPIPE EPIPE
+#endif
+#ifndef EBADFD
+#define EBADFD EBADF
+#endif
+
 #ifdef __cplusplus
 extern "C" {
 #endif


[FILE:760:patches/patch-src_async.c]
$NetBSD: patch-bk,v 1.1 2008/12/25 13:18:00 hasso Exp $

--- src/async.c.orig	2020-06-29 10:51:08 UTC
+++ src/async.c
@@ -54,6 +54,15 @@ static LIST_HEAD(snd_async_handlers);
 
 static void snd_async_handler(int signo ATTRIBUTE_UNUSED, siginfo_t *siginfo, void *context ATTRIBUTE_UNUSED)
 {
+#if defined(__DragonFly__) || defined(__FreeBSD__)
+	/* XXX XXX XXX */
+	struct list_head *i;
+	list_for_each(i, &snd_async_handlers) {
+		snd_async_handler_t *h = list_entry(i, snd_async_handler_t, glist);
+		if (h->callback)
+			h->callback(h);
+	}
+#else
 	int fd;
 	struct list_head *i;
 	//assert(siginfo->si_code == SI_SIGIO);
@@ -66,6 +75,7 @@ static void snd_async_handler(int signo
 		if (h->fd == fd && h->callback)
 			h->callback(h);
 	}
+#endif
 }
 
 /**


[FILE:529:patches/patch-src_conf.c]
--- src/conf.c.orig	2020-10-19 09:45:13 UTC
+++ src/conf.c
@@ -3836,7 +3836,7 @@ static int config_file_load(snd_config_t
 	if (!S_ISDIR(st.st_mode))
 		return config_file_open(root, fn);
 #ifndef DOC_HIDDEN
-#if defined(_GNU_SOURCE) && !defined(__NetBSD__) && !defined(__FreeBSD__) && !defined(__sun) && !defined(ANDROID)
+#if defined(_GNU_SOURCE) && !defined(__NetBSD__) && !defined(__FreeBSD__) && !defined(__sun) && !defined(ANDROID) &&!defined(__DragonFly__)
 #define SORTFUNC	versionsort
 #else
 #define SORTFUNC	alphasort


[FILE:402:patches/patch-src_dlmisc.c]
--- src/dlmisc.c.orig	2020-10-19 09:45:13 UTC
+++ src/dlmisc.c
@@ -42,11 +42,9 @@
 #ifndef PIC
 struct snd_dlsym_link *snd_dlsym_start = NULL;
 #endif
-#ifdef DL_ORIGIN_AVAILABLE
 static int snd_plugin_dir_set = 0;
 static char *snd_plugin_dir = NULL;
 #endif
-#endif
 
 #if defined(DL_ORIGIN_AVAILABLE) && defined(HAVE_LIBPTHREAD)
 static pthread_mutex_t snd_dlpath_mutex = PTHREAD_MUTEX_INITIALIZER;


[FILE:528:patches/patch-src_pcm_pcm__direct.c]
--- src/pcm/pcm_direct.c.orig	2020-06-29 10:51:08 UTC
+++ src/pcm/pcm_direct.c
@@ -44,12 +44,17 @@
  *
  */
  
+#if !defined(__DragonFly__) && !defined(__OpenBSD__) \
+  && !(defined(__FreeBSD__) && __FreeBSD__ < 12)
 union semun {
 	int              val;    /* Value for SETVAL */
 	struct semid_ds *buf;    /* Buffer for IPC_STAT, IPC_SET */
 	unsigned short  *array;  /* Array for GETALL, SETALL */
+#ifdef __linux__
 	struct seminfo  *__buf;  /* Buffer for IPC_INFO (Linux specific) */
+#endif
 };
+#endif
  
 /*
  * FIXME:


[FILE:536:patches/patch-src_ucm_parser.c]
--- src/ucm/parser.c.orig	2020-10-19 09:45:13 UTC
+++ src/ucm/parser.c
@@ -2299,7 +2299,7 @@ int uc_mgr_scan_master_configs(const cha
 		snprintf(filename, sizeof(filename), "%s/ucm2",
 			 snd_config_topdir());
 
-#if defined(_GNU_SOURCE) && !defined(__NetBSD__) && !defined(__FreeBSD__) && !defined(__sun) && !defined(ANDROID)
+#if defined(_GNU_SOURCE) && !defined(__NetBSD__) && !defined(__FreeBSD__) && !defined(__sun) && !defined(ANDROID) && !defined(__DragonFly__)
 #define SORTFUNC	versionsort
 #else
 #define SORTFUNC	alphasort


[FILE:381:patches/patch-test_midifile.c]
--- test/midifile.c.orig	2020-06-29 10:51:08 UTC
+++ test/midifile.c
@@ -71,7 +71,7 @@
 #endif
 
 #include <stdio.h>
-#include <values.h>
+#include <limits.h>
 
 #include <string.h>
 /*void exit(), free();*/
@@ -328,7 +328,7 @@ readtrack ()			/* read a track chunk */
 
   if (Mf_interactive)
     {
-      Mf_toberead = MAXINT;
+      Mf_toberead = INT_MAX;
     }
   else
     {


[FILE:281:files/byteswap.h]
#ifndef _BYTESWAP_H
#define _BYTESWAP_H

#ifdef __OpenBSD__
#define bswap_16(x)	swap16(x)
#define bswap_32(x)	swap32(x)
#define bswap_64(x)	swap64(x)
#else
#define bswap_16(x)	bswap16(x)
#define bswap_32(x)	bswap32(x)
#define bswap_64(x)	bswap64(x)
#endif
#endif /* _BYTESWAP_H */


[FILE:84:files/endian.h]
#ifndef _ENDIAN_H
#define	_ENDIAN_H
#include <linux/types.h>
#endif /* _ENDIAN_H */


[FILE:98:files/ioctl.h]
#ifndef _LINUX_IOCTL_H
#define _LINUX_IOCTL_H
#include <sys/ioccom.h>
#endif /* _LINUX_IOCTL_H */


[FILE:79:files/malloc.h]
#ifndef _MALLOC_H
#define	_MALLOC_H
#include <stdlib.h>
#endif /* _MALLOC_H */


[FILE:225:files/types.h]
#ifndef _LINUX_TYPES_H
#define _LINUX_TYPES_H

#include <sys/types.h>

#define __bitwise
#define __u8 u_int8_t

typedef pid_t __kernel_pid_t;
typedef off_t __kernel_off_t;

typedef uint64_t __u64;
#endif /* _LINUX_TYPES_H */

