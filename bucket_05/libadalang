# Buildsheet autogenerated by ravenadm tool -- Do not edit.

NAMEBASE=		libadalang
VERSION=		2018
REVISION=		1
KEYWORDS=		python lang devel
VARIANTS=		py27
SDESC[py27]=		High-performance semantic engine for Ada (PY 27)
HOMEPAGE=		https://github.com/AdaCore/libadalang
CONTACT=		John_Marino[draco@marino.st]

DOWNLOAD_GROUPS=	main langkit
SITES[main]=		http://downloads.dragonlace.net/src/
DISTFILE[1]=		libadalang-gpl-2018-20180524-src.tar.gz:main
DISTFILE[2]=		langkit-gpl-2018-20180524-src.tar.gz:main
DF_INDEX=		1 2
SPKGS[py27]=		single

OPTIONS_AVAILABLE=	DEBUG PY27
OPTIONS_STANDARD=	DEBUG
VOPTS[py27]=		PY27=ON DEBUG=ON

BROKEN[sunos]=		Source file navigate.adb fails to link

BUILD_DEPENDS=		quex:single:adalang
BUILDRUN_DEPENDS=	gnatcoll-core:primary:standard
			gnatcoll-bindings:iconv:standard

USES=			gprbuild

DISTNAME=		libadalang-gpl-2018-src

MUST_CONFIGURE=		yes

INSTALL_REQ_TOOLCHAIN=	yes

[DEBUG].MAKEFILE_ON=			WITH_DEBUG=yes
[DEBUG].MAKE_ARGS_ON=			--debug
					--full-error-traces

[PY27].BUILDRUN_DEPENDS_ON=		python-Mako:single:py27
					python-PyYAML:single:py27
					python-coverage:single:py27
					python-psutil:single:py27
					python-autopep8:single:py27
					python-yapf:single:py27
					python-enum:single:py27
					python-enum34:single:py27
[PY27].BUILD_DEPENDS_ON=		python-funcy:single:py27
[PY27].USES_ON=				python:py27

post-patch:
	# disable -Werror
	${REINPLACE_CMD} -e 's|, "-gnatwe"||' \
		${WRKSRC}/langkit/langkit/templates/project_file.mako \
		${WRKSRC}/langkit/langkit/templates/langkit_support_gpr.mako

post-patch-linux:
	${REINPLACE_CMD} -e 's|@PREFIX@|${PREFIX}|' \
		${WRKSRC}/langkit/langkit/templates/mains_project_file.mako

post-configure-freebsd:
	# link executables with -lutil
	${PATCH} -d ${PATCH_WRKSRC} --backup --forward -E -p0 --batch \
		< ${FILESDIR}/pc-patch-build_src_mains.gpr

post-configure-dragonfly:
	# link executables with -lutil
	${PATCH} -d ${PATCH_WRKSRC} --backup --forward -E -p0 --batch \
		< ${FILESDIR}/pc-patch-build_src_mains.gpr

do-build:
	(cd ${BUILD_WRKSRC} && ${SETENV} ${MAKE_ENV} \
		${PYTHON_CMD} ada/manage.py\
		--verbosity info\
		--disable-shared\
		--enable-static\
		${MAKE_ARGS:NDESTDIR=*}\
		build)

do-configure:
	# must build as static since rpaths are either missing,
	# refer to /construction, ignore gpr settings, etc
	(cd ${BUILD_WRKSRC} && ${SETENV} ${MAKE_ENV} \
		${PYTHON_CMD} ada/manage.py\
		--verbosity info\
		--disable-shared\
		--enable-static\
		generate)

post-extract:
	${MV} ${WRKDIR}/langkit-* ${WRKSRC}/langkit

do-install:
	(cd ${BUILD_WRKSRC} && ${SETENV} ${MAKE_ENV} \
		${PYTHON_CMD} ada/manage.py \
		--disable-shared \
		--enable-static \
		install ${STAGEDIR}${PREFIX})
	${STRIP_CMD} ${STAGEDIR}${PREFIX}/bin/*
	${RM} -r ${STAGEDIR}${PREFIX}/lib/gnat/manifests

[FILE:853:descriptions/desc.single]
Libadalang is a project to build a high performance semantic engine for
the Ada programming language. It is meant to provide a basis to write Ada
tooling, including tools working on potentially changing and incorrect
code, such as IDEs. Its goals encompass, but are not limited to:

* Full support for parsing the Ada 2012 syntax, plus SPARK extensions.
* Error tolerant parsing: the parser must be able to recover from simple
  errors and provide a "best-guess" tree.
* Error tolerant semantic analysis: it must be possible to create a tool
  that works only on syntax, and completely ignores semantic issues.
* Full symbol resolution respecting Ada 2012 - and prior - semantics.
* Bindings to a variety of languages, including Ada, C, Python and Java, so
  that tools can be written from various ecosystems. 
* Incremental processing of source files.


[FILE:233:distinfo]
615a1aeb8e58360248625456e0770d8a67fef90ce425270a34a674b9659c8685      1990774 libadalang-gpl-2018-20180524-src.tar.gz
b2798a901382443a1973234d207e8a80fa1a81e2e0d538f967372668534913cc       565649 langkit-gpl-2018-20180524-src.tar.gz


[FILE:5597:manifests/plist.single]
bin/
 gnat_compare
 nameres
 navigate
 parse
include/libadalang.h
include/langkit_support/
 langkit_support-adalog-abstract_relation.adb
 langkit_support-adalog-abstract_relation.ads
 langkit_support-adalog-debug.adb
 langkit_support-adalog-debug.ads
 langkit_support-adalog-eq_same.adb
 langkit_support-adalog-eq_same.ads
 langkit_support-adalog-logic_ref.adb
 langkit_support-adalog-logic_ref.ads
 langkit_support-adalog-logic_var.ads
 langkit_support-adalog-main_support.adb
 langkit_support-adalog-main_support.ads
 langkit_support-adalog-operations.adb
 langkit_support-adalog-operations.ads
 langkit_support-adalog-predicates.adb
 langkit_support-adalog-predicates.ads
 langkit_support-adalog-pure_relations.adb
 langkit_support-adalog-pure_relations.ads
 langkit_support-adalog-relations.adb
 langkit_support-adalog-relations.ads
 langkit_support-adalog-unify.adb
 langkit_support-adalog-unify.ads
 langkit_support-adalog-unify_lr.adb
 langkit_support-adalog-unify_lr.ads
 langkit_support-adalog-unify_one_side.adb
 langkit_support-adalog-unify_one_side.ads
 langkit_support-adalog.ads
 langkit_support-array_utils.adb
 langkit_support-array_utils.ads
 langkit_support-bump_ptr-vectors.adb
 langkit_support-bump_ptr-vectors.ads
 langkit_support-bump_ptr.adb
 langkit_support-bump_ptr.ads
 langkit_support-cheap_sets.adb
 langkit_support-cheap_sets.ads
 langkit_support-diagnostics.adb
 langkit_support-diagnostics.ads
 langkit_support-extensions.adb
 langkit_support-extensions.ads
 langkit_support-hashes.adb
 langkit_support-hashes.ads
 langkit_support-images.adb
 langkit_support-images.ads
 langkit_support-iterators.adb
 langkit_support-iterators.ads
 langkit_support-lexical_env.adb
 langkit_support-lexical_env.ads
 langkit_support-packrat.adb
 langkit_support-packrat.ads
 langkit_support-relative_get.adb
 langkit_support-relative_get.ads
 langkit_support-slocs.adb
 langkit_support-slocs.ads
 langkit_support-symbols.adb
 langkit_support-symbols.ads
 langkit_support-text.adb
 langkit_support-text.ads
 langkit_support-token_data_handlers.adb
 langkit_support-token_data_handlers.ads
 langkit_support-tree_traversal_iterator.adb
 langkit_support-tree_traversal_iterator.ads
 langkit_support-vectors.adb
 langkit_support-vectors.ads
 langkit_support.ads
include/libadalang/
 gdb.c
 libadalang-analysis-implementation-c.adb
 libadalang-analysis-implementation-c.ads
 libadalang-analysis-implementation.adb
 libadalang-analysis-implementation.ads
 libadalang-analysis-parsers.adb
 libadalang-analysis-parsers.ads
 libadalang-analysis-properties.adb
 libadalang-analysis-properties.ads
 libadalang-analysis.adb
 libadalang-analysis.ads
 libadalang-auto_provider.adb
 libadalang-auto_provider.ads
 libadalang-debug.adb
 libadalang-debug.ads
 libadalang-expr_eval.adb
 libadalang-expr_eval.ads
 libadalang-init.adb
 libadalang-init.ads
 libadalang-introspection.adb
 libadalang-introspection.ads
 libadalang-iterators.adb
 libadalang-iterators.ads
 libadalang-lexer.adb
 libadalang-lexer.ads
 libadalang-rewriting.adb
 libadalang-rewriting.ads
 libadalang-sources.adb
 libadalang-sources.ads
 libadalang-unit_files-default.adb
 libadalang-unit_files-default.ads
 libadalang-unit_files-env_hook.adb
 libadalang-unit_files-env_hook.ads
 libadalang-unit_files-projects.adb
 libadalang-unit_files-projects.ads
 libadalang-unit_files.adb
 libadalang-unit_files.ads
 libadalang-unparsing-implementation.adb
 libadalang-unparsing-implementation.ads
 libadalang-unparsing.adb
 libadalang-unparsing.ads
 libadalang.ads
 quex_interface.c
 quex_interface.h
 quex_lexer-configuration.h
 quex_lexer-token.h
 quex_lexer-token_ids.h
 quex_lexer.c
 quex_lexer.h
lib/gnat/
 langkit_support.gpr
 libadalang.gpr
lib/langkit_support.static/
 langkit_support-adalog-abstract_relation.ali
 langkit_support-adalog-debug.ali
 langkit_support-adalog-eq_same.ali
 langkit_support-adalog-logic_ref.ali
 langkit_support-adalog-logic_var.ali
 langkit_support-adalog-main_support.ali
 langkit_support-adalog-operations.ali
 langkit_support-adalog-predicates.ali
 langkit_support-adalog-pure_relations.ali
 langkit_support-adalog-relations.ali
 langkit_support-adalog-unify.ali
 langkit_support-adalog-unify_lr.ali
 langkit_support-adalog-unify_one_side.ali
 langkit_support-adalog.ali
 langkit_support-array_utils.ali
 langkit_support-bump_ptr-vectors.ali
 langkit_support-bump_ptr.ali
 langkit_support-cheap_sets.ali
 langkit_support-diagnostics.ali
 langkit_support-extensions.ali
 langkit_support-hashes.ali
 langkit_support-images.ali
 langkit_support-iterators.ali
 langkit_support-lexical_env.ali
 langkit_support-packrat.ali
 langkit_support-relative_get.ali
 langkit_support-slocs.ali
 langkit_support-symbols.ali
 langkit_support-text.ali
 langkit_support-token_data_handlers.ali
 langkit_support-tree_traversal_iterator.ali
 langkit_support-vectors.ali
 langkit_support.ali
 liblangkit_support.a
lib/libadalang.static/
 libadalang-analysis-implementation-c.ali
 libadalang-analysis-implementation.ali
 libadalang-analysis-parsers.ali
 libadalang-analysis-properties.ali
 libadalang-analysis.ali
 libadalang-auto_provider.ali
 libadalang-debug.ali
 libadalang-expr_eval.ali
 libadalang-init.ali
 libadalang-introspection.ali
 libadalang-iterators.ali
 libadalang-lexer.ali
 libadalang-rewriting.ali
 libadalang-sources.ali
 libadalang-unit_files-default.ali
 libadalang-unit_files-env_hook.ali
 libadalang-unit_files-projects.ali
 libadalang-unit_files.ali
 libadalang-unparsing-implementation.ali
 libadalang-unparsing.ali
 libadalang.a
 libadalang.ali
python/libadalang.py
share/libadalang/ast-types.html


[FILE:489:patches/patch-langkit_langkit_libmanage.py]
--- langkit/langkit/libmanage.py.orig	2018-04-25 09:45:20 UTC
+++ langkit/langkit/libmanage.py
@@ -750,6 +750,7 @@ class ManageScript(object):
         base_argv = ['gprinstall', '-p',
                      '-P{}'.format(project_file),
                      '--prefix={}'.format(self.dirs.install_dir()),
+                     '--project-subdir=lib/gnat',
                      '--build-var=LIBRARY_TYPE']
 
         # If this is a library, install sources in an unique location: there is


[FILE:339:files/pc-patch-build_src_mains.gpr]
post-configure patch to generated mains.gpr
(BSD only, maybe MacOS too)

--- build/src/mains.gpr.orig	2019-01-15 15:41:29 UTC
+++ build/src/mains.gpr
@@ -38,4 +38,8 @@ project Mains is
       for Switches ("ada") use ("-E");
    end Binder;
 
+   package Linker is
+      for Switches ("ada") use ("-lutil");
+   end Linker;
+
 end Mains;


[FILE:354:linux/patch-langkit_langkit_templates_mains__project__file.mako]
--- langkit/langkit/templates/mains_project_file.mako.orig	2018-04-25 09:45:20 UTC
+++ langkit/langkit/templates/mains_project_file.mako
@@ -40,4 +40,8 @@ project Mains is
       for Switches ("ada") use ("-E");
    end Binder;
 
+   package Linker is
+      for Switches ("ada") use ("-lgnarl", "-Wl,-rpath,@PREFIX@/lib");
+   end Linker;
+
 end Mains;

