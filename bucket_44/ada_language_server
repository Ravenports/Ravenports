# Buildsheet autogenerated by ravenadm tool -- Do not edit.

NAMEBASE=		ada_language_server
VERSION=		26.0.202507021
EPOCH=			1
KEYWORDS=		ada textproc
VARIANTS=		std
SDESC[std]=		Microsoft Language Server Protocol for Ada
HOMEPAGE=		https://github.com/AdaCore/ada_language_server
CONTACT=		John_Marino[draco@marino.st]

DOWNLOAD_GROUPS=	main
SITES[main]=		GITHUB/AdaCore:ada_language_server:26.0.202507021
DISTFILE[1]=		generated:main
DF_INDEX=		1
SPKGS[std]=		set
			primary
			dev

OPTIONS_AVAILABLE=	none
OPTIONS_STANDARD=	none

BUILD_DEPENDS=		ada_libfswatch:single:std
			gtkada:dev:std
			gnatdoc:dev:std
			ada_spawn:dev:std
			lal-refactor:dev:std
			libadalang:dev:std
			libadalang-tools:dev:std
			gnatformat:dev:std
			vss-extra:dev:std
BUILDRUN_DEPENDS=	libadalang-tools:primary:std
			lal-refactor:primary:std
			ada_spawn:primary:std
			gnatformat:primary:std
EXRUN[dev]=		vss-text:dev:std
			vss-extra:dev:std
			gtkada:dev:std
			ada_spawn:dev:std
			gnatcoll-core:dev:std

USES=			gmake gprbuild iconv:build,standalone

LICENSE=		GPLv3+:primary
LICENSE_TERMS=		primary:{{WRKDIR}}/TERMS
LICENSE_FILE=		GPLv3+:{{WRKSRC}}/LICENSE
LICENSE_AWK=		TERMS:"^$$"
LICENSE_SOURCE=		TERMS:{{WRKSRC}}/source/server/lsp-servers.ads
LICENSE_SCHEME=		solo

MAKE_ARGS=		BUILD_MODE=prod
			PROCESSORS={{MAKE_JOBS_NUMBER}}
			OS=unix

INSTALL_REQ_TOOLCHAIN=	yes

post-install:
	${RM} -r ${STAGEDIR}${PREFIX}/share/gpr/manifests
	# not sure why this happened
	${RM} ${STAGEDIR}${PREFIX}/share/gpr/gnatcoll.gpr
	# strip
	${STRIP_CMD} ${STAGEDIR}${PREFIX}/bin/*

[FILE:451:descriptions/desc.primary]
Ada_Language_Server an implementation of the Microsoft Language Server
Protocol for Ada/SPARK.

Current features:
 * GNAT project files support.
 * Code completion for names, keywords, aggregates, etc.
 * Code navigation, such as Go to Definition/Declaration, Find All
   References, Call Hierarchies, etc.
 * Code refactoring like insert named associations, auto-add with-clauses.
 * Document/Workspace symbol search.
 * Code folding and formatting.


[FILE:128:distinfo]
4eaf4284586e9d2026345b613cc0f3e375a0d94223e73b78bc60ad3fa9fceb9e      6655382 AdaCore-ada_language_server-26.0.202507021.tar.gz


[FILE:38:manifests/plist.primary]
bin/
 ada_language_server
 tester-run


[FILE:4454:manifests/plist.dev]
include/lsp/
 lsp-client_message_receivers.ads
 lsp-client_notification_receivers.ads
 lsp-client_request_receivers.ads
 lsp-client_response_senders.ads
 lsp-commands.adb
 lsp-commands.ads
 lsp-errors.adb
 lsp-errors.ads
 lsp-generic_notifications.adb
 lsp-generic_notifications.ads
 lsp-generic_optional.adb
 lsp-generic_optional.ads
 lsp-generic_optional_with_read_write.adb
 lsp-generic_optional_with_read_write.ads
 lsp-generic_requests.adb
 lsp-generic_requests.ads
 lsp-generic_responses.adb
 lsp-generic_responses.ads
 lsp-generic_sets.adb
 lsp-generic_sets.ads
 lsp-generic_vectors.adb
 lsp-generic_vectors.ads
 lsp-message_io.adb
 lsp-message_io.ads
 lsp-messages-client_notifications.adb
 lsp-messages-client_notifications.ads
 lsp-messages-client_requests.adb
 lsp-messages-client_requests.ads
 lsp-messages-client_responses.adb
 lsp-messages-client_responses.ads
 lsp-messages-common_writers.adb
 lsp-messages-common_writers.ads
 lsp-messages-server_notifications.adb
 lsp-messages-server_notifications.ads
 lsp-messages-server_requests.adb
 lsp-messages-server_requests.ads
 lsp-messages-server_responses.adb
 lsp-messages-server_responses.ads
 lsp-messages-visitors.adb
 lsp-messages-visitors.ads
 lsp-messages.adb
 lsp-messages.ads
 lsp-server_notification_receivers.ads
 lsp-server_request_receivers.ads
 lsp-server_response_senders.ads
 lsp-types-utils.adb
 lsp-types-utils.ads
 lsp-types.adb
 lsp-types.ads
 vss-json-pull_readers-look_ahead.adb
 vss-json-pull_readers-look_ahead.ads
include/lsp_base/
 lsp-json_streams.adb
 lsp-json_streams.ads
 lsp.ads
 minimal_perfect_hash.adb
 minimal_perfect_hash.ads
 uris.adb
 uris.ads
include/lsp_client/
 lsp-clients-request_handlers.ads
 lsp-clients-response_handlers.ads
 lsp-clients.adb
 lsp-clients.ads
 lsp-raw_clients.adb
 lsp-raw_clients.ads
include/lsp_client_glib/
 lsp-clients-request_handlers.ads
 lsp-clients-response_handlers.ads
 lsp-clients.adb
 lsp-clients.ads
 lsp-raw_clients.adb
 lsp-raw_clients.ads
include/tester/
 tester-macros.adb
 tester-macros.ads
 tester-run.adb
 tester-tests.adb
 tester-tests.ads
 tester.ads
lib/lsp/
 lsp-client_message_receivers.ali
 lsp-client_message_receivers.o
 lsp-client_notification_receivers.ali
 lsp-client_notification_receivers.o
 lsp-client_request_receivers.ali
 lsp-client_request_receivers.o
 lsp-client_response_senders.ali
 lsp-client_response_senders.o
 lsp-commands.ali
 lsp-commands.o
 lsp-errors.ali
 lsp-errors.o
 lsp-generic_notifications.ali
 lsp-generic_notifications.o
 lsp-generic_optional.ali
 lsp-generic_optional.o
 lsp-generic_optional_with_read_write.ali
 lsp-generic_optional_with_read_write.o
 lsp-generic_requests.ali
 lsp-generic_requests.o
 lsp-generic_responses.ali
 lsp-generic_responses.o
 lsp-generic_sets.ali
 lsp-generic_sets.o
 lsp-generic_vectors.ali
 lsp-generic_vectors.o
 lsp-message_io.ali
 lsp-message_io.o
 lsp-messages-client_notifications.ali
 lsp-messages-client_notifications.o
 lsp-messages-client_requests.ali
 lsp-messages-client_requests.o
 lsp-messages-client_responses.ali
 lsp-messages-client_responses.o
 lsp-messages-common_writers.ali
 lsp-messages-common_writers.o
 lsp-messages-server_notifications.ali
 lsp-messages-server_notifications.o
 lsp-messages-server_requests.ali
 lsp-messages-server_requests.o
 lsp-messages-server_responses.ali
 lsp-messages-server_responses.o
 lsp-messages-visitors.ali
 lsp-messages-visitors.o
 lsp-messages.ali
 lsp-messages.o
 lsp-server_notification_receivers.ali
 lsp-server_notification_receivers.o
 lsp-server_request_receivers.ali
 lsp-server_request_receivers.o
 lsp-server_response_senders.ali
 lsp-server_response_senders.o
 lsp-types-utils.ali
 lsp-types-utils.o
 lsp-types.ali
 lsp-types.o
 vss-json-pull_readers-look_ahead.ali
 vss-json-pull_readers-look_ahead.o
lib/lsp_base/
 lsp-json_streams.ali
 lsp-json_streams.o
 lsp.ali
 lsp.o
 minimal_perfect_hash.ali
 minimal_perfect_hash.o
 uris.ali
 uris.o
lib/lsp_client/
 lsp-clients-request_handlers.ali
 lsp-clients-request_handlers.o
 lsp-clients-response_handlers.ali
 lsp-clients-response_handlers.o
 lsp-clients.ali
 lsp-clients.o
 lsp-raw_clients.ali
 lsp-raw_clients.o
lib/lsp_client_glib/
 lsp-clients-request_handlers.ali
 lsp-clients-request_handlers.o
 lsp-clients-response_handlers.ali
 lsp-clients-response_handlers.o
 lsp-clients.ali
 lsp-clients.o
 lsp-raw_clients.ali
 lsp-raw_clients.o
share/gpr/
 lsp.gpr
 lsp_base.gpr
 lsp_client.gpr
 lsp_client_glib.gpr
 tester.gpr


[FILE:1877:patches/patch-Makefile]
--- Makefile.orig	2025-07-02 16:04:06 UTC
+++ Makefile
@@ -16,12 +16,7 @@ ifeq ($(OS),Windows_NT)
    EXE=.exe
    LSP_OS=$(OS)
 else
-   UNAME_S := $(shell uname -s)
-   ifeq ($(UNAME_S),Linux)
-      LSP_OS=unix
-   else ifeq ($(UNAME_S),Darwin)
-      LSP_OS=osx
-   endif
+   LSP_OS=unix
    PYTHON=python3
    EXE=
 endif
@@ -118,6 +113,8 @@ endif
 	$(GPRBUILD) -P gnat/lsp_3_17.gpr -p $(COVERAGE_BUILD_FLAGS) $(GPRBUILD_CARGS)
 	$(GPRBUILD) -P gnat/tester.gpr -p $(BUILD_FLAGS) $(GPRBUILD_CARGS)
 	$(GPRBUILD) -P gnat/lsp_client.gpr -p $(COVERAGE_BUILD_FLAGS) $(GPRBUILD_CARGS)
+	$(GPRBUILD) -P gnat/lsp_client_glib.gpr -p $(COVERAGE_BUILD_FLAGS) $(GPRBUILD_CARGS) \
+		-XVERSION=$(VERSION) -XBUILD_DATE=$(BUILD_DATE)
 ifdef NODE
 	mkdir -p integration/vscode/ada/$(NODE_ARCH_PLATFORM)
 	cp -v -f $(ALS) integration/vscode/ada/$(NODE_ARCH_PLATFORM)
@@ -140,16 +137,20 @@ ifneq ($(COVERAGE),)
 endif
 
 install:
-	gprinstall -f -P gnat/lsp_server.gpr -p -r --mode=usage \
-		--prefix=$(DESTDIR) $(LIBRARY_FLAGS)
-	gprinstall -f -P gnat/tester.gpr -p --prefix=$(DESTDIR) $(LIBRARY_FLAGS)
+	gprinstall -f -P gnat/lsp_server.gpr -p -r --mode=usage --no-manifests \
+		--prefix=$(DESTDIR)$(PREFIX) $(LIBRARY_FLAGS)
+	gprinstall -f -P gnat/tester.gpr -p --no-manifests \
+		--prefix=$(DESTDIR)$(PREFIX) $(LIBRARY_FLAGS)
 	gprinstall -f -P gnat/lsp_client.gpr -p -r	\
 		--mode=dev				\
-		--prefix=$(DESTDIR)			\
+		--no-manifests                          \
+		--prefix=$(DESTDIR)$(PREFIX)		\
 		$(LIBRARY_FLAGS)
+	gprinstall -f -P gnat/lsp_client_glib.gpr -p -r \
+		--mode=dev --no-manifests --prefix=$(DESTDIR)$(PREFIX) $(LIBRARY_FLAGS)
 ifneq ($(COVERAGE),)
-	mkdir -p $(DESTDIR)/share/als/sids || true
-	cp .obj/*/*.sid $(DESTDIR)/share/als/sids/
+	mkdir -p $(DESTDIR)$(PREFIX)/share/als/sids || true
+	cp .obj/*/*.sid $(DESTDIR)$(PREFIX)/share/als/sids/
 endif
 
 clean:


[FILE:1324:patches/patch-cherry_001]
From 3de3b12c288a47009c836b67f7bcd9fcfd4d438b Mon Sep 17 00:00:00 2001
From: Romain Beguet <beguet@adacore.com>
Date: Tue, 2 Sep 2025 15:50:52 +0200
Subject: [PATCH] Update due to recent LAL API change.

(cherry picked from commit 9a3378a9ab645737177e1b9236cc288f88f975ab)
---
 source/ada/lsp-ada_highlighters.adb | 6 +++---
 1 file changed, 3 insertions(+), 3 deletions(-)

--- source/ada/lsp-ada_highlighters.adb.orig
+++ source/ada/lsp-ada_highlighters.adb
@@ -741,7 +741,7 @@ package body LSP.Ada_Highlighters is
          end case;
       end To_Kind;
 
-      Failsafe_Def : Libadalang.Analysis.Refd_Def;
+      Failsafe_Decl : Libadalang.Analysis.Refd_Decl;
       Def  : Libadalang.Analysis.Defining_Name;
       Decl : Libadalang.Analysis.Basic_Decl;
       Kind : LSP.Enumerations.SemanticTokenTypes;
@@ -772,8 +772,8 @@ package body LSP.Ada_Highlighters is
                Highlight_Token (Node.Token_Start, declaration);
          end;
       else
-         Failsafe_Def := Node.P_Failsafe_Referenced_Def_Name (True);
-         Def :=  Libadalang.Analysis.Defining_Name (Failsafe_Def.Def_Name);
+         Failsafe_Decl := Node.P_Failsafe_Referenced_Decl (True);
+         Def :=  Libadalang.Analysis.Defining_Name (Failsafe_Decl.Def_Name);
       end if;
 
       if Node.Kind in Libadalang.Common.Ada_Name then


[FILE:166:patches/patch-gnat_tester.gpr]
--- gnat/tester.gpr.orig	2025-07-02 16:04:06 UTC
+++ gnat/tester.gpr
@@ -17,6 +17,7 @@
 
 with "lsp_client";
 with "gnatcoll";
+with "vss_os";
 
 project Tester is
 

