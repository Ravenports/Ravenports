# Buildsheet autogenerated by ravenadm tool -- Do not edit.

NAMEBASE=		monit
VERSION=		5.34.3
KEYWORDS=		sysutils
VARIANTS=		std
SDESC[std]=		Unix system management and proactive monitoring
HOMEPAGE=		https://mmonit.com/monit/
CONTACT=		nobody

DOWNLOAD_GROUPS=	main
SITES[main]=		https://mmonit.com/monit/dist/
DISTFILE[1]=		monit-5.34.3.tar.gz:main
DF_INDEX=		1
SPKGS[std]=		set
			primary
			man

OPTIONS_AVAILABLE=	none
OPTIONS_STANDARD=	none

BUILD_DEPENDS=		openpam:dev:std
BUILDRUN_DEPENDS=	openpam:primary:std

USES=			cpe ssl:openssl30 bison gmake zlib mbsdfix

LICENSE=		AGPLv3:primary
LICENSE_TERMS=		primary:{{WRKDIR}}/TERMS
LICENSE_FILE=		AGPLv3:{{WRKSRC}}/COPYING
LICENSE_AWK=		TERMS:"^$$"
LICENSE_SOURCE=		TERMS:{{WRKSRC}}/src/monit.h
LICENSE_SCHEME=		solo

CPE_VENDOR=		tildeslash
FPC_EQUIVALENT=		sysutils/monit

MUST_CONFIGURE=		gnu
CONFIGURE_ARGS=		--with-ssl-dir={{OPENSSLBASE}}
CONFIGURE_ENV=		ax_cv_check_cflags___fstack_protector_all=no

INSTALL_REQ_TOOLCHAIN=	yes
RC_SUBR=		monit:primary
SUB_FILES=		messages-primary.ucl

post-install:
	${INSTALL_DATA} ${WRKSRC}/monitrc \
		${STAGEDIR}${PREFIX}/etc/monitrc.sample

[FILE:1088:descriptions/desc.primary]
Monit is a utility for managing and monitoring processes,
files, directories, devices and network services on a Unix system.
Monit conducts automatic maintenance and repair and can execute
meaningful causal actions in error situations.

monit supports:
 * Daemon mode - poll services at a specified interval
 * Group and manage groups of services, service dependencies
 * Logging - syslog or own logfile
 * Alert, start, stop and restart of services based on it's characteristics
 * MD5 and SHA1 checksums
 * Runtime Unix socket and TCP/IP port checking (TCP and UDP)
 * Process status, timeout, memory and cpu usage, etc.
 * Device usage monitoring (inodes and space)
 * File monitoring (timestamp, checksum, permission, owner, etc.)
 * Directory monitoring (timestamp, permission, owner, etc.)
 * Remote network services monitoring (ping, response time, protocol, etc.)
 * System load average monitoring
 * Flexible and customizable email alert messages and notifications
 * Protocol verification such as HTTP, FTP, SMTP, POP, IMAP, NNTP, NTP
 * A HTTP interface with XML output option


[FILE:98:distinfo]
669d8b95ddec124d1444ba5264f67fdeae8e90e53b2929719f4750fc5ff3ba60      1518592 monit-5.34.3.tar.gz


[FILE:37:manifests/plist.primary]
@sample etc/monitrc.sample
bin/monit


[FILE:23:manifests/plist.man]
share/man/man1/monit.1


[FILE:346:patches/patch-configure]
--- configure.orig	2024-10-11 11:03:00 UTC
+++ configure
@@ -19287,7 +19287,7 @@ _ACEOF
 fi
 
    with_pam=0 # No PAM on OpenBSD (supports BSD Auth API instead of PAM)
-elif test "$architecture" = "FreeBSD"
+elif test "$architecture" = "FreeBSD" || test "$architecture" = "MidnightBSD"
 then
    ARCH="FREEBSD"
    CFLAGS="$CFLAGS -D _REENTRANT"


[FILE:310:patches/patch-libmonit_configure]
--- libmonit/configure.orig	2024-10-11 11:03:01 UTC
+++ libmonit/configure
@@ -13372,7 +13372,7 @@ then
 
 $as_echo "#define LINUX 1" >>confdefs.h
 
-elif test "$architecture" = "FreeBSD"
+elif test "$architecture" = "FreeBSD" || test "$architecture" = "MidnightBSD"
 then
    CFLAGS="$CFLAGS -D _REENTRANT"
 


[FILE:386:patches/patch-src_net_os_dragonfly_Link.inc]
--- src/net/os/dragonfly/Link.inc.orig	2024-10-11 11:02:44 UTC
+++ src/net/os/dragonfly/Link.inc
@@ -32,7 +32,7 @@
  */
 
 
-static boolean_t _update(T L, const char *interface) {
+static bool _update(T L, const char *interface) {
         for (struct ifaddrs *a = _stats.addrs; a != NULL; a = a->ifa_next) {
                 if (a->ifa_addr == NULL)
                         continue;


[FILE:774:patches/patch-src_process_sysdep__DRAGONFLY.c]
--- src/process/sysdep_DRAGONFLY.c.orig	2024-10-11 11:02:44 UTC
+++ src/process/sysdep_DRAGONFLY.c
@@ -74,6 +74,7 @@
 #endif
 
 #include "monit.h"
+#include "system/Time.h"
 #include "ProcessTree.h"
 #include "process_sysdep.h"
 
@@ -141,7 +142,8 @@ bool init_systeminfo_sysdep(void) {
  * @return treesize > 0 if succeeded otherwise 0.
  */
 int init_processtree_sysdep(ProcessTree_T **reference, ProcessEngine_Flags pflags) {
-        kvm_t *kvm_handle = kvm_open(NULL, _PATH_DEVNULL, NULL, O_RDONLY, prog);
+	char errbuf[_POSIX2_LINE_MAX];
+        kvm_t *kvm_handle = kvm_open(NULL, _PATH_DEVNULL, NULL, O_RDONLY, errbuf);
         if (! kvm_handle) {
                 Log_error("system statistic error -- cannot initialize kvm interface\n");
                 return 0;


[FILE:268:files/messages-primary.ucl.in]
primary: {
  type: "install"
  message: <<EOM
USAGE:

To enable monit you need to add monit_enable="YES" to rc.conf file.
Before running monit you have to configure monitrc file. There is
example configuration file monitrc.sample.

%%PREFIX%%/etc/monitrc.sample
EOM
}


[FILE:864:files/monit.in]
#!/bin/sh
#
# PROVIDE: monit
# REQUIRE: NETWORKING SERVERS
# BEFORE: DAEMON
# KEYWORD: shutdown

#
# Add the following lines to /etc/rc.conf to enable monit:
# monit_enable (bool):        Set to "NO" by default.
#                             Set it to "YES" to enable monit
# monit_flags (str):          Flags passed to monit on startup.
#                             Default is "".
#
. /etc/rc.subr

name=monit
rcvar=monit_enable
load_rc_config ${name}

: ${monit_enable:=NO}

extra_commands=reload
restart_precmd=monit_checkconfig
reload_precmd=monit_checkconfig

default_config=%%PREFIX%%/etc/monitrc
required_files=${default_config}
command="%%PREFIX%%/bin/monit"
command_args="-c ${default_config}"
pidfile=/var/run/monit.pid

monit_checkconfig()
{
	echo "Performing sanity check on monit configuration:"
	${command} ${command_args} -t
}

run_rc_command "$1"

