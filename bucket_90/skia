# Buildsheet autogenerated by ravenadm tool -- Do not edit.

NAMEBASE=		skia
VERSION=		113
EPOCH=			1
KEYWORDS=		graphics
VARIANTS=		standard
SDESC[standard]=	Open-source 2D graphics library
HOMEPAGE=		https://skia.org
CONTACT=		nobody

DOWNLOAD_GROUPS=	main dng piex sfn wuffs zlib
SITES[main]=		GITHUB/google:skia:9bfb45d
SITES[dng]=		GITHUB/QtSkia:dng_sdk:c8d0c9b:third_party/externals/dng_sdk
SITES[piex]=		GITHUB/google:piex:f1e15dd:third_party/externals/piex
SITES[sfn]=		GITHUB/googlefonts:sfntly:b55ff30:third_party/externals/sfntly
SITES[wuffs]=		GITHUB/google:wuffs-mirror-release-c:a0041ac:third_party/externals/wuffs
SITES[zlib]=		https://chromium.googlesource.com/chromium/src/third_party/zlib/+archive/
DISTFILE[1]=		generated:main
DISTFILE[2]=		generated:sfn
DISTFILE[3]=		generated:dng
DISTFILE[4]=		generated:piex
DISTFILE[5]=		c876c8f87101c5a75f6014b0f832499afeb65b73.tar.gz:zlib
DISTFILE[6]=		generated:wuffs
DIST_SUBDIR=		skia-src
DF_INDEX=		1 2 3 4 5 6
SPKGS[standard]=	complete
			primary
			dev

OPTIONS_AVAILABLE=	none
OPTIONS_STANDARD=	none

BUILD_DEPENDS=		gn:single:standard
			harfbuzz:dev:standard
			fontconfig:dev:standard
			xorg-x11:dev:standard
			icu:dev:standard
BUILDRUN_DEPENDS=	WebP:single:standard
			harfbuzz:primary:standard
			harfbuzz:icu:standard

USES=			ninja jpeg png expat zlib freetype c++:primary

EXTRACT_DIRTY=		5

LICENSE=		BSD3CLAUSE:primary
LICENSE_FILE=		BSD3CLAUSE:{{WRKSRC}}/LICENSE
LICENSE_SCHEME=		solo

CONFIGURE_OUTSOURCE=	yes

SOVERSION=		1.0

VAR_OPSYS[freebsd]=	VAR1=skia_enable_fontmgr_empty=true
VAR_OPSYS[netbsd]=	VAR1=skia_enable_fontmgr_empty=true
VAR_OPSYS[dragonfly]=	VAR1=skia_enable_fontmgr_empty=true
VAR_OPSYS[midnightbsd]=	VAR1=skia_enable_fontmgr_empty=true

do-configure:
	${MKDIR} ${CONFIGURE_WRKSRC}
	(cd ${WRKSRC} && ${SETENV} ${CONFIGURE_ENV} \
		gn gen ${CONFIGURE_WRKSRC} --args="\
		is_official_build=true \
		is_component_build=true \
		skia_use_system_libjpeg_turbo=true \
		skia_use_system_libpng=true \
		skia_use_system_libwebp=true \
		skia_use_system_icu=true \
		skia_use_system_expat=true \
		skia_use_system_zlib=true \
		skia_use_system_harfbuzz=true \
		${VAR1} \
		")

pre-configure:
	${REINPLACE_CMD} -e 's|/usr/include/harfbuzz|${LOCALBASE}/include/harfbuzz|'\
		${WRKSRC}/third_party/harfbuzz/BUILD.gn
	${REINPLACE_CMD} -e 's|/usr/include/freetype2|${LOCALBASE}/include/freetype2|'\
		${WRKSRC}/third_party/freetype2/BUILD.gn
	# Delete reference to gn function "set_sources_assignment_filter"
	# https://gn.googlesource.com/gn/+/55e535a6716e57320fdd3901f0347a5c30562199
	${REINPLACE_CMD} -e '/set_sources_assignment_filter/d' \
		-e '/visibility/d' \
		${WRKSRC}/BUILD.gn

post-extract:
	${MV} ${WRKDIR}/skia_5 ${WRKSRC}/third_party/externals/zlib

do-install:
	${MKDIR} ${STAGEDIR}${PREFIX}/lib
	${MKDIR} ${STAGEDIR}${PREFIX}/include/skia
	${INSTALL_LIB} ${BUILD_WRKSRC}/libskia.so \
		${STAGEDIR}${PREFIX}/lib/libskia.so.1.0
	(cd ${STAGEDIR}${PREFIX}/lib && \
		${LN} -s libskia.so.1.0 libskia.so)
	(cd ${WRKSRC} && ${COPYTREE_SHARE} \
		include ${STAGEDIR}${PREFIX}/include/skia)

[FILE:265:descriptions/desc.primary]
Skia is an open source 2D graphics library which provides common APIs that
work across a variety of hardware and software platforms. It serves as the
graphics engine for Google Chrome and Chrome OS, Android, Mozilla Firefox
and Firefox OS, and many other products.


[FILE:733:distinfo]
c15c41e69b3e86c3e653c980a810a8cc1af23f590f0bb483b462c9c065f49829     59906409 skia-src/google-skia-9bfb45d.tar.gz
471fdcebf662f3b731e602b41461aa7a6cdcda9d78d8ec5196edf08f504fe53f     39295928 skia-src/googlefonts-sfntly-b55ff30.tar.gz
a523111f2911a68efc3f1488dc60c8bd4d41746731ce28014ae273767a28311e       421656 skia-src/QtSkia-dng_sdk-c8d0c9b.tar.gz
fc3e75fe261db3740d3d1b2d16e8130b39218b5a1af5d412da9eb42b24c49ee0        41606 skia-src/google-piex-f1e15dd.tar.gz
cac36317b07faebee81401d7abc90606abc7be8edc1746d545155bb5d906cf0b       314249 skia-src/c876c8f87101c5a75f6014b0f832499afeb65b73.tar.gz
772dd0b61d08ff475b8b18cc4bbf82ed93a4afbc3a26f5322eeeaaafac0891dd       325343 skia-src/google-wuffs-mirror-release-c-a0041ac.tar.gz


[FILE:43:manifests/plist.primary]
lib/
 libskia.so
 libskia.so.%%SOVERSION%%


[FILE:7227:manifests/plist.dev]
include/skia/include/
 BUILD.bazel
 OWNERS
include/skia/include/android/
 BUILD.bazel
 SkAndroidFrameworkUtils.h
 SkAnimatedImage.h
 SkImageAndroid.h
include/skia/include/codec/
 BUILD.bazel
 SkAndroidCodec.h
 SkCodec.h
 SkCodecAnimation.h
 SkEncodedOrigin.h
include/skia/include/config/
 BUILD.bazel
 SkUserConfig.h
include/skia/include/core/
 BUILD.bazel
 SkAlphaType.h
 SkAnnotation.h
 SkBBHFactory.h
 SkBitmap.h
 SkBlendMode.h
 SkBlender.h
 SkBlurTypes.h
 SkCanvas.h
 SkCanvasVirtualEnforcer.h
 SkCapabilities.h
 SkClipOp.h
 SkColor.h
 SkColorFilter.h
 SkColorPriv.h
 SkColorSpace.h
 SkColorType.h
 SkContourMeasure.h
 SkCoverageMode.h
 SkCubicMap.h
 SkData.h
 SkDataTable.h
 SkDeferredDisplayList.h
 SkDeferredDisplayListRecorder.h
 SkDocument.h
 SkDrawLooper.h
 SkDrawable.h
 SkEncodedImageFormat.h
 SkExecutor.h
 SkFlattenable.h
 SkFont.h
 SkFontArguments.h
 SkFontMetrics.h
 SkFontMgr.h
 SkFontParameters.h
 SkFontStyle.h
 SkFontTypes.h
 SkGraphics.h
 SkICC.h
 SkImage.h
 SkImageEncoder.h
 SkImageFilter.h
 SkImageGenerator.h
 SkImageInfo.h
 SkM44.h
 SkMallocPixelRef.h
 SkMaskFilter.h
 SkMatrix.h
 SkMesh.h
 SkMilestone.h
 SkOpenTypeSVGDecoder.h
 SkOverdrawCanvas.h
 SkPaint.h
 SkPath.h
 SkPathBuilder.h
 SkPathEffect.h
 SkPathMeasure.h
 SkPathTypes.h
 SkPathUtils.h
 SkPicture.h
 SkPictureRecorder.h
 SkPixelRef.h
 SkPixmap.h
 SkPngChunkReader.h
 SkPoint.h
 SkPoint3.h
 SkPromiseImageTexture.h
 SkRRect.h
 SkRSXform.h
 SkRasterHandleAllocator.h
 SkRect.h
 SkRefCnt.h
 SkRegion.h
 SkSamplingOptions.h
 SkScalar.h
 SkSerialProcs.h
 SkShader.h
 SkSize.h
 SkSpan.h
 SkStream.h
 SkString.h
 SkStrokeRec.h
 SkSurface.h
 SkSurfaceCharacterization.h
 SkSurfaceProps.h
 SkSwizzle.h
 SkTextBlob.h
 SkTextureCompressionType.h
 SkTileMode.h
 SkTime.h
 SkTraceMemoryDump.h
 SkTypeface.h
 SkTypes.h
 SkUnPreMultiply.h
 SkVertices.h
 SkYUVAInfo.h
 SkYUVAPixmaps.h
include/skia/include/docs/
 BUILD.bazel
 SkPDFDocument.h
 SkXPSDocument.h
include/skia/include/effects/
 BUILD.bazel
 Sk1DPathEffect.h
 Sk2DPathEffect.h
 SkBlenders.h
 SkBlurDrawLooper.h
 SkBlurMaskFilter.h
 SkColorMatrix.h
 SkColorMatrixFilter.h
 SkCornerPathEffect.h
 SkDashPathEffect.h
 SkDiscretePathEffect.h
 SkGradientShader.h
 SkHighContrastFilter.h
 SkImageFilters.h
 SkLayerDrawLooper.h
 SkLumaColorFilter.h
 SkOpPathEffect.h
 SkOverdrawColorFilter.h
 SkPerlinNoiseShader.h
 SkRuntimeEffect.h
 SkShaderMaskFilter.h
 SkStrokeAndFillPathEffect.h
 SkTableColorFilter.h
 SkTableMaskFilter.h
 SkTrimPathEffect.h
include/skia/include/encode/
 BUILD.bazel
 SkEncoder.h
 SkJpegEncoder.h
 SkPngEncoder.h
 SkWebpEncoder.h
include/skia/include/gpu/
 BUILD.bazel
 GpuTypes.h
 GrBackendDrawableInfo.h
 GrBackendSemaphore.h
 GrBackendSurface.h
 GrBackendSurfaceMutableState.h
 GrContextOptions.h
 GrContextThreadSafeProxy.h
 GrDirectContext.h
 GrDriverBugWorkarounds.h
 GrDriverBugWorkaroundsAutogen.h
 GrRecordingContext.h
 GrSurfaceInfo.h
 GrTypes.h
 GrYUVABackendTextures.h
 MutableTextureState.h
 ShaderErrorHandler.h
include/skia/include/gpu/d3d/
 BUILD.bazel
 GrD3DBackendContext.h
 GrD3DTypes.h
include/skia/include/gpu/dawn/
 BUILD.bazel
 GrDawnTypes.h
include/skia/include/gpu/gl/
 BUILD.bazel
 GrGLAssembleHelpers.h
 GrGLAssembleInterface.h
 GrGLConfig.h
 GrGLConfig_chrome.h
 GrGLExtensions.h
 GrGLFunctions.h
 GrGLInterface.h
 GrGLTypes.h
include/skia/include/gpu/gl/egl/
 BUILD.bazel
 GrGLMakeEGLInterface.h
include/skia/include/gpu/gl/glx/
 BUILD.bazel
 GrGLMakeGLXInterface.h
include/skia/include/gpu/graphite/
 BackendTexture.h
 Context.h
 ContextOptions.h
 GraphiteTypes.h
 ImageProvider.h
 Recorder.h
 Recording.h
 TextureInfo.h
 YUVABackendTextures.h
include/skia/include/gpu/graphite/dawn/
 DawnBackendContext.h
 DawnTypes.h
 DawnUtils.h
include/skia/include/gpu/graphite/mtl/
 BUILD.bazel
 MtlBackendContext.h
 MtlGraphiteTypes.h
 MtlGraphiteUtils.h
include/skia/include/gpu/graphite/vk/
 VulkanGraphiteTypes.h
 VulkanGraphiteUtils.h
include/skia/include/gpu/mock/
 BUILD.bazel
 GrMockTypes.h
include/skia/include/gpu/mtl/
 BUILD.bazel
 GrMtlBackendContext.h
 GrMtlTypes.h
 MtlMemoryAllocator.h
include/skia/include/gpu/vk/
 BUILD.bazel
 GrVkBackendContext.h
 GrVkExtensions.h
 GrVkMemoryAllocator.h
 GrVkTypes.h
 VulkanBackendContext.h
 VulkanExtensions.h
 VulkanMemoryAllocator.h
 VulkanTypes.h
include/skia/include/pathops/
 BUILD.bazel
 SkPathOps.h
include/skia/include/ports/
 BUILD.bazel
 SkCFObject.h
 SkFontConfigInterface.h
 SkFontMgr_FontConfigInterface.h
 SkFontMgr_android.h
 SkFontMgr_directory.h
 SkFontMgr_empty.h
 SkFontMgr_fontconfig.h
 SkFontMgr_fuchsia.h
 SkFontMgr_indirect.h
 SkFontMgr_mac_ct.h
 SkImageGeneratorCG.h
 SkImageGeneratorNDK.h
 SkImageGeneratorWIC.h
 SkRemotableFontMgr.h
 SkTypeface_mac.h
 SkTypeface_win.h
include/skia/include/private/
 BUILD.bazel
 OWNERS
 SkBitmaskEnum.h
 SkChecksum.h
 SkColorData.h
 SkEncodedInfo.h
 SkGainmapInfo.h
 SkGainmapShader.h
 SkIDChangeListener.h
 SkJpegGainmapEncoder.h
 SkOpts_spi.h
 SkPathRef.h
 SkSLDefines.h
 SkSLIRNode.h
 SkSLLayout.h
 SkSLModifiers.h
 SkSLProgramElement.h
 SkSLProgramKind.h
 SkSLSampleUsage.h
 SkSLStatement.h
 SkSLString.h
 SkSLSymbol.h
 SkShadowFlags.h
 SkSpinlock.h
 SkWeakRefCnt.h
include/skia/include/private/base/
 BUILD.bazel
 README.md
 SingleOwner.h
 SkAPI.h
 SkAlign.h
 SkAlignedStorage.h
 SkAssert.h
 SkAttributes.h
 SkCPUTypes.h
 SkContainers.h
 SkDebug.h
 SkDeque.h
 SkFeatures.h
 SkFixed.h
 SkFloatBits.h
 SkFloatingPoint.h
 SkLoadUserConfig.h
 SkMacros.h
 SkMalloc.h
 SkMath.h
 SkMutex.h
 SkNoncopyable.h
 SkOnce.h
 SkPathEnums.h
 SkSafe32.h
 SkSemaphore.h
 SkSpan_impl.h
 SkTArray.h
 SkTDArray.h
 SkTFitsIn.h
 SkTLogic.h
 SkTPin.h
 SkTemplates.h
 SkThreadAnnotations.h
 SkThreadID.h
 SkTo.h
 SkTypeTraits.h
include/skia/include/private/chromium/
 BUILD.bazel
 GrSlug.h
 GrVkSecondaryCBDrawContext.h
 SkChromeRemoteGlyphCache.h
 SkDiscardableMemory.h
 Slug.h
include/skia/include/private/gpu/BUILD.bazel
include/skia/include/private/gpu/ganesh/
 BUILD.bazel
 GrContext_Base.h
 GrD3DTypesMinimal.h
 GrDawnTypesPriv.h
 GrGLTypesPriv.h
 GrImageContext.h
 GrMockTypesPriv.h
 GrMtlTypesPriv.h
 GrTypesPriv.h
 GrVkTypesPriv.h
include/skia/include/private/gpu/graphite/
 DawnTypesPriv.h
 MtlGraphiteTypesPriv.h
 VulkanGraphiteTypesPriv.h
include/skia/include/private/gpu/vk/
 BUILD.bazel
 SkiaVulkan.h
 VulkanTypesPriv.h
include/skia/include/sksl/
 BUILD.bazel
 DSL.h
 DSLBlock.h
 DSLCase.h
 DSLCore.h
 DSLExpression.h
 DSLFunction.h
 DSLLayout.h
 DSLModifiers.h
 DSLStatement.h
 DSLType.h
 DSLVar.h
 OWNERS
 SkSLDebugTrace.h
 SkSLErrorReporter.h
 SkSLOperator.h
 SkSLPosition.h
 SkSLVersion.h
include/skia/include/svg/
 BUILD.bazel
 SkSVGCanvas.h
include/skia/include/third_party/vulkan/
 BUILD.bazel
 LICENSE
include/skia/include/third_party/vulkan/vulkan/
 vk_platform.h
 vulkan.h
 vulkan_android.h
 vulkan_core.h
 vulkan_ios.h
 vulkan_macos.h
 vulkan_win32.h
 vulkan_xcb.h
include/skia/include/utils/
 BUILD.bazel
 SkAnimCodecPlayer.h
 SkBase64.h
 SkCamera.h
 SkCanvasStateUtils.h
 SkCustomTypeface.h
 SkEventTracer.h
 SkNWayCanvas.h
 SkNoDrawCanvas.h
 SkNullCanvas.h
 SkOrderedFontMgr.h
 SkPaintFilterCanvas.h
 SkParse.h
 SkParsePath.h
 SkShadowUtils.h
 SkTextUtils.h
 SkTraceEventPhase.h
include/skia/include/utils/mac/
 BUILD.bazel
 SkCGUtils.h


[FILE:811:patches/patch-src_base_SkContainers.cpp]
--- src/base/SkContainers.cpp.orig	2023-03-17 16:04:02 UTC
+++ src/base/SkContainers.cpp
@@ -14,6 +14,8 @@
 
 #if defined(SK_BUILD_FOR_MAC) || defined(SK_BUILD_FOR_IOS)
 #include <malloc/malloc.h>
+#elif defined(__DragonFly__) || defined(__OpenBSD__)
+// do-nothing
 #elif defined(SK_BUILD_FOR_ANDROID) || defined(SK_BUILD_FOR_UNIX)
 #include <malloc.h>
 #elif defined(SK_BUILD_FOR_WIN)
@@ -38,6 +40,8 @@ SkSpan<std::byte> complete_size(void* pt
     #elif defined(SK_BUILD_FOR_ANDROID) && __ANDROID_API__ >= 17
         completeSize = malloc_usable_size(ptr);
         SkASSERT(completeSize >= size);
+    #elif defined(__DragonFly__) || defined(__OpenBSD__)
+        // do-nothing
     #elif defined(SK_BUILD_FOR_UNIX)
         completeSize = malloc_usable_size(ptr);
         SkASSERT(completeSize >= size);


[FILE:531:patches/patch-third__party_externals_dng__sdk_source_RawEnvironment.h]
--- third_party/externals/dng_sdk/source/RawEnvironment.h.orig	2019-03-13 04:56:20 UTC
+++ third_party/externals/dng_sdk/source/RawEnvironment.h
@@ -5,7 +5,7 @@
 // compilation. The constants qMacOS and qWinOS must be defined on all
 // platforms. Other constants, such as qLinux, only need to be defined if we're
 // actually compiling for that platform.
-#if defined(__linux__)
+#if defined(__linux__) || defined(__DragonFly__) || defined(__FreeBSD__) || defined(__NetBSD__)
 #define qMacOS 0
 #define qWinOS 0
 #define qLinux 1


[FILE:1461:patches/patch-third__party_externals_dng__sdk_source_dng__safe__arithmetic.h]
--- third_party/externals/dng_sdk/source/dng_safe_arithmetic.h.orig	2019-03-13 04:56:20 UTC
+++ third_party/externals/dng_sdk/source/dng_safe_arithmetic.h
@@ -109,20 +109,6 @@ std::int64_t SafeInt64MultSlow(std::int6
 
 // Internal function used as optimization for SafeInt64Mult() if Clang
 // __builtin_smull_overflow is supported. Don't call this function directly.
-#if __has_builtin(__builtin_smull_overflow)
-inline std::int64_t SafeInt64MultByClang(std::int64_t arg1, std::int64_t arg2) {
-  std::int64_t result;
-#if (__WORDSIZE == 64) && !defined(__APPLE__)
-  if (__builtin_smull_overflow(arg1, arg2, &result)) {
-#else
-  if (__builtin_smulll_overflow(arg1, arg2, &result)) {
-#endif
-    ThrowProgramError("Arithmetic overflow");
-    abort();  // Never reached.
-  }
-  return result;
-}
-#endif
 
 // Internal function used as optimization for SafeInt64Mult() if __int128 type
 // is supported. Don't call this function directly.
@@ -147,9 +133,7 @@ inline std::int64_t SafeInt64MultByInt12
 // (without overflow). Otherwise, throws a dng_exception with error code
 // dng_error_unknown.
 inline std::int64_t SafeInt64Mult(std::int64_t arg1, std::int64_t arg2) {
-#if __has_builtin(__builtin_smull_overflow)
-  return dng_internal::SafeInt64MultByClang(arg1, arg2);
-#elif defined(DNG_HAS_INT128)
+#if defined(DNG_HAS_INT128)
   return dng_internal::SafeInt64MultByInt128(arg1, arg2);
 #else
   return dng_internal::SafeInt64MultSlow(arg1, arg2);


[FILE:329:patches/patch-third__party_externals_piex_src_image__type__recognition_image__type__recognition__lite.cc]
--- third_party/externals/piex/src/image_type_recognition/image_type_recognition_lite.cc.orig	2022-02-17 16:43:38 UTC
+++ third_party/externals/piex/src/image_type_recognition/image_type_recognition_lite.cc
@@ -26,6 +26,7 @@
 
 #include <algorithm>
 #include <cassert>
+#include <cstring>
 #include <string>
 #include <vector>
 


[FILE:312:files/special.mk]
_USES_extract+=	501:make_extdir

.if "${OPSYS}" != "Linux"
_USES_configure+= 452:remove_libdl
.endif

make_extdir:
	${MKDIR} ${WRKSRC}/third_party/externals

remove_libdl:
	@echo "BSD: Remove -ldl linkage"
	${REINPLACE_CMD} -e 's|-ldl||' ${WRKSRC}/public.bzl
	${REINPLACE_CMD} -e 's|"dl"|""|' ${WRKSRC}/BUILD.gn

