# Buildsheet autogenerated by ravenadm tool -- Do not edit.

NAMEBASE=		tesseract
VERSION=		5.5.0
KEYWORDS=		graphics
VARIANTS=		std
SDESC[std]=		OCR (Optical Character Recognition) engine
HOMEPAGE=		https://github.com/tesseract-ocr/tesseract
CONTACT=		nobody

DOWNLOAD_GROUPS=	main
SITES[main]=		GITHUB/tesseract-ocr:tesseract:5.5.0
DISTFILE[1]=		generated:main
DF_INDEX=		1
SPKGS[std]=		set
			primary
			dev
			tools

OPTIONS_AVAILABLE=	none
OPTIONS_STANDARD=	none

BUILD_DEPENDS=		harfbuzz:dev:std
			leptonica:dev:std
			icu:dev:std
			llvm:dev:std
			llvm:tools:std
BUILDRUN_DEPENDS=	icu:primary:std
			leptonica:primary:std
			llvm:primary:std
			pango:primary:std
RUN_DEPENDS=		tesseract-data:latin:std
EXRUN[tools]=		tesseract:primary:std

USES=			cpe autoreconf libtool fontconfig pkgconfig gettext
			fortran:library,tools
C_USES[freebsd]=	fortran:library
GNOME_COMPONENTS=	pango cairo

CPE_VENDOR=		tesseract_project
FPC_EQUIVALENT=		graphics/tesseract

MUST_CONFIGURE=		gnu
CONFIGURE_ENV=		LIBLEPT_HEADERSDIR="{{LOCALBASE}}/include/leptonica"

MAKE_ARGS=		datadir={{LOCALBASE}}/share/tesseract-data

INSTALL_TARGET=		install-strip training-install
INSTALL_REQ_TOOLCHAIN=	yes
SOVERSION=		5.0.5

LDFLAGS=		-lpthread

post-patch:
	${REINPLACE_CMD} -e 's|-O3 -DNDEBUG||' ${WRKSRC}/configure.ac

post-install:
	${STRIP_CMD} ${STAGEDIR}${PREFIX}/bin/*

[FILE:291:descriptions/desc.primary]
The Tesseract OCR engine was one of the top 3 engines in the 1995 UNLV
Accuracy test. Between 1995 and 2006 it had little work done on it, but
it is probably one of the most accurate open source OCR engines available.
The source code will read a binary, grey or color image and output text.


[FILE:54:descriptions/desc.tools]
This package contains the Tesseract OCR engine tools.


[FILE:115:distinfo]
f2fb34ca035b6d087a42875a35a7a5c4155fa9979c6132365b1e5a28ebc3fc11      1905018 tesseract-ocr-tesseract-5.5.0.tar.gz


[FILE:65:manifests/plist.primary]
lib/
 libtesseract.so.%%SOMAJOR%%
 libtesseract.so.%%SOVERSION%%


[FILE:241:manifests/plist.dev]
include/tesseract/
 baseapi.h
 capi.h
 export.h
 ltrresultiterator.h
 ocrclass.h
 osdetect.h
 pageiterator.h
 publictypes.h
 renderer.h
 resultiterator.h
 unichar.h
 version.h
lib/
 libtesseract.a
 libtesseract.so
lib/pkgconfig/tesseract.pc


[FILE:588:manifests/plist.tools]
bin/
 ambiguous_words
 classifier_tester
 cntraining
 combine_lang_model
 combine_tessdata
 dawg2wordlist
 lstmeval
 lstmtraining
 merge_unicharsets
 mftraining
 set_unicharset_properties
 shapeclustering
 tesseract
 text2image
 unicharset_extractor
 wordlist2dawg
share/tesseract-data/
 alto
 ambigs.train
 api_config
 batch
 batch.nochop
 bigram
 box.train
 box.train.stderr
 digits
 get.images
 hocr
 inter
 kannada
 linebox
 logfile
 lstm.train
 lstmbox
 lstmdebug
 makebox
 matdemo
 msdemo
 nobatch
 page
 pdf
 pdf.ttf
 quiet
 rebox
 segdemo
 strokewidth
 tsv
 txt
 unlv
 wordstrbox


[FILE:683:freebsd/patch-configure.ac]
sem_init(3) is part of libc on FreeBSD, so we ended up not linking against
libpthread. Look for a symbol that causes us to load it.
libtesseract.so is not linked against libomp if openmp is enabled,
which makes dependent ports fail. This adds a workaround by linking
directly against libomp.
--- configure.ac.orig	2024-11-10 19:23:34 UTC
+++ configure.ac
@@ -422,6 +422,9 @@ esac
 # ----------------------------------------
 
 AC_SEARCH_LIBS([pthread_create], [pthread])
+if test "$enable_openmp" != no; then
+  AC_SEARCH_LIBS([omp_get_thread_num ], [omp])
+fi
 
 # Set PKG_CONFIG_PATH for macOS with Homebrew unless it is already set.
 AC_CHECK_PROG([have_brew], brew, true, false)

