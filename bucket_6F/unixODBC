# Buildsheet autogenerated by ravenadm tool -- Do not edit.

NAMEBASE=		unixODBC
VERSION=		2.3.14
KEYWORDS=		databases
VARIANTS=		std
SDESC[std]=		ODBC library suite for Unix
HOMEPAGE=		https://www.unixodbc.org/
CONTACT=		nobody

DOWNLOAD_GROUPS=	main
SITES[main]=		ftp://ftp.unixodbc.org/pub/unixODBC/
DISTFILE[1]=		unixODBC-2.3.14.tar.gz:main
DF_INDEX=		1
SPKGS[std]=		set
			primary
			tools
			dev
			man
			docs

OPTIONS_AVAILABLE=	none
OPTIONS_STANDARD=	none

EXRUN[tools]=		primary

USES=			cpe iconv libtool mbsdfix

LICENSE=		GPLv2:primary LGPL21:primary
LICENSE_TERMS=		primary:{{WRKDIR}}/TERMS
LICENSE_FILE=		GPLv2:stock
			LGPL21:{{WRKSRC}}/COPYING
LICENSE_SCHEME=		multi

CPE_PRODUCT=		unixodbc
CPE_VENDOR=		unixodbc
FPC_EQUIVALENT=		databases/unixODBC

MUST_CONFIGURE=		gnu
CONFIGURE_ARGS=		--enable-static
			--enable-shared
			{{ICONV_CONFIGURE_ARG}}

INSTALL_TARGET=		install-strip
INSTALL_REQ_TOOLCHAIN=	yes

VAR_OPSYS[sunos]=	CFLAGS=-D_POSIX_PTHREAD_SEMANTICS
			LDFLAGS=-lsocket

post-install:
	(cd ${WRKSRC}/doc && ${COPYTREE_SHARE} . ${STAGEDIR}${STD_DOCDIR} \
	    "-not -name 'Makefile*'")

pre-configure:
	${REINPLACE_CMD} -e 's|\.ini$$|.ini.sample|' ${WRKSRC}/Makefile.in
	# fix mutext
	${REINPLACE_CMD} -e 's,mutex_exit,odbc_mutex_exit,g' \
		${WRKSRC}/DriverManager/__handles.c \
		${WRKSRC}/odbcinst/_logging.c \
		${WRKSRC}/odbcinst/SQLGetPrivateProfileString.c

post-extract:
	${HEAD} -n 17 ${WRKSRC}/README | ${TAIL} -n 5 > ${WRKDIR}/TERMS

[FILE:356:descriptions/desc.primary]
What is the unixODBC Project?

The unixODBC Project goals are to develop and promote unixODBC to be the
definitive standard for ODBC on the Linux platform.

ODBC is an open specification for providing application developers with
a predictable API with which to access Data Sources. Data Sources include
SQL Servers and any Data Source with an ODBC Driver.


[FILE:34:descriptions/desc.tools]
This package contains ODBC tools.


[FILE:101:distinfo]
4e2814de3e01fc30b0b9f75e83bb5aba91ab0384ee951286504bb70205524771      1758907 unixODBC-2.3.14.tar.gz


[FILE:113:manifests/plist.primary]
lib/
 libodbc.so.2
 libodbc.so.2.0.0
 libodbccr.so.2
 libodbccr.so.2.0.0
 libodbcinst.so.2
 libodbcinst.so.2.0.0


[FILE:132:manifests/plist.tools]
@sample etc/odbc.ini.sample
@sample etc/odbcinst.ini.sample
bin/
 dltest
 isql
 iusql
 odbcinst
 slencheck
@dir etc/ODBCDataSources


[FILE:325:manifests/plist.dev]
bin/odbc_config
include/
 autotest.h
 odbcinst.h
 odbcinstext.h
 sql.h
 sqlext.h
 sqlspi.h
 sqltypes.h
 sqlucode.h
 unixodbc.h
 uodbc_extras.h
 uodbc_stats.h
include/unixODBC/unixodbc_conf.h
lib/
 libodbc.a
 libodbc.so
 libodbccr.a
 libodbccr.so
 libodbcinst.a
 libodbcinst.so
lib/pkgconfig/
 odbc.pc
 odbccr.pc
 odbcinst.pc


[FILE:140:manifests/plist.man]
share/man/man1/
 dltest.1
 isql.1
 iusql.1
 odbc_config.1
 odbcinst.1
share/man/man5/
 odbc.ini.5
 odbcinst.ini.5
share/man/man7/unixODBC.7


[FILE:1973:patches/patch-odbcinst_SQLSetConfigMode.c]
$NetBSD: patch-odbcinst_SQLSetConfigMode.c,v 1.1 2025/10/17 13:15:29 jperkin Exp $

Avoid conflict with system mutex_entry() / mutex_exit().

--- odbcinst/SQLSetConfigMode.c.orig	2025-10-17 13:11:08.381130630 +0000
+++ odbcinst/SQLSetConfigMode.c
@@ -30,7 +30,7 @@ static int __config_mode = ODBC_BOTH_DSN
 static pth_mutex_t mutex_config = PTH_MUTEX_INIT;
 static int pth_init_called = 0;
 
-static int mutex_entry( pth_mutex_t *mutex )
+static int sql_mutex_entry( pth_mutex_t *mutex )
 {
     if ( !pth_init_called )
     {
@@ -40,7 +40,7 @@ static int mutex_entry( pth_mutex_t *mut
     return pth_mutex_acquire( mutex, 0, NULL );
 }
 
-static int mutex_exit( pth_mutex_t *mutex )
+static int sql_mutex_exit( pth_mutex_t *mutex )
 {
     return pth_mutex_release( mutex );
 }
@@ -51,12 +51,12 @@ static int mutex_exit( pth_mutex_t *mute
                 
 static pthread_mutex_t mutex_config = PTHREAD_MUTEX_INITIALIZER;
 
-static int mutex_entry( pthread_mutex_t *mutex )
+static int sql_mutex_entry( pthread_mutex_t *mutex )
 {
     return pthread_mutex_lock( mutex );
 }
 
-static int mutex_exit( pthread_mutex_t *mutex )
+static int sql_mutex_exit( pthread_mutex_t *mutex )
 {
     return pthread_mutex_unlock( mutex );
 }
@@ -67,31 +67,31 @@ static int mutex_exit( pthread_mutex_t *
 
 static mutex_t mutex_config;
 
-static int mutex_entry( mutex_t *mutex )
+static int sql_mutex_entry( mutex_t *mutex )
 {
     return mutex_lock( mutex );
 }
 
-static int mutex_exit( mutex_t *mutex )
+static int sql_mutex_exit( mutex_t *mutex )
 {
     return mutex_unlock( mutex );
 }
 
 #else
 
-#define mutex_entry(x)
-#define mutex_exit(x)
+#define sql_mutex_entry(x)
+#define sql_mutex_exit(x)
 
 #endif
 
 void __lock_config_mode( void )
 {
-    mutex_entry( &mutex_config );
+    sql_mutex_entry( &mutex_config );
 }
 
 void __unlock_config_mode( void )
 {
-    mutex_exit( &mutex_config );
+    sql_mutex_exit( &mutex_config );
 }
 
 void __set_config_mode( int mode )

