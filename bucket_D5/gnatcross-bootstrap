# Buildsheet autogenerated by ravenadm tool -- Do not edit.

NAMEBASE=		gnatcross-bootstrap
VERSION=		14.3.0
KEYWORDS=		lang
VARIANTS=		std
SDESC[std]=		Gnatcross-to-native compiler generator
HOMEPAGE=		http://www.dragonlace.net/
CONTACT=		John_Marino[draco@marino.st]

DOWNLOAD_GROUPS=	main draco gmp iconv mpc mpfr
SITES[main]=		GCC/releases/gcc-14.3.0
SITES[draco]=		https://raw.githubusercontent.com/jrmarino/draco/14.3.0-base/generated/patches-14.3.0/
SITES[gmp]=		GNU/gmp
SITES[iconv]=		GNU/libiconv
SITES[mpc]=		GNU/mpc
SITES[mpfr]=		https://www.mpfr.org/mpfr-4.2.2/
DISTFILE[1]=		gcc-14.3.0.tar.xz:main
DISTFILE[2]=		mpfr-4.2.2.tar.xz:mpfr
DISTFILE[3]=		gmp-6.3.0.tar.xz:gmp
DISTFILE[4]=		mpc-1.3.1.tar.gz:mpc
DISTFILE[5]=		libiconv-1.18.tar.gz:iconv
DISTFILE[6]=		patch-diff-ada:draco
DISTFILE[7]=		patch-diff-core:draco
DISTFILE[8]=		patch-diff-cxx:draco
DISTFILE[9]=		patch-diff-ada-testsuite:draco
DISTFILE[10]=		patch-diff-gcc-testsuite:draco
DIST_SUBDIR=		gnatcross-bootstrap-14.3.0
DF_INDEX=		1 2 3 4 5
SPKGS[std]=		single

OPTIONS_AVAILABLE=	DISABLE FARM64_R11 FAMD64_R12 FI386_R12 OMNIOS
			MAMD64_R3
OPTIONS_STANDARD=	DISABLE FARM64_R11 FAMD64_R12 FI386_R12 OMNIOS
			MAMD64_R3
OPTGROUP_RADIO=		TARGET
OPTDESCR[TARGET]=	Target platform for generated compiler
OPTGROUP[TARGET]=	DISABLE FARM64_R11 FAMD64_R12 FI386_R12 OMNIOS
			MAMD64_R3
OPT_ON[all]=		DISABLE

BUILD_DEPENDS=		zstd:primary:std

USES=			gmake libtool perl:build

DISTNAME=		gcc-14.3.0

CC=			{{BSPREFIX}}/bin/{{TGTSYS}}-gcc
CPP=			{{BSPREFIX}}/bin/{{TGTSYS}}-cpp
CXX=			{{BSPREFIX}}/bin/{{TGTSYS}}-c++

PATCHFILES=		6 7 8 9 10

MUST_CONFIGURE=		yes
CONFIGURE_OUTSOURCE=	yes
CONFIGURE_ARGS=		--enable-languages="c,c++,ada"
			--prefix={{LOCALBASE}}/toolchain/gcc14
			--enable-shared
			--enable-threads=posix
			--enable-checking=release
			--disable-libquadmath
			--disable-nls
			--disable-multilib
			--disable-libsanitizer
			--disable-libvtv
			--disable-libmpx
			--disable-libcilkrts
			--disable-libstdcxx-pch
			--disable-lto
			--with-pkgversion="Ravenports"
CONFIGURE_ENV=		build_configargs="CPPFLAGS=\"{{CPPFLAGS}}\""
			host_configargs="CPPFLAGS=\"{{CPPFLAGS}}\""

INSTALL_TARGET=		install-strip
PLIST_SUB=		TGTSYS={{TGTSYS}}

INFRASTRUCTURE=		yes

[OMNIOS].DESCRIPTION=			Build native compiler for OmniOS v11
[OMNIOS].BUILD_DEPENDS_ON=		gnatcross:single:OMNIOS
[OMNIOS].CONFIGURE_ARGS_ON=		--build={{CONFIGURE_TARGET}}
					--host=x86_64-raven-solaris2.11
					--target=x86_64-raven-solaris2.11
					--disable-multilib
					--without-gnu-ld
					--with-gnu-as
					--with-as={{LOCALBASE}}/toolchain/bin/as
[OMNIOS].MAKEFILE_ON=			TGTSYS=x86_64-raven-solaris2.11
					BSPREFIX={{LOCALBASE}}/OmniOS11
					PREPEND_PATH={{BSPREFIX}}/{{TGTSYS}}/bin:{{BSPREFIX}}/bin

[FARM64_R11].DESCRIPTION=		Build native compiler for FreeBSD/ARM64 Release 11
[FARM64_R11].BUILD_DEPENDS_ON=		gnatcross:single:FARM64_R11
[FARM64_R11].CONFIGURE_ARGS_ON=		--build={{CONFIGURE_TARGET}}
					--host=aarch64-raven-freebsd11.3
					--target=aarch64-raven-freebsd11.3
[FARM64_R11].MAKEFILE_ON=		TGTSYS=aarch64-raven-freebsd11.3
					BSPREFIX={{LOCALBASE}}/FreeBSD11_ARM64
					PREPEND_PATH={{BSPREFIX}}/{{TGTSYS}}/bin:{{BSPREFIX}}/bin

[MAMD64_R3].DESCRIPTION=		Build native compiler for MidnighBSD/AMD64 R3.0.0
[MAMD64_R3].BUILD_DEPENDS_ON=		gnatcross:single:MAMD64_R3
[MAMD64_R3].CONFIGURE_ARGS_ON=		--build={{CONFIGURE_TARGET}}
					--host=x86_64-raven-freebsd12.3
					--target=x86_64-raven-freebsd12.3
[MAMD64_R3].MAKEFILE_ON=		TGTSYS=x86_64-raven-freebsd12.3
					BSPREFIX={{LOCALBASE}}/MidnightBSD_AMD64
					PREPEND_PATH={{BSPREFIX}}/{{TGTSYS}}/bin:{{BSPREFIX}}/bin

[FI386_R12].DESCRIPTION=		Build native compiler for FreeBSD/I386 Release 12
[FI386_R12].BUILD_DEPENDS_ON=		gnatcross:single:FI386_R12
[FI386_R12].CONFIGURE_ARGS_ON=		--build={{CONFIGURE_TARGET}}
					--host=i386-raven-freebsd12.2
					--target=i386-raven-freebsd12.2
[FI386_R12].MAKEFILE_ON=		TGTSYS=i386-raven-freebsd12.2
					BSPREFIX={{LOCALBASE}}/FreeBSD12_I386
					PREPEND_PATH={{BSPREFIX}}/{{TGTSYS}}/bin:{{BSPREFIX}}/bin

[DISABLE].DESCRIPTION=			Disable building of native compiler (default)
[DISABLE].BROKEN_ON=			Native compiler building disabled (set option!)

[FAMD64_R12].DESCRIPTION=		Build native compiler for FreeBSD/AMD64 Release 12
[FAMD64_R12].BUILD_DEPENDS_ON=		gnatcross:single:FAMD64_R12
[FAMD64_R12].CONFIGURE_ARGS_ON=		--build={{CONFIGURE_TARGET}}
					--host=x86_64-raven-freebsd12.2
					--target=x86_64-raven-freebsd12.2
[FAMD64_R12].MAKEFILE_ON=		TGTSYS=x86_64-raven-freebsd12.2
					BSPREFIX={{LOCALBASE}}/FreeBSD12_AMD64
					PREPEND_PATH={{BSPREFIX}}/{{TGTSYS}}/bin:{{BSPREFIX}}/bin

post-patch:
	# Update LINK_SPEC to add gcc-aux lib runpath in every binary
	@${ECHO} "Configuring LINK_SPEC runpath"
	${REINPLACE_CMD} -e 's;\@PREFIX\@;${PREFIX:H};' \
		-e 's;\@GCCAUX\@;${NAMEBASE};' \
		-e 's;\@LOCALBASE\@;${LOCALBASE};g' \
		${WRKSRC}/gcc/gcc.cc \
		${WRKSRC}/gcc/config/darwin.h \
		${WRKSRC}/gcc/config/dragonfly.h \
		${WRKSRC}/gcc/config/sol2.h \
		${WRKSRC}/gcc/config/i386/freebsd64.h \
		${WRKSRC}/gcc/config/i386/freebsd.h \
		${WRKSRC}/gcc/config/i386/gnu-user64.h \
		${WRKSRC}/gcc/config/aarch64/aarch64-freebsd.h \
		${WRKSRC}/gcc/ada/gnatls.adb
	# fix FreeBSD spec error
	${REINPLACE_CMD} -e 's|static:crtbeginT.o%s;||' \
		${WRKSRC}/gcc/config/freebsd-spec.h

post-stage:
	# package bootstrap compiler with zstd, then relocate files to avoid packaging them
	${MKDIR} ${WRKDIR}/bootstrap_compiler
	(cd ${STAGEDIR}${PREFIX}/toolchain/gcc14 \
		&& ${CP} -a bin ${WRKDIR}/bootstrap_compiler \
		&& ${CP} -a lib ${WRKDIR}/bootstrap_compiler \
		&& ${CP} -a include ${WRKDIR}/bootstrap_compiler \
		&& ${CP} -a libexec ${WRKDIR}/bootstrap_compiler)
	${ECHO_CMD} "Relocate directories to: ${PREFIX}/toolchain/gcc14" \
		>> ${WRKDIR}/bootstrap_compiler/README
	${RM} ${WRKDIR}/bootstrap_compiler/bin/${TGTSYS}*
	${MV} ${STAGEDIR} ${STAGEDIR}.old
	${MKDIR} ${STAGEDIR}${LOCALBASE}/share/${NAMEBASE}
	(cd ${WRKDIR} && ${TAR} -cf \
		${STAGEDIR}${LOCALBASE}/share/${NAMEBASE}/${TGTSYS}-gcc.tar \
		bootstrap_compiler)
	(cd ${STAGEDIR}${LOCALBASE}/share/${NAMEBASE} && \
		zstd -7 --no-progress --rm ${TGTSYS}-gcc.tar)

post-patch-FI386_R12-ON:
	# work around malloc detection issue
	${REINPLACE_CMD} -e 's/#undef HAVE_ALIGNED_ALLOC/#define HAVE_ALIGNED_ALLOC 1/' \
		${WRKSRC}/libstdc++-v3/config.h.in

post-patch-OMNIOS-ON:
	# undo BSD thin socket modification
	${MV} ${WRKSRC}/gcc/ada/libgnat/g-socthi.ads.orig \
		${WRKSRC}/gcc/ada/libgnat/g-socthi.ads

post-patch-MAMD64_R3-ON:
	# work around malloc detection issue
	${REINPLACE_CMD} -e 's/#undef HAVE_ALIGNED_ALLOC/#define HAVE_ALIGNED_ALLOC 1/' \
		${WRKSRC}/libstdc++-v3/config.h.in
	${REINPLACE_CMD} -e '/<malloc.h>/d' ${WRKSRC}/libiberty/hashtab.c

post-install:
	cp ${STAGEDIR}${PREFIX}/toolchain/gcc14/bin/gcc ${STAGEDIR}${PREFIX}/toolchain/gcc14/bin/cc
	cp ${STAGEDIR}${PREFIX}/toolchain/gcc14/bin/g++ ${STAGEDIR}${PREFIX}/toolchain/gcc14/bin/CC
	${STRIP_CMD} ${STAGEDIR}${PREFIX}/toolchain/gcc14/lib/gcc/${TGTSYS}/14.3.0/adalib/libgnarl.so
	${STRIP_CMD} ${STAGEDIR}${PREFIX}/toolchain/gcc14/lib/gcc/${TGTSYS}/14.3.0/adalib/libgnat.so

post-install-FARM64_R11-ON:
	${RM} -r ${STAGEDIR}${PREFIX}/toolchain/gcc14/lib/gcc/${TGTSYS}/14.3.0/include-fixed

post-extract:
	${MKDIR} ${WRKSRC}/libiconv
	${MV} ${WRKDIR}/gmp-*      ${WRKSRC}/gmp
	${MV} ${WRKDIR}/mpc-*      ${WRKSRC}/mpc
	${MV} ${WRKDIR}/mpfr-*     ${WRKSRC}/mpfr
	${MV} ${WRKDIR}/libiconv-* ${WRKSRC}/libiconv

post-patch-FARM64_R11-ON:
	# work around malloc detection issue
	${REINPLACE_CMD} -e 's/#undef HAVE_ALIGNED_ALLOC/#define HAVE_ALIGNED_ALLOC 1/' \
		${WRKSRC}/libstdc++-v3/config.h.in

post-install-FI386_R12-ON:
	${RM} -r ${STAGEDIR}${PREFIX}/toolchain/gcc14/lib/gcc/${TGTSYS}/14.3.0/include-fixed

post-install-FAMD64_R12-ON:
	${RM} -r ${STAGEDIR}${PREFIX}/toolchain/gcc14/lib/gcc/${TGTSYS}/14.3.0/include-fixed

post-patch-FAMD64_R12-ON:
	# work around malloc detection issue
	${REINPLACE_CMD} -e 's/#undef HAVE_ALIGNED_ALLOC/#define HAVE_ALIGNED_ALLOC 1/' \
		${WRKSRC}/libstdc++-v3/config.h.in
	${REINPLACE_CMD} -e '/<malloc.h>/d' ${WRKSRC}/libiberty/hashtab.c

post-install-MAMD64_R3-ON:
	${RM} -r ${STAGEDIR}${PREFIX}/toolchain/gcc14/lib/gcc/${TGTSYS}/14.3.0/include-fixed

[FILE:141:descriptions/desc.single]
This package contains a native compiler bootstrapped by a gnatcross
cross-compiler.  The target system is determined by the set port option.


[FILE:1237:distinfo]
e0dc77297625631ac8e50fa92fffefe899a4eb702592da5c32ef04e2293aca3a     95212220 gnatcross-bootstrap-14.3.0/gcc-14.3.0.tar.xz
b67ba0383ef7e8a8563734e2e889ef5ec3c3b898a01d00fa0a6869ad81c6ce01      1505596 gnatcross-bootstrap-14.3.0/mpfr-4.2.2.tar.xz
a3c2b80201b89e68616f4ad30bc66aee4927c3ce50e33929ca819d5c43538898      2094196 gnatcross-bootstrap-14.3.0/gmp-6.3.0.tar.xz
ab642492f5cf882b74aa0cb730cd410a81edcdbec895183ce930e706c1c759b8       773573 gnatcross-bootstrap-14.3.0/mpc-1.3.1.tar.gz
3b08f5f4f9b4eb82f151a7040bfd6fe6c6fb922efe4b1659c66ea933276965e8      5822590 gnatcross-bootstrap-14.3.0/libiconv-1.18.tar.gz
e46a743f055d955b3b86dd0438fa0da46be3b8a8dde4b62b16c6caad67a1036c        65972 gnatcross-bootstrap-14.3.0/patch-diff-ada
bd7f6d89815d22a8d46de7379ff68f21cecd027716fdabe1df4aa5bcb785c569        10562 gnatcross-bootstrap-14.3.0/patch-diff-core
f2f5e7f386a807b8ee28572360471bc222fef7d599cb7cbabbbc4fd6564deeea         6705 gnatcross-bootstrap-14.3.0/patch-diff-cxx
4182fbd55846131da646767d4a3c1c9d0af826141376a26eea6cabad17e75f6e        19253 gnatcross-bootstrap-14.3.0/patch-diff-ada-testsuite
0c943f75b1c8d03233f3947148a0aaa2e083418b1e89a4cfed8e8cd401a51bba         1894 gnatcross-bootstrap-14.3.0/patch-diff-gcc-testsuite


[FILE:49:manifests/plist.single]
share/gnatcross-bootstrap/%%TGTSYS%%-gcc.tar.zst


[FILE:479:patches/patch-libstdc++-v3_include_tr1_special__function__util.h]
--- libstdc++-v3/include/tr1/special_function_util.h.orig	2024-08-01 08:17:18 UTC
+++ libstdc++-v3/include/tr1/special_function_util.h
@@ -105,7 +105,7 @@ namespace tr1
       };
 
 
-#if _GLIBCXX_USE_C99_MATH && !_GLIBCXX_USE_C99_FP_MACROS_DYNAMIC
+#if _GLIBCXX_USE_C99_MATH && !_GLIBCXX_USE_C99_FP_MACROS_DYNAMIC && !defined(__sun)
 
     /// This is a wrapper for the isnan function. Otherwise, for NaN,
     /// all comparisons result in false. If/when we build a std::isnan

