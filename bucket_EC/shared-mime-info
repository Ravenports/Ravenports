# Buildsheet autogenerated by ravenadm tool -- Do not edit.

NAMEBASE=		shared-mime-info
VERSION=		2.4
REVISION=		1
KEYWORDS=		misc
VARIANTS=		std
SDESC[std]=		MIME types database from freedesktop.org project
HOMEPAGE=		http://www.freedesktop.org/wiki/Software/shared-mime-info
CONTACT=		nobody

DOWNLOAD_GROUPS=	main
SITES[main]=		https://gitlab.freedesktop.org/xdg/shared-mime-info/-/archive/2.4/
DISTFILE[1]=		shared-mime-info-2.4.tar.gz:main
DF_INDEX=		1
SPKGS[std]=		set
			primary
			dev
			nls
			man

OPTIONS_AVAILABLE=	none
OPTIONS_STANDARD=	none

BUILD_DEPENDS=		xmlto:single:std

USES=			pkgconfig meson c++:primary
GNOME_COMPONENTS=	glib libxml2 intltool

LICENSE=		GPLv2:primary
LICENSE_TERMS=		primary:{{WRKDIR}}/TERMS
LICENSE_FILE=		GPLv2:{{WRKSRC}}/COPYING
LICENSE_SCHEME=		solo

FPC_EQUIVALENT=		misc/shared-mime-info
MESON_ARGS=		-Dupdate-mimedb=false
			-Dxdgmime-path="{{WRKSRC}}/src/xdgmime"

SUB_FILES=		triggers-primary.ucl

post-install:
.for DIR in application audio image inode message model multipart packages text video x-epoc x-content font
	# XMLnamespaces aliases generic-icons globs globs2 icons magic mime.cache subclasses treemagic types version
	${MKDIR} ${STAGEDIR}${PREFIX}/share/mime/${DIR}
.endfor

pre-configure:
	${REINPLACE_CMD} -e 's|/usr/local|${LOCALBASE}|g' \
		${WRKSRC}/src/update-mime-database.cpp
	# Use local dtd
	${REINPLACE_CMD} -e 's|%%LOCALBASE%%|${LOCALBASE}|g' \
		${WRKSRC}/data/shared-mime-info-spec.xml

post-extract:
	${AWK} '/Copyright/,/file named COPYING/' \
		${WRKSRC}/src/update-mime-database.cpp > ${WRKDIR}/TERMS

[FILE:231:descriptions/desc.primary]
The freedesktop.org project provides a shared MIME database to avoid
inconsistencies between desktops. This database has been created by
converting the existing KDE and GNOME databases to a common format and
merging them together.


[FILE:106:distinfo]
531291d0387eb94e16e775d7e73788d06d2b2fdd8cd2ac6b6b15287593b6a2de      7852841 shared-mime-info-2.4.tar.gz


[FILE:407:manifests/plist.primary]
bin/update-mime-database
share/gettext/its/
 shared-mime-info.its
 shared-mime-info.loc
share/mime/packages/freedesktop.org.xml
@dir share/mime/application
@dir share/mime/audio
@dir share/mime/font
@dir share/mime/image
@dir share/mime/inode
@dir share/mime/message
@dir share/mime/model
@dir share/mime/multipart
@dir share/mime/text
@dir share/mime/video
@dir share/mime/x-content
@dir share/mime/x-epoc


[FILE:34:manifests/plist.dev]
lib/pkgconfig/shared-mime-info.pc


[FILE:3737:manifests/plist.nls]
share/locale/af/LC_MESSAGES/shared-mime-info.mo
share/locale/ar/LC_MESSAGES/shared-mime-info.mo
share/locale/as/LC_MESSAGES/shared-mime-info.mo
share/locale/ast/LC_MESSAGES/shared-mime-info.mo
share/locale/az/LC_MESSAGES/shared-mime-info.mo
share/locale/be/LC_MESSAGES/shared-mime-info.mo
share/locale/be@latin/LC_MESSAGES/shared-mime-info.mo
share/locale/bg/LC_MESSAGES/shared-mime-info.mo
share/locale/bn_IN/LC_MESSAGES/shared-mime-info.mo
share/locale/ca/LC_MESSAGES/shared-mime-info.mo
share/locale/ca@valencia/LC_MESSAGES/shared-mime-info.mo
share/locale/cs/LC_MESSAGES/shared-mime-info.mo
share/locale/cy/LC_MESSAGES/shared-mime-info.mo
share/locale/da/LC_MESSAGES/shared-mime-info.mo
share/locale/de/LC_MESSAGES/shared-mime-info.mo
share/locale/el/LC_MESSAGES/shared-mime-info.mo
share/locale/en_GB/LC_MESSAGES/shared-mime-info.mo
share/locale/eo/LC_MESSAGES/shared-mime-info.mo
share/locale/es/LC_MESSAGES/shared-mime-info.mo
share/locale/et/LC_MESSAGES/shared-mime-info.mo
share/locale/eu/LC_MESSAGES/shared-mime-info.mo
share/locale/fa/LC_MESSAGES/shared-mime-info.mo
share/locale/fi/LC_MESSAGES/shared-mime-info.mo
share/locale/fo/LC_MESSAGES/shared-mime-info.mo
share/locale/fr/LC_MESSAGES/shared-mime-info.mo
share/locale/fur/LC_MESSAGES/shared-mime-info.mo
share/locale/ga/LC_MESSAGES/shared-mime-info.mo
share/locale/gl/LC_MESSAGES/shared-mime-info.mo
share/locale/gu/LC_MESSAGES/shared-mime-info.mo
share/locale/he/LC_MESSAGES/shared-mime-info.mo
share/locale/hi/LC_MESSAGES/shared-mime-info.mo
share/locale/hr/LC_MESSAGES/shared-mime-info.mo
share/locale/hu/LC_MESSAGES/shared-mime-info.mo
share/locale/ia/LC_MESSAGES/shared-mime-info.mo
share/locale/id/LC_MESSAGES/shared-mime-info.mo
share/locale/is/LC_MESSAGES/shared-mime-info.mo
share/locale/it/LC_MESSAGES/shared-mime-info.mo
share/locale/ja/LC_MESSAGES/shared-mime-info.mo
share/locale/ka/LC_MESSAGES/shared-mime-info.mo
share/locale/kk/LC_MESSAGES/shared-mime-info.mo
share/locale/kn/LC_MESSAGES/shared-mime-info.mo
share/locale/ko/LC_MESSAGES/shared-mime-info.mo
share/locale/ky/LC_MESSAGES/shared-mime-info.mo
share/locale/lt/LC_MESSAGES/shared-mime-info.mo
share/locale/lv/LC_MESSAGES/shared-mime-info.mo
share/locale/ml/LC_MESSAGES/shared-mime-info.mo
share/locale/mr/LC_MESSAGES/shared-mime-info.mo
share/locale/ms/LC_MESSAGES/shared-mime-info.mo
share/locale/nb/LC_MESSAGES/shared-mime-info.mo
share/locale/nl/LC_MESSAGES/shared-mime-info.mo
share/locale/nn/LC_MESSAGES/shared-mime-info.mo
share/locale/oc/LC_MESSAGES/shared-mime-info.mo
share/locale/or/LC_MESSAGES/shared-mime-info.mo
share/locale/pa/LC_MESSAGES/shared-mime-info.mo
share/locale/pl/LC_MESSAGES/shared-mime-info.mo
share/locale/pt/LC_MESSAGES/shared-mime-info.mo
share/locale/pt_BR/LC_MESSAGES/shared-mime-info.mo
share/locale/ro/LC_MESSAGES/shared-mime-info.mo
share/locale/ru/LC_MESSAGES/shared-mime-info.mo
share/locale/rw/LC_MESSAGES/shared-mime-info.mo
share/locale/si/LC_MESSAGES/shared-mime-info.mo
share/locale/sk/LC_MESSAGES/shared-mime-info.mo
share/locale/sl/LC_MESSAGES/shared-mime-info.mo
share/locale/sq/LC_MESSAGES/shared-mime-info.mo
share/locale/sr/LC_MESSAGES/shared-mime-info.mo
share/locale/sr@latin/LC_MESSAGES/shared-mime-info.mo
share/locale/sv/LC_MESSAGES/shared-mime-info.mo
share/locale/ta/LC_MESSAGES/shared-mime-info.mo
share/locale/te/LC_MESSAGES/shared-mime-info.mo
share/locale/th/LC_MESSAGES/shared-mime-info.mo
share/locale/tr/LC_MESSAGES/shared-mime-info.mo
share/locale/uk/LC_MESSAGES/shared-mime-info.mo
share/locale/vi/LC_MESSAGES/shared-mime-info.mo
share/locale/wa/LC_MESSAGES/shared-mime-info.mo
share/locale/zh_CN/LC_MESSAGES/shared-mime-info.mo
share/locale/zh_HK/LC_MESSAGES/shared-mime-info.mo
share/locale/zh_TW/LC_MESSAGES/shared-mime-info.mo


[FILE:41:manifests/plist.man]
share/man/man1/update-mime-database.1.gz


[FILE:414:patches/patch-data_shared-mime-info-spec.xml]
--- data/shared-mime-info-spec.xml.orig	2023-10-07 11:16:03 UTC
+++ data/shared-mime-info-spec.xml
@@ -1,6 +1,6 @@
 <?xml version="1.0" standalone="no"?>
 <!DOCTYPE article PUBLIC "-//OASIS//DTD DocBook XML V4.1.2//EN"
-"http://www.oasis-open.org/docbook/xml/4.1.2/docbookx.dtd" [
+"file://%%LOCALBASE%%/share/xml/docbook/4.1.2/docbookx.dtd" [
   <!ENTITY updated "2 October 2018">
   <!ENTITY version "0.21">
 ]>


[FILE:340:patches/patch-meson.build]
--- meson.build.orig	2023-10-07 11:16:03 UTC
+++ meson.build
@@ -79,7 +79,7 @@ configure_file(
         'prefix': get_option('prefix'),
         'VERSION': meson.project_version()
     },
-    install_dir: get_option('datadir') / 'pkgconfig'
+    install_dir: get_option('prefix') / 'lib' / 'pkgconfig'
 )
 
 if get_option('update-mimedb')


[FILE:401:patches/patch-src_update-mime-database.cpp]
--- src/update-mime-database.cpp.orig	2023-11-12 08:52:33 UTC
+++ src/update-mime-database.cpp
@@ -2159,7 +2159,7 @@ static void check_in_path_xdg_data(const
 
 	env = getenv("XDG_DATA_DIRS");
 	if (!env)
-		env = "/usr/local/share/" PATH_SEPARATOR "/usr/share/";
+		env = "/usr/local/share/";
 	dirs = g_strsplit(env, PATH_SEPARATOR, 0);
 	g_return_if_fail(dirs != NULL);
 	for (n = 0; dirs[n]; n++)


[FILE:1011:files/triggers-primary.ucl.in]
mimeinfo: {
    dir_path: ["%%PREFIX%%/share/mime/packages"]
    cleanup: <<EOS
local mimedir = "%%PREFIX%%/share/mime/"
local files = { "XMLnamespaces", "aliases", "generic-icons", "globs", "globs2", "icons", "mime.cache", "subclasses", "treemagic", "types", "version"}
for _,filename in ipairs(files) do
	local fpath = mimedir .. filename
	local st = pkg.stat(fpath)
	if st then
		os.remove(fpath)
	end
end
local res = pkg.readdir(mimedir)
if res == nil then goto cleanmime end

for _,dir in ipairs(res) do
	if  dir == "packages" then goto continue end

	local directory = mimedir .. "/" .. dir
	local r = pkg.readdir(directory)
	if r == nil then goto cleandir end
	for _,file in ipairs(r) do
		os.remove(directory .. "/" .. file)
	end
	::cleandir::
	os.remove(directory)

	::continue::
end
::cleanmime::
os.remove(mimedir)
EOS

    trigger: <<EOS
pkg.print_msg("Triggered: Building the shared MIME information database cache")
pkg.exec({"%%PREFIX%%/bin/update-mime-database", "%%PREFIX%%/share/mime"})
EOS
}

