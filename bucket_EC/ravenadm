# Buildsheet autogenerated by ravenadm tool -- Do not edit.

NAMEBASE=		ravenadm
VERSION=		3.47
KEYWORDS=		raven
VARIANTS=		std
SDESC[std]=		Ravenports administration utility
HOMEPAGE=		https://github.com/ravenports/ravenadm
CONTACT=		John_Marino[draco@marino.st]

DOWNLOAD_GROUPS=	main format
SITES[main]=		GITHUB/ravenports:ravenadm:v3.47
SITES[format]=		GITHUB/ravenports:rvn-format:v4.7:rvn-format
DISTFILE[1]=		generated:main
DISTFILE[2]=		generated:format
DF_INDEX=		1 2
SPKGS[std]=		set
			primary
			man

OPTIONS_AVAILABLE=	WATCHDOG NCURSES
OPTIONS_STANDARD=	WATCHDOG NCURSES
OPT_ON[freebsd]=	WATCHDOG
OPT_ON[all]=		NCURSES
OPT_ON[netbsd]=		WATCHDOG
OPT_ON[dragonfly]=	WATCHDOG
OPT_ON[midnightbsd]=	WATCHDOG

BUILD_DEPENDS=		libucl:dev:ravensw
			libblake3:dev:std
R_DEPS[sunos]=		mandoc:set:std

USES=			zstd:build

LICENSE=		ISCL:primary
LICENSE_FILE=		ISCL:{{WRKSRC}}/License.txt
LICENSE_SCHEME=		solo

BUILD_WRKSRC=		{{WRKSRC}}/build
MAKE_ARGS=		PROCESSORS={{MAKE_JOBS_NUMBER}}

INFRASTRUCTURE=		yes
SET_DEBUGGING_ON=	yes
OPTIMIZER_LEVEL=	0
VAR_OPSYS[sunos]=	LDFLAGS=-lsocket

[WATCHDOG].DESCRIPTION=			Use "watchdog" monitor to abort stalled builds

[NCURSES].DESCRIPTION=			Activate options dialog and pretty build monitor
[NCURSES].BUILDRUN_DEPENDS_ON=		ncurses:primary:std
[NCURSES].BUILD_DEPENDS_ON=		adacurses:primary:std
					ncurses:dev:std
[NCURSES].MAKE_ENV_ON=			WITH_DISPLAY=1
[NCURSES].RUN_DEPENDS_ON=		ncurses:terminfo:std

post-install-freebsd:
	${MKDIR} ${STAGEDIR}${PREFIX}/libexec
	${INSTALL_PROGRAM} ${WRKSRC}/build/ravenexec ${STAGEDIR}${PREFIX}/libexec

pre-configure-NCURSES-ON:
	# Code disabled curses support by default, we have to
	# inline patch to activate it.
	${REINPLACE_CMD} -e '/adacurses.gpr/ s|-- ||' \
		${WRKSRC}/ravenadm.gpr
	${REINPLACE_CMD} \
		-e 's|Options_Dialog_Console|Options_Dialog|' \
		-e 's|Display\.Console|Display.Curses|' \
		${WRKSRC}/src/portscan-operations.adb \
		${WRKSRC}/src/pilot.adb

post-extract:
	${REINPLACE_CMD} -e 's|/raven"|${LOCALBASE}"|' \
		-e 's|:= dragonfly|:= ${OPSYS:tl}|' \
		${WRKSRC}/src/definitions.ads

do-install:
	${MKDIR} ${STAGEDIR}${PREFIX}/share/ravenadm \
		${STAGEDIR}/var/ravenports/primary \
		${STAGEDIR}/var/ravenports/distfiles \
		${STAGEDIR}/var/ravenports/conspiracy
	${INSTALL_PROGRAM} ${WRKSRC}/build/ravenadm \
		${STAGEDIR}${PREFIX}/bin
	${INSTALL_DATA} ${WRKSRC}/www/* ${STAGEDIR}${PREFIX}/share/ravenadm
	${INSTALL_DATA} ${WRKSRC}/manpages/*.8 ${STAGEDIR}${MANPREFIX}/man/man8/

pre-configure-WATCHDOG-OFF:
	@${ECHO_MSG} "Disabling watchdog monitor ..."
	${REINPLACE_CMD} -e "/hangmonitor :/ s|True|False|" \
		${WRKSRC}/src/portscan-buildcycle.adb

[FILE:888:descriptions/desc.primary]
Ravenports is a new approach to building and packaging software on
Unix-like platforms. The significant benefits over other package systems
are present for binary package users, binary package builders, and ports
developers. The detailed description of each benefit (which would be
exhausting to list) are out of scope of this document. The intended
audience consist of people that have already decided to try to use
Ravenports.

There are three basic components to the Ravenports system: The ravenadm
administration tool, the conspiracy collection of buildsheets (also
referred to as "Ravenports"), and the ravensource repository. The latter
is only of interest to ports developers, and it is used to generate
Ravenports.

Once installed, the ravenadm tool can quickly install the latest
conspiracy collection of buildsheets, so this program is the main point
of interest for new users.


[FILE:221:distinfo]
6233d87bb1b711c36e904ca32490e7d5ba96c30b343a54815d8535f37dfc2f5a       381058 ravenports-ravenadm-3.47.tar.gz
24b633249a4c99a838a753b3c59b31ac9a6956a598cdcb6ae716dcd34f463278       128231 ravenports-rvn-format-4.7.tar.gz


[FILE:283:manifests/plist.primary]
%%ONLY-FREEBSD%%libexec/ravenexec
bin/ravenadm
share/ravenadm/
 catalog.template
 favicon.png
 progress.css
 progress.html
 progress.js
 raven-project.png
 ravenports-200.png
 ravenports.css
@dir /var/ravenports/conspiracy
@dir /var/ravenports/distfiles
@dir /var/ravenports/primary


[FILE:477:manifests/plist.man]
share/man/man8/
 ravenadm-build-everything.8
 ravenadm-build.8
 ravenadm-check-ports.8
 ravenadm-configure.8
 ravenadm-dev.8
 ravenadm-force.8
 ravenadm-generate-repository.8
 ravenadm-generate-website.8
 ravenadm-incremental.8
 ravenadm-locate.8
 ravenadm-purge-distfiles.8
 ravenadm-purge-logs.8
 ravenadm-set-options.8
 ravenadm-status-everything.8
 ravenadm-status.8
 ravenadm-subpackages.8
 ravenadm-test-everything.8
 ravenadm-test.8
 ravenadm-update-ports.8
 ravenadm.8

