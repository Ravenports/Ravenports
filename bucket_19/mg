# Buildsheet autogenerated by ravenadm tool -- Do not edit.

NAMEBASE=		mg
VERSION=		20180927
KEYWORDS=		editors
VARIANTS=		standard
SDESC[standard]=	Microscopic GNU Emacs clone
HOMEPAGE=		https://github.com/hboetes/mg
CONTACT=		nobody

DOWNLOAD_GROUPS=	main
SITES[main]=		GITHUB/hboetes:mg:20180927
DISTFILE[1]=		generated:main
DF_INDEX=		1
SPKGS[standard]=	single

OPTIONS_AVAILABLE=	none
OPTIONS_STANDARD=	none

BR_DEPS[linux]=		libbsd:single:standard

USES=			cmake ncurses pkgconfig

LICENSE=		PUBDOM:single
LICENSE_FILE=		PUBDOM:{{WRKDIR}}/LICENSE
LICENSE_AWK=		PUBDOM:"^\#include"
LICENSE_SOURCE=		PUBDOM:{{WRKSRC}}/main.c
LICENSE_SCHEME=		solo

FPC_EQUIVALENT=		editors/mg

CFLAGS=			-I{{NCURSESINC}}

post-extract:
	${CP} ${FILESDIR}/CMakeLists.txt ${WRKSRC}

do-install:
	${INSTALL_PROGRAM} ${WRKDIR}/.build/mg ${STAGEDIR}${PREFIX}/bin
	${INSTALL_MAN} ${WRKSRC}/mg.1 ${STAGEDIR}${MAN1PREFIX}/man/man1

[FILE:232:descriptions/desc.single]
Mg is a small, fast, portable, and free (public domain) Emacs-like
editor maintained by the OpenBSD Project.  It is intended for people
who can't, or don't want to, run the real GNU Emacs, or are not
familiar with the vi(1) editor.


[FILE:105:distinfo]
fbb09729ea00fe42dcdbc96ac7fc1d2b89eac651dec49e4e7af52fad4f5788f6       143903 hboetes-mg-20180927.tar.gz


[FILE:30:manifests/plist.single]
bin/mg
share/man/man1/mg.1.gz


[FILE:332:patches/patch-main.c]
--- main.c.orig	2018-09-28 18:34:33.627045000 +0300
+++ main.c	2018-09-28 18:34:57.797531000 +0300
@@ -35,7 +35,7 @@ struct mgwin	*wheadp;			/* MGWIN listhea
 char		 pat[NPAT];			/* pattern		*/
 
 #ifndef __dead
-#define __dead __dead2
+#define __dead __attribute__ ((__noreturn__))
 #endif
 
 static void	 edinit(struct buffer *);


[FILE:488:patches/patch-mg.1]
--- mg.1.orig	2018-09-28 18:30:39.842341000 +0300
+++ mg.1	2018-09-28 18:32:35.454667000 +0300
@@ -1071,15 +1071,13 @@ or
 .Dq #
 as the first character of a line.
 .Sh FILES
-.Bl -tag -width /usr/share/doc/mg/tutorial -compact
+.Bl -tag -width ~/.mg-TERM -compact
 .It Pa ~/.mg
 normal startup file
 .It Pa ~/.mg-TERM
 terminal-specific startup file
 .It Pa ~/.mg.d
 alternative backup file location
-.It Pa /usr/share/doc/mg/tutorial
-concise tutorial
 .El
 .Sh SEE ALSO
 .Xr ctags 1 ,


[FILE:888:files/CMakeLists.txt]
cmake_minimum_required (VERSION 3.5)
project (mg)

set (MG_SRC autoexec.c basic.c bell.c buffer.c cinfo.c dir.c display.c
	echo.c extend.c file.c fileio.c funmap.c help.c kbd.c keymap.c
	line.c macro.c main.c match.c modes.c paragraph.c
	re_search.c region.c search.c spawn.c tty.c ttyio.c ttykbd.c
	undo.c util.c version.c window.c word.c yank.c
	cmode.c cscope.c dired.c grep.c tags.c
)

if(CMAKE_SYSTEM_NAME MATCHES "DragonFly")
set (REALLOC_SRC reallocarray.c)
endif()

add_executable (mg ${MG_SRC} ${REALLOC_SRC})

if(CMAKE_SYSTEM_NAME MATCHES "Linux")
  find_package (PkgConfig REQUIRED)
  pkg_check_modules (BSD REQUIRED libbsd-overlay)
  link_directories (${BSD_LIBRARY_DIRS})
  string (REPLACE ";" " " LIBBSD_FLAGS "${BSD_CFLAGS}")
  target_link_libraries (mg ${BSD_LIBRARIES})
endif()

set (CMAKE_C_FLAGS "-Wall -DREGEX ${LIBBSD_FLAGS}")
target_link_libraries (mg ncurses util)

