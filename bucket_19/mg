# Buildsheet autogenerated by ravenadm tool -- Do not edit.

NAMEBASE=		mg
VERSION=		20200215
KEYWORDS=		editors
VARIANTS=		standard
SDESC[standard]=	Microscopic GNU Emacs clone
HOMEPAGE=		https://github.com/hboetes/mg
CONTACT=		nobody

DOWNLOAD_GROUPS=	main
SITES[main]=		GITHUB/hboetes:mg:20200215
DISTFILE[1]=		generated:main
DF_INDEX=		1
SPKGS[standard]=	single

OPTIONS_AVAILABLE=	none
OPTIONS_STANDARD=	none

BR_DEPS[linux]=		libbsd:single:standard

USES=			cmake ncurses pkgconfig

LICENSE=		PUBDOM:single
LICENSE_FILE=		PUBDOM:{{WRKDIR}}/LICENSE
LICENSE_AWK=		PUBDOM:"^\#include"
LICENSE_SOURCE=		PUBDOM:{{WRKSRC}}/main.c
LICENSE_SCHEME=		solo

FPC_EQUIVALENT=		editors/mg

CFLAGS=			-I{{NCURSESINC}}

do-install:
	${INSTALL_PROGRAM} ${WRKDIR}/.build/mg ${STAGEDIR}${PREFIX}/bin
	${INSTALL_MAN} ${WRKSRC}/mg.1 ${STAGEDIR}${MAN1PREFIX}/man/man1

[FILE:232:descriptions/desc.single]
Mg is a small, fast, portable, and free (public domain) Emacs-like
editor maintained by the OpenBSD Project.  It is intended for people
who can't, or don't want to, run the real GNU Emacs, or are not
familiar with the vi(1) editor.


[FILE:105:distinfo]
4802750c4cd52e8154b38e7e1549d68b704230e4b44f5884932b3b08efdaa9bb       152254 hboetes-mg-20200215.tar.gz


[FILE:30:manifests/plist.single]
bin/mg
share/man/man1/mg.1.gz


[FILE:696:patches/patch-CMakeLists.txt]
--- CMakeLists.txt.orig	2020-02-15 14:33:45 UTC
+++ CMakeLists.txt
@@ -1,12 +1,16 @@
 cmake_minimum_required (VERSION 3.5)
 project (mg)
 
+if(CMAKE_SYSTEM_NAME MATCHES "DragonFly|FreeBSD|NetBSD|Linux|MidnightBSD")
+  set(INTERPRETER "interpreter.c")
+endif()
+
 set (MG_SRC autoexec.c basic.c bell.c buffer.c cinfo.c dir.c display.c
 	echo.c extend.c file.c fileio.c funmap.c help.c kbd.c keymap.c
 	line.c macro.c main.c match.c modes.c paragraph.c
 	re_search.c region.c search.c spawn.c tty.c ttyio.c ttykbd.c
 	undo.c util.c version.c window.c word.c yank.c
-	cmode.c cscope.c dired.c grep.c tags.c
+	cmode.c cscope.c dired.c grep.c tags.c ${INTERPRETER}
 )
 
 add_executable (mg ${MG_SRC})


[FILE:451:patches/patch-interpreter.c]
--- interpreter.c.orig	2020-02-15 14:33:45 UTC
+++ interpreter.c
@@ -304,7 +304,11 @@ foundlist(char *defstr)
 	 * in a linked list. But first remove variable, if existing already.
 	 */
 	if (!SLIST_EMPTY(&varhead)) {
+#ifdef __DragonFly__
+		SLIST_FOREACH_MUTABLE(v1, &varhead, entry, vt) {
+#else
 		SLIST_FOREACH_SAFE(v1, &varhead, entry, vt) {
+#endif
 			if (strcmp(vnamep, v1->name) == 0)
 				SLIST_REMOVE(&varhead, v1, varentry, entry);
 		}


[FILE:440:patches/patch-mg.1]
--- mg.1.orig	2020-02-15 14:33:45 UTC
+++ mg.1
@@ -1087,15 +1087,13 @@ or
 .Sq #
 as the first character of a line.
 .Sh FILES
-.Bl -tag -width /usr/share/doc/mg/tutorial -compact
+.Bl -tag -width ~/.mg-TERM -compact
 .It Pa ~/.mg
 normal startup file
 .It Pa ~/.mg-TERM
 terminal-specific startup file
 .It Pa ~/.mg.d
 alternative backup file location
-.It Pa /usr/share/doc/mg/tutorial
-concise tutorial
 .El
 .Sh SEE ALSO
 .Xr ctags 1 ,

