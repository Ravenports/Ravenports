# Buildsheet autogenerated by ravenadm tool -- Do not edit.

NAMEBASE=		mold
VERSION=		2.31.0
KEYWORDS=		devel
VARIANTS=		standard
SDESC[standard]=	Faster replacement for existing Unix linkers
HOMEPAGE=		https://github.com/rui314/mold
CONTACT=		nobody

DOWNLOAD_GROUPS=	main
SITES[main]=		GITHUB/rui314:mold:v2.31.0
DISTFILE[1]=		generated:main
DF_INDEX=		1
SPKGS[standard]=	complete
			primary
			man
			docs

OPTIONS_AVAILABLE=	none
OPTIONS_STANDARD=	none

USES=			cmake zstd zlib ssl c++:primary
C_USES[freebsd]=	clang
C_USES[midnightbsd]=	clang

LICENSE=		MIT:primary
LICENSE_FILE=		MIT:{{WRKSRC}}/LICENSE
LICENSE_SCHEME=		solo

FPC_EQUIVALENT=		devel/mold

CMAKE_ARGS=		-DMOLD_USE_SYSTEM_MIMALLOC=OFF
			-DMOLD_USE_SYSTEM_TBB=OFF
			-DOPENSSL_ROOT_DIR:STRING="{{OPENSSLBASE}}"

post-install:
	${STRIP_CMD} ${STAGEDIR}${PREFIX}/bin/mold
	${STRIP_CMD} ${STAGEDIR}${PREFIX}/lib/mold/mold-wrapper.so

pre-configure:
	# don't duplicate license installation
	${REINPLACE_CMD} -e '/LICENSE DESTINATION/d' ${WRKSRC}/CMakeLists.txt

[FILE:322:descriptions/desc.primary]
mold is a faster drop-in replacement for existing Unix linkers.  It is
several times quicker than the LLVM lld linker, the second-fastest
open-source linker, which I initially developed a few years ago. mold
aims to enhance developer productivity by minimizing build time,
particularly in rapid debug-edit-rebuild cycles.


[FILE:104:distinfo]
3dc3af83a5d22a4b29971bfad17261851d426961c665480e2ca294e5c74aa1e5     10031469 rui314-mold-2.31.0.tar.gz


[FILE:61:manifests/plist.primary]
bin/
 ld.mold
 mold
lib/mold/mold-wrapper.so
libexec/mold/ld


[FILE:41:manifests/plist.man]
share/man/man1/
 ld.mold.1.gz
 mold.1.gz


[FILE:35:manifests/plist.docs]
share/doc/mold/LICENSE.third-party


[FILE:249:patches/patch-common_filepath.cc]
--- common/filepath.cc.orig	2024-05-03 01:04:55 UTC
+++ common/filepath.cc
@@ -3,6 +3,10 @@
 #include <filesystem>
 #include <sys/stat.h>
 
+#ifdef __FreeBSD__
+# include <sys/sysctl.h>
+#endif
+
 #ifdef __APPLE__
 # include <mach-o/dyld.h>
 #endif


[FILE:322:patches/patch-elf_mold-wrapper.c]
--- elf/mold-wrapper.c.orig	2024-05-03 01:04:55 UTC
+++ elf/mold-wrapper.c
@@ -9,7 +9,7 @@
 #include <string.h>
 #include <unistd.h>
 
-#if !defined(__OpenBSD__) && !defined(__FreeBSD__)
+#if !defined(__OpenBSD__) && !defined(__FreeBSD__) && !defined(__NetBSD__) && !defined(__DragonFly__)
 # include <alloca.h>
 #endif
 


[FILE:638:patches/patch-third-party_mimalloc_src_alloc-override.c]
--- third-party/mimalloc/src/alloc-override.c.orig	2024-05-03 01:04:55 UTC
+++ third-party/mimalloc/src/alloc-override.c
@@ -232,7 +232,7 @@ extern "C" {
   // Forward Posix/Unix calls as well
   void*  reallocf(void* p, size_t newsize) MI_FORWARD2(mi_reallocf,p,newsize)
   size_t malloc_size(const void* p)        MI_FORWARD1(mi_usable_size,p)
-  #if !defined(__ANDROID__) && !defined(__FreeBSD__)
+  #if !defined(__ANDROID__) && !defined(__FreeBSD__) && !defined(__DragonFly__)
   size_t malloc_usable_size(void *p)       MI_FORWARD1(mi_usable_size,p)
   #else
   size_t malloc_usable_size(const void *p) MI_FORWARD1(mi_usable_size,p)

