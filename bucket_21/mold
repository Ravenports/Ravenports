# Buildsheet autogenerated by ravenadm tool -- Do not edit.

NAMEBASE=		mold
VERSION=		2.3.2
KEYWORDS=		devel
VARIANTS=		standard
SDESC[standard]=	Faster replacement for existing Unix linkers
HOMEPAGE=		https://github.com/rui314/mold
CONTACT=		nobody

DOWNLOAD_GROUPS=	main
SITES[main]=		GITHUB/rui314:mold:v2.3.2
DISTFILE[1]=		generated:main
DF_INDEX=		1
SPKGS[standard]=	complete
			primary
			man
			docs

OPTIONS_AVAILABLE=	none
OPTIONS_STANDARD=	none

USES=			cmake zstd zlib ssl c++:primary
C_USES[freebsd]=	clang
C_USES[midnightbsd]=	clang

LICENSE=		MIT:primary
LICENSE_FILE=		MIT:{{WRKSRC}}/LICENSE
LICENSE_SCHEME=		solo

FPC_EQUIVALENT=		devel/mold

CMAKE_ARGS=		-DMOLD_USE_SYSTEM_MIMALLOC=OFF
			-DMOLD_USE_SYSTEM_TBB=OFF
			-DOPENSSL_ROOT_DIR:STRING="{{OPENSSLBASE}}"

post-install:
	${STRIP_CMD} ${STAGEDIR}${PREFIX}/bin/mold
	${STRIP_CMD} ${STAGEDIR}${PREFIX}/lib/mold/mold-wrapper.so

pre-configure:
	# don't duplicate license installation
	${REINPLACE_CMD} -e '/LICENSE DESTINATION/d' ${WRKSRC}/CMakeLists.txt

[FILE:322:descriptions/desc.primary]
mold is a faster drop-in replacement for existing Unix linkers.  It is
several times quicker than the LLVM lld linker, the second-fastest
open-source linker, which I initially developed a few years ago. mold
aims to enhance developer productivity by minimizing build time,
particularly in rapid debug-edit-rebuild cycles.


[FILE:103:distinfo]
db172c0e97606565a81e37995bf5c911606d3f3b9f3829e92cd26985c9b0ed3b      9970530 rui314-mold-2.3.2.tar.gz


[FILE:61:manifests/plist.primary]
bin/
 ld.mold
 mold
lib/mold/mold-wrapper.so
libexec/mold/ld


[FILE:41:manifests/plist.man]
share/man/man1/
 ld.mold.1.gz
 mold.1.gz


[FILE:35:manifests/plist.docs]
share/doc/mold/LICENSE.third-party


[FILE:322:patches/patch-elf_mold-wrapper.c]
--- elf/mold-wrapper.c.orig	2023-11-04 06:44:32 UTC
+++ elf/mold-wrapper.c
@@ -1,6 +1,6 @@
 #define _GNU_SOURCE 1
 
-#if !defined(__OpenBSD__) && !defined(__FreeBSD__)
+#if !defined(__OpenBSD__) && !defined(__FreeBSD__) && !defined(__DragonFly__) && !defined(__NetBSD__)
 #  include <alloca.h>
 #endif
 #include <dlfcn.h>


[FILE:638:patches/patch-third-party_mimalloc_src_alloc-override.c]
--- third-party/mimalloc/src/alloc-override.c.orig	2023-11-04 06:44:32 UTC
+++ third-party/mimalloc/src/alloc-override.c
@@ -232,7 +232,7 @@ extern "C" {
   // Forward Posix/Unix calls as well
   void*  reallocf(void* p, size_t newsize) MI_FORWARD2(mi_reallocf,p,newsize)
   size_t malloc_size(const void* p)        MI_FORWARD1(mi_usable_size,p)
-  #if !defined(__ANDROID__) && !defined(__FreeBSD__)
+  #if !defined(__ANDROID__) && !defined(__FreeBSD__) && !defined(__DragonFly__)
   size_t malloc_usable_size(void *p)       MI_FORWARD1(mi_usable_size,p)
   #else
   size_t malloc_usable_size(const void *p) MI_FORWARD1(mi_usable_size,p)


[FILE:595:patches/patch-third-party_tbb_cmake_compilers_GNU.cmake]
--- third-party/tbb/cmake/compilers/GNU.cmake.orig	2023-11-04 06:44:32 UTC
+++ third-party/tbb/cmake/compilers/GNU.cmake
@@ -40,9 +40,6 @@ if (CMAKE_SYSTEM_PROCESSOR MATCHES "(AMD
     set(TBB_COMMON_COMPILE_FLAGS ${TBB_COMMON_COMPILE_FLAGS} -mrtm $<$<AND:$<NOT:$<CXX_COMPILER_ID:Intel>>,$<NOT:$<VERSION_LESS:${CMAKE_CXX_COMPILER_VERSION},11.0>>>:-mwaitpkg>)
 endif()
 
-if (NOT MINGW)
-    set(TBB_COMMON_LINK_LIBS dl)
-endif()
 
 # Ignore -Werror set through add_compile_options() or added to CMAKE_CXX_FLAGS if TBB_STRICT is disabled.
 if (NOT TBB_STRICT AND COMMAND tbb_remove_compile_flag)

