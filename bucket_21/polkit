# Buildsheet autogenerated by ravenadm tool -- Do not edit.

NAMEBASE=		polkit
VERSION=		0.116
KEYWORDS=		sysutils
VARIANTS=		standard
SDESC[standard]=	Framework for access control to system components
HOMEPAGE=		https://www.freedesktop.org/wiki/Software/polkit/
CONTACT=		Michael_Reim[kraileth@elderlinux.org]

DOWNLOAD_GROUPS=	main
SITES[main]=		https://www.freedesktop.org/software/polkit/releases/
DISTFILE[1]=		polkit-0.116.tar.gz:main
DF_INDEX=		1
SPKGS[standard]=	single

OPTIONS_AVAILABLE=	none
OPTIONS_STANDARD=	none

BUILD_DEPENDS=		docbook-xsl:primary:standard
			intltool:single:standard
BUILDRUN_DEPENDS=	dbus:single:standard
			expat:complete:standard
			openpam:single:standard
			spidermonkey60:single:standard

USERS=			polkitd
GROUPS=			polkitd
USERGROUP_SPKG=		single

USES=			gettext-tools gmake libtool pkgconfig python
			shebangfix solaris-funcs
GNOME_COMPONENTS=	glib introspection libxslt

LICENSE=		LGPL21+:single
LICENSE_TERMS=		single:{{WRKDIR}}/TERMS
LICENSE_FILE=		LGPL21+:stock
LICENSE_AWK=		TERMS:"^$$"
LICENSE_SOURCE=		TERMS:{{WRKSRC}}/src/polkit/polkit.h
LICENSE_SCHEME=		solo

FPC_EQUIVALENT=		sysutils/polkit
SHEBANG_FILES=		{{WRKSRC}}/src/polkitbackend/toarray.pl
SOL_FUNCTIONS=		getline:src/polkitagent/polkitagenthelperprivate.c

MUST_CONFIGURE=		gnu
CONFIGURE_ARGS=		--with-authfw=pam
			--with-pam-include=system
			--with-os-type={{OPSYS}}
			--disable-libsystemd-login
			--disable-libelogind
			--disable-static
			--enable-introspection=yes
			--localstatedir=/var
			--disable-test

INSTALL_TARGET=		install-strip
INSTALL_REQ_TOOLCHAIN=	yes

CFLAGS=			-Wno-deprecated-declarations

post-patch:
	${REINPLACE_CMD} -e 's|__DBPATH__|${PREFIX}/share/xsl/docbook/manpages|' ${WRKSRC}/docs/man/Makefile.in
	${REINPLACE_CMD} -e 's|/usr/bin/|${PREFIX}/bin/|g' \
		${WRKSRC}/docs/man/pkexec.xml \
		${WRKSRC}/src/examples/org.freedesktop.policykit.examples.pkexec.policy.in
	${REINPLACE_CMD} -e 's|/usr/local|${PREFIX}|g' \
		${WRKSRC}/docs/man/polkit.xml

post-install:
	${MKDIR} ${STAGEDIR}/var/lib/polkit-1
	${INSTALL_DATA} ${WRKSRC}/data/org.freedesktop.PolicyKit1.conf \
		${STAGEDIR}${PREFIX}/etc/dbus-1/system.d/org.freedesktop.PolicyKit1.conf.sample
.for i in 10-vendor.d 20-org.d 30-site.d 50-local.d 90-mandatory.d
	${MKDIR} ${STAGEDIR}${PREFIX}/etc/polkit-1/localauthority/${i}
	${MKDIR} ${STAGEDIR}/var/lib/polkit-1/localauthority/${i}
.endfor
	${RM} -r ${STAGEDIR}${PREFIX}/etc/dbus-1

post-patch-sunos:
	${REINPLACE_CMD} -e '/as-needed/ s/^.*$$/NOOP=1/' ${WRKSRC}/configure

[FILE:300:descriptions/desc.single]
Polkit is an application-level toolkit for defining and handling the 
policy that allows unprivileged processes to speak to privileged 
processes. It is a framework for centralizing the decision making process 
with respect to granting access to privileged operations for unprivileged 
applications.


[FILE:98:distinfo]
88170c9e711e8db305a12fdb8234fac5706c61969b94e084d0f117d8ec5d34b1      1548311 polkit-0.116.tar.gz


[FILE:2738:manifests/plist.single]
bin/
 pk-example-frobnicate
 pkaction
 pkcheck
@(root,,4755) bin/pkexec
 pkttyagent
etc/pam.d/polkit-1
etc/polkit-1/rules.d/50-default.rules
include/polkit-1/polkit/
 polkit.h
 polkitactiondescription.h
 polkitauthority.h
 polkitauthorityfeatures.h
 polkitauthorizationresult.h
 polkitcheckauthorizationflags.h
 polkitdetails.h
 polkitenumtypes.h
 polkiterror.h
 polkitidentity.h
 polkitimplicitauthorization.h
 polkitpermission.h
 polkitprivate.h
 polkitsubject.h
 polkitsystembusname.h
 polkittemporaryauthorization.h
 polkittypes.h
 polkitunixgroup.h
 polkitunixnetgroup.h
 polkitunixprocess.h
 polkitunixsession.h
 polkitunixuser.h
include/polkit-1/polkitagent/
 polkitagent.h
 polkitagentenumtypes.h
 polkitagentlistener.h
 polkitagentsession.h
 polkitagenttextlistener.h
 polkitagenttypes.h
lib/
 libpolkit-agent-1.so
 libpolkit-agent-1.so.0
 libpolkit-agent-1.so.0.0.0
 libpolkit-gobject-1.so
 libpolkit-gobject-1.so.0
 libpolkit-gobject-1.so.0.0.0
lib/girepository-1.0/
 Polkit-1.0.typelib
 PolkitAgent-1.0.typelib
lib/pkgconfig/
 polkit-agent-1.pc
 polkit-gobject-1.pc
@(root,,4755) lib/polkit-1/polkit-agent-helper-1
lib/polkit-1/polkitd
share/dbus-1/system-services/org.freedesktop.PolicyKit1.service
share/gettext/its/
 polkit.its
 polkit.loc
share/gir-1.0/
 Polkit-1.0.gir
 PolkitAgent-1.0.gir
share/locale/cs/LC_MESSAGES/polkit-1.mo
share/locale/da/LC_MESSAGES/polkit-1.mo
share/locale/de/LC_MESSAGES/polkit-1.mo
share/locale/hr/LC_MESSAGES/polkit-1.mo
share/locale/hu/LC_MESSAGES/polkit-1.mo
share/locale/id/LC_MESSAGES/polkit-1.mo
share/locale/it/LC_MESSAGES/polkit-1.mo
share/locale/pl/LC_MESSAGES/polkit-1.mo
share/locale/pt_BR/LC_MESSAGES/polkit-1.mo
share/locale/sk/LC_MESSAGES/polkit-1.mo
share/locale/sv/LC_MESSAGES/polkit-1.mo
share/locale/tr/LC_MESSAGES/polkit-1.mo
share/locale/uk/LC_MESSAGES/polkit-1.mo
share/locale/zh_CN/LC_MESSAGES/polkit-1.mo
share/locale/zh_TW/LC_MESSAGES/polkit-1.mo
share/man/man1/
 pkaction.1.gz
 pkcheck.1.gz
 pkexec.1.gz
 pkttyagent.1.gz
share/man/man8/
 polkit.8.gz
 polkitd.8.gz
share/polkit-1/actions/
 org.freedesktop.policykit.examples.pkexec.policy
 org.freedesktop.policykit.policy
@dir /var/lib/polkit-1/localauthority/10-vendor.d
@dir /var/lib/polkit-1/localauthority/20-org.d
@dir /var/lib/polkit-1/localauthority/30-site.d
@dir /var/lib/polkit-1/localauthority/50-local.d
@dir /var/lib/polkit-1/localauthority/90-mandatory.d
@dir etc/polkit-1/localauthority/10-vendor.d
@dir etc/polkit-1/localauthority/20-org.d
@dir etc/polkit-1/localauthority/30-site.d
@dir etc/polkit-1/localauthority/50-local.d
@dir etc/polkit-1/localauthority/90-mandatory.d
@dir(polkitd,,700) share/polkit-1/rules.d
@postexec chown polkitd %D/etc/polkit-1/rules.d && chmod 700 %D/etc/polkit-1/rules.d


[FILE:667:patches/patch-docs_man_Makefile.in]
--- docs/man/Makefile.in.orig	2018-03-13 16:34:14.322676000 +0100
+++ docs/man/Makefile.in	2018-03-13 16:35:12.363732000 +0100
@@ -644,7 +644,7 @@
 
 
 @MAN_PAGES_ENABLED_TRUE@%.8 %.1 : %.xml
-@MAN_PAGES_ENABLED_TRUE@	$(XSLTPROC) -nonet --stringparam man.base.url.for.relative.links $(datadir)/gtk-doc/html/polkit-1/ --xinclude http://docbook.sourceforge.net/release/xsl/current/manpages/docbook.xsl $<
+@MAN_PAGES_ENABLED_TRUE@	$(XSLTPROC) -nonet --path __DBPATH__ --stringparam man.base.url.for.relative.links $(datadir)/gtk-doc/html/polkit-1/ --xinclude http://docbook.sourceforge.net/release/xsl/current/manpages/docbook.xsl $<
 
 clean-local:
 	rm -f *~ *.1 *.8


[FILE:692:patches/patch-src_polkit_polkitunixprocess.c]
Fix SunOS includes.
Fix pid_t type.

--- src/polkit/polkitunixprocess.c.orig	2019-02-07 11:52:03 UTC
+++ src/polkit/polkitunixprocess.c
@@ -24,6 +24,11 @@
 #endif
 
 #include <sys/types.h>
+#ifdef HAVE_SOLARIS
+#include <sys/stat.h>
+#include <fcntl.h>
+#include <procfs.h>
+#endif
 #ifdef HAVE_FREEBSD
 #include <sys/param.h>
 #include <sys/sysctl.h>
@@ -164,7 +169,7 @@ enum
 
 static void subject_iface_init (PolkitSubjectIface *subject_iface);
 
-static guint64 get_start_time_for_pid (gint    pid,
+static guint64 get_start_time_for_pid (pid_t    pid,
                                        GError **error);
 
 #if defined(HAVE_FREEBSD) || defined(HAVE_NETBSD) || defined(HAVE_OPENBSD)


[FILE:330:patches/patch-src_polkitbackend_polkitbackendauthority.c]
--- src/polkitbackend/polkitbackendauthority.c.orig	2018-05-31 11:52:53 UTC
+++ src/polkitbackend/polkitbackendauthority.c
@@ -25,6 +25,9 @@
 #include <string.h>
 #include <syslog.h>
 #include <stdarg.h>
+#ifdef HAVE_SOLARIS
+#include <netinet/ip_compat.h>
+#endif
 
 #include <polkit/polkit.h>
 #include <polkit/polkitprivate.h>


[FILE:1494:patches/patch-src_polkitbackend_polkitbackendjsauthority.cpp]
--- src/polkitbackend/polkitbackendjsauthority.cpp.orig	2019-04-02 12:54:12 UTC
+++ src/polkitbackend/polkitbackendjsauthority.cpp
@@ -55,6 +55,46 @@
 #error "This code is not safe in SpiderMonkey exact stack rooting configurations"
 #endif
 
+#ifdef __sun__
+int
+getgrouplist(const char *uname, gid_t agroup, gid_t *groups, int *grpcnt)
+{
+	const struct group *grp;
+	int i, maxgroups, ngroups, ret;
+
+	ret = 0;
+	ngroups = 0;
+	maxgroups = *grpcnt;
+	groups ? groups[ngroups++] = agroup : ngroups++;
+	if (maxgroups > 1)
+		groups ? groups[ngroups++] = agroup : ngroups++;
+	setgrent();
+	while ((grp = getgrent()) != NULL) {
+		if (groups) {
+			for (i = 0; i < ngroups; i++) {
+				if (grp->gr_gid == groups[i])
+					goto skip;
+			}
+		}
+		for (i = 0; grp->gr_mem[i]; i++) {
+			if (!strcmp(grp->gr_mem[i], uname)) {
+				if (ngroups >= maxgroups) {
+					ret = -1;
+					break;
+				}
+				groups ? groups[ngroups++] = grp->gr_gid : ngroups++;
+				break;
+			}
+		}
+skip:
+		;
+	}
+	endgrent();
+	*grpcnt = ngroups;
+	return (ret);
+}
+#endif
+
 /**
  * SECTION:polkitbackendjsauthority
  * @title: PolkitBackendJsAuthority
@@ -812,7 +852,11 @@ subject_to_jsval (PolkitBackendJsAuthori
 
       if (getgrouplist (passwd->pw_name,
                         passwd->pw_gid,
+#ifdef __APPLE__
+			(int *)gids,
+#else
                         gids,
+#endif
                         &num_gids) < 0)
         {
           g_warning ("Error looking up groups for uid %d: %m", (gint) uid);


[FILE:897:patches/patch-src_programs_pkexec.c]
Avoid conflict with SunOS function.
Provide solaris header for LOG_AUTHPRIV

--- src/programs/pkexec.c.orig	2018-05-31 11:52:53 UTC
+++ src/programs/pkexec.c
@@ -45,6 +45,9 @@
 
 #include <syslog.h>
 #include <stdarg.h>
+#ifdef HAVE_SOLARIS
+#include <netinet/ip_compat.h>
+#endif
 
 #include <polkit/polkit.h>
 #define POLKIT_AGENT_I_KNOW_API_IS_SUBJECT_TO_CHANGE
@@ -245,7 +248,7 @@ set_close_on_exec (gint     fd,
 }
 
 static gboolean
-fdwalk (FdCallback callback,
+gfdwalk (FdCallback callback,
         gpointer   user_data)
 {
   gint fd;
@@ -918,7 +921,7 @@ main (int argc, char *argv[])
     }
 
   /* set close_on_exec on all file descriptors except stdin, stdout, stderr */
-  if (!fdwalk (set_close_on_exec, GINT_TO_POINTER (3)))
+  if (!gfdwalk (set_close_on_exec, GINT_TO_POINTER (3)))
     {
       g_printerr ("Error setting close-on-exec for file desriptors\n");
       goto out;

