# Buildsheet autogenerated by ravenadm tool -- Do not edit.

NAMEBASE=		bmake
VERSION=		20240314
KEYWORDS=		devel
VARIANTS=		standard prevdbsd prevfbsd prevlinux
SDESC[prevdbsd]=	BSD Make encoded for previous DragonFly sysroot
SDESC[prevlinux]=	BSD Make encoded for previous Linux sysroot
SDESC[standard]=	Portable version of NetBSD 'make' utility
SDESC[prevfbsd]=	BSD Make encoded for previous FreeBSD sysroot
HOMEPAGE=		http://www.crufty.net/help/sjg/bmake.html
CONTACT=		nobody

DOWNLOAD_GROUPS=	main
SITES[main]=		https://cdn.netbsd.org/pub/NetBSD/misc/sjg/
			ftp://ftp.netbsd.org/pub/NetBSD/misc/sjg/
DISTFILE[1]=		bmake-20240314.tar.gz:main
DF_INDEX=		1
SPKGS[prevdbsd]=	single
SPKGS[prevlinux]=	single
SPKGS[standard]=	single
SPKGS[prevfbsd]=	single

OPTIONS_AVAILABLE=	PREV_DBSD PREV_FBSD PREV_LINUX
OPTIONS_STANDARD=	none
VOPTS[prevdbsd]=	PREV_DBSD=ON PREV_FBSD=OFF PREV_LINUX=OFF
VOPTS[prevlinux]=	PREV_DBSD=OFF PREV_FBSD=OFF PREV_LINUX=ON
VOPTS[prevfbsd]=	PREV_DBSD=OFF PREV_FBSD=ON PREV_LINUX=OFF

DISTNAME=		bmake

LICENSE=		BSD3CLAUSE:single
LICENSE_FILE=		BSD3CLAUSE:{{WRKDIR}}/LICENSE
LICENSE_AWK=		BSD3CLAUSE:"make.h --"
LICENSE_SOURCE=		BSD3CLAUSE:{{WRKSRC}}/make.h
LICENSE_SCHEME=		solo

FPC_EQUIVALENT=		devel/bmake

MUST_CONFIGURE=		gnu
CONFIGURE_ARGS=		--with-default-sys-path="/xports/Mk:{{PREFIX}}/share/mk"
			--with-machine-arch={{ARCH}}
			--with-mksrc=no

VAR_OPSYS[freebsd]=	MAKEFILE_LINE=SYSTEM=FreeBSD/amd64/x86_64/1302001/13.2/13
VAR_OPSYS[sunos]=	MAKEFILE_LINE=SYSTEM=SunOS/i86pc/x86_64/510200910/5.10/5.10
VAR_OPSYS[linux]=	MAKEFILE_LINE=SYSTEM=Linux/x86_64/x86_64/610000/6.1.0/6.1
VAR_OPSYS[darwin]=	MAKEFILE_LINE=SYSTEM=Darwin/x86_64/x86_64/170700/17.7.0/17
VAR_OPSYS[netbsd]=	MAKEFILE_LINE=SYSTEM=NetBSD/x86_64/x86_64/902000000/9.2/9
VAR_OPSYS[dragonfly]=	MAKEFILE_LINE=SYSTEM=DragonFly/x86_64/x86_64/600400/6.4/6.4
VAR_OPSYS[midnightbsd]=	MAKEFILE_LINE=SYSTEM=MidnightBSD/amd64/x86_64/300005/3.0.0/3

[PREV_DBSD].DESCRIPTION=		Hardcode OS values to older DragonFly release
[PREV_DBSD].MAKEFILE_ON=		SYSTEM=DragonFly/x86_64/x86_64/600200/6.2/6.2
[PREV_DBSD].ONLY_FOR_OPSYS_ON=		dragonfly

[PREV_FBSD].DESCRIPTION=		Hardcode OS values to older FreeBSD release
[PREV_FBSD].MAKEFILE_ON=		SYSTEM=FreeBSD/amd64/x86_64/1202000/12.2/12
[PREV_FBSD].ONLY_FOR_OPSYS_ON=		freebsd

[PREV_LINUX].DESCRIPTION=		Hardcode OS values to older Linux release
[PREV_LINUX].MAKEFILE_ON=		SYSTEM=Linux/x86_64/x86_64/440053/4.4.0/4.4
[PREV_LINUX].ONLY_FOR_OPSYS_ON=		linux

post-patch:
	${REINPLACE_CMD} -e 's|@CFLAGS@|\
	-DOSNAME=\\\"${ZOPSYS}\\\"\
	-DOSARCH=\\\"${ZARCH}\\\"\
	-DSTDARCH=\\\"${ZARCHSTD}\\\"\
	-DOSVERSION=\\\"${ZOSVERSION}\\\"\
	-DOSRELEASE=\\\"${ZOSREL}\\\"\
	-DOSMAJOR=\\\"${ZMAJOR}\\\"\
	@CFLAGS@|' ${WRKDIR}/bmake/make-bootstrap.sh.in

do-build:
	(cd ${WRKSRC} && ${SETENV} ${MAKE_ENV} ${SH} make-bootstrap.sh)

do-install:
	${INSTALL_PROGRAM} ${WRKSRC}/bmake ${STAGEDIR}${PREFIX}/bin
	${INSTALL_MAN} ${WRKSRC}/bmake.1 ${STAGEDIR}${MAN1PREFIX}/man/man1
	${MKDIR} ${STAGEDIR}${PREFIX}/share/mk/sys
	${INSTALL_DATA} ${WRKSRC}/mk/*.mk ${STAGEDIR}${PREFIX}/share/mk/
	${INSTALL_DATA} ${WRKSRC}/mk/sys/*.mk \
		${STAGEDIR}${PREFIX}/share/mk/sys/

[FILE:193:descriptions/desc.single]
bmake is a portable version of NetBSD's make(1) utility,
conveniently packaged using a configure script, for other environments
which may lack NetBSD's libraries, regular expression code, etc.


[FILE:100:distinfo]
f9a906d7487699c9e0d2c135700c2d088da5fcd0f2f6761267a57aabfea31feb       858436 bmake-20240314.tar.gz


[FILE:925:manifests/plist.single]
bin/bmake
share/man/man1/bmake.1.gz
share/mk/
 auto.dep.mk
 auto.obj.mk
 autoconf.mk
 autodep.mk
 cc-wrap.mk
 ccm.dep.mk
 compiler.mk
 cython.mk
 dep.mk
 dirdeps-cache-update.mk
 dirdeps-options.mk
 dirdeps-targets.mk
 dirdeps.mk
 doc.mk
 dpadd.mk
 files.mk
 final.mk
 gendirdeps.mk
 host-target.mk
 host.libnames.mk
 inc.mk
 init.mk
 install-new.mk
 java.mk
 jobs.mk
 ldorder.mk
 lib.mk
 libnames.mk
 libs.mk
 links.mk
 man.mk
 manifest.mk
 meta.autodep.mk
 meta.stage.mk
 meta.subdir.mk
 meta.sys.mk
 nls.mk
 obj.mk
 options.mk
 own.mk
 posix.mk
 prlist.mk
 prog.mk
 progs.mk
 rst2htm.mk
 scripts.mk
 srctop.mk
 subdir.mk
 suffixes.mk
 sys.clean-env.mk
 sys.debug.mk
 sys.dependfile.mk
 sys.dirdeps.mk
 sys.mk
 sys.vars.mk
 target-flags.mk
 warnings.mk
 whats.mk
 yacc.mk
share/mk/sys/
 AIX.mk
 Cygwin.mk
 Darwin.mk
 Generic.mk
 HP-UX.mk
 IRIX.mk
 Linux.mk
 NetBSD.mk
 OSF1.mk
 OpenBSD.mk
 SCO_SV.mk
 SunOS.mk
 UnixWare.mk


[FILE:638:patches/patch-main.c]
--- main.c.orig	2024-03-10 03:03:48 UTC
+++ main.c
@@ -1424,6 +1424,12 @@ main_Init(int argc, char **argv)
 		Global_Set_ReadOnly(".MAKE.UID", buf);
 		snprintf(buf, sizeof buf, "%u", getgid());
 		Global_Set_ReadOnly(".MAKE.GID", buf);
+		Global_Set_ReadOnly(".MAKE.OS.NAME",          OSNAME);
+		Global_Set_ReadOnly(".MAKE.OS.VERSION",       OSVERSION);
+		Global_Set_ReadOnly(".MAKE.OS.RELEASE",       OSRELEASE);
+		Global_Set_ReadOnly(".MAKE.OS.MAJOR",         OSMAJOR);
+		Global_Set_ReadOnly(".MAKE.OS.ARCHITECTURE",  OSARCH);
+		Global_Set_ReadOnly(".MAKE.OS.ARCH.STANDARD", STDARCH);
 	}
 	if (makelevel > 0) {
 		char pn[1024];


[FILE:157:files/special.mk]
ZOPSYS=		${SYSTEM:H:H:H:H:H}
ZARCH=		${SYSTEM:H:H:H:H:T}
ZARCHSTD=	${SYSTEM:H:H:H:T}
ZOSVERSION=	${SYSTEM:H:H:T}
ZOSREL=		${SYSTEM:H:T}
ZMAJOR=		${SYSTEM:T}

