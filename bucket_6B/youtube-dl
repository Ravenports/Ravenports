# Buildsheet autogenerated by ravenadm tool -- Do not edit.

NAMEBASE=		youtube-dl
VERSION=		2021.02.22
KEYWORDS=		www
VARIANTS=		standard
SDESC[standard]=	Program for downloading videos from YouTube.com
HOMEPAGE=		https://youtube-dl.org/
CONTACT=		nobody

DOWNLOAD_GROUPS=	main
SITES[main]=		https://github.com/ytdl-org/youtube-dl/releases/download/2021.02.22/
DISTFILE[1]=		youtube-dl-2021.02.22.tar.gz:main
DF_INDEX=		1
SPKGS[standard]=	single

OPTIONS_AVAILABLE=	none
OPTIONS_STANDARD=	none

RUN_DEPENDS=		rtmpdump:program:standard

USES=			python:sutools

DISTNAME=		youtube-dl

LICENSE=		PUBDOM:single
LICENSE_FILE=		PUBDOM:{{WRKSRC}}/LICENSE
LICENSE_SCHEME=		solo

FPC_EQUIVALENT=		www/youtube_dl

BUILD_TARGET=		youtube-dl
MAKE_ARGS=		PYTHON={{PYTHON_CMD}}

post-patch:
	${REINPLACE_CMD} -e 's|python devscripts/|${PYTHON_CMD} devscripts/|' \
		${WRKSRC}/Makefile

post-install:
	# there's no docs subpackage, so remove README.txt
	# Worse, it's not even in $STD_DOCDIR
	${RM} -r ${STAGEDIR}${PREFIX}/share/doc/youtube_dl

post-extract:
	# remove tarball provided version, build our own
	${RM} ${WRKSRC}/youtube-dl

[FILE:169:descriptions/desc.single]
youtube-dl is a small command-line program for downloading videos from
YouTube.com, metacafe.com, google video, photobucket videos, yahoo videos,
dailymotion and others


[FILE:107:distinfo]
fd605dd76b6e46179bd2eed6905537bebffdc72732b578db21d3074bb19b44a6      3293733 youtube-dl-2021.02.22.tar.gz


[FILE:116:manifests/plist.single]
@comment left after autoplist
etc/bash_completion.d/youtube-dl.bash-completion
etc/fish/completions/youtube-dl.fish


[FILE:1892:patches/patch-Makefile]
--- Makefile.orig	2021-02-04 06:14:03 UTC
+++ Makefile
@@ -12,7 +12,7 @@ SHAREDIR ?= $(PREFIX)/share
 PYTHON ?= /usr/bin/env python
 
 # set SYSCONFDIR to /etc if PREFIX=/usr or PREFIX=/usr/local
-SYSCONFDIR = $(shell if [ $(PREFIX) = /usr -o $(PREFIX) = /usr/local ]; then echo /etc; else echo $(PREFIX)/etc; fi)
+SYSCONFDIR ?= $(PREFIX)/etc
 
 # set markdown input format to "markdown-smart" for pandoc version 2 and to "markdown" for pandoc prior to version 2
 MARKDOWN = $(shell if [ `pandoc -v | head -n1 | cut -d" " -f2 | head -c1` = "2" ]; then echo markdown-smart; else echo markdown; fi)
@@ -23,11 +23,11 @@ install: youtube-dl youtube-dl.1 youtube
 	install -d $(DESTDIR)$(MANDIR)/man1
 	install -m 644 youtube-dl.1 $(DESTDIR)$(MANDIR)/man1
 	install -d $(DESTDIR)$(SYSCONFDIR)/bash_completion.d
-	install -m 644 youtube-dl.bash-completion $(DESTDIR)$(SYSCONFDIR)/bash_completion.d/youtube-dl
+	install -m 644 youtube-dl.bash-completion $(DESTDIR)$(SYSCONFDIR)/bash_completion.d/youtube-dl.sh
 	install -d $(DESTDIR)$(SHAREDIR)/zsh/site-functions
 	install -m 644 youtube-dl.zsh $(DESTDIR)$(SHAREDIR)/zsh/site-functions/_youtube-dl
-	install -d $(DESTDIR)$(SYSCONFDIR)/fish/completions
-	install -m 644 youtube-dl.fish $(DESTDIR)$(SYSCONFDIR)/fish/completions/youtube-dl.fish
+	install -d $(DESTDIR)$(SHAREDIR)/fish/completions
+	install -m 644 youtube-dl.fish $(DESTDIR)$(SHAREDIR)/fish/completions/youtube-dl.fish
 
 codetest:
 	flake8 .
@@ -91,10 +91,6 @@ supportedsites:
 README.txt: README.md
 	pandoc -f $(MARKDOWN) -t plain README.md -o README.txt
 
-youtube-dl.1: README.md
-	$(PYTHON) devscripts/prepare_manpage.py youtube-dl.1.temp.md
-	pandoc -s -f $(MARKDOWN) -t man youtube-dl.1.temp.md -o youtube-dl.1
-	rm -f youtube-dl.1.temp.md
 
 youtube-dl.bash-completion: youtube_dl/*.py youtube_dl/*/*.py devscripts/bash-completion.in
 	$(PYTHON) devscripts/bash-completion.py


[FILE:851:patches/patch-youtube__dl_____init____.py]
--- youtube_dl/__init__.py.orig	2021-02-04 06:14:03 UTC
+++ youtube_dl/__init__.py
@@ -36,7 +36,6 @@ from .utils import (
     write_string,
     render_table,
 )
-from .update import update_self
 from .downloader import (
     FileDownloader,
 )
@@ -440,17 +439,13 @@ def _real_main(argv=None):
     }
 
     with YoutubeDL(ydl_opts) as ydl:
-        # Update version
-        if opts.update_self:
-            update_self(ydl.to_screen, opts.verbose, ydl._opener)
-
         # Remove cache dir
         if opts.rm_cachedir:
             ydl.cache.remove()
 
         # Maybe do nothing
         if (len(all_urls) < 1) and (opts.load_info_filename is None):
-            if opts.update_self or opts.rm_cachedir:
+            if opts.rm_cachedir:
                 sys.exit()
 
             ydl.warn_if_short_id(sys.argv[1:] if argv is None else argv)


[FILE:671:patches/patch-youtube_dl__options.py]
--- youtube_dl/options.py.orig	2021-02-04 06:14:03 UTC
+++ youtube_dl/options.py
@@ -138,10 +138,6 @@ def parseOpts(overrideArguments=None):
         action='version',
         help='Print program version and exit')
     general.add_option(
-        '-U', '--update',
-        action='store_true', dest='update_self',
-        help='Update this program to latest version. Make sure that you have sufficient permissions (run with sudo if needed)')
-    general.add_option(
         '-i', '--ignore-errors',
         action='store_true', dest='ignoreerrors', default=False,
         help='Continue on download errors, for example to skip unavailable videos in a playlist')

