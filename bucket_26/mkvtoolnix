# Buildsheet autogenerated by ravenadm tool -- Do not edit.

NAMEBASE=		mkvtoolnix
VERSION=		86.0
KEYWORDS=		multimedia graphics
VARIANTS=		standard
SDESC[standard]=	Matroska media files manipulation tools
HOMEPAGE=		https://mkvtoolnix.download/
CONTACT=		nobody

DOWNLOAD_GROUPS=	main
SITES[main]=		https://mkvtoolnix.download/sources/
DISTFILE[1]=		mkvtoolnix-86.0.tar.xz:main
DF_INDEX=		1
SPKGS[standard]=	complete
			primary
			man
			nls

OPTIONS_AVAILABLE=	none
OPTIONS_STANDARD=	none

BUILD_DEPENDS=		docbook-xsl:primary:standard
			ruby-rake:single:ruby_default
			libxslt:primary:standard
			po4a:primary:standard
			gmp:dev:standard
			boost-libraries:dev:standard
			libvorbis:dev:standard
			flac:dev:standard
			qt6-qtbase:dev:standard
			qt6-qtsvg:dev:standard
			qt6-qtmultimedia:dev:standard
			pugixml:dev:standard
			libdvdread:dev:standard
			cmark:dev:standard
			cmark:primary:standard
BUILDRUN_DEPENDS=	libmatroska:single:standard
			libvorbis:primary:standard
			flac:primary:standard
			boost-libraries:primary:standard
			libdvdread:primary:standard
			pugixml:primary:standard
			qt6-qtsvg:primary:standard
			qt6-qtmultimedia:primary:standard
			gmp:primary:standard

USES=			zlib pkgconfig gettext pcre2 iconv:build
			solaris-funcs mime-info:primary
			desktop-utils:primary

FPC_EQUIVALENT=		multimedia/mkvtoolnix
SOL_FUNCTIONS=		timegm:src/common/date_time.cpp

MUST_CONFIGURE=		gnu
CONFIGURE_ARGS=		--with-boost="{{LOCALBASE}}"
			--with-docbook-xsl-root="{{PREFIX}}/share/xsl/docbook"
			--with-dvdread
			--enable-gui
			--with-qmake6="{{LOCALBASE}}/lib/qt6/bin/qmake"
CONFIGURE_ENV=		PKG_CONFIG_PATH="{{LOCALBASE}}/lib/qt6/pkgconfig"

BUILD_TARGET=		#skip
MAKEFILE=		Rakefile
MAKE_ENV=		V=1

VAR_OPSYS[freebsd]=	CONFIGURE_ARGS=--enable-precompiled-headers=no
VAR_OPSYS[sunos]=	LDFLAGS=-lintl
VAR_OPSYS[midnightbsd]=	CONFIGURE_ARGS=--enable-precompiled-headers=no

post-patch:
	${FIND} ${WRKSRC} -type f -name "windows\.cpp" -delete
	${FIND} ${WRKSRC} -type f -name "macos\.cpp" -delete
	${FIND} ${WRKSRC} -type f -name "[wm]*_program_runner*" -delete
	${RM} ${WRKSRC}/src/mkvtoolnix-gui/util/windows_font.cpp
	if [ "${OPSYS}" != "Linux" ]; then \
	   ${RM} ${WRKSRC}/src/mkvtoolnix-gui/jobs/program_runner/linux_program_runner.*; \
	fi

[FILE:112:descriptions/desc.primary]
MKVToolNix is a set of tools to create, alter and inspect Matroska files
under Linux, other Unices and Windows.


[FILE:101:distinfo]
29a9155fbba99f9074de2abcfbdc4e966ea38c16d9f6f547cf2d8d9a48152c97     11369476 mkvtoolnix-86.0.tar.xz


[FILE:1231:manifests/plist.primary]
bin/
 mkvextract
 mkvinfo
 mkvmerge
 mkvpropedit
 mkvtoolnix-gui
share/applications/org.bunkus.mkvtoolnix-gui.desktop
share/icons/hicolor/128x128/apps/
 mkvextract.png
 mkvinfo.png
 mkvmerge.png
 mkvpropedit.png
 mkvtoolnix-gui.png
share/icons/hicolor/16x16/apps/
 mkvextract.png
 mkvinfo.png
 mkvmerge.png
 mkvpropedit.png
 mkvtoolnix-gui.png
share/icons/hicolor/24x24/apps/
 mkvextract.png
 mkvinfo.png
 mkvmerge.png
 mkvpropedit.png
 mkvtoolnix-gui.png
share/icons/hicolor/256x256/apps/
 mkvextract.png
 mkvinfo.png
 mkvmerge.png
 mkvpropedit.png
 mkvtoolnix-gui.png
share/icons/hicolor/32x32/apps/
 mkvextract.png
 mkvinfo.png
 mkvmerge.png
 mkvpropedit.png
 mkvtoolnix-gui.png
share/icons/hicolor/48x48/apps/
 mkvextract.png
 mkvinfo.png
 mkvmerge.png
 mkvpropedit.png
 mkvtoolnix-gui.png
share/icons/hicolor/64x64/apps/
 mkvextract.png
 mkvinfo.png
 mkvmerge.png
 mkvpropedit.png
 mkvtoolnix-gui.png
share/icons/hicolor/96x96/apps/
 mkvextract.png
 mkvinfo.png
 mkvmerge.png
 mkvpropedit.png
 mkvtoolnix-gui.png
share/metainfo/org.bunkus.mkvtoolnix-gui.appdata.xml
share/mime/packages/org.bunkus.mkvtoolnix-gui.xml
share/mkvtoolnix/qt_resources.rcc
share/mkvtoolnix/sounds/
 finished-1.webm
 finished-2.webm
 finished-3.webm


[FILE:1771:manifests/plist.man]
share/man/be/man1/
 mkvextract.1.gz
 mkvinfo.1.gz
 mkvmerge.1.gz
 mkvpropedit.1.gz
 mkvtoolnix-gui.1.gz
share/man/bg/man1/
 mkvextract.1.gz
 mkvinfo.1.gz
 mkvmerge.1.gz
 mkvpropedit.1.gz
 mkvtoolnix-gui.1.gz
share/man/ca/man1/
 mkvextract.1.gz
 mkvinfo.1.gz
 mkvmerge.1.gz
 mkvpropedit.1.gz
 mkvtoolnix-gui.1.gz
share/man/de/man1/
 mkvextract.1.gz
 mkvinfo.1.gz
 mkvmerge.1.gz
 mkvpropedit.1.gz
 mkvtoolnix-gui.1.gz
share/man/es/man1/
 mkvextract.1.gz
 mkvinfo.1.gz
 mkvmerge.1.gz
 mkvpropedit.1.gz
 mkvtoolnix-gui.1.gz
share/man/fr/man1/
 mkvextract.1.gz
 mkvinfo.1.gz
 mkvmerge.1.gz
 mkvpropedit.1.gz
 mkvtoolnix-gui.1.gz
share/man/it/man1/
 mkvextract.1.gz
 mkvinfo.1.gz
 mkvmerge.1.gz
 mkvpropedit.1.gz
 mkvtoolnix-gui.1.gz
share/man/ja/man1/
 mkvextract.1.gz
 mkvinfo.1.gz
 mkvmerge.1.gz
 mkvpropedit.1.gz
 mkvtoolnix-gui.1.gz
share/man/ko/man1/
 mkvextract.1.gz
 mkvinfo.1.gz
 mkvmerge.1.gz
 mkvpropedit.1.gz
 mkvtoolnix-gui.1.gz
share/man/man1/
 mkvextract.1.gz
 mkvinfo.1.gz
 mkvmerge.1.gz
 mkvpropedit.1.gz
 mkvtoolnix-gui.1.gz
share/man/nb/man1/
 mkvextract.1.gz
 mkvinfo.1.gz
 mkvmerge.1.gz
 mkvpropedit.1.gz
 mkvtoolnix-gui.1.gz
share/man/nl/man1/
 mkvextract.1.gz
 mkvinfo.1.gz
 mkvmerge.1.gz
 mkvpropedit.1.gz
 mkvtoolnix-gui.1.gz
share/man/pl/man1/
 mkvextract.1.gz
 mkvinfo.1.gz
 mkvmerge.1.gz
 mkvpropedit.1.gz
 mkvtoolnix-gui.1.gz
share/man/ru/man1/
 mkvextract.1.gz
 mkvinfo.1.gz
 mkvmerge.1.gz
 mkvpropedit.1.gz
 mkvtoolnix-gui.1.gz
share/man/uk/man1/
 mkvextract.1.gz
 mkvinfo.1.gz
 mkvmerge.1.gz
 mkvpropedit.1.gz
 mkvtoolnix-gui.1.gz
share/man/zh_CN/man1/
 mkvextract.1.gz
 mkvinfo.1.gz
 mkvmerge.1.gz
 mkvpropedit.1.gz
 mkvtoolnix-gui.1.gz
share/man/zh_TW/man1/
 mkvextract.1.gz
 mkvinfo.1.gz
 mkvmerge.1.gz
 mkvpropedit.1.gz
 mkvtoolnix-gui.1.gz


[FILE:1158:manifests/plist.nls]
share/locale/be/LC_MESSAGES/mkvtoolnix.mo
share/locale/bg/LC_MESSAGES/mkvtoolnix.mo
share/locale/ca/LC_MESSAGES/mkvtoolnix.mo
share/locale/cs/LC_MESSAGES/mkvtoolnix.mo
share/locale/de/LC_MESSAGES/mkvtoolnix.mo
share/locale/es/LC_MESSAGES/mkvtoolnix.mo
share/locale/eu/LC_MESSAGES/mkvtoolnix.mo
share/locale/fr/LC_MESSAGES/mkvtoolnix.mo
share/locale/it/LC_MESSAGES/mkvtoolnix.mo
share/locale/ja/LC_MESSAGES/mkvtoolnix.mo
share/locale/ko/LC_MESSAGES/mkvtoolnix.mo
share/locale/lt/LC_MESSAGES/mkvtoolnix.mo
share/locale/nb/LC_MESSAGES/mkvtoolnix.mo
share/locale/nl/LC_MESSAGES/mkvtoolnix.mo
share/locale/pl/LC_MESSAGES/mkvtoolnix.mo
share/locale/pt/LC_MESSAGES/mkvtoolnix.mo
share/locale/pt_BR/LC_MESSAGES/mkvtoolnix.mo
share/locale/ro/LC_MESSAGES/mkvtoolnix.mo
share/locale/ru/LC_MESSAGES/mkvtoolnix.mo
share/locale/sr_RS/LC_MESSAGES/mkvtoolnix.mo
share/locale/sr_RS@latin/LC_MESSAGES/mkvtoolnix.mo
share/locale/sv/LC_MESSAGES/mkvtoolnix.mo
share/locale/tr/LC_MESSAGES/mkvtoolnix.mo
share/locale/uk/LC_MESSAGES/mkvtoolnix.mo
share/locale/zh_CN/LC_MESSAGES/mkvtoolnix.mo
share/locale/zh_SG/LC_MESSAGES/mkvtoolnix.mo
share/locale/zh_TW/LC_MESSAGES/mkvtoolnix.mo


[FILE:389:patches/patch-Rakefile]
--- Rakefile.orig	2024-07-13 16:11:11 UTC
+++ Rakefile
@@ -247,8 +247,6 @@ def determine_optimization_cflags
 end
 
 def determine_stack_protector_flags
-  return " -fstack-protector"        if is_gcc? && !check_compiler_version("gcc", "4.9.0")
-  return " -fstack-protector-strong" if check_compiler_version("gcc", "4.9.0") || check_compiler_version("clang", "3.5.0")
   return ""
 end
 


[FILE:3260:patches/patch-configure]
--- configure.orig	2024-07-13 16:11:14 UTC
+++ configure
@@ -8732,13 +8732,9 @@ fi
 { printf "%s\n" "$as_me:${as_lineno-$LINENO}: result: $ac_cv_fmt" >&5
 printf "%s\n" "$ac_cv_fmt" >&6; }
 
-if test x"$ac_cv_fmt" = xyes; then
-  FMT_INTERNAL=no
-else
-  { printf "%s\n" "$as_me:${as_lineno-$LINENO}: Using the internal version of fmt" >&5
+{ printf "%s\n" "$as_me:${as_lineno-$LINENO}: Using the internal version of fmt" >&5
 printf "%s\n" "$as_me: Using the internal version of fmt" >&6;}
   FMT_INTERNAL=yes
-fi
 
 
 
@@ -9182,9 +9178,9 @@ printf "%s\n" "$qmake6_ver" >&6; }
 
   qt_searchpath="$qt_libexecdir:$qt_bindir:$PATH"
 
-  QT_CFLAGS="`$ac_cv_path_EGREP '^DEFINES *=' "$qmake_dir/Makefile" | sed 's/^DEFINES *= *//'`"
-  QT_CFLAGS="$QT_CFLAGS `$ac_cv_path_EGREP '^CXXFLAGS *=' "$qmake_dir/Makefile" | sed -e 's/^CXXFLAGS *= *//' -e 's/-pipe//g' -e 's/-O.//g' -e 's/ -f[a-z][^ ]*//g' -e 's/ -W[^ ]*//g' -e 's/-std=[^ ]*//g' -e 's/\$([^)]*)//g'`"
-  QT_INCFLAGS="`$ac_cv_path_EGREP '^INCPATH *=' "$qmake_dir/Makefile" | sed -e 's/^INCPATH *= *//'`"
+  QT_CFLAGS="`$ac_cv_path_EGREP '^DEFINES *\+=' "$qmake_dir/Makefile" | sed 's/^DEFINES *+= *//'`"
+  QT_CFLAGS="$QT_CFLAGS `$ac_cv_path_EGREP '^CXXFLAGS *\+=' "$qmake_dir/Makefile" | sed -e 's/^CXXFLAGS *+= *//' -e 's/-pipe//g' -e 's/-O.//g' -e 's/ -f[a-z][^ ]*//g' -e 's/ -W[^ ]*//g' -e 's/-std=[^ ]*//g' -e 's/\$([^)]*)//g'`"
+  QT_INCFLAGS="`$ac_cv_path_EGREP '^INCPATH *\+=' "$qmake_dir/Makefile" | sed -e 's/^INCPATH *+= *//'`"
 
   # If under MinGW/MSYS2, fix relative include paths
   if ! test -z "${MINGW_PREFIX}"; then
@@ -9194,11 +9190,11 @@ printf "%s\n" "$qmake6_ver" >&6; }
   QT_INCFLAGS="`echo $QT_INCFLAGS | sed -e 's:-I[^/][^ ]*::g'`"
   QT_CFLAGS="$QT_CFLAGS $QT_INCFLAGS"
   QT_CFLAGS="`echo $QT_CFLAGS | sed -e 's/\$(EXPORT_ARCH_ARGS)//'`"
-  QT_LIBS="`$ac_cv_path_EGREP '^LFLAGS *=' "$qmake_dir/Makefile" | sed -e 's/^LFLAGS *= *//' -e 's/-Wl,-O[^ ]*//g' -e 's/ -f[a-z][^ ]*//g'`"
-  QT_LIBS="$QT_LIBS `$ac_cv_path_EGREP '^LIBS *=' "$qmake_dir/Makefile" | sed -e 's/^LIBS *= *//' -e 's/\$([^)]*)//g' -e 's:-L[^/][^ ]*::g'`"
+  QT_LIBS="`$ac_cv_path_EGREP '^LFLAGS *\+=' "$qmake_dir/Makefile" | sed -e 's/^LFLAGS *+= *//' -e 's/-Wl,-O[^ ]*//g' -e 's/ -f[a-z][^ ]*//g'`"
+  QT_LIBS="$QT_LIBS `$ac_cv_path_EGREP '^LIBS *\+=' "$qmake_dir/Makefile" | sed -e 's/^LIBS *+= *//' -e 's/\$([^)]*)//g' -e 's:-L[^/][^ ]*::g'`"
   QT_LIBS="`echo $QT_LIBS | sed -e 's/\$(EXPORT_ARCH_ARGS)//'`"
-  QT_LIBS_NON_GUI="`$ac_cv_path_EGREP '^LFLAGS *=' "$qmake_dir/Makefile.non_gui" | sed -e 's/^LFLAGS *= *//' -e 's/-Wl,-O[^ ]*//g' -e 's/ -f[a-z][^ ]*//g'`"
-  QT_LIBS_NON_GUI="$QT_LIBS_NON_GUI `$ac_cv_path_EGREP '^LIBS *=' "$qmake_dir/Makefile.non_gui" | sed -e 's/^LIBS *= *//' -e 's/\$([^)]*)//g' -e 's:-L[^/][^ ]*::g'`"
+  QT_LIBS_NON_GUI="`$ac_cv_path_EGREP '^LFLAGS *\+=' "$qmake_dir/Makefile.non_gui" | sed -e 's/^LFLAGS *+= *//' -e 's/-Wl,-O[^ ]*//g' -e 's/ -f[a-z][^ ]*//g'`"
+  QT_LIBS_NON_GUI="$QT_LIBS_NON_GUI `$ac_cv_path_EGREP '^LIBS *\+=' "$qmake_dir/Makefile.non_gui" | sed -e 's/^LIBS *+= *//' -e 's/\$([^)]*)//g' -e 's:-L[^/][^ ]*::g'`"
   QT_LIBS_NON_GUI="`echo $QT_LIBS_NON_GUI | sed -e 's/\$(EXPORT_ARCH_ARGS)//' -e 's/-Wl,-subsystem,windows *//g'`"
 
   rm -rf "$qmake_dir"


[FILE:354:patches/patch-lib_fmt_include_fmt_os.h]
--- lib/fmt/include/fmt/os.h.orig	2024-07-13 16:11:14 UTC
+++ lib/fmt/include/fmt/os.h
@@ -15,7 +15,7 @@
 
 #include "format.h"
 
-#if defined __APPLE__ || defined(__FreeBSD__)
+#if defined __APPLE__ || defined(__FreeBSD__) || defined(__DragonFly__)
 #  if FMT_HAS_INCLUDE(<xlocale.h>)
 #    include <xlocale.h>  // for LC_NUMERIC_MASK on OS X
 #  endif


[FILE:368:patches/patch-lib_fmt_src_fmt.cc]
--- lib/fmt/src/fmt.cc.orig	2024-07-13 16:11:14 UTC
+++ lib/fmt/src/fmt.cc
@@ -41,7 +41,7 @@ module;
 #if defined(_MSC_VER) || defined(__MINGW32__)
 #  include <intrin.h>
 #endif
-#if defined __APPLE__ || defined(__FreeBSD__)
+#if defined __APPLE__ || defined(__FreeBSD__) || defined(__DragonFly__)
 #  include <xlocale.h>
 #endif
 #if __has_include(<winapifamily.h>)


[FILE:664:patches/patch-src_common_locale.cpp]
$NetBSD: patch-src_common_locale.cpp,v 1.2 2020/05/31 11:34:15 adam Exp $

Remove broken SunOS section that is no longer needed.
https://gitlab.com/mbunkus/mkvtoolnix/issues/2450

--- src/common/locale.cpp.orig	2024-07-13 16:11:11 UTC
+++ src/common/locale.cpp
@@ -286,12 +286,6 @@ get_local_charset() {
 
 #if defined(COMP_MINGW) || defined(COMP_MSC)
   lc_charset = fmt::format("CP{0}", GetACP());
-#elif defined(SYS_SOLARIS)
-  int i;
-
-  lc_charset = nl_langinfo(CODESET);
-  if (mtx::string::parse_number(lc_charset, i))
-    lc_charset = "ISO"s + lc_charset + "-US"s;
 #elif HAVE_NL_LANGINFO
   lc_charset = nl_langinfo(CODESET);
 #elif HAVE_LOCALE_CHARSET


[FILE:362:patches/patch-src_common_os.h]
--- src/common/os.h.orig	2024-07-13 16:11:11 UTC
+++ src/common/os.h
@@ -21,7 +21,7 @@
 #else
 # define COMP_GCC
 # define SYS_UNIX
-# if defined(__bsdi__) || defined(__FreeBSD__)
+# if defined(__bsdi__) || defined(__FreeBSD__) || defined(__DragonFly__) || defined(__NetBSD__)
 #  define SYS_BSD
 # elif defined(__sun) && defined(__SUNPRO_CC)
 #  undef COMP_GCC


[FILE:761:patches/patch-src_mkvtoolnix-gui_util_sleep__inhibitor.cpp]
--- src/mkvtoolnix-gui/util/sleep_inhibitor.cpp.orig	2024-07-13 16:11:11 UTC
+++ src/mkvtoolnix-gui/util/sleep_inhibitor.cpp
@@ -6,7 +6,7 @@
 # include "mkvtoolnix-gui/util/sleep_inhibitor/windows.h"
 #elif defined(SYS_APPLE)
 # include "mkvtoolnix-gui/util/sleep_inhibitor/macos.h"
-#elif defined(HAVE_QTDBUS)
+#elif defined(__linux__)
 # include "mkvtoolnix-gui/util/sleep_inhibitor/linux_logind.h"
 #endif
 
@@ -66,7 +66,7 @@ BasicSleepInhibitor::create() {
   inhibitor->addInhibitor(std::make_shared<WindowsSleepInhibitor>());
 #elif defined(SYS_APPLE)
   inhibitor->addInhibitor(std::make_shared<MacOSSleepInhibitor>());
-#elif defined(HAVE_QTDBUS)
+#elif defined(__linux__)
   inhibitor->addInhibitor(std::make_shared<LogindSleepInhibitor>());
 #endif
 


[FILE:308:patches/patch-src_mkvtoolnix-gui_util_sleep__inhibitor_linux__logind.cpp]
--- src/mkvtoolnix-gui/util/sleep_inhibitor/linux_logind.cpp.orig	2024-07-13 16:11:11 UTC
+++ src/mkvtoolnix-gui/util/sleep_inhibitor/linux_logind.cpp
@@ -1,6 +1,6 @@
 #include "common/common_pch.h"
 
-#if defined(HAVE_QTDBUS)
+#if defined(__linux__)
 
 #include <QDBusConnection>
 #include <QDBusInterface>


[FILE:18:files/special.mk]
MAKE_CMD=	rake -v

