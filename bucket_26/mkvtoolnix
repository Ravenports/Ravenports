# Buildsheet autogenerated by ravenadm tool -- Do not edit.

NAMEBASE=		mkvtoolnix
VERSION=		58.0.0
KEYWORDS=		multimedia graphics
VARIANTS=		standard gui
SDESC[gui]=		Matroska multimedia tools with GUI
SDESC[standard]=	Matroska media files manipulation tools
HOMEPAGE=		https://mkvtoolnix.download/
CONTACT=		nobody

DOWNLOAD_GROUPS=	main
SITES[main]=		https://mkvtoolnix.download/sources/
DISTFILE[1]=		mkvtoolnix-58.0.0.tar.xz:main
DF_INDEX=		1
SPKGS[gui]=		complete
			primary
			nls
SPKGS[standard]=	complete
			primary
			nls

OPTIONS_AVAILABLE=	GUI
OPTIONS_STANDARD=	none
VOPTS[gui]=		GUI=ON

BUILD_DEPENDS=		docbook-xsl:primary:standard
			ruby-rake:single:ruby_default
			libxslt:single:standard
			po4a:primary:standard
BUILDRUN_DEPENDS=	fmt:single:standard
			libmatroska:single:standard
			pcre2:primary:standard
			libvorbis:primary:standard
			libogg:primary:standard
			flac:primary:standard
			boost-libraries:rest:python_default
			file:single:standard
			libdvdread:single:standard
			pugixml:single:standard

USES=			zlib pkgconfig gettext-tools gettext-runtime
			solaris-funcs
C_USES[freebsd]=	clang

FPC_EQUIVALENT=		multimedia/mkvtoolnix
SOL_FUNCTIONS=		timegm:src/common/date_time.cpp

MUST_CONFIGURE=		gnu
CONFIGURE_ARGS=		--with-boost="{{LOCALBASE}}"
			--with-boost-filesystem=boost_filesystem
			--with-boost-system=boost_system
			--with-docbook-xsl-root="{{PREFIX}}/share/xsl/docbook"
			--with-dvdread

BUILD_TARGET=		#skip
MAKEFILE=		Rakefile
MAKE_ENV=		V=1

VAR_OPSYS[sunos]=	LDFLAGS=-lintl

[GUI].DESCRIPTION=			Include Graphic User Interface with tools
[GUI].BUILDRUN_DEPENDS_ON=		qt5-qtmultimedia:single:standard
					cmark:single:standard
[GUI].BUILD_DEPENDS_ON=			qt5-qtbase:primary:standard
[GUI].CONFIGURE_ARGS_ON=		--enable-qt
					--with-moc="{{LOCALBASE}}/lib/qt5/bin/moc"
					--with-uic="{{LOCALBASE}}/lib/qt5/bin/uic"
					--with-rcc="{{LOCALBASE}}/lib/qt5/bin/rcc"
					--with-qmake="{{LOCALBASE}}/lib/qt5/bin/qmake"
[GUI].CONFIGURE_ENV_ON=			PKG_CONFIG_PATH="{{LOCALBASE}}/lib/qt5/pkgconfig"
[GUI].USES_ON=				mime-info:primary
					desktop-utils:primary

[FILE:112:descriptions/desc.primary]
MKVToolNix is a set of tools to create, alter and inspect Matroska files
under Linux, other Unices and Windows.


[FILE:103:distinfo]
1af727fa203e2bd8c54a005f28b635c96a4b80aa4ee8d23b4def0b6800ca6e38      7651964 mkvtoolnix-58.0.0.tar.xz


[FILE:3298:manifests/plist.primary]
%%GUI-ON%%bin/mkvtoolnix-gui
%%GUI-ON%%share/applications/org.bunkus.mkvtoolnix-gui.desktop
%%GUI-ON%%share/icons/hicolor/128x128/apps/
 mkvextract.png
 mkvinfo.png
 mkvmerge.png
 mkvpropedit.png
 mkvtoolnix-gui.png
%%GUI-ON%%share/icons/hicolor/16x16/apps/
 mkvextract.png
 mkvinfo.png
 mkvmerge.png
 mkvpropedit.png
 mkvtoolnix-gui.png
%%GUI-ON%%share/icons/hicolor/24x24/apps/
 mkvextract.png
 mkvinfo.png
 mkvmerge.png
 mkvpropedit.png
 mkvtoolnix-gui.png
%%GUI-ON%%share/icons/hicolor/256x256/apps/
 mkvextract.png
 mkvinfo.png
 mkvmerge.png
 mkvpropedit.png
 mkvtoolnix-gui.png
%%GUI-ON%%share/icons/hicolor/32x32/apps/
 mkvextract.png
 mkvinfo.png
 mkvmerge.png
 mkvpropedit.png
 mkvtoolnix-gui.png
%%GUI-ON%%share/icons/hicolor/48x48/apps/
 mkvextract.png
 mkvinfo.png
 mkvmerge.png
 mkvpropedit.png
 mkvtoolnix-gui.png
%%GUI-ON%%share/icons/hicolor/64x64/apps/
 mkvextract.png
 mkvinfo.png
 mkvmerge.png
 mkvpropedit.png
 mkvtoolnix-gui.png
%%GUI-ON%%share/icons/hicolor/96x96/apps/
 mkvextract.png
 mkvinfo.png
 mkvmerge.png
 mkvpropedit.png
 mkvtoolnix-gui.png
%%GUI-ON%%share/man/bg/man1/mkvtoolnix-gui.1.gz
%%GUI-ON%%share/man/ca/man1/mkvtoolnix-gui.1.gz
%%GUI-ON%%share/man/de/man1/mkvtoolnix-gui.1.gz
%%GUI-ON%%share/man/es/man1/mkvtoolnix-gui.1.gz
%%GUI-ON%%share/man/fr/man1/mkvtoolnix-gui.1.gz
%%GUI-ON%%share/man/it/man1/mkvtoolnix-gui.1.gz
%%GUI-ON%%share/man/ja/man1/mkvtoolnix-gui.1.gz
%%GUI-ON%%share/man/ko/man1/mkvtoolnix-gui.1.gz
%%GUI-ON%%share/man/man1/mkvtoolnix-gui.1.gz
%%GUI-ON%%share/man/nl/man1/mkvtoolnix-gui.1.gz
%%GUI-ON%%share/man/pl/man1/mkvtoolnix-gui.1.gz
%%GUI-ON%%share/man/ru/man1/mkvtoolnix-gui.1.gz
%%GUI-ON%%share/man/uk/man1/mkvtoolnix-gui.1.gz
%%GUI-ON%%share/man/zh_CN/man1/mkvtoolnix-gui.1.gz
%%GUI-ON%%share/man/zh_TW/man1/mkvtoolnix-gui.1.gz
%%GUI-ON%%share/metainfo/org.bunkus.mkvtoolnix-gui.appdata.xml
%%GUI-ON%%share/mime/packages/org.bunkus.mkvtoolnix-gui.xml
%%GUI-ON%%share/mkvtoolnix/sounds/
 finished-1.ogg
 finished-2.ogg
 finished-3.ogg
bin/
 mkvextract
 mkvinfo
 mkvmerge
 mkvpropedit
share/man/bg/man1/
 mkvextract.1.gz
 mkvinfo.1.gz
 mkvmerge.1.gz
 mkvpropedit.1.gz
share/man/ca/man1/
 mkvextract.1.gz
 mkvinfo.1.gz
 mkvmerge.1.gz
 mkvpropedit.1.gz
share/man/de/man1/
 mkvextract.1.gz
 mkvinfo.1.gz
 mkvmerge.1.gz
 mkvpropedit.1.gz
share/man/es/man1/
 mkvextract.1.gz
 mkvinfo.1.gz
 mkvmerge.1.gz
 mkvpropedit.1.gz
share/man/fr/man1/
 mkvextract.1.gz
 mkvinfo.1.gz
 mkvmerge.1.gz
 mkvpropedit.1.gz
share/man/it/man1/
 mkvextract.1.gz
 mkvinfo.1.gz
 mkvmerge.1.gz
 mkvpropedit.1.gz
share/man/ja/man1/
 mkvextract.1.gz
 mkvinfo.1.gz
 mkvmerge.1.gz
 mkvpropedit.1.gz
share/man/ko/man1/
 mkvextract.1.gz
 mkvinfo.1.gz
 mkvmerge.1.gz
 mkvpropedit.1.gz
share/man/man1/
 mkvextract.1.gz
 mkvinfo.1.gz
 mkvmerge.1.gz
 mkvpropedit.1.gz
share/man/nl/man1/
 mkvextract.1.gz
 mkvinfo.1.gz
 mkvmerge.1.gz
 mkvpropedit.1.gz
share/man/pl/man1/
 mkvextract.1.gz
 mkvinfo.1.gz
 mkvmerge.1.gz
 mkvpropedit.1.gz
share/man/ru/man1/
 mkvextract.1.gz
 mkvinfo.1.gz
 mkvmerge.1.gz
 mkvpropedit.1.gz
share/man/uk/man1/
 mkvextract.1.gz
 mkvinfo.1.gz
 mkvmerge.1.gz
 mkvpropedit.1.gz
share/man/zh_CN/man1/
 mkvextract.1.gz
 mkvinfo.1.gz
 mkvmerge.1.gz
 mkvpropedit.1.gz
share/man/zh_TW/man1/
 mkvextract.1.gz
 mkvinfo.1.gz
 mkvmerge.1.gz
 mkvpropedit.1.gz


[FILE:1029:manifests/plist.nls]
share/locale/bg/LC_MESSAGES/mkvtoolnix.mo
share/locale/ca/LC_MESSAGES/mkvtoolnix.mo
share/locale/cs/LC_MESSAGES/mkvtoolnix.mo
share/locale/de/LC_MESSAGES/mkvtoolnix.mo
share/locale/es/LC_MESSAGES/mkvtoolnix.mo
share/locale/eu/LC_MESSAGES/mkvtoolnix.mo
share/locale/fr/LC_MESSAGES/mkvtoolnix.mo
share/locale/it/LC_MESSAGES/mkvtoolnix.mo
share/locale/ja/LC_MESSAGES/mkvtoolnix.mo
share/locale/ko/LC_MESSAGES/mkvtoolnix.mo
share/locale/lt/LC_MESSAGES/mkvtoolnix.mo
share/locale/nl/LC_MESSAGES/mkvtoolnix.mo
share/locale/pl/LC_MESSAGES/mkvtoolnix.mo
share/locale/pt/LC_MESSAGES/mkvtoolnix.mo
share/locale/pt_BR/LC_MESSAGES/mkvtoolnix.mo
share/locale/ro/LC_MESSAGES/mkvtoolnix.mo
share/locale/ru/LC_MESSAGES/mkvtoolnix.mo
share/locale/sr_RS/LC_MESSAGES/mkvtoolnix.mo
share/locale/sr_RS@latin/LC_MESSAGES/mkvtoolnix.mo
share/locale/sv/LC_MESSAGES/mkvtoolnix.mo
share/locale/tr/LC_MESSAGES/mkvtoolnix.mo
share/locale/uk/LC_MESSAGES/mkvtoolnix.mo
share/locale/zh_CN/LC_MESSAGES/mkvtoolnix.mo
share/locale/zh_TW/LC_MESSAGES/mkvtoolnix.mo


[FILE:389:patches/patch-Rakefile]
--- Rakefile.orig	2021-06-13 10:46:33 UTC
+++ Rakefile
@@ -234,8 +234,6 @@ def determine_optimization_cflags
 end
 
 def determine_stack_protector_flags
-  return " -fstack-protector"        if is_gcc? && !check_compiler_version("gcc", "4.9.0")
-  return " -fstack-protector-strong" if check_compiler_version("gcc", "4.9.0") || check_compiler_version("clang", "3.5.0")
   return ""
 end
 


[FILE:690:patches/patch-src_common_locale.cpp]
$NetBSD: patch-src_common_locale.cpp,v 1.2 2020/05/31 11:34:15 adam Exp $

Remove broken SunOS section that is no longer needed.
https://gitlab.com/mbunkus/mkvtoolnix/issues/2450

--- src/common/locale.cpp.orig	2021-06-13 10:46:33 UTC
+++ src/common/locale.cpp
@@ -284,12 +284,6 @@ get_local_charset() {
   setlocale(LC_CTYPE, "");
 #if defined(COMP_MINGW) || defined(COMP_MSC)
   lc_charset = fmt::format("CP{0}", GetACP());
-#elif defined(SYS_SOLARIS)
-  int i;
-
-  lc_charset = nl_langinfo(CODESET);
-  if (mtx::string::parse_number(lc_charset, i))
-    lc_charset = "ISO"s + lc_charset + "-US"s;
 #elif HAVE_NL_LANGINFO
   lc_charset = nl_langinfo(CODESET);
 #elif HAVE_LOCALE_CHARSET


[FILE:339:patches/patch-src_common_os.h]
--- src/common/os.h.orig	2021-06-13 10:46:33 UTC
+++ src/common/os.h
@@ -21,7 +21,7 @@
 #else
 # define COMP_GCC
 # define SYS_UNIX
-# if defined(__bsdi__) || defined(__FreeBSD__)
+# if defined(__bsdi__) || defined(__FreeBSD__) || defined(__DragonFly__)
 #  define SYS_BSD
 # elif defined(__sun) && defined(__SUNPRO_CC)
 #  undef COMP_GCC


[FILE:761:patches/patch-src_mkvtoolnix-gui_util_sleep__inhibitor.cpp]
--- src/mkvtoolnix-gui/util/sleep_inhibitor.cpp.orig	2021-06-13 10:46:33 UTC
+++ src/mkvtoolnix-gui/util/sleep_inhibitor.cpp
@@ -6,7 +6,7 @@
 # include "mkvtoolnix-gui/util/sleep_inhibitor/windows.h"
 #elif defined(SYS_APPLE)
 # include "mkvtoolnix-gui/util/sleep_inhibitor/macos.h"
-#elif defined(HAVE_QTDBUS)
+#elif defined(SYS_LINUX)
 # include "mkvtoolnix-gui/util/sleep_inhibitor/linux_logind.h"
 #endif
 
@@ -66,7 +66,7 @@ BasicSleepInhibitor::create() {
   inhibitor->addInhibitor(std::make_shared<WindowsSleepInhibitor>());
 #elif defined(SYS_APPLE)
   inhibitor->addInhibitor(std::make_shared<MacOSSleepInhibitor>());
-#elif defined(HAVE_QTDBUS)
+#elif defined(SYS_LINUX)
   inhibitor->addInhibitor(std::make_shared<LogindSleepInhibitor>());
 #endif
 


[FILE:18:files/special.mk]
MAKE_CMD=	rake -v

