# Buildsheet autogenerated by ravenadm tool -- Do not edit.

NAMEBASE=		mkvtoolnix
VERSION=		73.0.0
KEYWORDS=		multimedia graphics
VARIANTS=		standard
SDESC[standard]=	Matroska media files manipulation tools
HOMEPAGE=		https://mkvtoolnix.download/
CONTACT=		nobody

DOWNLOAD_GROUPS=	main
SITES[main]=		https://mkvtoolnix.download/sources/
DISTFILE[1]=		mkvtoolnix-73.0.0.tar.xz:main
DF_INDEX=		1
SPKGS[standard]=	complete
			primary
			nls

OPTIONS_AVAILABLE=	none
OPTIONS_STANDARD=	none

BUILD_DEPENDS=		docbook-xsl:primary:standard
			ruby-rake:single:ruby_default
			libxslt:single:standard
			po4a:primary:standard
			qt5-qtbase:primary:standard
			gmp:static:standard
BUILDRUN_DEPENDS=	libmatroska:single:standard
			pcre2:primary:standard
			libvorbis:primary:standard
			libogg:primary:standard
			flac:primary:standard
			boost-libraries:single:standard
			file:single:standard
			libdvdread:single:standard
			pugixml:single:standard
			qt5-qtmultimedia:single:standard
			gmp:shared:standard
			cmark:single:standard
			qt5-qtsvg:single:standard

USES=			zlib pkgconfig gettext iconv:build solaris-funcs
			mime-info:primary desktop-utils:primary
C_USES[freebsd]=	clang

FPC_EQUIVALENT=		multimedia/mkvtoolnix
SOL_FUNCTIONS=		timegm:src/common/date_time.cpp

MUST_CONFIGURE=		yes
CONFIGURE_ARGS=		--prefix="{{PREFIX}}"
			--with-boost="{{LOCALBASE}}"
			--with-docbook-xsl-root="{{PREFIX}}/share/xsl/docbook"
			--with-dvdread
			--enable-qt5=yes
			--enable-qt6=no
			--with-qmake="{{LOCALBASE}}/lib/qt5/bin/qmake"
			--enable-gui
CONFIGURE_ENV=		PKG_CONFIG_PATH="{{LOCALBASE}}/lib/qt5/pkgconfig"

BUILD_TARGET=		#skip
MAKEFILE=		Rakefile
MAKE_ENV=		V=1

VAR_OPSYS[sunos]=	LDFLAGS=-lintl

post-patch:
	${FIND} ${WRKSRC} -type f -name "windows\.cpp" -delete
	${FIND} ${WRKSRC} -type f -name "macos\.cpp" -delete
	${FIND} ${WRKSRC} -type f -name "[wm]*_program_runner*" -delete
	${RM} ${WRKSRC}/src/mkvtoolnix-gui/util/windows_font.cpp
	if [ "${OPSYS}" != "Linux" ]; then \
	   ${RM} ${WRKSRC}/src/mkvtoolnix-gui/jobs/program_runner/linux_program_runner.*; \
	fi

[FILE:112:descriptions/desc.primary]
MKVToolNix is a set of tools to create, alter and inspect Matroska files
under Linux, other Unices and Windows.


[FILE:103:distinfo]
f31a129723571b46a974bc5d57d73733c1245ee429afd6ddaf274038e94e2280     10996112 mkvtoolnix-73.0.0.tar.xz


[FILE:2760:manifests/plist.primary]
bin/
 mkvextract
 mkvinfo
 mkvmerge
 mkvpropedit
 mkvtoolnix-gui
share/applications/org.bunkus.mkvtoolnix-gui.desktop
share/icons/hicolor/128x128/apps/
 mkvextract.png
 mkvinfo.png
 mkvmerge.png
 mkvpropedit.png
 mkvtoolnix-gui.png
share/icons/hicolor/16x16/apps/
 mkvextract.png
 mkvinfo.png
 mkvmerge.png
 mkvpropedit.png
 mkvtoolnix-gui.png
share/icons/hicolor/24x24/apps/
 mkvextract.png
 mkvinfo.png
 mkvmerge.png
 mkvpropedit.png
 mkvtoolnix-gui.png
share/icons/hicolor/256x256/apps/
 mkvextract.png
 mkvinfo.png
 mkvmerge.png
 mkvpropedit.png
 mkvtoolnix-gui.png
share/icons/hicolor/32x32/apps/
 mkvextract.png
 mkvinfo.png
 mkvmerge.png
 mkvpropedit.png
 mkvtoolnix-gui.png
share/icons/hicolor/48x48/apps/
 mkvextract.png
 mkvinfo.png
 mkvmerge.png
 mkvpropedit.png
 mkvtoolnix-gui.png
share/icons/hicolor/64x64/apps/
 mkvextract.png
 mkvinfo.png
 mkvmerge.png
 mkvpropedit.png
 mkvtoolnix-gui.png
share/icons/hicolor/96x96/apps/
 mkvextract.png
 mkvinfo.png
 mkvmerge.png
 mkvpropedit.png
 mkvtoolnix-gui.png
share/man/bg/man1/
 mkvextract.1.gz
 mkvinfo.1.gz
 mkvmerge.1.gz
 mkvpropedit.1.gz
 mkvtoolnix-gui.1.gz
share/man/ca/man1/
 mkvextract.1.gz
 mkvinfo.1.gz
 mkvmerge.1.gz
 mkvpropedit.1.gz
 mkvtoolnix-gui.1.gz
share/man/de/man1/
 mkvextract.1.gz
 mkvinfo.1.gz
 mkvmerge.1.gz
 mkvpropedit.1.gz
 mkvtoolnix-gui.1.gz
share/man/es/man1/
 mkvextract.1.gz
 mkvinfo.1.gz
 mkvmerge.1.gz
 mkvpropedit.1.gz
 mkvtoolnix-gui.1.gz
share/man/fr/man1/
 mkvextract.1.gz
 mkvinfo.1.gz
 mkvmerge.1.gz
 mkvpropedit.1.gz
 mkvtoolnix-gui.1.gz
share/man/it/man1/
 mkvextract.1.gz
 mkvinfo.1.gz
 mkvmerge.1.gz
 mkvpropedit.1.gz
 mkvtoolnix-gui.1.gz
share/man/ja/man1/
 mkvextract.1.gz
 mkvinfo.1.gz
 mkvmerge.1.gz
 mkvpropedit.1.gz
 mkvtoolnix-gui.1.gz
share/man/ko/man1/
 mkvextract.1.gz
 mkvinfo.1.gz
 mkvmerge.1.gz
 mkvpropedit.1.gz
 mkvtoolnix-gui.1.gz
share/man/man1/
 mkvextract.1.gz
 mkvinfo.1.gz
 mkvmerge.1.gz
 mkvpropedit.1.gz
 mkvtoolnix-gui.1.gz
share/man/nl/man1/
 mkvextract.1.gz
 mkvinfo.1.gz
 mkvmerge.1.gz
 mkvpropedit.1.gz
 mkvtoolnix-gui.1.gz
share/man/pl/man1/
 mkvextract.1.gz
 mkvinfo.1.gz
 mkvmerge.1.gz
 mkvpropedit.1.gz
 mkvtoolnix-gui.1.gz
share/man/ru/man1/
 mkvextract.1.gz
 mkvinfo.1.gz
 mkvmerge.1.gz
 mkvpropedit.1.gz
 mkvtoolnix-gui.1.gz
share/man/uk/man1/
 mkvextract.1.gz
 mkvinfo.1.gz
 mkvmerge.1.gz
 mkvpropedit.1.gz
 mkvtoolnix-gui.1.gz
share/man/zh_CN/man1/
 mkvextract.1.gz
 mkvinfo.1.gz
 mkvmerge.1.gz
 mkvpropedit.1.gz
 mkvtoolnix-gui.1.gz
share/man/zh_TW/man1/
 mkvextract.1.gz
 mkvinfo.1.gz
 mkvmerge.1.gz
 mkvpropedit.1.gz
 mkvtoolnix-gui.1.gz
share/metainfo/org.bunkus.mkvtoolnix-gui.appdata.xml
share/mime/packages/org.bunkus.mkvtoolnix-gui.xml
share/mkvtoolnix/sounds/
 finished-1.webm
 finished-2.webm
 finished-3.webm


[FILE:1074:manifests/plist.nls]
share/locale/bg/LC_MESSAGES/mkvtoolnix.mo
share/locale/ca/LC_MESSAGES/mkvtoolnix.mo
share/locale/cs/LC_MESSAGES/mkvtoolnix.mo
share/locale/de/LC_MESSAGES/mkvtoolnix.mo
share/locale/es/LC_MESSAGES/mkvtoolnix.mo
share/locale/eu/LC_MESSAGES/mkvtoolnix.mo
share/locale/fr/LC_MESSAGES/mkvtoolnix.mo
share/locale/it/LC_MESSAGES/mkvtoolnix.mo
share/locale/ja/LC_MESSAGES/mkvtoolnix.mo
share/locale/ko/LC_MESSAGES/mkvtoolnix.mo
share/locale/lt/LC_MESSAGES/mkvtoolnix.mo
share/locale/nl/LC_MESSAGES/mkvtoolnix.mo
share/locale/pl/LC_MESSAGES/mkvtoolnix.mo
share/locale/pt/LC_MESSAGES/mkvtoolnix.mo
share/locale/pt_BR/LC_MESSAGES/mkvtoolnix.mo
share/locale/ro/LC_MESSAGES/mkvtoolnix.mo
share/locale/ru/LC_MESSAGES/mkvtoolnix.mo
share/locale/sr_RS/LC_MESSAGES/mkvtoolnix.mo
share/locale/sr_RS@latin/LC_MESSAGES/mkvtoolnix.mo
share/locale/sv/LC_MESSAGES/mkvtoolnix.mo
share/locale/tr/LC_MESSAGES/mkvtoolnix.mo
share/locale/uk/LC_MESSAGES/mkvtoolnix.mo
share/locale/zh_CN/LC_MESSAGES/mkvtoolnix.mo
share/locale/zh_SG/LC_MESSAGES/mkvtoolnix.mo
share/locale/zh_TW/LC_MESSAGES/mkvtoolnix.mo


[FILE:389:patches/patch-Rakefile]
--- Rakefile.orig	2022-11-13 11:57:34 UTC
+++ Rakefile
@@ -244,8 +244,6 @@ def determine_optimization_cflags
 end
 
 def determine_stack_protector_flags
-  return " -fstack-protector"        if is_gcc? && !check_compiler_version("gcc", "4.9.0")
-  return " -fstack-protector-strong" if check_compiler_version("gcc", "4.9.0") || check_compiler_version("clang", "3.5.0")
   return ""
 end
 


[FILE:575:patches/patch-configure]
--- configure.orig	2022-11-13 11:57:42 UTC
+++ configure
@@ -8974,14 +8974,10 @@ fi
 { printf "%s\n" "$as_me:${as_lineno-$LINENO}: result: $ac_cv_fmt" >&5
 printf "%s\n" "$ac_cv_fmt" >&6; }
 
-if test x"$ac_cv_fmt" = xyes; then
-  FMT_INTERNAL=no
-else
-  { printf "%s\n" "$as_me:${as_lineno-$LINENO}: Using the internal version of fmt" >&5
+{ printf "%s\n" "$as_me:${as_lineno-$LINENO}: Using the internal version of fmt" >&5
 printf "%s\n" "$as_me: Using the internal version of fmt" >&6;}
   FMT_INTERNAL=yes
   ac_cv_fmt_v8=yes
-fi
 
 if test $ac_cv_fmt_v8 = yes; then
 


[FILE:359:patches/patch-lib_fmt_include_fmt_os.h]
--- lib/fmt/include/fmt/os.h.orig	2022-11-13 11:57:41 UTC
+++ lib/fmt/include/fmt/os.h
@@ -13,7 +13,7 @@
 #include <cstdio>
 #include <system_error>  // std::system_error
 
-#if defined __APPLE__ || defined(__FreeBSD__)
+#if defined __APPLE__ || defined(__FreeBSD__) || defined(__DragonFly__)
 #  include <xlocale.h>  // for LC_NUMERIC_MASK on OS X
 #endif
 


[FILE:335:patches/patch-lib_fmt_src_fmt.cc]
--- lib/fmt/src/fmt.cc.orig	2022-11-13 11:57:41 UTC
+++ lib/fmt/src/fmt.cc
@@ -46,7 +46,7 @@ module;
 #if _MSC_VER
 #  include <intrin.h>
 #endif
-#if defined __APPLE__ || defined(__FreeBSD__)
+#if defined __APPLE__ || defined(__FreeBSD__) || defined(__DragonFly__)
 #  include <xlocale.h>
 #endif
 #if __has_include(<winapifamily.h>)


[FILE:690:patches/patch-src_common_locale.cpp]
$NetBSD: patch-src_common_locale.cpp,v 1.2 2020/05/31 11:34:15 adam Exp $

Remove broken SunOS section that is no longer needed.
https://gitlab.com/mbunkus/mkvtoolnix/issues/2450

--- src/common/locale.cpp.orig	2022-11-13 11:57:34 UTC
+++ src/common/locale.cpp
@@ -286,12 +286,6 @@ get_local_charset() {
   setlocale(LC_CTYPE, "");
 #if defined(COMP_MINGW) || defined(COMP_MSC)
   lc_charset = fmt::format("CP{0}", GetACP());
-#elif defined(SYS_SOLARIS)
-  int i;
-
-  lc_charset = nl_langinfo(CODESET);
-  if (mtx::string::parse_number(lc_charset, i))
-    lc_charset = "ISO"s + lc_charset + "-US"s;
 #elif HAVE_NL_LANGINFO
   lc_charset = nl_langinfo(CODESET);
 #elif HAVE_LOCALE_CHARSET


[FILE:362:patches/patch-src_common_os.h]
--- src/common/os.h.orig	2022-11-13 11:57:34 UTC
+++ src/common/os.h
@@ -21,7 +21,7 @@
 #else
 # define COMP_GCC
 # define SYS_UNIX
-# if defined(__bsdi__) || defined(__FreeBSD__)
+# if defined(__bsdi__) || defined(__FreeBSD__) || defined(__DragonFly__) || defined(__NetBSD__)
 #  define SYS_BSD
 # elif defined(__sun) && defined(__SUNPRO_CC)
 #  undef COMP_GCC


[FILE:761:patches/patch-src_mkvtoolnix-gui_util_sleep__inhibitor.cpp]
--- src/mkvtoolnix-gui/util/sleep_inhibitor.cpp.orig	2022-11-13 11:57:34 UTC
+++ src/mkvtoolnix-gui/util/sleep_inhibitor.cpp
@@ -6,7 +6,7 @@
 # include "mkvtoolnix-gui/util/sleep_inhibitor/windows.h"
 #elif defined(SYS_APPLE)
 # include "mkvtoolnix-gui/util/sleep_inhibitor/macos.h"
-#elif defined(HAVE_QTDBUS)
+#elif defined(SYS_LINUX)
 # include "mkvtoolnix-gui/util/sleep_inhibitor/linux_logind.h"
 #endif
 
@@ -66,7 +66,7 @@ BasicSleepInhibitor::create() {
   inhibitor->addInhibitor(std::make_shared<WindowsSleepInhibitor>());
 #elif defined(SYS_APPLE)
   inhibitor->addInhibitor(std::make_shared<MacOSSleepInhibitor>());
-#elif defined(HAVE_QTDBUS)
+#elif defined(SYS_LINUX)
   inhibitor->addInhibitor(std::make_shared<LogindSleepInhibitor>());
 #endif
 


[FILE:18:files/special.mk]
MAKE_CMD=	rake -v

