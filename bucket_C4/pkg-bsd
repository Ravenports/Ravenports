# Buildsheet autogenerated by ravenadm tool -- Do not edit.

NAMEBASE=		pkg-bsd
VERSION=		1.10.99.6
KEYWORDS=		raven
VARIANTS=		standard
SDESC[standard]=	BSD binary package manager
HOMEPAGE=		https://github.com/freebsd/pkg/blob/master/README.md
CONTACT=		nobody

DOWNLOAD_GROUPS=	main
SITES[main]=		GITHUB/jrmarino:pkg:e4f05af
DISTFILE[1]=		generated:main
DF_INDEX=		1
SPKGS[standard]=	complete
			shared
			static

OPTIONS_AVAILABLE=	none
OPTIONS_STANDARD=	none

BUILD_DEPENDS=		libarchive-devel:static:standard
			zlib:static:standard
			bzip2:static:standard
			autoconf:single:standard
			automake:single:standard
BUILDRUN_DEPENDS=	libarchive-devel:shared:standard
BR_DEPS[linux]=		libbsd:single:standard

USES=			libtool:build

LICENSE=		BSD2CLAUSE:shared
LICENSE_SCHEME=		solo
LICENSE_FILE=		BSD2CLAUSE:{{WRKSRC}}/COPYING

FPC_EQUIVALENT=		ports-mgmt/pkg

MUST_CONFIGURE=		gnu
CONFIGURE_ARGS=		--disable-maintainer-mode
			--mandir={{MANPREFIX}}/man
CONFIGURE_ENV=		LIBS="-lpthread -lzstd"

SINGLE_JOB=		yes

INSTALL_TARGET=		install-strip

CFLAGS=			-Wno-error

post-patch:
	${REINPLACE_CMD} -e 's/larchive/larchive-devel/' \
		${WRKSRC}/libpkg/Makefile.am \
		${WRKSRC}/tests/Makefile.am \
		${WRKSRC}/src/Makefile.am
	${REINPLACE_CMD} -e 's/\[archive\]/[archive-devel]/' \
		${WRKSRC}/configure.ac

post-patch-linux:
	${REINPLACE_CMD} -e '/libpkg_la_LDFLAGS=/ s/-ver/-ldl -ver/' \
		${WRKSRC}/libpkg/Makefile.am

post-install:
	${RM} ${STAGEDIR}${PREFIX}/sbin/pkg2ng
	${MV} ${STAGEDIR}${PREFIX}/lib/libpkg_static.a \
		${STAGEDIR}${PREFIX}/lib/libpkg.a
	${INSTALL_SCRIPT} ${WRKSRC}/scripts/periodic/411.pkg-backup \
		${WRKSRC}/scripts/periodic/490.status-pkg-changes \
		${STAGEDIR}${PREFIX}/etc/periodic/daily/
	${INSTALL_SCRIPT} ${WRKSRC}/scripts/periodic/460.pkg-checksum \
		${WRKSRC}/scripts/periodic/410.pkg-audit \
		${STAGEDIR}${PREFIX}/etc/periodic/security/
	${INSTALL_SCRIPT} ${WRKSRC}/scripts/periodic/400.status-pkg \
		${STAGEDIR}${PREFIX}/etc/periodic/weekly/
	${MKDIR} ${STAGEDIR}${PREFIX}/etc/pkg/repos

pre-configure:
	(cd ${WRKSRC} && ./autogen.sh)

[FILE:290:descriptions/desc.shared]
The pkg program is the package management tool used natively on FreeBSD and
DragonFly, and has also been successfully demonstrated on NetBSD, OpenBSD
and Darwin.

It is one of the package managers available for the manipulation of both
locally-built and remotely available binary packages.


[FILE:362:descriptions/desc.static]
The pkg program is the package management tool used natively on FreeBSD and
DragonFly, and has also been successfully demonstrated on NetBSD, OpenBSD
and Darwin.

It is one of the package managers available for the manipulation of both
locally-built and remotely available binary packages.

This package contains just the statically-linked version (pkg-static).


[FILE:106:distinfo]
b8d8b2fc05f2b19ed2910d02ec06eee41beb9c24e0c36290cf8c82162f9cf5be      3397549 jrmarino-pkg-e4f05af.tar.gz


[FILE:1040:manifests/plist.shared]
etc/bash_completion.d/_pkg.bash
etc/periodic/daily/
 411.pkg-backup
 490.status-pkg-changes
etc/periodic/security/
 410.pkg-audit
 460.pkg-checksum
etc/periodic/weekly/400.status-pkg
@sample etc/pkg.conf.sample
include/pkg.h
lib/
 libpkg.a
 libpkg.so
 libpkg.so.4
 libpkg.so.4.0.0
libdata/pkgconfig/pkg.pc
share/man/man3/
 pkg_printf.3.gz
 pkg_repos.3.gz
share/man/man5/
 pkg-repository.5.gz
 pkg.conf.5.gz
share/man/man8/
 pkg-add.8.gz
 pkg-alias.8.gz
 pkg-annotate.8.gz
 pkg-audit.8.gz
 pkg-autoremove.8.gz
 pkg-backup.8.gz
 pkg-check.8.gz
 pkg-clean.8.gz
 pkg-config.8.gz
 pkg-create.8.gz
 pkg-delete.8.gz
 pkg-fetch.8.gz
 pkg-info.8.gz
 pkg-install.8.gz
 pkg-lock.8.gz
 pkg-query.8.gz
 pkg-register.8.gz
 pkg-remove.8.gz
 pkg-repo.8.gz
 pkg-rquery.8.gz
 pkg-search.8.gz
 pkg-set.8.gz
 pkg-shell.8.gz
 pkg-shlib.8.gz
 pkg-ssh.8.gz
 pkg-static.8.gz
 pkg-stats.8.gz
 pkg-unlock.8.gz
 pkg-update.8.gz
 pkg-updating.8.gz
 pkg-upgrade.8.gz
 pkg-version.8.gz
 pkg-which.8.gz
 pkg.8.gz
sbin/pkg
share/zsh/site-functions/_pkg
@dir etc/pkg/repos


[FILE:16:manifests/plist.static]
sbin/pkg-static


[FILE:906:linux/patch-src_Makefile.in]
--- src/Makefile.in.orig	2017-05-16 18:01:51 UTC
+++ src/Makefile.in
@@ -710,9 +710,18 @@ pkg$(EXEEXT): $(pkg_OBJECTS) $(pkg_DEPEN
 	@rm -f pkg$(EXEEXT)
 	$(AM_V_CCLD)$(pkg_LINK) $(pkg_OBJECTS) $(pkg_LDADD) $(LIBS)
 
-pkg-static$(EXEEXT): $(pkg_static_OBJECTS) $(pkg_static_DEPENDENCIES) $(EXTRA_pkg_static_DEPENDENCIES) 
+pkg-static: $(pkg_OBJECTS) $(pkg_DEPENDENCIES) $(EXTRA_pkg_DEPENDENCIES) 
 	@rm -f pkg-static$(EXEEXT)
-	$(AM_V_CCLD)$(pkg_static_LINK) $(pkg_static_OBJECTS) $(pkg_static_LDADD) $(LIBS)
+	$(CCLD) $(pkg_CFLAGS) $(CFLAGS) $(AM_LDFLAGS) $(LDFLAGS) -o ${.TARGET} \
+	$(pkg_OBJECTS) -pthread \
+	../libpkg/.libs/libpkg_static.a \
+	../external/.libs/libelf_static.a \
+	../compat/.libs/libbsd_compat.a \
+	-Wl,-Bstatic \
+	-lutil -lssl -lcrypto -lbsd -lresolv -larchive -lz -lbz2 -llzma \
+	-Wl,-Bdynamic \
+	-lm \
+	-Wl,-rpath -Wl,/raven/lib
 
 mostlyclean-compile:
 	-rm -f *.$(OBJEXT)

