# Buildsheet autogenerated by ravenadm tool -- Do not edit.

NAMEBASE=		pkg-bsd
VERSION=		1.10.99.10
REVISION=		5
KEYWORDS=		raven
VARIANTS=		standard
SDESC[standard]=	BSD binary package manager
HOMEPAGE=		https://github.com/freebsd/pkg/blob/master/README.md
CONTACT=		nobody

DOWNLOAD_GROUPS=	main sqlite
SITES[main]=		GITHUB/jrmarino:pkg:1a364d2
SITES[sqlite]=		https://www.sqlite.org/2018/
			http://www2.sqlite.org/2018/
DISTFILE[1]=		generated:main
DISTFILE[2]=		sqlite-autoconf-3230100.tar.gz:sqlite
DF_INDEX=		1 2
SPKGS[standard]=	shared
			static

OPTIONS_AVAILABLE=	none
OPTIONS_STANDARD=	none

BUILD_DEPENDS=		zlib:static:standard
			bzip2:static:standard
			Zstandard:static:standard
			autoconf:single:standard
			automake:single:standard
BUILDRUN_DEPENDS=	libarchive:single:standard
B_DEPS[sunos]=		libbsd4sol:single:standard musl-fts:single:standard
BR_DEPS[linux]=		libbsd:single:standard

USES=			pkgconfig

LICENSE=		BSD2CLAUSE:shared
LICENSE_FILE=		BSD2CLAUSE:{{WRKSRC}}/COPYING
LICENSE_SCHEME=		solo

FPC_EQUIVALENT=		ports-mgmt/pkg

MUST_CONFIGURE=		yes
CONFIGURE_ARGS=		--mandir={{MANPREFIX}}/man
			--pkgconfigdir={{PREFIX}}/lib/pkgconfig
			--prefix={{PREFIX}}

SUB_FILES=		pkg.c

CFLAGS=			-Wno-error
VAR_OPSYS[sunos]=	CFLAGS=-I{{LOCALBASE}}/include/bsd

post-install:
	${RM} ${STAGEDIR}${PREFIX}/sbin/pkg2ng
	${STRIP_CMD} ${STAGEDIR}${PREFIX}/sbin/pkg*
	${STRIP_CMD} ${STAGEDIR}${PREFIX}/lib/libpkg.${LIBEXT}
	${MV} ${STAGEDIR}${PREFIX}/sbin/pkg \
		${STAGEDIR}${PREFIX}/sbin/pkg-dynamic
	${MV} ${WRKDIR}/pkg-selector ${STAGEDIR}${PREFIX}/sbin/pkg
	${INSTALL_SCRIPT} ${WRKSRC}/scripts/periodic/411.pkg-backup \
		${WRKSRC}/scripts/periodic/490.status-pkg-changes \
		${STAGEDIR}${PREFIX}/etc/periodic/daily/
	${INSTALL_SCRIPT} ${WRKSRC}/scripts/periodic/460.pkg-checksum \
		${WRKSRC}/scripts/periodic/410.pkg-audit \
		${STAGEDIR}${PREFIX}/etc/periodic/security/
	${INSTALL_SCRIPT} ${WRKSRC}/scripts/periodic/400.status-pkg \
		${STAGEDIR}${PREFIX}/etc/periodic/weekly/
	${MKDIR} ${STAGEDIR}${PREFIX}/etc/pkg/repos

post-build:
	(cd ${WRKDIR} && ${CC} pkg.c -o pkg-selector)
	${STRIP_CMD} ${WRKDIR}/pkg-selector

post-extract:
	# Use a newer sqlite than the provided 3.15.2 version
	(cd ${WRKDIR}/sqlite-autoconf-3230100/ && \
		cp sqlite3.[ch] shell.c ${WRKSRC}/external/sqlite/)
	${REINPLACE_CMD} -e 's|SQLITE_CDECL main|SQLITE_CDECL sqlite3_shell|'\
		${WRKSRC}/external/sqlite/shell.c
	${CHMOD} ${BINMODE} ${WRKSRC}/configure \
		${WRKSRC}/autosetup/autosetup-find-tclsh

[FILE:297:descriptions/desc.shared]
The pkg program is the package management tool used natively on FreeBSD and
DragonFly, and has also been successfully demonstrated on NetBSD, OpenBSD,
Darwin, Solaris and its derivatives.

This package manager handles the manipulation of both locally-built and
remotely available binary packages.


[FILE:509:descriptions/desc.static]
The pkg program is the package management tool used natively on FreeBSD and
DragonFly, and has also been successfully demonstrated on NetBSD, OpenBSD,
Darwin, Solaris and its derivatives.

This package manager handles the manipulation of both locally-built and
remotely available binary packages.

This package contains just the statically-linked version (pkg-static)
and a selector program (pkg) that preferentially forks into pkg-dynamic
with the same arguments and falls back to pkg-static when not found.


[FILE:215:distinfo]
eac9d1b2f9bac37f94ca6db5868e87c7e4b6eacd569b068bb31fafc23513ddc8      3556565 jrmarino-pkg-1a364d2.tar.gz
92842b283e5e744eff5da29ed3c69391de7368fccc4d0ee6bf62490ce555ef25      2675362 sqlite-autoconf-3230100.tar.gz


[FILE:1027:manifests/plist.shared]
@sample etc/pkg.conf.sample
etc/bash_completion.d/_pkg.bash
etc/periodic/daily/
 411.pkg-backup
 490.status-pkg-changes
etc/periodic/security/
 410.pkg-audit
 460.pkg-checksum
etc/periodic/weekly/400.status-pkg
include/pkg.h
lib/
 libpkg.a
 libpkg.so
 libpkg.so.4
lib/pkgconfig/pkg.pc
sbin/pkg-dynamic
share/man/man3/
 pkg_printf.3.gz
 pkg_repos.3.gz
share/man/man5/
 pkg-repository.5.gz
 pkg.conf.5.gz
share/man/man8/
 pkg-add.8.gz
 pkg-alias.8.gz
 pkg-annotate.8.gz
 pkg-audit.8.gz
 pkg-autoremove.8.gz
 pkg-backup.8.gz
 pkg-check.8.gz
 pkg-clean.8.gz
 pkg-config.8.gz
 pkg-create.8.gz
 pkg-delete.8.gz
 pkg-fetch.8.gz
 pkg-info.8.gz
 pkg-install.8.gz
 pkg-lock.8.gz
 pkg-query.8.gz
 pkg-register.8.gz
 pkg-remove.8.gz
 pkg-repo.8.gz
 pkg-rquery.8.gz
 pkg-search.8.gz
 pkg-set.8.gz
 pkg-shell.8.gz
 pkg-shlib.8.gz
 pkg-ssh.8.gz
 pkg-static.8.gz
 pkg-stats.8.gz
 pkg-unlock.8.gz
 pkg-update.8.gz
 pkg-updating.8.gz
 pkg-upgrade.8.gz
 pkg-version.8.gz
 pkg-which.8.gz
 pkg.8.gz
share/zsh/site-functions/_pkg
@dir etc/pkg/repos


[FILE:23:manifests/plist.static]
sbin/
 pkg
 pkg-static


[FILE:945:files/pkg.c.in]
/*
 * This program will check if %%PREFIX%%/bin/pkg-dynamic exists.
 * If it does, that program will be executed with the same arguments
 * provided to this one.  The fallback action is to execute
 * %%PREFIX/bin/pkg-static with the same arguments instead.  That
 * program is installed together with this one, so it's assumed to exist.
 */

#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <unistd.h>


int
main(int argc, char **argv)
{
	int x;
	char *cmd;
	char *PKG_STATIC  = "%%PREFIX%%/sbin/pkg-static";
	char *PKG_DYNAMIC = "%%PREFIX%%/sbin/pkg-dynamic";

	if (access(PKG_DYNAMIC, F_OK) != -1) {
		cmd = PKG_DYNAMIC;
	} else {
		cmd = PKG_STATIC;
	}

	argv[0] = cmd;
	execv(cmd, argv);

	/*
	 * Execution failed, so write out an error message
	 */
	printf ("Command execution failed: %s\n", cmd);
	printf ("               arguments:");
	for (x = 1; x < argc; x++)
		printf (" %s", argv[x]);
	printf ("\n");
	exit (1);
}


[FILE:1081:sunos/patch-src_Makefile.autosetup]
--- src/Makefile.autosetup.orig	Tue Oct 16 11:56:39 2018
+++ src/Makefile.autosetup	Tue Oct 16 11:59:43 2018
@@ -51,7 +51,7 @@
 @else
 LIBS+=	-larchive -lbz2 -lz -llzma -lzstd
 @endif
-OTHER_LIBS=	-lm -lssl -lcrypto -pthread
+OTHER_LIBS=	-lssl -lcrypto
 @if HAVE_LIBUTIL
 OTHER_LIBS+=	-lutil
 @endif
@@ -61,6 +61,8 @@
 @if HAVE_LIBRESOLV
 OTHER_LIBS+=	-lresolv
 @endif
+OTHER_LIBS+=	-lbsd -lfts
+DYNALIBS=	-lm -pthread -lsocket -lrt -lresolv -lgen
 
 @if libabidir == libmachista
 LOCAL_LDFLAGS=	$(LIBPKGFLAT) $(LIBS) $(OTHER_LIBS) -lresolv
@@ -74,13 +76,9 @@
 		$(PREFIX)/lib/libcrypto.a \
 		-lm -pthread -lresolv
 @else
-LOCAL_LDFLAGS=	-Wl,-Bstatic \
-		-Wl,--whole-archive $(LIBPKGFLAT) -Wl,--no-whole-archive \
-		$(LIBS) \
-		-Wl,-Bdynamic $(OTHER_LIBS) \
-		-Wl,--export-dynamic \
-		-Wl,--version-script,$(top_builddir)/libpkg/libpkg.ver
-STATIC_LDFLAGS=	-static $(LIBPKGFLAT) $(LIBS) $(OTHER_LIBS)
+LOCAL_LDFLAGS=	$(LIBPKGFLAT) $(LIBS) $(OTHER_LIBS) $(DYNALIBS)
+STATIC_LDFLAGS=	-Wl,-Bstatic $(LIBPKGFLAT) $(LIBS) $(OTHER_LIBS) \
+		-Wl,-Bdynamic $(DYNALIBS) 
 @endif
 
 

