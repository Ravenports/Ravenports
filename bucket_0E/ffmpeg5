# Buildsheet autogenerated by ravenadm tool -- Do not edit.

NAMEBASE=		ffmpeg5
VERSION=		5.1.6
REVISION=		1
KEYWORDS=		multimedia audio net
VARIANTS=		std
SDESC[std]=		Play, record, convert, and stream audio and video
HOMEPAGE=		https://www.ffmpeg.org/
CONTACT=		nobody

DOWNLOAD_GROUPS=	main
SITES[main]=		http://ffmpeg.org/releases/
DISTFILE[1]=		ffmpeg-5.1.6.tar.xz:main
DF_INDEX=		1
SPKGS[std]=		set
			primary
			tools
			dev
			examples
			man
			docs

OPTIONS_AVAILABLE=	none
OPTIONS_STANDARD=	none

BUILD_DEPENDS=		libdrm:dev:std
			libgcrypt:dev:std
			libvpx:dev:std
			gettext:solinks:std
			gmp:dev:std
			gnutls:dev:std
			nasm:primary:std
			x264:dev:std
			x265:dev:std
			libass:dev:std
			libva:dev:std
			libvorbis:dev:std
			WebP:dev:std
			frei0r:dev:std
			rtmpdump:dev:std
			xvid:dev:std
			libtheora:dev:std
			libvdpau:dev:std
BUILDRUN_DEPENDS=	gmp:primary:std
			libass:primary:std
			frei0r:primary:std
			libgcrypt:primary:std
			gnutls:primary:std
			rtmpdump:primary:std
			libtheora:primary:std
			libva:primary:std
			libvdpau:primary:std
			libvorbis:primary:std
			libvpx:primary:std
			libdrm:primary:std
			WebP:primary:std
			x264:primary:std
			x265:primary:std
			xvid:primary:std
EXRUN[tools]=		primary
EXRUN[dev]=		libdrm:dev:std
			libgcrypt:dev:std
			libvpx:dev:std
			libass:dev:std
			libva:dev:std
			libvorbis:dev:std
			libtheora:dev:std
			libvdpau:dev:std
			x264:dev:std
			x265:dev:std
			xvid:dev:std
			WebP:dev:std
			librsvg:dev:std
			libxml2:dev:std
			glib:dev:std
			zlib:dev:std
			sdl2:dev:std
			gnutls:dev:std
			rtmpdump:dev:std
			gdk-pixbuf:dev:std
			pango:dev:std

USES=			cpe gmake iconv zlib perl:build pkgconfig
			gettext:build shebangfix
GNOME_COMPONENTS=	libxml2 librsvg
SDL_COMPONENTS=		sdl2

DISTNAME=		ffmpeg-5.1.6

LICENSE=		LGPL3+:primary GPLv3+:primary
LICENSE_TERMS=		primary:{{WRKSRC}}/LICENSE.md
LICENSE_FILE=		LGPL3+:{{WRKSRC}}/COPYING.LGPLv3
			GPLv3+:{{WRKSRC}}/COPYING.GPLv3
LICENSE_SCHEME=		multi

CPE_PRODUCT=		ffmpeg
CPE_VENDOR=		ffmpeg
SHEBANG_ADD_SH=		ffbuild/libversion.sh
SHEBANG_FILES=		doc/texi2pod.pl

MUST_CONFIGURE=		yes
CONFIGURE_ARGS=		--cc="{{CC}}"
			--prefix="{{PREFIX}}"
			--mandir="{{MANPREFIX}}/man"
			--datadir="{{PREFIX}}/share/ffmpeg"
			--pkgconfigdir="{{PREFIX}}/lib/pkgconfig"
			--enable-shared
			--enable-pic
			--enable-gpl
			--enable-version3
			--enable-postproc
			--enable-avfilter
			--enable-pthreads
			--disable-alsa
			--disable-libopencore-amrnb
			--disable-libopencore-amrwb
			--disable-libbs2b
			--disable-libcaca
			--disable-libcdio
			--disable-libcelt
			--disable-chromaprint
			--disable-libdc1394
			--disable-debug
			--disable-htmlpages
			--disable-libfdk-aac
			--disable-libflite
			--disable-libgme
			--disable-libgsm
			--disable-libilbc
			--disable-libkvazaar
			--disable-ladspa
			--disable-libmp3lame
			--disable-libbluray
			--disable-libmodplug
			--disable-openal
			--disable-opencl
			--disable-opengl
			--disable-libopenh264
			--disable-libopenjpeg
			--disable-openssl
			--disable-libopus
			--disable-libpulse
			--disable-librubberband
			--disable-libsmbclient
			--disable-libsnappy
			--disable-sndio
			--disable-libsoxr
			--disable-libspeex
			--disable-libssh
			--disable-libtesseract
			--disable-libtwolame
			--disable-libvo-amrwbenc
			--disable-libvidstab
			--disable-libxcb
			--disable-outdev=xv
			--disable-libzimg
			--disable-libzmq
			--disable-libzvbi
			--disable-libmysofa
			--disable-libv4l2
			--disable-indev=v4l2
			--disable-outdev=v4l2
			--enable-libass
			--enable-fontconfig
			--enable-libfreetype
			--enable-frei0r
			--enable-libfribidi
			--enable-gcrypt
			--enable-gnutls
			--enable-gmp
			--enable-iconv
			--enable-optimizations
			--enable-runtime-cpudetect
			--enable-librtmp
			--enable-sdl2
			--enable-libtheora
			--enable-vaapi
			--enable-vdpau
			--enable-libvorbis
			--enable-libvpx
			--enable-libwebp
			--enable-libx264
			--enable-libx265
			--enable-libxvid
			--enable-libdrm
			--enable-librsvg
			--enable-libxml2

INSTALL_TARGET=		install-progs install-doc install-data install-libs
			install-headers install-examples
PLIST_SUB=		AVCODEC_SO=59.37.100
			AVCODEC_MAJOR=59
			AVDEVICE_SO=59.7.100
			AVDEVICE_MAJOR=59
			AVFILTER_SO=8.44.100
			AVFILTER_MAJOR=8
			AVFORMAT_SO=59.27.100
			AVFORMAT_MAJOR=59
			AVUTIL_SO=57.28.100
			AVUTIL_MAJOR=57
			POSTPROC_SO=56.6.100
			POSTPROC_MAJOR=56
			SWRESAMPLE_SO=40.7.100
			SWRESAMPLE_MAJOR=40
			SCALE_SO=6.7.100
			SCALE_MAJOR=6

post-install:
	@${MKDIR} ${STAGEDIR}${STD_DOCDIR}
.for DF in CREDITS LICENSE.md MAINTAINERS README.md RELEASE_NOTES
	${INSTALL_DATA} ${WRKSRC}/${DF} ${STAGEDIR}${STD_DOCDIR}
.endfor
	${INSTALL_DATA} ${WRKSRC}/doc/APIchanges ${STAGEDIR}${STD_DOCDIR}
	${INSTALL_DATA} ${WRKSRC}/doc/*.txt ${STAGEDIR}${STD_DOCDIR}

post-patch-sunos:
	${REINPLACE_CMD} -e '/^enabled libxvid/ s/$$/ -lrt/' \
		-e '/append SHFLAGS.*version_script/d' \
		${WRKSRC}/configure

[FILE:843:descriptions/desc.primary]
FFmpeg is the leading multimedia framework, able to decode, encode,
transcode, mux, demux, stream, filter and play pretty much anything that
humans and machines have created. It supports the most obscure ancient
formats up to the cutting edge. No matter if they were designed by some
standards committee, the community or a corporation. It is also highly
portable: FFmpeg compiles, runs, and passes our testing infrastructure
FATE across Linux, Mac OS X, Microsoft Windows, the BSDs, Solaris, etc.
under a wide variety of build environments, machine architectures, and
configurations.

It contains libavcodec, libavutil, libavformat, libavfilter, libavdevice,
libswscale and libswresample which can be used by applications. As well
as ffmpeg, ffserver, ffplay and ffprobe which can be used by end users
for transcoding, streaming and playing.


[FILE:42:descriptions/desc.tools]
This packages contains the ffmpeg5 tools.


[FILE:98:distinfo]
f4fa066278f7a47feab316fef905f4db0d5e9b589451949740f83972b30901bd     10021428 ffmpeg-5.1.6.tar.xz


[FILE:529:manifests/plist.primary]
lib/
 libavcodec.so.%%AVCODEC_MAJOR%%
 libavcodec.so.%%AVCODEC_SO%%
 libavdevice.so.%%AVDEVICE_MAJOR%%
 libavdevice.so.%%AVDEVICE_SO%%
 libavfilter.so.%%AVFILTER_MAJOR%%
 libavfilter.so.%%AVFILTER_SO%%
 libavformat.so.%%AVFORMAT_MAJOR%%
 libavformat.so.%%AVFORMAT_SO%%
 libavutil.so.%%AVUTIL_MAJOR%%
 libavutil.so.%%AVUTIL_SO%%
 libpostproc.so.%%POSTPROC_MAJOR%%
 libpostproc.so.%%POSTPROC_SO%%
 libswresample.so.%%SWRESAMPLE_MAJOR%%
 libswresample.so.%%SWRESAMPLE_SO%%
 libswscale.so.%%SCALE_MAJOR%%
 libswscale.so.%%SCALE_SO%%


[FILE:30:manifests/plist.tools]
bin/
 ffmpeg
 ffplay
 ffprobe


[FILE:2415:manifests/plist.dev]
include/libavcodec/
 ac3_parser.h
 adts_parser.h
 avcodec.h
 avdct.h
 avfft.h
 bsf.h
 codec.h
 codec_desc.h
 codec_id.h
 codec_par.h
 d3d11va.h
 defs.h
 dirac.h
 dv_profile.h
 dxva2.h
 jni.h
 mediacodec.h
 packet.h
 qsv.h
 vdpau.h
 version.h
 version_major.h
 videotoolbox.h
 vorbis_parser.h
 xvmc.h
include/libavdevice/
 avdevice.h
 version.h
 version_major.h
include/libavfilter/
 avfilter.h
 buffersink.h
 buffersrc.h
 version.h
 version_major.h
include/libavformat/
 avformat.h
 avio.h
 version.h
 version_major.h
include/libavutil/
 adler32.h
 aes.h
 aes_ctr.h
 attributes.h
 audio_fifo.h
 avassert.h
 avconfig.h
 avstring.h
 avutil.h
 base64.h
 blowfish.h
 bprint.h
 bswap.h
 buffer.h
 camellia.h
 cast5.h
 channel_layout.h
 common.h
 cpu.h
 crc.h
 csp.h
 des.h
 detection_bbox.h
 dict.h
 display.h
 dovi_meta.h
 downmix_info.h
 encryption_info.h
 error.h
 eval.h
 ffversion.h
 fifo.h
 file.h
 film_grain_params.h
 frame.h
 hash.h
 hdr_dynamic_metadata.h
 hdr_dynamic_vivid_metadata.h
 hmac.h
 hwcontext.h
 hwcontext_cuda.h
 hwcontext_d3d11va.h
 hwcontext_drm.h
 hwcontext_dxva2.h
 hwcontext_mediacodec.h
 hwcontext_opencl.h
 hwcontext_qsv.h
 hwcontext_vaapi.h
 hwcontext_vdpau.h
 hwcontext_videotoolbox.h
 hwcontext_vulkan.h
 imgutils.h
 intfloat.h
 intreadwrite.h
 lfg.h
 log.h
 lzo.h
 macros.h
 mastering_display_metadata.h
 mathematics.h
 md5.h
 mem.h
 motion_vector.h
 murmur3.h
 opt.h
 parseutils.h
 pixdesc.h
 pixelutils.h
 pixfmt.h
 random_seed.h
 rational.h
 rc4.h
 replaygain.h
 ripemd.h
 samplefmt.h
 sha.h
 sha512.h
 spherical.h
 stereo3d.h
 tea.h
 threadmessage.h
 time.h
 timecode.h
 timestamp.h
 tree.h
 twofish.h
 tx.h
 uuid.h
 version.h
 video_enc_params.h
 xtea.h
include/libpostproc/
 postprocess.h
 version.h
 version_major.h
include/libswresample/
 swresample.h
 version.h
 version_major.h
include/libswscale/
 swscale.h
 version.h
 version_major.h
lib/
 libavcodec.a
 libavcodec.so
 libavdevice.a
 libavdevice.so
 libavfilter.a
 libavfilter.so
 libavformat.a
 libavformat.so
 libavutil.a
 libavutil.so
 libpostproc.a
 libpostproc.so
 libswresample.a
 libswresample.so
 libswscale.a
 libswscale.so
lib/pkgconfig/
 libavcodec.pc
 libavdevice.pc
 libavfilter.pc
 libavformat.pc
 libavutil.pc
 libpostproc.pc
 libswresample.pc
 libswscale.pc
share/ffmpeg/
 ffprobe.xsd
 libvpx-1080p.ffpreset
 libvpx-1080p50_60.ffpreset
 libvpx-360p.ffpreset
 libvpx-720p.ffpreset
 libvpx-720p50_60.ffpreset


[FILE:409:manifests/plist.examples]
share/ffmpeg/examples/
 Makefile
 README
 avio_list_dir.c
 avio_reading.c
 decode_audio.c
 decode_video.c
 demuxing_decoding.c
 encode_audio.c
 encode_video.c
 extract_mvs.c
 filter_audio.c
 filtering_audio.c
 filtering_video.c
 http_multiclient.c
 hw_decode.c
 metadata.c
 muxing.c
 qsvdec.c
 remuxing.c
 resampling_audio.c
 scaling_video.c
 transcode_aac.c
 transcoding.c
 vaapi_encode.c
 vaapi_transcode.c


[FILE:381:manifests/plist.man]
share/man/man1/
 ffmpeg-all.1
 ffmpeg-bitstream-filters.1
 ffmpeg-codecs.1
 ffmpeg-devices.1
 ffmpeg-filters.1
 ffmpeg-formats.1
 ffmpeg-protocols.1
 ffmpeg-resampler.1
 ffmpeg-scaler.1
 ffmpeg-utils.1
 ffmpeg.1
 ffplay-all.1
 ffplay.1
 ffprobe-all.1
 ffprobe.1
share/man/man3/
 libavcodec.3
 libavdevice.3
 libavfilter.3
 libavformat.3
 libavutil.3
 libswresample.3
 libswscale.3


[FILE:251:patches/patch-configure]
--- configure.orig	2024-08-04 23:23:18 UTC
+++ configure
@@ -5513,7 +5513,7 @@ case $target_os in
     dragonfly)
         disable symver
         ;;
-    freebsd)
+    freebsd|midnightbsd)
         enable section_data_rel_ro
         ;;
     bsd/os)


[FILE:287:patches/patch-doc_Makefile]
--- doc/Makefile.orig	2024-08-04 23:23:18 UTC
+++ doc/Makefile
@@ -122,7 +122,7 @@ install-html: $(HTMLPAGES)
 endif
 
 ifdef CONFIG_MANPAGES
-install-progs-$(CONFIG_DOC): install-man
+#install-progs-$(CONFIG_DOC): install-man
 
 install-man: $(MANPAGES)
 	$(Q)mkdir -p "$(MANDIR)/man1"


[FILE:2674:patches/patch-libavcodec_libx265.c]
--- libavcodec/libx265.c.orig	2024-08-04 23:23:18 UTC
+++ libavcodec/libx265.c
@@ -504,7 +504,13 @@ static int libx265_encode_frame(AVCodecC
 {
     libx265Context *ctx = avctx->priv_data;
     x265_picture x265pic;
-    x265_picture x265pic_out = { 0 };
+#if X265_BUILD >= 210
+    x265_picture x265pic_layers_out[MAX_SCALABLE_LAYERS];
+    x265_picture* x265pic_lyrptr_out[MAX_SCALABLE_LAYERS];
+#else
+    x265_picture x265pic_solo_out = { 0 };
+#endif
+    x265_picture* x265pic_out;
     x265_nal *nal;
     uint8_t *dst;
     int pict_type;
@@ -575,8 +581,16 @@ static int libx265_encode_frame(AVCodecC
         }
     }
 
+#if X265_BUILD >= 210
+    for (i = 0; i < MAX_SCALABLE_LAYERS; i++)
+        x265pic_lyrptr_out[i] = &x265pic_layers_out[i];
+
+    ret = ctx->api->encoder_encode(ctx->encoder, &nal, &nnal,
+                                   pic ? &x265pic : NULL, x265pic_lyrptr_out);
+#else
     ret = ctx->api->encoder_encode(ctx->encoder, &nal, &nnal,
-                                   pic ? &x265pic : NULL, &x265pic_out);
+                                   pic ? &x265pic : NULL, &x265pic_solo_out);
+#endif
 
     av_freep(&x265pic.quantOffsets);
 
@@ -604,10 +618,16 @@ static int libx265_encode_frame(AVCodecC
             pkt->flags |= AV_PKT_FLAG_KEY;
     }
 
-    pkt->pts = x265pic_out.pts;
-    pkt->dts = x265pic_out.dts;
+#if X265_BUILD >= 210
+    x265pic_out = x265pic_lyrptr_out[0];
+#else
+    x265pic_out = &x265pic_solo_out;
+#endif
+
+    pkt->pts = x265pic_out->pts;
+    pkt->dts = x265pic_out->dts;
 
-    switch (x265pic_out.sliceType) {
+    switch (x265pic_out->sliceType) {
     case X265_TYPE_IDR:
     case X265_TYPE_I:
         pict_type = AV_PICTURE_TYPE_I;
@@ -625,17 +645,17 @@ static int libx265_encode_frame(AVCodecC
     }
 
 #if X265_BUILD >= 130
-    if (x265pic_out.sliceType == X265_TYPE_B)
+    if (x265pic_out->sliceType == X265_TYPE_B)
 #else
-    if (x265pic_out.frameData.sliceType == 'b')
+    if (x265pic_out->frameData.sliceType == 'b')
 #endif
         pkt->flags |= AV_PKT_FLAG_DISPOSABLE;
 
-    ff_side_data_set_encoder_stats(pkt, x265pic_out.frameData.qp * FF_QP2LAMBDA, NULL, 0, pict_type);
+    ff_side_data_set_encoder_stats(pkt, x265pic_out->frameData.qp * FF_QP2LAMBDA, NULL, 0, pict_type);
 
-    if (x265pic_out.userData) {
-        memcpy(&avctx->reordered_opaque, x265pic_out.userData, sizeof(avctx->reordered_opaque));
-        av_freep(&x265pic_out.userData);
+    if (x265pic_out->userData) {
+        memcpy(&avctx->reordered_opaque, x265pic_out->userData, sizeof(avctx->reordered_opaque));
+        av_freep(&x265pic_out->userData);
     } else
         avctx->reordered_opaque = 0;
 


[FILE:1819:patches/patch-libavformat_rtsp.c]
--- libavformat/rtsp.c.orig	2024-08-04 23:23:22 UTC
+++ libavformat/rtsp.c
@@ -1679,7 +1679,12 @@ int ff_rtsp_make_setup_request(AVFormatC
             }
             if (ttl > 0)
                 snprintf(optbuf, sizeof(optbuf), "?ttl=%d", ttl);
-            getnameinfo((struct sockaddr*) &addr, sizeof(addr),
+            getnameinfo((struct sockaddr*) &addr,
+#if HAVE_STRUCT_SOCKADDR_SA_LEN
+                        ((struct sockaddr*) &addr)->sa_len,
+#else
+                        sizeof(addr),
+#endif
                         namebuf, sizeof(namebuf), NULL, 0, NI_NUMERICHOST);
             ff_url_join(url, sizeof(url), "rtp", NULL, namebuf,
                         port, "%s", optbuf);
@@ -1913,8 +1918,13 @@ redirect:
         goto fail;
     }
     if (!getpeername(tcp_fd, (struct sockaddr*) &peer, &peer_len)) {
-        getnameinfo((struct sockaddr*) &peer, peer_len, host, sizeof(host),
-                    NULL, 0, NI_NUMERICHOST);
+        getnameinfo((struct sockaddr*) &peer,
+#if HAVE_STRUCT_SOCKADDR_SA_LEN
+                    ((struct sockaddr*) &peer)->sa_len,
+#else
+                    peer_len,
+#endif
+                    host, sizeof(host), NULL, 0, NI_NUMERICHOST);
     }
 
     /* request options supported by the server; this also detects server
@@ -2429,7 +2439,11 @@ static int sdp_read_header(AVFormatConte
             const char *p;
 
             err = getnameinfo((struct sockaddr*) &rtsp_st->sdp_ip,
+#if HAVE_STRUCT_SOCKADDR_SA_LEN
+                              ((struct sockaddr*) &rtsp_st->sdp_ip)->sa_len,
+#else
                               sizeof(rtsp_st->sdp_ip),
+#endif
                               namebuf, sizeof(namebuf), NULL, 0, NI_NUMERICHOST);
             if (err) {
                 av_log(s, AV_LOG_ERROR, "getnameinfo: %s\n", gai_strerror(err));


[FILE:338:patches/patch-libavutil_common.h]
--- libavutil/common.h.orig	2024-08-04 23:23:18 UTC
+++ libavutil/common.h
@@ -42,6 +42,10 @@
 #include "attributes.h"
 #include "macros.h"
 
+#ifndef	UINT64_C
+#define	UINT64_C(c)	(c ## UL)
+#endif
+
 //rounded division & shift
 #define RSHIFT(a,b) ((a) > 0 ? ((a) + ((1<<(b))>>1))>>(b) : ((a) + ((1<<(b))>>1)-1)>>(b))
 /* assume b>0 */


[FILE:281:patches/patch-libswresample_version__major.h]
--- libswresample/version_major.h.orig	2024-08-04 23:23:18 UTC
+++ libswresample/version_major.h
@@ -26,6 +26,6 @@
  * Libswresample version macros
  */
 
-#define LIBSWRESAMPLE_VERSION_MAJOR   4
+#define LIBSWRESAMPLE_VERSION_MAJOR   40
 
 #endif /* SWRESAMPLE_VERSION_MAJOR_H */

