# Buildsheet autogenerated by ravenadm tool -- Do not edit.

NAMEBASE=		ffmpeg
VERSION=		3.3.4
KEYWORDS=		multimedia audio net
VARIANTS=		standard
SDESC[standard]=	Play, record, convert, and stream audio and video
HOMEPAGE=		https://www.ffmpeg.org/
CONTACT=		nobody

DOWNLOAD_GROUPS=	main
SITES[main]=		http://ffmpeg.org/releases/
DISTFILE[1]=		ffmpeg-3.3.4.tar.xz:main
DF_INDEX=		1
SPKGS[standard]=	complete
			primary
			examples
			docs

OPTIONS_AVAILABLE=	none
OPTIONS_STANDARD=	none

BUILD_DEPENDS=		yasm:single:standard
			video4linux:headers:standard
			gmp:static:standard
BUILDRUN_DEPENDS=	gmp:shared:standard
			libass:single:standard
			fontconfig:primary:standard
			freetype:primary:standard
			frei0r:single:standard
			fribidi:single:standard
			libgcrypt:single:standard
			gnutls:single:standard
			video4linux:primary:standard
			opencv:core:standard
			rtmpdump:library:standard
			schroedinger:primary:standard
			libtheora:single:standard
			libva:single:standard
			libvdpau:single:standard
			libvorbis:primary:standard
			libvpx:single:standard
			wavpack:single:standard
			WebP:single:standard
			x264:library:standard
			x265:single:standard
			xvid:single:standard

USES=			cpe gmake iconv perl:build pkgconfig shebangfix
SDL_COMPONENTS=		sdl2

FPC_EQUIVALENT=		multimedia/ffmpeg
SHEBANG_FILES=		doc/texi2pod.pl

MUST_CONFIGURE=		yes
CONFIGURE_ARGS=		--cc="{{CC}}"
			--prefix="{{PREFIX}}"
			--mandir="{{MANPREFIX}}/man"
			--datadir="{{PREFIX}}/share/ffmpeg"
			--pkgconfigdir="{{PREFIX}}/lib/pkgconfig"
			--enable-shared
			--enable-pic
			--enable-gpl
			--enable-version3
			--enable-postproc
			--enable-avfilter
			--enable-avresample
			--enable-pthreads
			--disable-indev=alsa
			--disable-outdev=alsa
			--disable-libopencore-amrnb
			--disable-libopencore-amrwb
			--disable-libbs2b
			--disable-libcaca
			--disable-libcdio
			--disable-libcelt
			--disable-chromaprint
			--disable-libdc1394
			--disable-debug
			--disable-htmlpages
			--disable-libfdk-aac
			--disable-libflite
			--disable-libgme
			--disable-libgsm
			--disable-libilbc
			--disable-indev=jack
			--disable-libkvazaar
			--disable-ladspa
			--disable-libmp3lame
			--disable-libbluray
			--disable-libmodplug
			--disable-netcdf
			--disable-openal
			--disable-indev=openal
			--disable-opencl
			--disable-opengl
			--disable-libopenh264
			--disable-libopenjpeg
			--disable-openssl
			--disable-libopus
			--disable-libpulse
			--disable-indev=pulse
			--disable-outdev=pulse
			--disable-librubberband
			--disable-libsmbclient
			--disable-libsnappy
			--disable-indev=sndio
			--disable-outdev=sndio
			--disable-libsoxr
			--disable-libspeex
			--disable-libssh
			--disable-libtesseract
			--disable-libtwolame
			--disable-libvo-amrwbenc
			--disable-libvidstab
			--disable-libxcb
			--disable-outdev=xv
			--disable-libzimg
			--disable-libzmq
			--disable-libzvbi
			--enable-libass
			--enable-ffserver
			--enable-fontconfig
			--enable-libfreetype
			--enable-frei0r
			--enable-libfribidi
			--enable-gcrypt
			--enable-gnutls
			--enable-gmp
			--enable-iconv
			--enable-libv4l2
			--enable-libopencv
			--enable-optimizations
			--enable-runtime-cpudetect
			--enable-librtmp
			--enable-libschroedinger
			--enable-ffplay
			--enable-libtheora
			--enable-vaapi
			--enable-vdpau
			--enable-libvorbis
			--enable-libvpx
			--enable-libwavpack
			--enable-libwebp
			--enable-libx264
			--enable-libx265
			--enable-libxvid

INSTALL_TARGET=		install-progs install-doc install-data install-libs
			install-headers
RC_SUBR=		ffserver:primary

post-patch:
	# {C,LD}FLAGS safeness
	@${REINPLACE_CMD} -e 's|/etc/ffserver.conf|${PREFIX}/etc/ffserver.conf|' \
		${WRKSRC}/ffserver.c
	@${REINPLACE_CMD} -E \
		-e 's|require_pkg_config opencv|require_pkg_config opencv-core|g' \
		${CONFIGURE_WRKSRC}/${CONFIGURE_SCRIPT}

post-install:
	@${MKDIR} ${STAGEDIR}${STD_DOCDIR}
.for DF in CREDITS LICENSE.md MAINTAINERS README.md RELEASE_NOTES
	${INSTALL_DATA} ${WRKSRC}/${DF} ${STAGEDIR}${STD_DOCDIR}
.endfor
	${INSTALL_DATA} ${WRKSRC}/doc/APIchanges ${STAGEDIR}${STD_DOCDIR}
	${INSTALL_DATA} ${WRKSRC}/doc/*.txt ${STAGEDIR}${STD_DOCDIR}
	${INSTALL_DATA} ${WRKSRC}/doc/ffserver.conf \
		${STAGEDIR}${PREFIX}/etc/ffserver.conf.sample

[FILE:843:descriptions/desc.primary]
FFmpeg is the leading multimedia framework, able to decode, encode,
transcode, mux, demux, stream, filter and play pretty much anything that
humans and machines have created. It supports the most obscure ancient
formats up to the cutting edge. No matter if they were designed by some
standards committee, the community or a corporation. It is also highly
portable: FFmpeg compiles, runs, and passes our testing infrastructure
FATE across Linux, Mac OS X, Microsoft Windows, the BSDs, Solaris, etc.
under a wide variety of build environments, machine architectures, and
configurations.

It contains libavcodec, libavutil, libavformat, libavfilter, libavdevice,
libswscale and libswresample which can be used by applications. As well
as ffmpeg, ffserver, ffplay and ffprobe which can be used by end users
for transcoding, streaming and playing.


[FILE:98:distinfo]
98b97e1b908dfeb6aeb6d407e5a5eacdfc253a40c2d195f5867ed2d1d46ea957      8282960 ffmpeg-3.3.4.tar.xz


[FILE:2978:manifests/plist.primary]
@sample etc/ffserver.conf.sample
bin/
 ffmpeg
 ffplay
 ffprobe
 ffserver
include/libavcodec/
 avcodec.h
 avdct.h
 avfft.h
 d3d11va.h
 dirac.h
 dv_profile.h
 dxva2.h
 jni.h
 mediacodec.h
 qsv.h
 vaapi.h
 vda.h
 vdpau.h
 version.h
 videotoolbox.h
 vorbis_parser.h
 xvmc.h
include/libavdevice/
 avdevice.h
 version.h
include/libavfilter/
 avfilter.h
 avfiltergraph.h
 buffersink.h
 buffersrc.h
 version.h
include/libavformat/
 avformat.h
 avio.h
 version.h
include/libavresample/
 avresample.h
 version.h
include/libavutil/
 adler32.h
 aes.h
 aes_ctr.h
 attributes.h
 audio_fifo.h
 avassert.h
 avconfig.h
 avstring.h
 avutil.h
 base64.h
 blowfish.h
 bprint.h
 bswap.h
 buffer.h
 camellia.h
 cast5.h
 channel_layout.h
 common.h
 cpu.h
 crc.h
 des.h
 dict.h
 display.h
 downmix_info.h
 error.h
 eval.h
 ffversion.h
 fifo.h
 file.h
 frame.h
 hash.h
 hmac.h
 hwcontext.h
 hwcontext_cuda.h
 hwcontext_dxva2.h
 hwcontext_qsv.h
 hwcontext_vaapi.h
 hwcontext_vdpau.h
 imgutils.h
 intfloat.h
 intreadwrite.h
 lfg.h
 log.h
 lzo.h
 macros.h
 mastering_display_metadata.h
 mathematics.h
 md5.h
 mem.h
 motion_vector.h
 murmur3.h
 opt.h
 parseutils.h
 pixdesc.h
 pixelutils.h
 pixfmt.h
 random_seed.h
 rational.h
 rc4.h
 replaygain.h
 ripemd.h
 samplefmt.h
 sha.h
 sha512.h
 spherical.h
 stereo3d.h
 tea.h
 threadmessage.h
 time.h
 timecode.h
 timestamp.h
 tree.h
 twofish.h
 version.h
 xtea.h
include/libpostproc/
 postprocess.h
 version.h
include/libswresample/
 swresample.h
 version.h
include/libswscale/
 swscale.h
 version.h
lib/
 libavcodec.a
 libavcodec.so
 libavcodec.so.57
 libavcodec.so.57.89.100
 libavdevice.a
 libavdevice.so
 libavdevice.so.57
 libavdevice.so.57.6.100
 libavfilter.a
 libavfilter.so
 libavfilter.so.6
 libavfilter.so.6.82.100
 libavformat.a
 libavformat.so
 libavformat.so.57
 libavformat.so.57.71.100
 libavresample.a
 libavresample.so
 libavresample.so.3
 libavresample.so.3.5.0
 libavutil.a
 libavutil.so
 libavutil.so.55
 libavutil.so.55.58.100
 libpostproc.a
 libpostproc.so
 libpostproc.so.54
 libpostproc.so.54.5.100
 libswresample.a
 libswresample.so
 libswresample.so.2
 libswresample.so.2.7.100
 libswscale.a
 libswscale.so
 libswscale.so.4
 libswscale.so.4.6.100
lib/pkgconfig/
 libavcodec.pc
 libavdevice.pc
 libavfilter.pc
 libavformat.pc
 libavresample.pc
 libavutil.pc
 libpostproc.pc
 libswresample.pc
 libswscale.pc
share/ffmpeg/
 ffprobe.xsd
 libvpx-1080p.ffpreset
 libvpx-1080p50_60.ffpreset
 libvpx-360p.ffpreset
 libvpx-720p.ffpreset
 libvpx-720p50_60.ffpreset
share/man/man1/
 ffmpeg-all.1.gz
 ffmpeg-bitstream-filters.1.gz
 ffmpeg-codecs.1.gz
 ffmpeg-devices.1.gz
 ffmpeg-filters.1.gz
 ffmpeg-formats.1.gz
 ffmpeg-protocols.1.gz
 ffmpeg-resampler.1.gz
 ffmpeg-scaler.1.gz
 ffmpeg-utils.1.gz
 ffmpeg.1.gz
 ffplay-all.1.gz
 ffplay.1.gz
 ffprobe-all.1.gz
 ffprobe.1.gz
 ffserver-all.1.gz
 ffserver.1.gz
share/man/man3/
 libavcodec.3.gz
 libavdevice.3.gz
 libavfilter.3.gz
 libavformat.3.gz
 libavutil.3.gz
 libswresample.3.gz
 libswscale.3.gz


[FILE:360:manifests/plist.examples]
share/ffmpeg/examples/
 Makefile
 README
 avio_dir_cmd.c
 avio_reading.c
 decode_audio.c
 decode_video.c
 demuxing_decoding.c
 encode_audio.c
 encode_video.c
 extract_mvs.c
 filter_audio.c
 filtering_audio.c
 filtering_video.c
 http_multiclient.c
 metadata.c
 muxing.c
 qsvdec.c
 remuxing.c
 resampling_audio.c
 scaling_video.c
 transcode_aac.c
 transcoding.c


[FILE:3488:patches/patch-configure]
--- configure.orig	2017-09-12 00:51:31 UTC
+++ configure
@@ -464,7 +464,7 @@ log(){
 
 log_file(){
     log BEGIN $1
-    pr -n -t $1 >> $logfile
+    cat $1 >> $logfile
     log END $1
 }
 
@@ -1875,6 +1875,7 @@ HEADERS_LIST="
     machine_ioctl_meteor_h
     malloc_h
     opencv2_core_core_c_h
+    openjpeg_2_2_openjpeg_h
     openjpeg_2_1_openjpeg_h
     openjpeg_2_0_openjpeg_h
     openjpeg_1_5_openjpeg_h
@@ -3262,12 +3263,7 @@ target_os_default=$(tolower $(uname -s))
 host_os=$target_os_default
 
 # machine
-if test "$target_os_default" = aix; then
-    arch_default=$(uname -p)
-    strip_default="strip -X32_64"
-else
-    arch_default=$(uname -m)
-fi
+arch_default=$(uname -p)
 cpu="generic"
 intrinsics="none"
 
@@ -3417,7 +3413,7 @@ die_unknown(){
 
 print_in_columns() {
     cols=$(expr $ncols / 24)
-    cat | tr ' ' '\n' | sort | pr -r "-$cols" -w $ncols -t
+    cat | tr ' ' '\n' | sort 
 }
 
 show_list() {
@@ -5803,10 +5799,12 @@ enabled libopencore_amrwb && require lib
 enabled libopencv         && { check_header opencv2/core/core_c.h &&
                                { use_pkg_config opencv opencv2/core/core_c.h cvCreateImageHeader ||
                                  require opencv opencv2/core/core_c.h cvCreateImageHeader -lopencv_core -lopencv_imgproc; } ||
-                               require_pkg_config opencv opencv/cxcore.h cvCreateImageHeader; }
+                               require_pkg_config opencv-core-core-core opencv/cxcore.h cvCreateImageHeader; }
 enabled libopenh264       && require_pkg_config openh264 wels/codec_api.h WelsGetCodecVersion
 enabled libopenjpeg       && { { check_lib openjpeg-2.1/openjpeg.h opj_version -lopenjp2 -DOPJ_STATIC && add_cppflags -DOPJ_STATIC; } ||
                                check_lib openjpeg-2.1/openjpeg.h opj_version -lopenjp2 ||
+			       { check_lib openjpeg-2.2/openjpeg.h opj_version -lopenjp2 -DOPJ_STATIC && add_cppflags -DOPJ_STATIC; } ||
+                               check_lib openjpeg-2.2/openjpeg.h opj_version -lopenjp2 ||
                                { check_lib openjpeg-2.0/openjpeg.h opj_version -lopenjp2 -DOPJ_STATIC && add_cppflags -DOPJ_STATIC; } ||
                                { check_lib openjpeg-1.5/openjpeg.h opj_version -lopenjpeg -DOPJ_STATIC && add_cppflags -DOPJ_STATIC; } ||
                                { check_lib openjpeg.h opj_version -lopenjpeg -DOPJ_STATIC && add_cppflags -DOPJ_STATIC; } ||
@@ -6295,6 +6293,9 @@ elif enabled llvm_gcc; then
 elif enabled clang; then
     check_cflags -mllvm -stack-alignment=16
     check_cflags -mstack-alignment=16
+    if enabled x86_32; then
+        check_cflags -mstackrealign
+    fi
     check_cflags -Qunused-arguments
     check_cflags -Werror=implicit-function-declaration
     check_cflags -Werror=missing-prototypes
@@ -6900,7 +6901,7 @@ exec_prefix=\${prefix}
 libdir=$libdir
 includedir=$incdir
 
-Name: $name
+Name: ${name}${build_suffix}
 Description: $comment
 Version: $version
 Requires: $(enabled shared || echo $requires)
@@ -6914,10 +6915,10 @@ EOF
 mkdir -p doc/examples/pc-uninstalled
 includedir=${source_path}
 [ "$includedir" = . ] && includedir="\${pcfiledir}/../../.."
-    cat <<EOF > doc/examples/pc-uninstalled/${name}-uninstalled.pc
+    cat <<EOF > doc/examples/pc-uninstalled/${name}${build_suffix}-uninstalled.pc
 prefix=
 exec_prefix=
-libdir=\${pcfiledir}/../../../$name
+libdir=\${pcfiledir}/../../../${name}${build_suffix}.pc
 includedir=${includedir}
 
 Name: $name


[FILE:287:patches/patch-doc_Makefile]
--- doc/Makefile.orig	2017-09-12 00:51:31 UTC
+++ doc/Makefile
@@ -149,7 +149,7 @@ install-html: $(HTMLPAGES)
 endif
 
 ifdef CONFIG_MANPAGES
-install-progs-$(CONFIG_DOC): install-man
+#install-progs-$(CONFIG_DOC): install-man
 
 install-man: $(MANPAGES)
 	$(Q)mkdir -p "$(MANDIR)/man1"


[FILE:1842:patches/patch-libavformat_rtsp.c]
--- libavformat/rtsp.c.orig	2017-09-12 00:51:35 UTC
+++ libavformat/rtsp.c
@@ -1613,7 +1613,12 @@ int ff_rtsp_make_setup_request(AVFormatC
             }
             if (ttl > 0)
                 snprintf(optbuf, sizeof(optbuf), "?ttl=%d", ttl);
-            getnameinfo((struct sockaddr*) &addr, sizeof(addr),
+            getnameinfo((struct sockaddr*) &addr,
+#if HAVE_STRUCT_SOCKADDR_SA_LEN
+                        ((struct sockaddr*) &addr)->sa_len,
+#else
+                        sizeof(addr),
+#endif
                         namebuf, sizeof(namebuf), NULL, 0, NI_NUMERICHOST);
             ff_url_join(url, sizeof(url), "rtp", NULL, namebuf,
                         port, "%s", optbuf);
@@ -1829,8 +1834,13 @@ redirect:
         goto fail;
     }
     if (!getpeername(tcp_fd, (struct sockaddr*) &peer, &peer_len)) {
-        getnameinfo((struct sockaddr*) &peer, peer_len, host, sizeof(host),
-                    NULL, 0, NI_NUMERICHOST);
+        getnameinfo((struct sockaddr*) &peer,
+#if HAVE_STRUCT_SOCKADDR_SA_LEN
+                    ((struct sockaddr*) &peer)->sa_len,
+#else
+                    peer_len,
+#endif
+                    host, sizeof(host), NULL, 0, NI_NUMERICHOST);
     }
 
     /* request options supported by the server; this also detects server
@@ -2309,7 +2319,11 @@ static int sdp_read_header(AVFormatConte
             AVDictionary *opts = map_to_opts(rt);
 
             err = getnameinfo((struct sockaddr*) &rtsp_st->sdp_ip,
+#if HAVE_STRUCT_SOCKADDR_SA_LEN
+                              ((struct sockaddr*) &rtsp_st->sdp_ip)->sa_len,
+#else
                               sizeof(rtsp_st->sdp_ip),
+#endif
                               namebuf, sizeof(namebuf), NULL, 0, NI_NUMERICHOST);
             if (err) {
                 av_log(s, AV_LOG_ERROR, "getnameinfo: %s\n", gai_strerror(err));


[FILE:331:patches/patch-libavutil_common.h]
--- libavutil/common.h.orig	2017-09-12 00:51:35 UTC
+++ libavutil/common.h
@@ -50,6 +50,10 @@
 #   define AV_NE(be, le) (le)
 #endif
 
+#ifndef	UINT64_C
+#define	UINT64_C(c)	(c ## UL)
+#endif
+
 //rounded division & shift
 #define RSHIFT(a,b) ((a) > 0 ? ((a) + ((1<<(b))>>1))>>(b) : ((a) + ((1<<(b))>>1)-1)>>(b))
 /* assume b>0 */


[FILE:398:files/ffserver.in]
#!/bin/sh
#
# PROVIDE: ffserver
# REQUIRE: NETWORKING
# KEYWORD: shutdown

#
# Add the following lines to /etc/rc.conf to enable ffserver:
#
#ffserver_enable="YES"
#
ffserver_enable="${ffserver_enable-NO}"

. /etc/rc.subr

name=ffserver
rcvar=ffserver_enable

command="%%PREFIX%%/bin/${name}"
command_args="&"
required_files=%%PREFIX%%/etc/ffserver.conf

load_rc_config ${name}
run_rc_command "$1"

