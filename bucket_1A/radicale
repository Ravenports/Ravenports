# Buildsheet autogenerated by ravenadm tool -- Do not edit.

NAMEBASE=		radicale
VERSION=		3.0.3
KEYWORDS=		python
VARIANTS=		py38 py37
SDESC[py37]=		CalDAV and CardDAV Server (PY37)
SDESC[py38]=		CalDAV and CardDAV Server (PY38)
HOMEPAGE=		https://radicale.org/
CONTACT=		Python_Automaton[python@ironwolf.systems]

DOWNLOAD_GROUPS=	main
SITES[main]=		PYPI/R/Radicale
DISTFILE[1]=		Radicale-3.0.3.tar.gz:main
DF_INDEX=		1
SPKGS[py37]=		single
SPKGS[py38]=		single

OPTIONS_AVAILABLE=	PY38 PY37
OPTIONS_STANDARD=	none
VOPTS[py37]=		PY38=OFF PY37=ON
VOPTS[py38]=		PY38=ON PY37=OFF

USERS=			radicale
GROUPS=			radicale
USERGROUP_SPKG=		single

USES=			cpe shebangfix

DISTNAME=		Radicale-3.0.3

LICENSE=		GPLv3+:single
LICENSE_TERMS=		single:{{WRKDIR}}/TERMS
LICENSE_FILE=		GPLv3+:{{WRKSRC}}/COPYING
LICENSE_AWK=		TERMS:"Radicale WSGI application"
LICENSE_SOURCE=		TERMS:{{WRKSRC}}/radicale/app/__init__.py
LICENSE_SCHEME=		solo

SHEBANG_FILES=		radicale.fcgi
			radicale.wsgi
GENERATED=		yes

RC_SUBR=		radicale:single
SUB_LIST=		USERS="radicale"
			GROUPS="radicale"
			PYTHON_CMD="{{PYTHON_CMD}}"

[PY37].BUILDRUN_DEPENDS_ON=		python-defusedxml:single:py37
					python-passlib:single:py37
					python-vobject:single:py37
					python-python-dateutil:single:py37
[PY37].USES_ON=				python:py37

[PY38].BUILDRUN_DEPENDS_ON=		python-defusedxml:single:py38
					python-passlib:single:py38
					python-vobject:single:py38
					python-python-dateutil:single:py38
[PY38].USES_ON=				python:py38

post-patch:
	${REINPLACE_CMD} \
		-e 's,/etc/radicale,${PREFIX}/etc/radicale,g' \
		-e 's,/etc/ssl,${PREFIX}/etc/radicale,g' \
		-e 's,/var/lib/radicale,${PREFIX}/share/radicale,g' \
		${WRKSRC}/config \
		${WRKSRC}/radicale/config.py

post-install:
	${MKDIR} ${STAGEDIR}/${PREFIX}/etc/radicale
	${MKDIR} ${STAGEDIR}/${PREFIX}/share/radicale
	${MKDIR} ${STAGEDIR}/${PREFIX}/www/radicale
	${INSTALL_DATA} ${WRKSRC}/config \
		${STAGEDIR}/${PREFIX}/etc/radicale/config.sample
	${INSTALL_DATA} ${WRKSRC}/rights \
		${STAGEDIR}/${PREFIX}/etc/radicale/rights.sample
	${INSTALL_SCRIPT} ${WRKSRC}/radicale.fcgi \
		${STAGEDIR}${PREFIX}/www/radicale/radicale.fcgi
	${INSTALL_SCRIPT} ${WRKSRC}/radicale.wsgi \
		${STAGEDIR}${PREFIX}/www/radicale/radicale.wsgi

[FILE:633:descriptions/desc.single]

Radicale CalDAV and CardDAV server
==================================

The Radicale Project is a CalDAV (calendar) and CardDAV (contact) server. 
It
aims to be a light solution, easy to use, easy to install, easy to
configure.
As a consequence, it requires few software dependances and is
pre-configured to
work out-of-the-box.

The Radicale Project runs on most of the UNIX-like platforms (Linux, BSD,
MacOS X) and Windows.  It is known to work with Evolution, Lightning,
iPhone
and Android clients. It is free and open-source software, released under
GPL
version 3.

For further information, please visit the [Radicale Website
].


[FILE:100:distinfo]
3d9995adfaa47f7262151cf2d019c38ce35b1aa54b932231b2253ff0c9a3a222       101402 Radicale-3.0.3.tar.gz


[FILE:158:manifests/plist.single]
@sample etc/radicale/config.sample
@sample etc/radicale/rights.sample
www/radicale/
 radicale.fcgi
 radicale.wsgi
@dir(radicale,radicale,0755) share/radicale


[FILE:898:files/radicale.in]
#!/bin/sh
# Created by: Mark Felder <feld@FreeBSD.org>
#
#
# PROVIDE: radicale
# REQUIRE: DAEMON
# BEFORE: LOGIN
# KEYWORD: shutdown
#
#
# Add the following lines to /etc/rc.conf to enable radicale:
#  radicale_enable (bool):    Set to "NO" by default.
#                       Set it to "YES" to enable radicale.
#

. /etc/rc.subr

name=radicale
rcvar=radicale_enable

# set defaults

load_rc_config $name

: ${radicale_enable:=NO}
: ${radicale_config=%%PREFIX%%/etc/radicale/config}
: ${radicale_user:=radicale}
: ${radicale_group:=radicale}

pidfile=/var/run/radicale/radicale.pid
command=%%PREFIX%%/bin/radicale-%%PYTHON_VER%%
command_args="-d -p ${pidfile} -C ${radicale_config}"
command_interpreter=%%PYTHON_CMD%%
required_files=${radicale_config}
start_precmd=do_precmd

do_precmd()
{
	if [ ! -d ${pidfile%/*} ]; then
		install -d -o ${radicale_user} ${pidfile%/*}
	fi
}

run_rc_command "$1"

