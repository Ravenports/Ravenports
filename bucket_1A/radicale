# Buildsheet autogenerated by ravenadm tool -- Do not edit.

NAMEBASE=		radicale
VERSION=		3.5.8
KEYWORDS=		python
VARIANTS=		std
SDESC[std]=		CalDAV and CardDAV Server
HOMEPAGE=		https://radicale.org/
CONTACT=		Python_Automaton[python@ironwolf.systems]

DOWNLOAD_GROUPS=	main
SITES[main]=		GITHUB/Kozea:Radicale:v3.5.8
DISTFILE[1]=		generated:main
DF_INDEX=		1
SPKGS[std]=		single

OPTIONS_AVAILABLE=	none
OPTIONS_STANDARD=	none

BUILDRUN_DEPENDS=	python-defusedxml:single:python_used
			python-libpass:single:python_used
			python-vobject:single:python_used
			python-python-dateutil:single:python_used
			python-pika:single:python_used

USERS=			radicale
GROUPS=			radicale
USERGROUP_SPKG=		single

USES=			cpe shebangfix python:sutools

DISTNAME=		Radicale-3.5.8

LICENSE=		GPLv3+:single
LICENSE_TERMS=		single:{{WRKDIR}}/TERMS
LICENSE_FILE=		GPLv3+:{{WRKSRC}}/COPYING.md
LICENSE_AWK=		TERMS:"Radicale WSGI application"
LICENSE_SOURCE=		TERMS:{{WRKSRC}}/radicale/app/__init__.py
LICENSE_SCHEME=		solo

SHEBANG_FILES=		radicale.wsgi
GENERATED=		yes

RC_SUBR=		radicale:single
SUB_LIST=		USERS="radicale"
			GROUPS="radicale"
			PYTHON_CMD="{{PYTHON_CMD}}"

post-install:
	${MKDIR} ${STAGEDIR}/${PREFIX}/etc/radicale
	${MKDIR} ${STAGEDIR}/${PREFIX}/share/radicale
	${MKDIR} ${STAGEDIR}/${PREFIX}/www/radicale
	${INSTALL_DATA} ${WRKSRC}/config \
		${STAGEDIR}/${PREFIX}/etc/radicale/config.sample
	${INSTALL_DATA} ${WRKSRC}/rights \
		${STAGEDIR}/${PREFIX}/etc/radicale/rights.sample
	${INSTALL_SCRIPT} ${WRKSRC}/radicale.wsgi \
		${STAGEDIR}${PREFIX}/www/radicale/radicale.wsgi

pre-configure:
	${REINPLACE_CMD} \
		-e 's,/etc/radicale,${PREFIX}/etc/radicale,g' \
		-e 's,/etc/ssl,${PREFIX}/etc/radicale,g' \
		-e 's,/var/lib/radicale,${PREFIX}/share/radicale,g' \
		${WRKSRC}/config \
		${WRKSRC}/radicale/config.py

post-extract:
	${MV} ${WRKSRC}/setup.py.legacy ${WRKSRC}/setup.py

[FILE:497:descriptions/desc.single]
The Radicale Project is a CalDAV (calendar) and CardDAV (contact) server.
It aims to be a light solution, easy to use, easy to install, easy to
configure.  As a consequence, it requires few software dependances and is
pre-configured to work out-of-the-box.

The Radicale Project runs on most of the UNIX-like platforms (Linux, BSD,
MacOS X) and Windows.  It is known to work with Evolution, Lightning,
iPhone and Android clients. It is free and open-source software, released under
GPL version 3.


[FILE:106:distinfo]
62f203686668a60085ff09def6d4cfe8e025d8e5969ebf13d0b191595182f03f       229736 Kozea-Radicale-3.5.8.tar.gz


[FILE:141:manifests/plist.single]
@sample etc/radicale/config.sample
@sample etc/radicale/rights.sample
www/radicale/radicale.wsgi
@dir(radicale,radicale,0755) share/radicale


[FILE:871:files/radicale.in]
#!/bin/sh
# Created by: Mark Felder <feld@FreeBSD.org>

# PROVIDE: radicale
# REQUIRE: DAEMON
# BEFORE: LOGIN
# KEYWORD: shutdown

#
# Add the following lines to /etc/rc.conf to enable radicale:
#  radicale_enable (bool):    Set to "NO" by default.
#                       Set it to "YES" to enable radicale.
#

. /etc/rc.subr

name=radicale
rcvar=radicale_enable

# set defaults

load_rc_config $name

: ${radicale_enable:=NO}
: ${radicale_config=%%PREFIX%%/etc/radicale/config}
: ${radicale_user=radicale}
: ${radicale_group=radicale}

pidfile=/var/run/radicale/radicale.pid
command=/usr/sbin/daemon
command_args="-P ${pidfile} -f -ST ${name} %%PREFIX%%/bin/radicale -C ${radicale_config}"
required_files=${radicale_config}
start_precmd=do_precmd

do_precmd()
{
	if [ ! -d ${pidfile%/*} ]; then
		install -d -o ${radicale_user} ${pidfile%/*}
	fi
}

run_rc_command "$1"

