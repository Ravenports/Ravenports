# Buildsheet autogenerated by ravenadm tool -- Do not edit.

NAMEBASE=		libadalang-tools
VERSION=		2020
KEYWORDS=		python lang devel
VARIANTS=		standard
SDESC[standard]=	Development tools based on libadalang
HOMEPAGE=		https://github.com/AdaCore/libadalang-tools
CONTACT=		John_Marino[draco@marino.st]

DOWNLOAD_GROUPS=	main
SITES[main]=		http://downloads.dragonlace.net/src/
DISTFILE[1]=		libadalang-tools-2020-20200429-1998C-src.tar.gz:main
DF_INDEX=		1
SPKGS[standard]=	single

OPTIONS_AVAILABLE=	none
OPTIONS_STANDARD=	none

BUILD_DEPENDS=		libadalang:single:standard
RUN_DEPENDS=		libiconv:shared:standard
			gmp:shared:standard

USES=			gprbuild

DISTNAME=		libadalang-tools-2020-20200429-1998C-src

LICENSE=		GPLv3+:single
LICENSE_TERMS=		single:{{WRKDIR}}/TERMS
LICENSE_FILE=		GPLv3+:{{WRKSRC}}/COPYING3
LICENSE_AWK=		TERMS:"^$$"
LICENSE_SOURCE=		TERMS:{{WRKSRC}}/src/pp.ads
LICENSE_SCHEME=		solo

INSTALL_REQ_TOOLCHAIN=	yes

do-build:
	(cd ${WRKSRC} && ${SETENV} ${MAKE_ENV} \
		gprbuild -p -v -k -XLIBRARY_TYPE=static \
		-XXMLADA_BUILD=static -XBUILD_MODE=prod -p \
		-j${MAKE_JOBS_NUMBER} -P src/build.gpr)

do-install:
.for prog in gnatpp gnatmetric gnatstub gnattest
	${INSTALL_PROGRAM} ${WRKSRC}/bin/${prog} ${STAGEDIR}${PREFIX}/bin/
.endfor

[FILE:309:descriptions/desc.single]
This package contains several Libadalang-based development tools:

 - gnatpp       a pretty-printer to reformat source code.
 - gnatmetric   compute various source code metrics, such as SLOC count.
 - gnatstub     creates body stub (empty but compilable bodies) for
                library unit declarations.


[FILE:126:distinfo]
539dae0366a83ed3ff657b9d2f51cfcd87a138af62223521d0fd8fbd25675d9b       711777 libadalang-tools-2020-20200429-1998C-src.tar.gz


[FILE:45:manifests/plist.single]
bin/
 gnatmetric
 gnatpp
 gnatstub
 gnattest


[FILE:1107:patches/patch-src_pp-actions.adb]
From fd784d6fdfbb7dcbcb9b23d8aff15a369f6cff06 Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?Romain=20B=C3=A9guet?= <beguet@adacore.com>
Date: Wed, 20 May 2020 14:23:33 +0200
Subject: [PATCH] Revert "Revert "T519-017: stub Ada 2020 handling""

This reverts commit ec9333afdabeb1caab038de10d2a615515baf4ab.
Stable branch is now bumped.

Change-Id: Ifde8a4ed00a67149be5b33c22dfedbc0e7318455
---
 src/pp-actions.adb | 8 ++++++++
 1 file changed, 8 insertions(+)

--- src/pp-actions.adb
+++ src/pp-actions.adb
@@ -614,6 +614,14 @@ package body Pp.Actions is
            when Ada_Prim_Type_Accessor => null,
             --  ???The above are not used
 
+           when Ada_Iterated_Assoc => null,
+           when Ada_Bracket_Aggregate => null,
+           when Ada_Bracket_Delta_Aggregate => null,
+           when Ada_Delta_Aggregate => null,
+           when Ada_Decl_Expr => null,
+           --  ??? Ada 2020 related expressions, needs to be implemented. See
+           --  T519-017.
+
            when Ada_Ada_List => null,
            when Ada_Subp_Spec => null,
            when Ada_Aggregate_Assoc => null,


[FILE:339:patches/patch-src_test-main.adb]
--- src/test-main.adb.orig	2020-02-28 06:08:56 UTC
+++ src/test-main.adb
@@ -6,6 +6,8 @@ with Test.Command_Lines;
 
 procedure Test.Main is
 
+   pragma Linker_Options ("-lgnarl");
+   pragma Linker_Options ("-lpthread");
    --  Main procedure for gnattest
 
    procedure Callback (Phase : Parse_Phase; Swit : Dynamically_Typed_Switch);

