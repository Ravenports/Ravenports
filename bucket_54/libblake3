# Buildsheet autogenerated by ravenadm tool -- Do not edit.

NAMEBASE=		libblake3
VERSION=		1.8.2
KEYWORDS=		security
VARIANTS=		std
SDESC[std]=		C implementation of BLAKE3 is a cryptographic hash
HOMEPAGE=		https://github.com/BLAKE3-team/BLAKE3/
CONTACT=		nobody

DOWNLOAD_GROUPS=	main
SITES[main]=		GITHUB/BLAKE3-team:BLAKE3:1.8.2
DISTFILE[1]=		generated:main
DF_INDEX=		1
SPKGS[std]=		set
			primary
			dev

OPTIONS_AVAILABLE=	none
OPTIONS_STANDARD=	none

USES=			cmake

DISTNAME=		BLAKE3-1.8.2/c

LICENSE=		CC0_10:primary APACHE20:primary
LICENSE_TERMS=		primary:{{WRKDIR}}/TERMS
LICENSE_FILE=		CC0_10:{{WRKSRC}}/../LICENSE_CC0
			APACHE20:{{WRKSRC}}/../LICENSE_A2LLVM
LICENSE_SCHEME=		dual

SINGLE_JOB=		yes

SOVERSION=		1.8.2
SUB_FILES=		CMakeLists.txt
SUB_LIST=		SOVERSION=1.8.2
			SOMAJOR=1

post-install:
	${STRIP_CMD} ${STAGEDIR}${PREFIX}/lib/libblake3.so

pre-configure:
	# Install makefile
	${INSTALL_DATA} ${WRKDIR}/CMakeLists.txt ${WRKSRC}/
	# Enable .note.GNU-stack for all platforms, not just Linux
	${REINPLACE_CMD} -e '/__linux__/ s|__ELF__) && defined(__linux__)|__ELF__)|' \
		${WRKSRC}/blake3_avx2_x86-64_unix.S \
		${WRKSRC}/blake3_avx512_x86-64_unix.S \
		${WRKSRC}/blake3_sse2_x86-64_unix.S \
		${WRKSRC}/blake3_sse41_x86-64_unix.S

post-extract:
	${AWK} "/Licenses/,/Adoption/" ${WRKSRC}/../README.md > ${WRKDIR}/TERMS

[FILE:338:descriptions/desc.primary]
This is the official C implementation of BLAKE3.

This package compiles the individual files to provide the blake3 library.
Unlike the Rust implementation, the C implementation doesn't currently
support multithreading.

The x86-64 package leverages the provided assembly files.
Other platforms will build with intrinics (when supported).


[FILE:110:distinfo]
6b51aefe515969785da02e87befafc7fdc7a065cd3458cf1141f29267749e81f       264657 BLAKE3-team-BLAKE3-1.8.2.tar.gz


[FILE:59:manifests/plist.primary]
lib/
 libblake3.so.%%SOMAJOR%%
 libblake3.so.%%SOVERSION%%


[FILE:66:manifests/plist.dev]
include/blake3.h
lib/
 libblake3.a
 libblake3.so
 libblake3_pic.a


[FILE:1230:files/CMakeLists.txt.in]
# static, shared, and PIC fetch library
cmake_minimum_required(VERSION 4.0)

project(Blake3_Crypto C ASM)

include_directories(
	${CMAKE_SOURCE_DIR}
	${CMAKE_CURRENT_BINARY_DIR}
)

set (asmfiles
	${CMAKE_SOURCE_DIR}/blake3_sse2_x86-64_unix.S
	${CMAKE_SOURCE_DIR}/blake3_sse41_x86-64_unix.S
	${CMAKE_SOURCE_DIR}/blake3_avx2_x86-64_unix.S
    	${CMAKE_SOURCE_DIR}/blake3_avx512_x86-64_unix.S
)

set (libsrcs
	${CMAKE_SOURCE_DIR}/blake3.c
	${CMAKE_SOURCE_DIR}/blake3_dispatch.c
	${CMAKE_SOURCE_DIR}/blake3_portable.c
	${asmfiles}
)

add_library(blake3obj ${libsrcs})
set_property(TARGET blake3obj PROPERTY POSITION_INDEPENDENT_CODE 1)

add_library(blake3 SHARED $<TARGET_OBJECTS:blake3obj>)
add_library(blake3_pic STATIC $<TARGET_OBJECTS:blake3obj>)
add_library(blake3_static ${libsrcs})

set_target_properties(blake3 PROPERTIES VERSION %%SOVERSION%%)
set_target_properties(blake3 PROPERTIES SOVERSION %%SOMAJOR%%)

install(TARGETS blake3
    LIBRARY DESTINATION ${CMAKE_INSTALL_LIBDIR}
)

install(TARGETS blake3_pic
    LIBRARY DESTINATION ${CMAKE_INSTALL_LIBDIR}
)

install(FILES ${CMAKE_CURRENT_BINARY_DIR}/libblake3_static.a
	RENAME libblake3.a
	DESTINATION lib
)

install(FILES ${CMAKE_SOURCE_DIR}/blake3.h DESTINATION include)

