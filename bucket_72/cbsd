# Buildsheet autogenerated by ravenadm tool -- Do not edit.

NAMEBASE=		cbsd
VERSION=		14.2.1
KEYWORDS=		sysutils
VARIANTS=		std
SDESC[std]=		FreeBSD jails, bhyve and Xen manager
HOMEPAGE=		https://www.bsdstore.ru/en/about.html
CONTACT=		nobody

DOWNLOAD_GROUPS=	main
SITES[main]=		GITHUB/cbsd:cbsd:v14.2.1
DISTFILE[1]=		generated:main
DF_INDEX=		1
SPKGS[std]=		set
			primary
			man
			docs

OPTIONS_AVAILABLE=	none
OPTIONS_STANDARD=	none

ONLY_FOR_OPSYS=		freebsd dragonfly midnightbsd

BUILD_DEPENDS=		elftoolchain:dev:std
			libssh2:dev:std
			curl:dev:std
			file:dev:std
			libedit:dev:std
BUILDRUN_DEPENDS=	libssh2:primary:std
			libedit:primary:std
			file:primary:std
			curl:primary:std
RUN_DEPENDS=		rsync:set:std
			sudo:set:std

USERS=			cbsd
GROUPS=			cbsd
USERGROUP_SPKG=		primary

USES=			pkgconfig:buildrun ssl cmake sqlite

LICENSE=		BSD2CLAUSE:primary
LICENSE_FILE=		BSD2CLAUSE:{{WRKSRC}}/LICENSE
LICENSE_SCHEME=		solo

FPC_EQUIVALENT=		sysutils/cbsd

SINGLE_JOB=		yes

MANDIRS=		{{PREFIX}}/cbsd/man
RC_SUBR=		cbsdd:primary
			cbsdrsyncd:primary
			cbsd-statsd-bhyve:primary
			cbsd-statsd-hoster:primary
			cbsd-statsd-jail:primary
SUB_FILES=		messages-primary.ucl

post-install:
	# Add symbolic link
	${MKDIR} ${STAGEDIR}${PREFIX}/libexec/bsdconfig
	(cd ${STAGEDIR}${PREFIX}/libexec/bsdconfig &&\
		${LN} -sf ../../cbsd/share/bsdconfig/cbsd cbsd)
	# Strip
	${STRIP_CMD} ${STAGEDIR}${PREFIX}/bin/cbsd
	${STRIP_CMD} ${STAGEDIR}${PREFIX}/cbsd/bin/c*
	${STRIP_CMD} ${STAGEDIR}${PREFIX}/cbsd/sbin/netmask
	(cd ${STAGEDIR}${PREFIX}/cbsd && ${FIND} tools misc -type f | while read f; \
	do \
	    check=$$(file "$$f" | grep "dynamically linked,.*not stripped"); \
	    if [ -n "$$check" ]; then ${STRIP_CMD} "$$f"; fi; \
	done)

pre-configure:
	${REINPLACE_CMD} -e '/<sys\/elf_common.h>/d' \
		${WRKSRC}/misc/src/elf_tables.c
	# fix hardcoded paths
	${GREP} -rl '/usr/local' ${WRKSRC} | ${XARGS} \
		${SED} -i'' -e 's|/usr/local|${PREFIX}|g'
	# fix search path
	${REINPLACE_CMD} -e 's|_PATH_DEFPATH|"/bin:/sbin:/usr/bin:/usr/sbin:${PREFIX}/bin:${PREFIX}/sbin"|'\
		${WRKSRC}/bin/cbsdsh/var.c

post-extract:
	${MKDIR} ${WRKSRC}/bin/tool_mknodes
	${MKDIR} ${WRKSRC}/bin/tool_mksyntax
	${INSTALL_DATA} ${FILESDIR}/CM.txt \
		${WRKSRC}/CMakeLists.txt
	${INSTALL_DATA} ${FILESDIR}/CM_bin.txt \
		${WRKSRC}/bin/CMakeLists.txt
	${INSTALL_DATA} ${FILESDIR}/CM_bin_mknodes.txt \
		${WRKSRC}/bin/tool_mknodes/CMakeLists.txt
	${INSTALL_DATA} ${FILESDIR}/CM_bin_mksyntax.txt \
		${WRKSRC}/bin/tool_mksyntax/CMakeLists.txt
	${INSTALL_DATA} ${FILESDIR}/CM_bin_cbsdsh.txt \
		${WRKSRC}/bin/cbsdsh/CMakeLists.txt
	${INSTALL_DATA} ${FILESDIR}/CM_misc.txt \
		${WRKSRC}/misc/CMakeLists.txt
	${INSTALL_DATA} ${FILESDIR}/CM_tools.txt \
		${WRKSRC}/tools/CMakeLists.txt
	${INSTALL_DATA} ${FILESDIR}/CM_sbin.txt \
		${WRKSRC}/sbin/CMakeLists.txt

[FILE:496:descriptions/desc.primary]
CBSD is a management layer written for the FreeBSD jail(8) subsystem, bhyve
and Xen. The project is positioned as a single integrated tool of
comprehensive solution for building and deploying virtual environments
quickly with pre-defined software sets with minimal configuration.

No extra OS functionality has been exposed yet, and everything that CBSD
can do, you could also run manually with tens or hundreds of commands in
the CLI using the underlying utilities (Not that you would want to!)


[FILE:102:distinfo]
b8a5bbb66da99a75902f1200c123987f7e75eca7d00ebd733b00af3ffebbcae8      7344556 cbsd-cbsd-14.2.1.tar.gz


[FILE:30537:manifests/plist.primary]
@sample cbsd/cbsd.conf.sample
@sample cbsd/etc/modules.conf.sample
@sample cbsd/etc/spice.conf.sample
%%ONLY-FREEBSD%%cbsd/misc/next-vale-port
%%ONLY-FREEBSD%%cbsd/tools/
 bridge
 racct-bhyve-statsd
 racct-hoster-statsd
 racct-jail-statsd
 vale-ctl
@(cbsd,cbsd,500) bin/cbsd
cbsd/
 ObsoleteFiles
 securecmd
cbsd/.ssh/config
cbsd/bhyvectl/
 bcheckpoint
 bchroot
 bcleanup
 bclone
 bconfig
 bconstruct-tui
 bcontrol-tui
 bcreate
 bdescr
 bdestroy
 bexec
 bexport
 bget
 bhyve-controller-tui
 bhyve-dsk-tui
 bhyve-nic-tui
 bhyve-nvme-tui
 bhyvecfg-passhtu-tui
 bimport
 bjail
 blogin
 bls
 bmigrate
 border
 border-tui
 bpause
 bpcibus
 brctl-tui
 bregister
 bremove
 brename
 brenice
 brestart
 bscp
 bset
 bsetup-tui
 bsnapshot
 bstart
 bstop
 bswmode
 bunregister
 bwhereis
cbsd/bin/
 cbsdsftp
 cbsdsftp6
 cbsdssh
 cbsdssh6
 cfetch
 rexe
cbsd/etc/Makefile
cbsd/etc/defaults/
 DragonFly-bases.conf
 DragonFly-kernel-GENERIC-x86_64-4.6
 DragonFly-kernel-GENERIC-x86_64-4.7
 DragonFly-kernel-GENERIC-x86_64-4.8
 DragonFly-srvbrowser.conf
 FreeBSD-base_in_pkg-13.2.conf
 FreeBSD-base_in_pkg-14.1.conf
 FreeBSD-base_in_pkg-15.0.conf
 FreeBSD-base_in_pkg.conf
 FreeBSD-bases.conf
 FreeBSD-baseupdate.conf
 FreeBSD-kernel-BHYVE-amd64-13.1
 FreeBSD-kernel-BHYVE-amd64-13.2
 FreeBSD-kernel-BHYVE-amd64-13.3
 FreeBSD-kernel-BHYVE-amd64-14.1
 FreeBSD-kernel-BHYVE-amd64-15.0
 FreeBSD-kernel-CBSD-amd64-13.2
 FreeBSD-kernel-CBSD-amd64-13.3
 FreeBSD-kernel-CBSD-amd64-14
 FreeBSD-kernel-CBSD-amd64-14.1
 FreeBSD-kernel-CBSD-amd64-14.2
 FreeBSD-kernel-CBSD-amd64-14.3
 FreeBSD-kernel-CBSD-amd64-15
 FreeBSD-kernel-CBSD-amd64-15.0
 FreeBSD-kernel-FIRE-amd64-14.1
 FreeBSD-kernel-FIRE-amd64-15
 FreeBSD-kernel-FIRE-amd64-15.0
 FreeBSD-kernel-GENERIC-amd64-13
 FreeBSD-kernel-GENERIC-amd64-13.1
 FreeBSD-kernel-GENERIC-amd64-13.2
 FreeBSD-kernel-GENERIC-amd64-13.3
 FreeBSD-kernel-GENERIC-amd64-14
 FreeBSD-kernel-GENERIC-amd64-14.1
 FreeBSD-kernel-GENERIC-amd64-14.2
 FreeBSD-kernel-GENERIC-amd64-15
 FreeBSD-kernel-GENERIC-amd64-15.0
 FreeBSD-kernel-GENERIC-arm64-13
 FreeBSD-kernel-GENERIC-arm64-13.1
 FreeBSD-kernel-GENERIC-arm64-14
 FreeBSD-kernel-GENERIC-arm64-14.1
 FreeBSD-kernel-GENERIC-arm64-14.2
 FreeBSD-kernel-GENERIC-arm64-15
 FreeBSD-kernel-GENERIC-arm64-15.0
 FreeBSD-kernel-GENERIC-riscv-13.1
 FreeBSD-kernel-GENERIC-riscv-14
 FreeBSD-kernel-GENERIC-riscv-14.1
 FreeBSD-kernel-GENERIC-riscv-14.2
 FreeBSD-kernels.conf
 FreeBSD-sources.conf
 FreeBSD-srvbrowser.conf
 FreeBSD-userlist.conf
 HardenedBSD-bases.conf
 Linux-bases.conf
 bclone.conf
 bexec.conf
 bhyve-default-default.conf
 blogin.conf
 bls.conf
 brctl.conf
 bscp.conf
 bstart.conf
 bstop.conf
 buildworld.conf
 cbsd-pf.conf
 cbsdfile.conf
 cbsdrsyncd.conf
 cloud-init.conf
 color-white.conf
 color.conf
 dhcpd.conf
 dhcpdv6.conf
 distcc.conf
 etcupdate.conf
 fetch.conf
 fetch_iso.conf
 forms_env.conf
 forms_export_vars.conf
 geli.conf
 get-profiles.conf
 global.conf
 helpers.conf
 initenv.conf
 jail-freebsd-cbsdpuppet.conf
 jail-freebsd-debian_bookworm.conf
 jail-freebsd-debian_bullseye.conf
 jail-freebsd-default.conf
 jail-freebsd-devuan_daedalus.conf
 jail-freebsd-puppet.conf
 jail-freebsd-rocky_8.conf
 jail-freebsd-rocky_9.conf
 jail-freebsd-trusted.conf
 jail-freebsd-ubuntu_jammy.conf
 jail-freebsd-vnet.conf
 jail2iso.conf
 jclone.conf
 jcreate.conf
 jexport.conf
 jlogin.conf
 jls.conf
 jrctl.conf
 logger.conf
 make-pxe.conf
 nlogin.conf
 node.conf
 pf.conf.tpl
 pkgbrowser.conf
 portsup.conf
 qemu-default-default.conf
 qexec.conf
 qlogin.conf
 qls.conf
 racct-bhyve-statsd.conf
 racct-hoster-statsd.conf
 racct-jail-statsd.conf
 rctl-defaults.conf
 rctl-litejail.conf
 rsyncd.conf
 spice.conf
 src-lite.conf
 src-make-DragonFly.conf
 src-make-FreeBSD.conf
 src-make-HardenedBSD.conf
 src-pxe.conf
 src.conf
 srcup-DragonFly.conf
 srcup-FreeBSD.conf
 srcup-HardenedBSD.conf
 srcup.conf
 task.conf
 upgrade.conf
 virtualbox-default-default.conf
 vls.conf
 vm-dflybsd-cloud-DragonflyBSD-hammer-x64-6.conf
 vm-dflybsd-x86-6.conf
 vm-freebsd-FreeBSD-aarch64-14.2.conf
 vm-freebsd-FreeBSD-bsdinstall-jail.conf
 vm-freebsd-FreeBSD-from-jail.conf
 vm-freebsd-FreeBSD-img-aarch64-14.2.conf
 vm-freebsd-FreeBSD-img-arm64-14.2.conf
 vm-freebsd-FreeBSD-riscv64-14.2.conf
 vm-freebsd-FreeBSD-x64-13.4.conf
 vm-freebsd-FreeBSD-x64-14.1.conf
 vm-freebsd-FreeBSD-x64-14.2.conf
 vm-freebsd-FreeBSD-x64-15.0-LATEST.conf
 vm-freebsd-GhostBSD-x64-24.conf
 vm-freebsd-HardenedBSD-x64-14-STABLE.conf
 vm-freebsd-MidnightBSD-x64-3.conf
 vm-freebsd-OPNsense-24-RELEASE-amd64.conf
 vm-freebsd-TrueNAS-CORE-x64-13.conf
 vm-freebsd-XigmaNAS-13.conf
 vm-freebsd-cloud-FreeBSD-ufs-x64-13.2.conf
 vm-freebsd-cloud-FreeBSD-ufs-x64-13.3.conf
 vm-freebsd-cloud-FreeBSD-ufs-x64-13.4.conf
 vm-freebsd-cloud-FreeBSD-ufs-x64-14.1.conf
 vm-freebsd-cloud-FreeBSD-ufs-x64-14.2.conf
 vm-freebsd-cloud-FreeBSD-ufs-x64-15.conf
 vm-freebsd-cloud-FreeBSD-zfs-x64-13.2.conf
 vm-freebsd-cloud-FreeBSD-zfs-x64-13.3.conf
 vm-freebsd-cloud-FreeBSD-zfs-x64-13.4.conf
 vm-freebsd-cloud-FreeBSD-zfs-x64-14.1.conf
 vm-freebsd-cloud-FreeBSD-zfs-x64-14.2.conf
 vm-freebsd-cloud-FreeBSD-zfs-x64-15.conf
 vm-freebsd-cloud-GhostBSD-zfs-x64-24.conf
 vm-freebsd-cloud-OPNSense-22-RELEASE-amd64-22.conf
 vm-freebsd-cloud-XigmaNAS-13-amd64.conf
 vm-freebsd-cloud-firestarter-ufs-x64-14.conf
 vm-freebsd-fio.conf
 vm-freebsd-helloSystem-x64.conf
 vm-freebsd-ravynOS-x64-24.conf
 vm-linux-AlmaLinux-9-x86_64.conf
 vm-linux-Alpine-extended-3.conf
 vm-linux-Alpine-standart-3.conf
 vm-linux-AltLinux-10.conf
 vm-linux-AltLinux-kworkstation-10.conf
 vm-linux-AltVirt-10.conf
 vm-linux-ArchLinux-x86-2024.conf
 vm-linux-Batocera.conf
 vm-linux-BlackBox-9-x86_64.conf
 vm-linux-BlissOS-x86.conf
 vm-linux-CentOS-stream-9-x86_64.conf
 vm-linux-ClearLinux-Server-x86_64.conf
 vm-linux-Debian-x86-11.conf
 vm-linux-Debian-x86-12.conf
 vm-linux-Devuan-x86-5.conf
 vm-linux-EuroLinux-9-x86_64.conf
 vm-linux-FreePBX-64bit-16.conf
 vm-linux-Gentoo-x86-2024.conf
 vm-linux-Kali-2024-amd64.conf
 vm-linux-Manjaro-x86-2024.conf
 vm-linux-Mint-22.conf
 vm-linux-NetBootXYZ.conf
 vm-linux-NixOS-24.conf
 vm-linux-OracleLinux-7.conf
 vm-linux-OracleLinux-8.conf
 vm-linux-OracleLinux-9.conf
 vm-linux-Parrot-security-6-x64.conf
 vm-linux-Proxmox-Backup-8.conf
 vm-linux-Rocky-8-x86_64.conf
 vm-linux-Rocky-9-x86_64.conf
 vm-linux-RouterOS-x86-7.conf
 vm-linux-Slackware-x86-15.conf
 vm-linux-Starface-8.conf
 vm-linux-Starface-9.conf
 vm-linux-Tails-6.conf
 vm-linux-TinyCore-x86-15.conf
 vm-linux-TrueNAS-Scale-24.conf
 vm-linux-VoidLinux-2024-x86_64.conf
 vm-linux-cloud-Alma-9-x86_64.conf
 vm-linux-cloud-Arch-x86-2022.conf
 vm-linux-cloud-CentOS-7-x86_64.conf
 vm-linux-cloud-CentOS-stream-9-x86_64.conf
 vm-linux-cloud-Debian-x86-10.conf
 vm-linux-cloud-Debian-x86-11.conf
 vm-linux-cloud-Debian-x86-12.conf
 vm-linux-cloud-Debian-x86-9.conf
 vm-linux-cloud-Devuan-x86-5.conf
 vm-linux-cloud-Euro-9-x86_64.conf
 vm-linux-cloud-Fedora-39-x86_64.conf
 vm-linux-cloud-Fedora-40-x86_64.conf
 vm-linux-cloud-Fedora-41-x86_64.conf
 vm-linux-cloud-FreePBX-16-x86_64.conf
 vm-linux-cloud-HomeAssistantOS-2024.conf
 vm-linux-cloud-Kali-2022-amd64.conf
 vm-linux-cloud-Kali-2024-amd64.conf
 vm-linux-cloud-Oracle-7-x86_64.conf
 vm-linux-cloud-Oracle-8-x86_64.conf
 vm-linux-cloud-Oracle-9-x86_64.conf
 vm-linux-cloud-Parrot-5-amd64.conf
 vm-linux-cloud-Rocky-9-x86_64.conf
 vm-linux-cloud-firestarter-debian-11.conf
 vm-linux-cloud-kubernetes-27.conf
 vm-linux-cloud-ubuntudesktop-amd64-22.04.conf
 vm-linux-cloud-ubuntudesktop-amd64-24.04.conf
 vm-linux-cloud-ubuntuserver-amd64-20.conf
 vm-linux-cloud-ubuntuserver-amd64-22.04.conf
 vm-linux-cloud-ubuntuserver-amd64-23.04.conf
 vm-linux-cloud-ubuntuserver-amd64-24.04.conf
 vm-linux-fedora-server-40-x86_64.conf
 vm-linux-fedora-server-41-x86_64.conf
 vm-linux-fedora-silverblue-40-x86_64.conf
 vm-linux-kubuntu-desktop-amd64-22.conf
 vm-linux-kubuntu-desktop-amd64-24.conf
 vm-linux-lubuntu-desktop-amd64-22.conf
 vm-linux-lubuntu-desktop-amd64-24.conf
 vm-linux-opensuse-leap-15-x86.conf
 vm-linux-opensuse-microos-2024.conf
 vm-linux-ubuntu-desktop-amd64-22.conf
 vm-linux-ubuntu-desktop-amd64-23.conf
 vm-linux-ubuntu-desktop-amd64-24.conf
 vm-linux-ubuntuserver-amd64-20.conf
 vm-linux-ubuntuserver-amd64-22.conf
 vm-linux-ubuntuserver-amd64-24.conf
 vm-linux-vyos-1.5.conf
 vm-netbsd-cloud-netbsd-x86-10.conf
 vm-netbsd-cloud-netbsd-x86-9.conf
 vm-netbsd-x86-10.conf
 vm-netbsd-x86-9.conf
 vm-openbsd-cloud-openbsd-x86-7.conf
 vm-openbsd-cloud-openbsd-x86-75.conf
 vm-openbsd-x86-7.conf
 vm-other-FreeDOS.conf
 vm-other-Haiku-r1.conf
 vm-other-Minoca.conf
 vm-other-OpenIndiana-2024.conf
 vm-other-ReactOS.conf
 vm-other-Redox-0.7.conf
 vm-other-SmartOS.conf
 vm-other-omnios-2025.conf
 vm-other-plan9front.conf
 vm-windows-10_86x_64x.conf
 vm-windows-11_86x_64x.conf
 vm-windows-7_86x_64x.conf
 vnc.conf
 xen-default-default.conf
 xlogin.conf
 xls.conf
 xstop.conf
 zfs.conf
cbsd/jailctl/
 j2prepare
 j2slave
 jailnic-tui
 jbackup
 jcleanup
 jclone
 jcoldmigrate
 jconfig
 jconstruct-tui
 jcontrol-tui
 jcreate
 jdescr
 jdestroy
 jexec
 jexport
 jget
 jimport
 jlogin
 jls
 jmkrcconf
 jmkrctlconf
 jorder
 jorder-tui
 jpause
 jrclone
 jrctl
 jrctl-tui
 jregister
 jremove
 jrename
 jrenice
 jrestart
 jscp
 jset
 jsetup-tui
 jsnapshot
 jstart
 jstatus
 jstop
 jswmode
 junregister
 jupgrade
 jwhereis
cbsd/man/
 cbsd-jconstruct-tui.8
 cbsd-jdescr.8
 cbsd-jlogin.8
 cbsd-jls.8
 cbsd.8
cbsd/misc/
 cbsd_dot
 cbsd_fwatch
 cbsd_md5
 cbsdlogtail
 cbsdsysrc
 cbsdtee
 chk_arp_byip
 cmdboot
 config_pkgrepo
 conv2human
 daemon
 detect-emulation
 disks-list
 dump_cpu_topology
 dump_iscsi_discovery
 elf_tables
 fmagic
 ipv6range
 mtree
 next-ng-port
 nics-list
 popcnttest
 pwcrypt
 resolv
 sipcalc
 sqlcli
 symlink_changer
 tmpfsdir
 updatesql
cbsd/modules/bsdconf.d/
 adduser
 adduser-tui
 bsdconf.subr
 cloudinit
 ftp
 grouplist
 metadata.conf
 passwd
 pw
 securecmd
 service
 ssh
 sysrc
 tzsetup
 userlist
cbsd/modules/bsdconf.d/cloud-master_prestart.d/cloud_init_set_netname.sh
cbsd/modules/bsdconf.d/cloud-tpl/centos7/
 10-network-config
 10-user-data
 20-network-config-interface
 20-user-data-root-lockpassword
 20-user-data-root-password
 20-user-data-user-lockpassword
 20-user-data-user-password
 30-network-config-dhcp4
 30-network-config-static
 30-user-data-chpasswd
 40-network-config
 40-user-data-chpasswd-root
 40-user-data-chpasswd-user
 50-user-data-chpasswd
 meta-data
cbsd/modules/bsdconf.d/cloud-tpl/centos7-auto/
 10-user-data
 20-user-data-root-lockpassword
 20-user-data-root-password
 20-user-data-user-lockpassword
 20-user-data-user-password
 30-user-data-chpasswd
 40-user-data-chpasswd-root
 40-user-data-chpasswd-user
 50-user-data-chpasswd
 meta-data
 network-config
cbsd/modules/bsdconf.d/cloud-tpl/centos9/
 10-network-config
 10-user-data
 20-network-config-interface
 20-user-data-root-lockpassword
 20-user-data-root-password
 20-user-data-user-lockpassword
 20-user-data-user-password
 30-network-config-dhcp4
 30-network-config-static
 30-user-data-chpasswd
 40-network-config
 40-user-data-chpasswd-root
 40-user-data-chpasswd-user
 50-user-data-chpasswd
 meta-data
cbsd/modules/bsdconf.d/cloud-tpl/fire-deb/
 10-network-config
 20-user-data-user-lockpassword
 20-user-data-user-password
 30-network-config-static
 50-resize
cbsd/modules/bsdconf.d/cloud-tpl/fire-fbsd/
 10-network-config
 20-user-data-user-lockpassword
 20-user-data-user-password
 30-network-config-static
 50-resize
cbsd/modules/bsdconf.d/cloud-tpl/homeass/
 30-network-config-dhcp4
 30-network-config-static
 README.md
cbsd/modules/bsdconf.d/cloud-tpl/openbsd/
 10-network-config
 10-user-data
 20-network-config-interface
 20-user-data-root-lockpassword
 20-user-data-root-password
 20-user-data-user-lockpassword
 20-user-data-user-password
 30-network-config-dhcp4
 30-network-config-static
 30-user-data-chpasswd
 40-network-config
 40-user-data-chpasswd-root
 40-user-data-chpasswd-user
 50-user-data-chpasswd
 meta-data
cbsd/modules/bsdconf.d/cloud-tpl/tiny-cloud/
 README.md
 meta-data
 user-data
 user-data-static
cbsd/modules/bsdconf.d/cloud-tpl/windows/
 meta_data.json
 meta_data.json-uid
 network_data.json
cbsd/modules/cbsd_queue.d/
 cbsd_queue
 metadata.conf
 securecmd
cbsd/modules/cbsd_queue.d/bin-sample/notify.sh
cbsd/modules/cbsd_queue.d/etc-sample/cbsd_queue.conf
cbsd/modules/cbsd_redis.d/securecmd
cbsd/modules/cbsd_redis.d/etc-sample/cbsd-ext.conf
cbsd/modules/cbsd_redis.d/extra/
 .optional
 default.css
 index.html
 push.php
cbsd/modules/forms.d/brctl/
 cbsdsys
 helpers.conf
 initforms.sh
cbsd/modules/forms.d/jrctl/
 cbsdsys
 helpers.conf
 initforms.sh
cbsd/modules/pkg.d/
 ObsoleteFiles
 metadata.conf
 pkg
 pkg.conf
 pkg.subr
 securecmd
cbsd/modules/pkg.d/etc-sample/pkg.conf
cbsd/modules/zfsinstall.d/
 metadata.conf
 securecmd
 zfsinstall
 zfsinstall.subr
cbsd/nodectl/
 ndescr
 nlogin
 node
 nodeaddkey
 nodescp
cbsd/qemuctl/
 qcleanup
 qconfig
 qconstruct-tui
 qcreate
 qdestroy
 qemu-dsk-tui
 qemu-nic-tui
 qexec
 qget
 qlogin
 qls
 qorder
 qremove
 qset
 qsetup-tui
 qstart
 qstop
 qwhereis
cbsd/rc.d/
 cbsd-statsd-bhyve
 cbsd-statsd-hoster
 cbsd-statsd-jail
 cbsdd
 cbsdrsyncd
 jails-astart
cbsd/release/
 generate-release.sh
 install.sh
 mkisoimages.sh
cbsd/sbin/netmask
cbsd/share/
 DragonFly-git_branches.conf
 FreeBSD-filebases_12.txt.xz
 FreeBSD-filebases_13.txt.xz
 FreeBSD-filebases_14.txt.xz
 FreeBSD-filebases_15.txt.xz
 FreeBSD-filemin_12.txt.xz
 FreeBSD-filemin_13.txt.xz
 FreeBSD-filemin_14.txt.xz
 FreeBSD-filemin_15.txt.xz
 FreeBSD-git_branches.conf
 FreeBSD-jail2iso-prunelist
 FreeBSD-microbhyve.txt.xz
 FreeBSD-microjail.txt.xz
 HardenedBSD-filebases_11.txt.xz
 HardenedBSD-git_branches.conf
 bhyve.conf
 bhyve_cpu_topology.conf
 bhyve_dskcontroller.conf
 bhyve_nvme.conf
 bhyve_p9shares.conf
 bhyve_pcibus.conf
 bhyve_settings.conf
 bhyve_soundhw.conf
 bhyvedsk.conf
 bhyvenic.conf
 bhyverun.sh
 carp.conf
 cbsd_carp.conf
 cbsdtaskd-taskd.schema
 devfs.rules.sample
 etcupdate_12.txt.xz
 etcupdate_13.txt.xz
 etcupdate_14.txt.xz
 etcupdate_15.txt.xz
 forms.schema
 forms_system.schema
 forms_yesno.schema
 images.conf
 initenv.conf
 jail-arg
 jail.jconf
 jrctl-arg
 local-authkey.schema
 local-bhyve-cpu_topology.schema
 local-bhyve-dskcontroller.schema
 local-bhyve-nvme.schema
 local-bhyve-p9shares.schema
 local-bhyve-pcibus.schema
 local-bhyve-settings.schema
 local-bhyve-soundhw.schema
 local-bhyve.schema
 local-bhyvedsk.schema
 local-bhyvenic.schema
 local-bhyveppt.schema
 local-bsdbase.schema
 local-bsdkernel.schema
 local-bsdsrc.schema
 local-carp.schema
 local-fwcounters.schema
 local-gw.schema
 local-images.schema
 local-jailnic.schema
 local-jails.schema
 local-local.schema
 local-net.schema
 local-qemu-pcibus.schema
 local-qemu-settings.schema
 local-qemu.schema
 local-qemudsk.schema
 local-qemunic.schema
 local-rctl.schema
 local-storage_media_map.schema
 local-storage_pools.schema
 local-unconfigured.schema
 local-vale.schema
 local-vale_ports.schema
 local-virtualbox.schema
 local-virtualboxdsk.schema
 local-virtualboxnic.schema
 local-vm_cpu_topology.schema
 local-vmpackages.schema
 local-vnetnic.schema
 local-vpc-peers.schema
 local-vpc.schema
 local-xen-settings.schema
 local-xen.schema
 local-xendsk.schema
 local-xennic.schema
 node-nodelist.schema
 qemu.conf
 qemu_pcibus.conf
 qemu_settings.conf
 qemudsk.conf
 qemunic.conf
 racct.schema
 rctl.conf
 storage_pools.conf
 system-expose.schema
 virtualbox.conf
 virtualboxdsk.conf
 virtualboxnic.conf
 vnetnic.conf
 vpc-peers.conf
 vpc-rc.tpl
 vpc.conf
 vpnet-vpnet.schema
 webdev-jails.schema
 webdev-jimages.schema
 webdev-modules.schema
 webdev-modules_groups.schema
 webdev-packages.schema
 webdev-pkg_groups_link.schema
 webdev-projects.schema
 webdev-virtual_private_net.schema
 xen.conf
 xen_settings.conf
 xendsk.conf
 xennic.conf
cbsd/share/DragonFly-jail-skel/etc/
 crontab
 group
 make.conf
 master.passwd
 motd
 passwd
 pwd.db
 rc.conf
 spwd.db
cbsd/share/DragonFly-jail-skel/etc/mail/
 aliases
 aliases.db
cbsd/share/DragonFly-jail-skel/root/
 .bashrc
 .cshrc
cbsd/share/FreeBSD-jail-puppet-skel/etc/
 crontab
 group
 login.conf
 login.conf.db
 make.conf
 master.passwd
 motd
 motd.template
 passwd
 pwd.db
 rc.conf
 spwd.db
cbsd/share/FreeBSD-jail-puppet-skel/etc/mail/
 aliases
 aliases.db
cbsd/share/FreeBSD-jail-puppet-skel/root/
 .bashrc
 .cshrc
cbsd/share/FreeBSD-jail-puppet-system-skel/master_create.d/puppet-apply
cbsd/share/FreeBSD-jail-puppet-system-skel/puppet/hieradata/common.yaml
cbsd/share/FreeBSD-jail-puppet-system-skel/puppet/manifest/init.pp
cbsd/share/FreeBSD-jail-skel/etc/
 crontab
 group
 login.conf
 login.conf.db
 make.conf
 master.passwd
 motd
 motd.template
 passwd
 pwd.db
 rc.conf
 spwd.db
cbsd/share/FreeBSD-jail-skel/etc/mail/
 aliases
 aliases.db
cbsd/share/FreeBSD-jail-skel/root/
 .bashrc
 .cshrc
cbsd/share/FreeBSD-jail-vnet-skel/etc/
 crontab
 group
 login.conf
 login.conf.db
 make.conf
 master.passwd
 motd
 motd.template
 passwd
 pwd.db
 rc.conf
 spwd.db
cbsd/share/FreeBSD-jail-vnet-skel/etc/mail/
 aliases
 aliases.db
cbsd/share/FreeBSD-jail-vnet-skel/root/
 .bashrc
 .cshrc
cbsd/share/Linux-jail-debian-bookworm-system-skel/fstab.local
cbsd/share/Linux-jail-debian-bookworm-system-skel/tests/00.check_distribution.sh
cbsd/share/Linux-jail-debian-bullseye-system-skel/fstab.local
cbsd/share/Linux-jail-debian-bullseye-system-skel/tests/00.check_distribution.sh
cbsd/share/Linux-jail-devuan-daedalus-system-skel/fstab.local
cbsd/share/Linux-jail-devuan-daedalus-system-skel/tests/00.check_distribution.sh
cbsd/share/Linux-jail-rocky-8-system-skel/fstab.local
cbsd/share/Linux-jail-rocky-8-system-skel/tests/00.check_distribution.sh
cbsd/share/Linux-jail-rocky-9-system-skel/fstab.local
cbsd/share/Linux-jail-rocky-9-system-skel/tests/00.check_distribution.sh
cbsd/share/Linux-jail-ubuntu-jammy-system-skel/fstab.local
cbsd/share/Linux-jail-ubuntu-jammy-system-skel/tests/00.check_distribution.sh
cbsd/share/autocompletion/bash/CBSDCompletion.bash
cbsd/share/autocompletion/zsh/_cbsd
cbsd/share/bhyve/
 bhyve-controller.subr
 bhyve-dsk.subr
 bhyve-nvme.subr
cbsd/share/bhyve-HomeAssistantOS-system-skel/etc/
 blogin.conf
 qlogin.conf
 xlogin.conf
cbsd/share/bsdconfig/
 common.subr
 dialog.subr
 mustberoot.subr
 strings.subr
 struct.subr
 sysrc.subr
 variable.subr
cbsd/share/bsdconfig/cbsd/
 INDEX
 Makefile
 USAGE
 basecfg
 bhyve-cfg-nvme
 bhyve-dskcontroller
 bhyve-new-nvme
 bhyve-newcontroller
 bhyve-nvme
 bhyvecfg
 bhyvedsk
 bhyvedsk-cfgcontroller
 bhyvedsk-cfgdsk
 bhyvedsk-newdsk
 bhyvenic
 bhyvenic-cfgnic
 bhyvenic-newnic
 cbsd
 jailcfg
 jailnic
 jailnic-cfgnic
 jailnic-newnic
 node
 node-add
 node-cfg
 qemudsk
 qemudsk-cfgdsk
 qemudsk-newdsk
 qemunic
 qemunic-cfgnic
 repo
 repo-bases
 repo-images
 repo-kernels
 xencfg
 xendsk
 xendsk-cfgdsk
 xendsk-newdsk
 xennic
cbsd/share/bsdconfig/cbsd/include/
 Makefile
 bhyvenic.subr
 jailnic.subr
 messages-bhyve-dskcontroller.subr
 messages-bhyve-nvme.subr
 messages-bhyvedsk.subr
 messages-bhyvenic.subr
 messages-jailnic.subr
 messages-nodecfg.subr
 messages-qemudsk.subr
 messages-qemunic.subr
 messages-repo.subr
 messages-xendsk.subr
 messages-xennic.subr
 messages.subr
 qemunic.subr
 xennic.subr
cbsd/share/emulators/
 ostype_bhyve.subr
 ostype_qemu.subr
 ostype_virtualbox.subr
 ostype_xen.subr
cbsd/share/examples/bhyve/
 bhyverun.sh
 iscsi.sh
cbsd/share/examples/cbsdfile/
 CBSDfile
 CBSDfile.memcached
 CBSDfile.redis
cbsd/share/examples/cloud-init/centos/
 meta-data
 network-config
 user-data
cbsd/share/examples/cloud-init/freebsd/
 meta-data
 network-config
 user-data
cbsd/share/examples/cloud-init/homeass/master_prestart.d/prestart.sh
cbsd/share/examples/cloud-init/master_prestart.d/cloud_init_set_netname.sh
cbsd/share/examples/cloud-init/netbsd/
 meta-data
 network-config
 user-data
cbsd/share/examples/cloud-init/ubuntu/
 meta-data
 network-config
 user-data
cbsd/share/examples/cloud-init/windows/
 meta_data.json
 network_data.json
cbsd/share/examples/dhcpd-pxe/dhcpd_extra.conf
cbsd/share/examples/dhcpd-pxe/docroot/install.ipxe
cbsd/share/examples/dhcpd-pxe/etc/dhcpd.conf
cbsd/share/examples/dhcpd-pxe/master_prestart.d/make_cbsd_dhcpd.sh
cbsd/share/examples/env_start/nfsv4/
 env_start_nfs.conf
 env_start_nfs.sh
cbsd/share/examples/jails-fstab/ntfs-3g.sh
cbsd/share/examples/nodes/add.d/addhost.sh
cbsd/share/examples/ovs/auto_configure_nic.sh
cbsd/share/examples/systemd/
 README.md
 cbsdd.service
cbsd/share/grafana/CBSD_Jail_cluster_v0.0.json
cbsd/share/helpers/not_empty.txt
cbsd/share/helpers/dhcpd/
 cbsd-dhcpd.conf
 dhcpd_fixed.tpl
 make_cbsd_dhcpd.sh
cbsd/share/libexec/bsdconfig/include/messages.subr
cbsd/share/qemu/qemu-dsk.subr
cbsd/share/xen/xen-dsk.subr
cbsd/subr/
 DragonFly.subr
 FreeBSD.subr
 HardenedBSD.subr
 Linux.subr
 ansiicolor.subr
 bhyve.subr
 bsdconfig.subr
 build.subr
 carp.subr
 cbsdbootstrap.subr
 cbsdfile.subr
 cbsdinit.subr
 dialog.subr
 distccache.subr
 emulator.subr
 env_register.subr
 fetch.subr
 forms.subr
 freebsd_world.subr
 hammer.subr
 imghelper.subr
 initenv.subr
 ipfw.subr
 jcreate.subr
 jfs.subr
 jrctl.subr
 jsetup-tui.subr
 jstart.subr
 mailtools.subr
 mdtools.subr
 multiple.subr
 nc.subr
 nodes.subr
 qemu.subr
 rcconf.subr
 rctl.subr
 rrcconf.subr
 settings-tui-bhyve.subr
 settings-tui-jail.subr
 settings-tui-qemu.subr
 settings-tui-virtual.subr
 settings-tui-xen.subr
 settings-tui.subr
 strings.subr
 sudoexec.subr
 system.subr
 time.subr
 tools.subr
 universe.subr
 up.subr
 vale.subr
 virtual.subr
 virtualbox.subr
 vnet.subr
 xen.subr
 zfs.subr
cbsd/sudoexec/
 bcreate
 bdestroy
 bexec
 bhyve-exist
 bremove
 bstart
 bstop
 cbsdchown
 initenv
 jcreate
 jdestroy
 jexec
 jgensecrets
 jlogin
 jregister
 jremove
 jrsyncconf
 jstart
 jstop
 junregister
 mkdatadir
 qcreate
 qdestroy
 qexec
 qremove
 qstart
 qstop
 secretsfile
 vpc
 vremove
 xcreate
 xdestroy
 xen-exist
 xremove
 xstart
 xstop
 zfs-recv
cbsd/system/
 buildkernel
 buildworld
 delete-old-libs
 distribution
 etcupdate
 install-pkg-world
 installkernel
 installworld
 kernel
 mkdistribution
 module
 packages
 portsup
 preparebase
 register_base
 register_kernel
 register_source
 removebase
 removekernel
 removeobj
 removesrc
 srcpatch
 srcup
 unregister_base
 unregister_kernel
 upgrade
 world
cbsd/tools/
 apply
 attachgeli
 attachzfs
 bases
 baseupdate
 bhyve-controller
 bhyve-controller-list
 bhyve-dsk
 bhyve-dsk-list
 bhyve-exist
 bhyve-nic
 bhyve-nic-list
 bhyve-nvme
 bhyve-nvme-list
 bhyve-p9shares
 bhyve-ppt
 bootmgmt
 bootmgmt-pxe
 buildah
 capabilities
 carpcfg
 carpcontrol
 cbsdchown
 cbsdd
 check_for_empty_hdd
 checkip
 checkrhost
 cluster
 copy-binlib
 cpu-topology
 cpuset
 destroy
 detachzfs
 dhcpd
 dhcpdv6
 disks-list
 distccmakeconf
 emulator
 expose
 fetch_iso
 find_free_cidr4
 forms
 freectr
 freejname
 fwcounters
 fwefi
 geli
 get-next-ng-port
 get-next-nic
 get-next-tcp-port
 get-next-vale-port
 get-profiles
 getinfo
 getip-by-nics
 getnics-by-ip
 help
 history
 images
 images-list
 imghelper
 imghelper-tui
 imgpart
 imgpart2
 imgremove
 imgtype
 initenv
 initenv-tui
 iscsi-discovery
 jail2iso
 jailmapdb
 jconstruct
 jgensecrets
 jrsyncconf
 kernels
 login
 make_tmp_helper
 makejconf
 makeresolv
 makescene
 media
 merge
 mkdatadir
 mkinventory
 mkjhosts
 mountfstab
 mountmd
 natcfg
 natcfg-tui
 natoff
 naton
 netinv
 nexttask
 nic_info
 nics-list
 objls
 path2jail
 pkgbrowsecat
 pkgbrowser
 pull
 rctlcounters
 replacewdir
 repo
 repo-tui
 retrinv
 rsyncdoff
 rsyncdon
 save-jail-info
 secretsfile
 select_jail
 show_profile_list
 sockstat
 sources
 sqlrep
 srvbrowser-tui
 sshkey
 status
 summary
 sysinv
 task
 taskls
 trafstat
 unmountfstab
 unmountmd
 up
 valecfg
 valecfg-tui
 vhidcfg
 vhidcfg-tui
 vm-cpu-topology
 vm-cpu-topology-tui
 vm-packages
 vm-packages-tui
 vpc
 xen-dsk
 xen-dsk-list
 xen-exist
 zfs-migrator
 zfs-recv
cbsd/upgrade/
 post-patch-11.0.6.0
 post-patch-13.1.23.0
 pre-patch-11.1.15.0
 pre-patch-11.1.17.0
 pre-patch-11.1.17.1
 pre-patch-11.1.19.0
 pre-patch-11.1.5.0
 pre-patch-11.1.7.0
 pre-patch-11.1.7.1
 pre-patch-11.1.8.0
 pre-patch-11.1.9.0
 pre-patch-11.2.1.0
 pre-patch-11.2.1.1
 pre-patch-11.2.1.2
 pre-patch-11.2.1.3
 pre-patch-11.2.1.4
 pre-patch-12.0.0.0
 pre-patch-12.0.0.1
 pre-patch-12.0.0.2
 pre-patch-12.0.0.3
 pre-patch-12.0.1.1
 pre-patch-12.0.11.0
 pre-patch-12.0.12.0
 pre-patch-12.0.12.1
 pre-patch-12.0.12.2
 pre-patch-12.0.12.3
 pre-patch-12.0.13.0
 pre-patch-12.0.13.1
 pre-patch-12.0.13.2
 pre-patch-12.0.14.0
 pre-patch-12.0.14.1
 pre-patch-12.0.14.2
 pre-patch-12.0.14.3
 pre-patch-12.0.14.4
 pre-patch-12.0.14.5
 pre-patch-12.0.14.6
 pre-patch-12.0.2.0
 pre-patch-12.0.3.0
 pre-patch-12.0.4.0
 pre-patch-12.0.4.1
 pre-patch-12.0.4.2
 pre-patch-12.0.4.3
 pre-patch-12.0.4.4
 pre-patch-12.0.4.5
 pre-patch-12.0.4.6
 pre-patch-12.0.4.7
 pre-patch-12.0.4.8
 pre-patch-12.0.5.0
 pre-patch-12.0.5.1
 pre-patch-12.0.6.0
 pre-patch-12.0.6.1
 pre-patch-12.1.10.0
 pre-patch-12.1.10.1
 pre-patch-12.1.10.2
 pre-patch-12.1.12.0
 pre-patch-12.1.16.0
 pre-patch-12.1.16.1
 pre-patch-12.1.3.0
 pre-patch-12.1.3.1
 pre-patch-12.1.4.0
 pre-patch-12.1.5.0
 pre-patch-12.1.5.1
 pre-patch-12.1.5.2
 pre-patch-12.1.9.1
 pre-patch-12.1.9.2
 pre-patch-13.0.11.0
 pre-patch-13.0.11.1
 pre-patch-13.0.11.2
 pre-patch-13.0.16.0
 pre-patch-13.0.19.0
 pre-patch-13.0.19.1
 pre-patch-13.0.2.0
 pre-patch-13.0.21.0
 pre-patch-13.0.21.1
 pre-patch-13.0.23.0
 pre-patch-13.0.24.0
 pre-patch-13.0.3.0
 pre-patch-13.0.3.1
 pre-patch-13.0.4.0
 pre-patch-13.0.5.0
 pre-patch-13.1.1.0
 pre-patch-13.2.2.0
 pre-patch-14.0.3.0
 pre-patch-14.0.8.1
 pre-patch-14.1.0.0
 pre-patch-14.1.1.0
 pre-patch-14.1.3.0
 pre-patch-14.1.3.1
 pre-patch-14.2.0.0
 pre-patch-14.2.0.1
cbsd/upgrade/backup_db/pre-initenv-backup
cbsd/upgrade/patch/
 BHYVE_UEFI_VARS.fd
 efi.fd
 efigop.fd
 efirefd.fd
 efirefn.fd
cbsd/upgrade/patch/bhyve-vesa-fb-13.0/patch-13x-usr.sbin-bhyve-pci_fbuf.c
cbsd/upgrade/patch/iov-13.0/
 README.md
 patch-usr-sbin-bhyve-block_if.h
 patch-usr-sbin-bhyve-virtio.c
cbsd/upgrade/patch/iov-14.0/
 README.md
 patch-usr-sbin-bhyve-block_if.h
 patch-usr-sbin-bhyve-virtio.c
cbsd/upgrade/patch/iov-15.0/
 README.md
 patch-usr-sbin-bhyve-block_if.h
 patch-usr-sbin-bhyve-virtio.c
cbsd/upgrade/patch/kmem-10.2/
 patch-11x-sys-dev-drm-drmP.h
 patch-11x-sys-dev-drm2-drm_os_freebsd.h
 patch-11x-sys-kern-kern_jail.c
 patch-11x-sys-sys-jail.h
 patch-11x-sys-sys-priv.h
cbsd/upgrade/patch/kmem-11.0/
 patch-11x-sys-dev-drm-drmP.h
 patch-11x-sys-dev-drm2-drm_os_freebsd.h
 patch-11x-sys-kern-kern_jail.c
 patch-11x-sys-sys-jail.h
 patch-11x-sys-sys-priv.h
cbsd/upgrade/patch/kmem-11.1/
 patch-11x-sys-dev-drm-drmP.h
 patch-11x-sys-dev-drm2-drm_os_freebsd.h
 patch-11x-sys-kern-kern_jail.c
 patch-11x-sys-sys-jail.h
 patch-11x-sys-sys-priv.h
cbsd/upgrade/patch/kmem-12.0/
 patch-11x-sys-dev-drm-drmP.h
 patch-11x-sys-dev-drm-drm_os_freebsd.h
 patch-11x-sys-dev-drm2-drm_os_freebsd.h
 patch-11x-sys-kern-kern_jail.c
 patch-11x-sys-sys-jail.h
 patch-11x-sys-sys-priv.h
cbsd/upgrade/patch/lro-13.0/patch-usr-sbin-bhyve-net_backends.c
cbsd/upgrade/patch/lro-14.0/patch-usr-sbin-bhyve-net_backends.c
cbsd/upgrade/patch/lro-15.0/patch-usr-sbin-bhyve-net_backends.c
cbsd/upgrade/patch/p9-12.0/
 patch-12x-etc-mtree-BSD.include.dist
 patch-12x-lib-Makefile
 patch-12x-lib-lib9p-Makefile
 patch-12x-share-mk-bsd.libnames.mk
 patch-12x-share-mk-src.libnames.mk
 patch-12x-usr.sbin-bhyve-Makefile
 patch-12x-usr.sbin-bhyve-pci_virtio_9p.c
 patch-12x-usr.sbin-bhyve-virtio.h
cbsd/upgrade/patch/p9-13.0/
 patch-13x-etc-mtree-BSD.include.dist
 patch-13x-lib-Makefile
 patch-13x-lib-lib9p-Makefile
 patch-13x-share-mk-bsd.libnames.mk
 patch-13x-share-mk-src.libnames.mk
 patch-13x-usr.sbin-bhyve-Makefile
 patch-13x-usr.sbin-bhyve-pci_virtio_9p.c
 patch-13x-usr.sbin-bhyve-virtio.h
cbsd/upgrade/patch/vxlan-13.0/patch-sys-net-if_vxlan.c
cbsd/upgrade/patch/vxlan-14.0/patch-sys-net-if_vxlan.c
cbsd/upgrade/patch/vxlan-15.0/patch-sys-net-if_vxlan.c
cbsd/vboxctl/
 vconfig
 vconstruct-tui
 vcontrol-tui
 vcreate
 vls
 vremove
 vset
 vsetup-tui
 vstart
 vstop
cbsd/xenctl/
 xcheckpoint
 xconfig
 xconstruct-tui
 xcreate
 xdestroy
 xen-dsk-tui
 xen-nic-tui
 xget
 xlogin
 xls
 xmigrate
 xorder
 xregister
 xremove
 xset
 xsetup-tui
 xstart
 xstop
 xunregister
 xwhereis
libexec/bsdconfig/cbsd
@dir cbsd/share/bhyve-system-default/create.d
@dir cbsd/share/bhyve-system-default/facts.d
@dir cbsd/share/bhyve-system-default/master_create.d
@dir cbsd/share/bhyve-system-default/master_poststart.d
@dir cbsd/share/bhyve-system-default/master_poststop.d
@dir cbsd/share/bhyve-system-default/master_prestart.d
@dir cbsd/share/bhyve-system-default/master_prestop.d
@dir cbsd/share/bhyve-system-default/master_reboot.d
@dir cbsd/share/bhyve-system-default/remove.d
@dir cbsd/share/bhyve-system-default/start.d
@dir cbsd/share/bhyve-system-default/stop.d
@dir cbsd/share/jail-system-default/clone-local.d
@dir cbsd/share/jail-system-default/clone.d
@dir cbsd/share/jail-system-default/create.d
@dir cbsd/share/jail-system-default/facts.d
@dir cbsd/share/jail-system-default/master_create.d
@dir cbsd/share/jail-system-default/master_poststart.d
@dir cbsd/share/jail-system-default/master_poststop.d
@dir cbsd/share/jail-system-default/master_prestart.d
@dir cbsd/share/jail-system-default/master_prestop.d
@dir cbsd/share/jail-system-default/remove.d
@dir cbsd/share/jail-system-default/rename.d
@dir cbsd/share/jail-system-default/start.d
@dir cbsd/share/jail-system-default/stop.d
@dir cbsd/share/qemu-system-default/create.d
@dir cbsd/share/qemu-system-default/facts.d
@dir cbsd/share/qemu-system-default/master_create.d
@dir cbsd/share/qemu-system-default/master_poststart.d
@dir cbsd/share/qemu-system-default/master_poststop.d
@dir cbsd/share/qemu-system-default/master_prestart.d
@dir cbsd/share/qemu-system-default/master_prestop.d
@dir cbsd/share/qemu-system-default/master_reboot.d
@dir cbsd/share/qemu-system-default/remove.d
@dir cbsd/share/qemu-system-default/start.d
@dir cbsd/share/qemu-system-default/stop.d
@dir cbsd/share/xen-system-default/create.d
@dir cbsd/share/xen-system-default/facts.d
@dir cbsd/share/xen-system-default/master_create.d
@dir cbsd/share/xen-system-default/master_poststart.d
@dir cbsd/share/xen-system-default/master_poststop.d
@dir cbsd/share/xen-system-default/master_prestart.d
@dir cbsd/share/xen-system-default/master_prestop.d
@dir cbsd/share/xen-system-default/master_reboot.d
@dir cbsd/share/xen-system-default/remove.d
@dir cbsd/share/xen-system-default/start.d
@dir cbsd/share/xen-system-default/stop.d


[FILE:22:manifests/plist.man]
share/man/man8/cbsd.8


[FILE:1931:manifests/plist.docs]
cbsd/share/docs/README.md
cbsd/share/docs/bhyve/
 bhyve.md
 wf_bcheckpoint_ssi.md
 wf_bclone_ssi.md
 wf_bconfig_ssi.md
 wf_bcpu_topology_ssi.md
 wf_bcreate_ssi.md
 wf_bexit_behavior_ssi.md
 wf_bexport_ssi.md
 wf_bhyve_cloudinit_ssi.md
 wf_bhyve_gdb_ssi.md
 wf_bhyve_p9_ssi.md
 wf_bhyvenetwork_ssi.md
 wf_bhyveppt_ssi.md
 wf_bimport_ssi.md
 wf_blogin_ssi.md
 wf_bls_ssi.md
 wf_bmigration_ssi.md
 wf_bremove_ssi.md
 wf_brename_ssi.md
 wf_bstop_bstart_ssi.md
 wf_bstorage_ssi.md
 wf_bvnc_ssi.md
cbsd/share/docs/general/
 broker_driven_sample.md
 cbsd_additional.md
 cbsd_api.md
 cbsd_config.md
 cbsd_fetch.md
 cbsd_geli.md
 cbsd_gui.md
 cbsd_help.md
 cbsd_nat.md
 cbsd_oci.md
 cbsd_quickstart.md
 cbsd_taskd.md
 cbsd_upgrading.md
 cbsdfile.md
 cmdsyntax_cbsd.md
 custom_freecbsd.md
 initenv.md
 pkg.d_ssi.md
 racct_exports.md
 syslog.md
 wf_cbsd_variables_ssi.md
 wf_expose_ssi.md
 wf_imghelper_ssi.md
 wf_ipam.md
 wf_monit_ssi.md
 wf_puppet_ssi.md
 wf_repo_ssi.md
 wf_script_mass_man_ssi.md
 wf_vpc_ssi.md
cbsd/share/docs/jail/
 base_cbsd.md
 bsdconf.d_ssi.md
 cbsd_jail_quickstart.md
 cbsd_linux_jails.md
 cbsd_rcconf.md
 cbsd_vnet.md
 csync2.d_ssi.md
 ezjail2cbsd_ssi.md
 wf_etcupdate_ssi.md
 wf_jail2iso_ssi.md
 wf_jailscp_ssi.md
 wf_jailtraffic_ssi.md
 wf_jbackup_ssi.md
 wf_jclone_ssi.md
 wf_jcoldmigrate_ssi.md
 wf_jconfig_ssi.md
 wf_jcreate_secondary_ssi.md
 wf_jcreate_ssi.md
 wf_jdescr_ssi.md
 wf_jexec_ssi.md
 wf_jexport_ssi.md
 wf_jget_ssi.md
 wf_jimport_ssi.md
 wf_jlocate_ssi.md
 wf_jlogin_ssi.md
 wf_jls_ssi.md
 wf_jorder_ssi.md
 wf_jrctl_ssi.md
 wf_jremove_ssi.md
 wf_jrename_ssi.md
 wf_jsnapshot_ssi.md
 wf_jstop_jstart_ssi.md
 wf_jupgrade_ssi.md
cbsd/share/docs/node/
 wf_nlogin_ssi.md
 wf_node_add_ssi.md
 wf_node_del_ssi.md
 wf_node_list_ssi.md
 wf_node_overview_ssi.md
 wf_node_rexe_ssi.md
cbsd/share/docs/qemu/
 cbsd_qemu_quickstart.md
 cbsd_qemu_usermode.md
cbsd/share/docs/xen/
 cbsd_xen_quickstart.md
 xen.md


[FILE:267:patches/patch-bin_cbsdsh_jail.c]
--- bin/cbsdsh/jail.c.orig	2024-12-04 15:05:40 UTC
+++ bin/cbsdsh/jail.c
@@ -1,7 +1,7 @@
 #include <sys/param.h>
 #include <sys/jail.h>
 
-#ifdef __DragonFly__
+#if defined(__DragonFly__) || defined(__MidnightBSD__)
 
 #include <sys/types.h>
 #include <sys/sysctl.h>


[FILE:378:patches/patch-bin_cbsdsh_myhistedit.h]
--- bin/cbsdsh/myhistedit.h.orig	2024-12-04 15:05:40 UTC
+++ bin/cbsdsh/myhistedit.h
@@ -32,15 +32,7 @@
  * $FreeBSD: head/bin/sh/myhistedit.h 326025 2017-11-20 19:49:47Z pfg $
  */
 
-#ifdef CBSD
-#ifdef __DragonFly__
 #include <histedit.h>
-#else
-#include "/usr/include/histedit.h"
-#endif
-#else
-#include <histedit.h>
-#endif
 
 extern History *hist;
 extern EditLine *el;


[FILE:2289:files/CM.txt]
cmake_minimum_required(VERSION 3.16)
project(cbsd)

SET(CMAKE_SKIP_BUILD_RPATH TRUE)
add_subdirectory(misc)
add_subdirectory(bin)
add_subdirectory(sbin)
add_subdirectory(tools)

install(DIRECTORY bhyvectl DESTINATION cbsd USE_SOURCE_PERMISSIONS FILES_MATCHING PATTERN "b*")
install(DIRECTORY jailctl DESTINATION cbsd USE_SOURCE_PERMISSIONS FILES_MATCHING PATTERN "j*")
install(DIRECTORY nodectl DESTINATION cbsd USE_SOURCE_PERMISSIONS FILES_MATCHING PATTERN "n*")
install(DIRECTORY qemuctl DESTINATION cbsd USE_SOURCE_PERMISSIONS FILES_MATCHING PATTERN "q*")
install(DIRECTORY vboxctl DESTINATION cbsd USE_SOURCE_PERMISSIONS FILES_MATCHING PATTERN "v*")
install(DIRECTORY xenctl DESTINATION cbsd USE_SOURCE_PERMISSIONS FILES_MATCHING PATTERN "x*")
install(DIRECTORY .ssh DESTINATION cbsd USE_SOURCE_PERMISSIONS)
install(DIRECTORY rc.d DESTINATION cbsd USE_SOURCE_PERMISSIONS)
install(DIRECTORY subr DESTINATION cbsd USE_SOURCE_PERMISSIONS)
install(DIRECTORY sudoexec DESTINATION cbsd USE_SOURCE_PERMISSIONS)
install(DIRECTORY system DESTINATION cbsd USE_SOURCE_PERMISSIONS)
install(DIRECTORY release DESTINATION cbsd USE_SOURCE_PERMISSIONS)
install(DIRECTORY upgrade DESTINATION cbsd USE_SOURCE_PERMISSIONS)
install(DIRECTORY man DESTINATION cbsd USE_SOURCE_PERMISSIONS FILES_MATCHING PATTERN "*.[12345678]")
install(DIRECTORY etc/defaults DESTINATION cbsd/etc USE_SOURCE_PERMISSIONS)
install(DIRECTORY modules/
  DESTINATION cbsd/modules
  USE_SOURCE_PERMISSIONS
  PATTERN ".gitignore" EXCLUDE
  PATTERN "placeholder" EXCLUDE
)
install(DIRECTORY share/
  DESTINATION cbsd/share
  USE_SOURCE_PERMISSIONS
  PATTERN "placeholder" EXCLUDE
)
install(DIRECTORY tools/
  DESTINATION cbsd/tools
  USE_SOURCE_PERMISSIONS
  PATTERN "src" EXCLUDE
  PATTERN "CMakeLists.txt" EXCLUDE
)
install(DIRECTORY misc/
  DESTINATION cbsd/misc
  USE_SOURCE_PERMISSIONS
  PATTERN "src" EXCLUDE
  PATTERN "CMakeLists.txt" EXCLUDE
)

install(FILES man/cbsd.8 DESTINATION share/man/man8)
install(FILES securecmd ObsoleteFiles DESTINATION cbsd)
install(FILES cbsd.conf DESTINATION cbsd RENAME cbsd.conf.sample)
install(FILES etc/modules.conf DESTINATION cbsd/etc RENAME modules.conf.sample)
install(FILES etc/spice.conf DESTINATION cbsd/etc RENAME spice.conf.sample)
install(FILES etc/Makefile DESTINATION cbsd/etc)


[FILE:851:files/CM_bin.txt]
add_subdirectory(tool_mknodes)
add_subdirectory(tool_mksyntax)
add_subdirectory(cbsdsh)

set (prog1 cbsdsftp)
set (prog2 cbsdsftp6)
set (prog3 cbsdssh)
set (prog4 cbsdssh6)
set (prog5 cfetch)

set (srcs1 src/cbsdsftp.c)
set (srcs2 src/cbsdsftp6.c)
set (srcs3 src/cbsdssh.c)
set (srcs4 src/cbsdssh6.c)
set (srcs5 src/cfetch.c)

add_executable(${prog1} ${srcs1})
add_executable(${prog2} ${srcs2})
add_executable(${prog3} ${srcs3})
add_executable(${prog4} ${srcs4})
add_executable(${prog5} ${srcs5})

target_link_libraries (${prog1} -lssh2)
target_link_libraries (${prog2} -lssh2)
target_link_libraries (${prog3} -lssh2)
target_link_libraries (${prog4} -lssh2)
target_link_libraries (${prog5} -lcurl -lssl -lcrypto)

install(TARGETS
    ${prog1} ${prog2} ${prog3} ${prog4} ${prog5}
    DESTINATION cbsd/bin
)

install(PROGRAMS rexe DESTINATION cbsd/bin)


[FILE:2547:files/CM_bin_cbsdsh.txt]
set (prog cbsd)

set (genhdrs builtins.h nodes.h syntax.h token.h)
set (gensrcs builtins.c nodes.c syntax.c)

set (srcs
    ${genhdrs} ${gensrcs}
    about.c alias.c arith_yacc.c arith_yylex.c cbsdhistory.c cbsd_fwatch.c
    cbsd_pwait.c cd.c error.c eval.c exec.c expand.c histedit.c input.c
    jobs.c logger.c main.c memalloc.c miscbltin.c mystring.c options.c
    output.c parser.c redir.c show.c sqlcmd.c spawn_task.c trap.c var.c jail.c
    bltin/echo.c
    kill/kill.c
    printf/printf.c
    test/test.c
)

set (libs -ledit -lm -pthread -lsqlite3 -lm)
if (CMAKE_SYSTEM_NAME MATCHES "FreeBSD")
   set (libs -ljail ${libs})
endif()

set_source_files_properties(${genhdrs} PROPERTIES GENERATED true)
set_source_files_properties(${gensrcs} PROPERTIES GENERATED true)
set_source_files_properties(builtins.def.o PROPERTIES GENERATED true)

add_custom_command(
	OUTPUT ${CMAKE_CURRENT_BINARY_DIR}/token.h 
	DEPENDS ${CMAKE_CURRENT_SOURCE_DIR}/mktokens
	COMMAND /bin/sh ${CMAKE_CURRENT_SOURCE_DIR}/mktokens-cbsd
)

add_custom_command(
	OUTPUT ${CMAKE_CURRENT_BINARY_DIR}/syntax.h 
               ${CMAKE_CURRENT_BINARY_DIR}/syntax.c
	DEPENDS ${CMAKE_BINARY_DIR}/bin/tool_mksyntax/mksyntax
	COMMAND ${CMAKE_BINARY_DIR}/bin/tool_mksyntax/mksyntax
)

add_custom_command(
	OUTPUT ${CMAKE_CURRENT_BINARY_DIR}/nodes.h 
               ${CMAKE_CURRENT_BINARY_DIR}/nodes.c
	DEPENDS ${CMAKE_BINARY_DIR}/bin/tool_mknodes/mknodes
                ${CMAKE_CURRENT_SOURCE_DIR}/nodetypes
                ${CMAKE_CURRENT_SOURCE_DIR}/nodes.c.pat
	COMMAND ${CMAKE_BINARY_DIR}/bin/tool_mknodes/mknodes
                ${CMAKE_CURRENT_SOURCE_DIR}/nodetypes
                ${CMAKE_CURRENT_SOURCE_DIR}/nodes.c.pat
)

add_custom_command(
	OUTPUT ${CMAKE_CURRENT_BINARY_DIR}/builtins.h 
               ${CMAKE_CURRENT_BINARY_DIR}/builtins.c
	DEPENDS ${CMAKE_CURRENT_SOURCE_DIR}/mkbuiltins
                ${CMAKE_CURRENT_SOURCE_DIR}/builtins.def.o
	COMMAND /bin/sh ${CMAKE_CURRENT_SOURCE_DIR}/mkbuiltins
		${CMAKE_CURRENT_SOURCE_DIR}
)

add_custom_command(
	OUTPUT ${CMAKE_CURRENT_SOURCE_DIR}/builtins.def.o
	DEPENDS ${CMAKE_CURRENT_SOURCE_DIR}/builtins.def
	COMMAND /bin/cp 
		${CMAKE_CURRENT_SOURCE_DIR}/builtins.def
		${CMAKE_CURRENT_SOURCE_DIR}/builtins.def.o
)

add_executable(${prog} ${srcs})
target_compile_definitions(${prog} PUBLIC CBSD SHELL)
target_include_directories(${prog} PUBLIC
	${CMAKE_CURRENT_BINARY_DIR}
	${CMAKE_CURRENT_SOURCE_DIR}
	${CMAKE_CURRENT_SOURCE_DIR}/bltin
)
target_link_libraries(${prog} ${libs})

install(TARGETS ${prog} DESTINATION bin)


[FILE:82:files/CM_bin_mknodes.txt]
set (prog mknodes)
set (srcs ../cbsdsh/mknodes.c)
add_executable(${prog} ${srcs})


[FILE:137:files/CM_bin_mksyntax.txt]
set (prog mksyntax)
set (srcs ../cbsdsh/mksyntax.c)
add_executable(${prog} ${srcs})
target_include_directories(${prog} PUBLIC ../cbsdsh)


[FILE:2826:files/CM_misc.txt]
set (prog1 dump_cpu_topology)
set (prog2 dump_iscsi_discovery)
set (prog3 sipcalc)
set (prog4 cbsd_dot)
set (prog5 daemon)
set (prog6 resolv)
set (prog7 ipv6range)
set (prog8 popcnttest)
set (prog10 cbsdlogtail)
set (prog11 cbsdtee)
set (prog12 cbsd_fwatch)
set (prog13 chk_arp_byip)
set (prog14 conv2human)
set (prog15 elf_tables)
set (prog16 fmagic)
set (prog17 pwcrypt)
set (prog18 sqlcli)
set (prog19 cbsd_md5)

set (fbsd1 next-vale-port)

set (srcs1
   src/dump_cpu_topology.c
   ../lib/simplexml/simplexml.c
)

set (srcs2
   src/dump_iscsi_discovery.c
   ../lib/simplexml/simplexml.c
)

set (srcs3
   src/sipcalc/sub-func.c
   src/sipcalc/interface.c
   src/sipcalc/sipcalc.c
   src/sipcalc/sub-output.c
)

set (srcs4 src/cbsd_dot.c)
set (srcs5 src/daemon.c)
set (srcs6 src/resolv.c)
set (srcs7 src/ipv6range.c)
set (srcs8 src/popcnttest.c)
set (srcs10 src/cbsdlogtail.c)
set (srcs11 src/cbsdtee.c)
set (srcs12 src/cbsd_fwatch.c)
set (srcs13 src/chk_arp_byip.c)
set (srcs14 src/conv2human.c)
set (srcs15 src/elf_tables.c)
set (srcs16 src/fmagic.c)
set (srcs17 src/pwcrypt.c)
set (srcs18 src/sqlcli.c)

set (srcs19
  src/cbsd_md5/md5.c
  src/cbsd_md5/main.c
)

set (freesrcs1 src/next-vale-port.c)

add_executable(${prog1} ${srcs1})
add_executable(${prog2} ${srcs2})
add_executable(${prog3} ${srcs3})
add_executable(${prog4} ${srcs4})
add_executable(${prog5} ${srcs5})
add_executable(${prog6} ${srcs6})
add_executable(${prog7} ${srcs7})
add_executable(${prog10} ${srcs10})
add_executable(${prog11} ${srcs11})
add_executable(${prog12} ${srcs12})
add_executable(${prog13} ${srcs13})
add_executable(${prog14} ${srcs14})
add_executable(${prog15} ${srcs15})
add_executable(${prog16} ${srcs16})
add_executable(${prog17} ${srcs17})
add_executable(${prog18} ${srcs18})
add_executable(${prog19} ${srcs19})

target_include_directories(${prog1} PUBLIC
    ${CMAKE_SOURCE_DIR}/lib/simplexml
)

target_include_directories(${prog2} PUBLIC
    ${CMAKE_SOURCE_DIR}/lib/simplexml
)

target_link_libraries (${prog5} -lutil)
target_link_libraries (${prog14} -lelf_pic -lutil)
target_link_libraries (${prog15} -lelf_pic)
target_link_libraries (${prog16} -lmagic)
target_link_libraries (${prog17} -lcrypt)
target_link_libraries (${prog18} -lsqlite3)

install(TARGETS
    ${prog1} ${prog2} ${prog3} ${prog4}
    ${prog5} ${prog6} ${prog7}
    ${prog10} ${prog11} ${prog12} ${prog13}
    ${prog14} ${prog15} ${prog16} ${prog17}
    ${prog18} ${prog19}
    DESTINATION cbsd/misc
)

if (CMAKE_SYSTEM_NAME MATCHES "FreeBSD")
add_executable(${fbsd1} ${freesrcs1})
install(TARGETS ${fbsd1} DESTINATION cbsd/misc)
endif()

if (${CMAKE_SYSTEM_PROCESSOR} MATCHES "x86_64|AMD64|amd64|i386")
add_executable(${prog8} ${srcs8})
set_source_files_properties(${srcs8} PROPERTIES COMPILE_FLAGS -msse4.2)
install(TARGETS ${prog8} DESTINATION cbsd/misc)
endif()


[FILE:128:files/CM_sbin.txt]
set (prog1 netmask)
set (srcs1 src/netmask.c)
add_executable(${prog1} ${srcs1})
install(TARGETS ${prog1} DESTINATION cbsd/sbin)


[FILE:1610:files/CM_tools.txt]
set (prog1 imghelper)
set (prog2 nic_info)
set (prog3 select_jail)
set (fbsd1 vale-ctl)
set (fbsd2 bridge)
set (fbsd3 racct-jail-statsd)
set (fbsd4 racct-bhyve-statsd)
set (fbsd5 racct-hoster-statsd)

set (srcs1 src/imghelper.c)
set (srcs2 src/nic_info.c)
set (srcs3 src/select_jail.c)

set (freesrcs1 src/vale-ctl.c)
set (freesrcs2 src/bridge.c)
set (freesrcs3
   src/racct-jail-statsd.c
   ../lib/beanstalk-client/beanstalk.c
)
set (freesrcs4
   src/racct-bhyve-statsd.c
   ../lib/beanstalk-client/beanstalk.c
)
set (freesrcs5
   src/racct-hoster-statsd.c 
   ../lib/beanstalk-client/beanstalk.c
)

add_executable(${prog1} ${srcs1})
add_executable(${prog2} ${srcs2})
add_executable(${prog3} ${srcs3})

install(TARGETS ${prog1} ${prog2} ${prog3} DESTINATION cbsd/tools)

if (CMAKE_SYSTEM_NAME MATCHES "FreeBSD")
add_executable(${fbsd1} ${freesrcs1})
add_executable(${fbsd2} ${freesrcs2})
add_executable(${fbsd3} ${freesrcs3})
add_executable(${fbsd4} ${freesrcs4})
add_executable(${fbsd5} ${freesrcs5})

target_include_directories(${fbsd3} PUBLIC
    ${CMAKE_SOURCE_DIR}/lib/beanstalk-client
)
target_include_directories(${fbsd4} PUBLIC
    ${CMAKE_SOURCE_DIR}/lib/beanstalk-client
)
target_include_directories(${fbsd5} PUBLIC
    ${CMAKE_SOURCE_DIR}/lib/beanstalk-client
)

target_link_libraries (${fbsd3} -lutil -lpthread -lprocstat -ljail -lsqlite3)
target_link_libraries (${fbsd4} -lutil -lpthread -lprocstat -ljail -lsqlite3)
target_link_libraries (${fbsd5} -lutil -lpthread -lprocstat -ljail -lsqlite3)

install(TARGETS
   ${fbsd1} ${fbsd2} ${fbsd3} ${fbsd4} ${fbsd5}
   DESTINATION cbsd/tools
)
endif()


[FILE:2020:files/cbsd-statsd-bhyve.in]
#!/bin/sh
#
# PROVIDE: cbsd_statsd_bhyve
# REQUIRE: LOGIN FILESYSTEMS sshd
# KEYWORD: shutdown
#
# cbsd_statsd_bhyve_enable="YES"
#

. /etc/rc.subr

name=cbsd_statsd_bhyve
rcvar=cbsd_statsd_bhyve_enable
load_rc_config $name

# Set defaults
: ${cbsd_statsd_bhyve_enable:="NO"}

export workdir="${cbsd_workdir}"
globalconf=${cbsd_globalconf:-"%%PREFIX%%/cbsd/cbsd.conf"}

start_cmd=${name}_start
restart_cmd=${name}_restart
extra_commands="restart"

command="%%PREFIX%%/cbsd/tools/racct-bhyve-statsd"
pidfile="/var/run/$name.pid"
command_args="&"

pidfile=/var/run/racct-bhyve-statsd.pid

if [ ! -f ${globalconf} ]; then
	echo "cbsd: no such ${globalconf}";
	exit 1
fi

if [ ! -f ${subr} ]; then
	echo "cbsd: no such ${subr}";
	exit 1
fi

. ${globalconf}
. ${subr}

cbsd_statsd_bhyve_start()
{
	local args= racct_enabled=

	# RACCT enabled?
	racct_enabled=$( /sbin/sysctl -qn kern.racct.enable )
	[ $? -ne 0 ] && err 1 "cbsd-statsd-bhyve: RACCT not enabled"
	[ "${racct_enabled}" != "1" ] && err 1 "cbsd-statsd-bhyve: RACCT not enabled"

	readconf racct-bhyve-statsd.conf
	[ -n "${log_file}" ] && args="${args} --log_file=${log_file}"
	[ -n "${log_level}" ] && args="${args} --log_level=${log_level}"
	[ -n "${loop_interval}" ] && args="${args} --loop_interval=${loop_interval}"
	[ -n "${save_loop_count}" ] && args="${args} --save_loop_count=${save_loop_count}"

	case "${prometheus_exporter_enable}" in
		[Yy][Ee][Ss])
			args="${args} --prometheus_exporter=1"
			;;
		[No][Oo])
			args="${args} --prometheus_exporter=0"
			;;
	esac

	case "${beanstald_enable}" in
		[Yy][Ee][Ss])
			args="${args} --save_beanstalkd=1"
			;;
		[No][Oo])
			args="${args} --save_beanstalkd=0"
			;;
	esac

	case "${sqlite3_enable}" in
		[Yy][Ee][Ss])
			args="${args} --save_sqlite=1"
			;;
		[No][Oo])
			args="${args} --save_sqlite=0"
			;;
	esac

	exec env workdir=${cbsd_workdir} %%PREFIX%%/cbsd/tools/racct-bhyve-statsd ${args}
}

cbsd_statsd_bhyve_restart()
{
	cbsd_statsd_bhyve_stop
	cbsd_statsd_bhyve_start
}

run_rc_command "$1"


[FILE:2035:files/cbsd-statsd-hoster.in]
#!/bin/sh
#
# PROVIDE: cbsd_statsd_hoster
# REQUIRE: LOGIN FILESYSTEMS sshd
# KEYWORD: shutdown
#
# cbsd_statsd_hoster_enable="YES"
#

. /etc/rc.subr

name=cbsd_statsd_hoster
rcvar=cbsd_statsd_hoster_enable
load_rc_config $name

# Set defaults
: ${cbsd_statsd_hoster_enable:="NO"}

export workdir="${cbsd_workdir}"
globalconf=${cbsd_globalconf:-"%%PREFIX%%/cbsd/cbsd.conf"}

start_cmd=${name}_start
restart_cmd=${name}_restart
extra_commands="restart"

command="%%PREFIX%%/cbsd/tools/racct-hoster-statsd"
pidfile="/var/run/$name.pid"
command_args="&"

pidfile=/var/run/racct-hoster-statsd.pid

if [ ! -f ${globalconf} ]; then
	echo "cbsd: no such ${globalconf}";
	exit 1
fi

if [ ! -f ${subr} ]; then
	echo "cbsd: no such ${subr}";
	exit 1
fi

. ${globalconf}
. ${subr}

cbsd_statsd_hoster_start()
{
	local args= racct_enabled=

	# RACCT enabled?
	racct_enabled=$( /sbin/sysctl -qn kern.racct.enable )
	[ $? -ne 0 ] && err 1 "cbsd-statsd-hoster: RACCT not enabled"
	[ "${racct_enabled}" != "1" ] && err 1 "cbsd-statsd-hoster: RACCT not enabled"

	readconf racct-hoster-statsd.conf
	[ -n "${log_file}" ] && args="${args} --log_file=${log_file}"
	[ -n "${log_level}" ] && args="${args} --log_level=${log_level}"
	[ -n "${loop_interval}" ] && args="${args} --loop_interval=${loop_interval}"
	[ -n "${save_loop_count}" ] && args="${args} --save_loop_count=${save_loop_count}"

	case "${prometheus_exporter_enable}" in
		[Yy][Ee][Ss])
			args="${args} --prometheus_exporter=1"
			;;
		[No][Oo])
			args="${args} --prometheus_exporter=0"
			;;
	esac

	case "${beanstald_enable}" in
		[Yy][Ee][Ss])
			args="${args} --save_beanstalkd=1"
			;;
		[No][Oo])
			args="${args} --save_beanstalkd=0"
			;;
	esac

	case "${sqlite3_enable}" in
		[Yy][Ee][Ss])
			args="${args} --save_sqlite=1"
			;;
		[No][Oo])
			args="${args} --save_sqlite=0"
			;;
	esac

	exec env workdir=${cbsd_workdir} %%PREFIX%%/cbsd/tools/racct-hoster-statsd ${args}
}

cbsd_statsd_hoster_restart()
{
	cbsd_statsd_hoster_stop
	cbsd_statsd_hoster_start
}

run_rc_command "$1"


[FILE:2005:files/cbsd-statsd-jail.in]
#!/bin/sh
#
# PROVIDE: cbsd_statsd_jail
# REQUIRE: LOGIN FILESYSTEMS sshd
# KEYWORD: shutdown
#
# cbsd_statsd_jail_enable="YES"
#

. /etc/rc.subr

name=cbsd_statsd_jail
rcvar=cbsd_statsd_jail_enable
load_rc_config $name

# Set defaults
: ${cbsd_statsd_jail_enable:="NO"}

export workdir="${cbsd_workdir}"
globalconf=${cbsd_globalconf:-"%%PREFIX%%/cbsd/cbsd.conf"}

start_cmd=${name}_start
restart_cmd=${name}_restart
extra_commands="restart"

command="%%PREFIX%%/cbsd/tools/racct-jail-statsd"
pidfile="/var/run/$name.pid"
command_args="&"

pidfile=/var/run/racct-jail-statsd.pid

if [ ! -f ${globalconf} ]; then
	echo "cbsd: no such ${globalconf}";
	exit 1
fi

if [ ! -f ${subr} ]; then
	echo "cbsd: no such ${subr}";
	exit 1
fi

. ${globalconf}
. ${subr}

cbsd_statsd_jail_start()
{
	local args= racct_enabled=

	# RACCT enabled?
	racct_enabled=$( /sbin/sysctl -qn kern.racct.enable )
	[ $? -ne 0 ] && err 1 "cbsd-statsd-jail: RACCT not enabled"
	[ "${racct_enabled}" != "1" ] && err 1 "cbsd-statsd-jail: RACCT not enabled"

	readconf racct-jail-statsd.conf
	[ -n "${log_file}" ] && args="${args} --log_file=${log_file}"
	[ -n "${log_level}" ] && args="${args} --log_level=${log_level}"
	[ -n "${loop_interval}" ] && args="${args} --loop_interval=${loop_interval}"
	[ -n "${save_loop_count}" ] && args="${args} --save_loop_count=${save_loop_count}"

	case "${prometheus_exporter_enable}" in
		[Yy][Ee][Ss])
			args="${args} --prometheus_exporter=1"
			;;
		[No][Oo])
			args="${args} --prometheus_exporter=0"
			;;
	esac

	case "${beanstald_enable}" in
		[Yy][Ee][Ss])
			args="${args} --save_beanstalkd=1"
			;;
		[No][Oo])
			args="${args} --save_beanstalkd=0"
			;;
	esac

	case "${sqlite3_enable}" in
		[Yy][Ee][Ss])
			args="${args} --save_sqlite=1"
			;;
		[No][Oo])
			args="${args} --save_sqlite=0"
			;;
	esac

	exec env workdir=${cbsd_workdir} %%PREFIX%%/cbsd/tools/racct-jail-statsd ${args}
}

cbsd_statsd_jail_restart()
{
	cbsd_statsd_jail_stop
	cbsd_statsd_jail_start
}

run_rc_command "$1"


[FILE:2142:files/cbsdd.in]
#!/bin/sh
#
# PROVIDE: cbsdd
# REQUIRE: LOGIN FILESYSTEMS sshd
# KEYWORD: shutdown
#
# cbsdd_enable="YES"
#

. /etc/rc.subr

name=cbsdd
rcvar=cbsdd_enable
load_rc_config $name

: ${cbsdd_enable="NO"}

export workdir="${cbsd_workdir}"
export NO_CBSD_HISTORY=yes
globalconf=${cbsd_globalconf:-"%%PREFIX%%/cbsd/cbsd.conf"}

if [ ! -f ${globalconf} ]; then
	echo "cbsd: no such ${globalconf}";
	exit 1
fi

if [ ! -f ${mdtools} ]; then
	echo "cbsd: no such ${mdtools}";
	exit 1
fi

if [ ! -f ${subr} ]; then
	echo "cbsd: no such ${subr}";
	exit 1
fi

if [ ! -f ${localcbsdconf} ]; then
	echo "cbsd: no such ${localcbsdconf}";
	exit 1
fi

. ${globalconf}
. ${mdtools}
. ${subr}

. ${localcbsdconf}

start_precmd=${name}_prestart
stop_precmd=${name}_prestop
stop_cmd=${name}_stop
status_cmd="${name}_status"
restart_cmd=${name}_restart
extra_commands="restart"

command="${toolsdir}/cbsdd"
pidfile="${cbsd_workdir}/var/run/$name.pid"
command_args="&"

cbsdd_prestart() {
	%%PREFIX%%/bin/cbsd task mode=flushall > /dev/null 2>&1
	. ${subrdir}/initenv.subr
	. ${inventory}

	%%PREFIX%%/bin/cbsd sysinv mode=update
	%%PREFIX%%/bin/cbsd netinv
	update_netinfo
	${miscdir}/sqlcli ${dbdir}/local.sqlite "UPDATE jails SET status='0' WHERE status='3'"
	[ -n "${nat_enable}" ] && %%PREFIX%%/bin/cbsd naton
	/usr/sbin/daemon -f ${rcddir}/jails-astart start
}

cbsdd_prestop()
{
	${rcddir}/jails-astart stop
	[ -n "${nat_enable}" ] && %%PREFIX%%/bin/cbsd natoff
}

cbsdd_stop()
{
	if [ -f "${pidfile}" ]; then
		pids=$( pgrep -F ${pidfile} 2>&1 )
		_err=$?
		if [ ${_err} -eq  0 ]; then
			kill -9 ${pids} && /bin/rm -f ${pidfile}
		else
			echo "pgrep: ${pids}"
			return ${_err}
		fi
	fi
}

cbsdd_restart()
{
	if [ -f "${pidfile}" ]; then
		pkill -9 -f ${pidfile} > /dev/null 2>&1
		/bin/rm -f ${pidfile}
	fi
	run_rc_command "start"
	exit 0
}

cbsdd_status()
{
	local _err

	if [ -f "${pidfile}" ]; then
		pids=$( pgrep -F ${pidfile} 2>&1 )
		_err=$?
		if [ ${_err} -eq  0 ]; then
			echo "${name} is running as pid ${pids}."
		else
			echo "pgrep: ${pids}"
			return ${_err}
		fi
	else
		echo "${name} is not running."
		return 1
	fi
}

run_rc_command "$1"


[FILE:492:files/cbsdrsyncd.in]
#!/bin/sh
# PROVIDE: cbsdrsyncd
# REQUIRE: LOGIN
# KEYWORD: shutdown

# cbsdrsyncd_enable="YES"
# cbsdrsyncd_flags="<set as needed>"
#
# See rsync(1) for cbsdrsyncd_flags
#

. /etc/rc.subr
. /etc/rc.conf

name="cbsdrsyncd"
rcvar=cbsdrsyncd_enable

command="%%PREFIX%%/bin/rsync"
command_args="--daemon"
pidfile="/var/run/$name.pid"
required_files="${cbsd_workdir}/etc/rsyncd.conf"

# read configuration and set defaults
load_rc_config "$name"
: ${cbsdrsyncd_enable="NO"}

run_rc_command "$1"


[FILE:817:files/messages-primary.ucl.in]
single: {
  type: "install"
  message: <<EOM
cbsd is now installed, but requires additional setup steps:
Upon initial installation, run:

  env workdir="/path" %%PREFIX%%/cbsd/sudoexec/initenv

Where /path is the path to the cbsd workdir, e.g.: /usr/jails
For upgrading an existing installation, run:

  cbsd initenv
EOM
}
final: {
  type: "remove"
  message: <<EOM
The cbsd package has been deleted.

If you are *not* upgrading this package, you may want to
remove the following to complete the deinstallation process:

1) Records in /etc/rc.conf
  cbsdrsyncd_enable="YES"
  cbsdrsyncd_flags="--config=$workdir/etc/rsyncd.conf"
  cbsdd_enable="YES"
  devfs_load_rulesets="YES"
  cbsd_workdir="$workdir"
  rcshutdown_timeout="900"
  sshd_flags="-oPort=22222"

2) Remove %%LOCALBASE%%/etc/sudoers.d/cbsd_sudoers
EOM
}

