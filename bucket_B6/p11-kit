# Buildsheet autogenerated by ravenadm tool -- Do not edit.

NAMEBASE=		p11-kit
VERSION=		0.25.5
REVISION=		1
KEYWORDS=		security devel
VARIANTS=		std
SDESC[std]=		Library for loading and sharing PKCS#11 modules
HOMEPAGE=		https://p11-glue.freedesktop.org/p11-kit.html
CONTACT=		nobody

DOWNLOAD_GROUPS=	main
SITES[main]=		https://github.com/p11-glue/p11-kit/releases/download/0.25.5/
DISTFILE[1]=		p11-kit-0.25.5.tar.xz:main
DF_INDEX=		1
SPKGS[std]=		set
			primary
			dev
			tools
			docs

OPTIONS_AVAILABLE=	none
OPTIONS_STANDARD=	none

BUILD_DEPENDS=		libffi:dev:std
			libtasn1:dev:std
			glib:dev:std
BUILDRUN_DEPENDS=	libtasn1:primary:std
			libffi:primary:std
EXRUN[tools]=		p11-kit:primary:std

USES=			cpe meson pkgconfig gtk-doc rootca:tools

LICENSE=		BSD3CLAUSE:primary
LICENSE_FILE=		BSD3CLAUSE:{{WRKSRC}}/COPYING
LICENSE_SCHEME=		solo

CPE_VENDOR=		p11-kit_project
FPC_EQUIVALENT=		security/p11-kit
MESON_ARGS=		-Dnls=false
			-Dtest=false
			-Dgtk_doc=true
			-Dtrust_paths={{LOCALBASE}}/share/certs/ca-root-nss.crt

INSTALL_TARGET=		install-strip
SOVERSION=		0.4.1

VAR_OPSYS[sunos]=	CFLAGS=-D_POSIX_PTHREAD_SEMANTICS
			LDFLAGS=-lsocket

[FILE:290:descriptions/desc.primary]
Provides a way to load and enumerate PKCS#11 modules. Provides a
standard configuration setup for installing PKCS#11 modules in
such a way that they're discoverable.

Also solves problems with coordinating the use of PKCS#11 by
different components or libraries living in the same process.


[FILE:50:descriptions/desc.tools]
This package contains tools based on the P11 kit.


[FILE:100:distinfo]
04d0a86450cdb1be018f26af6699857171a188ac6d5b8c90786a60854e1198e5      1002056 p11-kit-0.25.5.tar.xz


[FILE:135:manifests/plist.primary]
lib/
 libp11-kit.so.%%SOMAJOR%%
 libp11-kit.so.%%SOVERSION%%
 p11-kit-proxy.so
lib/pkcs11/p11-kit-client.so
@dir share/p11-kit/modules


[FILE:161:manifests/plist.dev]
include/p11-kit-1/p11-kit/
 deprecated.h
 iter.h
 p11-kit.h
 pin.h
 pkcs11.h
 pkcs11x.h
 remote.h
 uri.h
 version.h
lib/libp11-kit.so
lib/pkgconfig/p11-kit-1.pc


[FILE:92:manifests/plist.tools]
bin/p11-kit
etc/pkcs11/pkcs11.conf.example
libexec/p11-kit/
 p11-kit-remote
 p11-kit-server


[FILE:685:manifests/plist.docs]
share/doc/p11-kit/
 config-example.html
 config-files.html
 config.html
 devel-building-style.html
 devel-building.html
 devel-commands.html
 devel-debugging.html
 devel-paths.html
 devel-testing.html
 devel.html
 home.png
 index.html
 left-insensitive.png
 left.png
 p11-kit-Deprecated.html
 p11-kit-Future.html
 p11-kit-Modules.html
 p11-kit-PIN-Callbacks.html
 p11-kit-URIs.html
 p11-kit-Utilities.html
 p11-kit.html
 pkcs11-conf.html
 reference.html
 remoting.html
 right-insensitive.png
 right.png
 sharing-managed.html
 sharing.html
 style.css
 tools.html
 trust-disable.html
 trust-glib-networking.html
 trust-module.html
 trust-nss.html
 trust.html
 up-insensitive.png
 up.png


[FILE:818:patches/patch-common_compat.c]
--- common/compat.c.orig	2024-03-07 14:46:09 UTC
+++ common/compat.c
@@ -41,18 +41,6 @@
  * This is excluded on SunOS due to it making the code compile in < XPG6 mode
  * which is not supported with a C99 compiler.
  */
-#ifndef __sun
-#define _XOPEN_SOURCE 700
-#endif
-
-/*
- * This is needed to expose issetugid, getresuid, and getresgid, which are
- * hidden with the _XOPEN_SOURCE setting above
- */
-#ifdef __FreeBSD__
-#undef __BSD_VISIBLE
-#define __BSD_VISIBLE 1
-#endif
 
 #include "compat.h"
 #include "debug.h"
@@ -876,7 +864,7 @@ _p11_getauxval (unsigned long type)
 		secure = __libc_enable_secure;
 
 #elif defined(HAVE_ISSETUGID) && \
-	!((defined __APPLE__ && defined __MACH__) || (defined __FreeBSD__))
+	!((defined __APPLE__ && defined __MACH__))
 		secure = issetugid ();
 
 #elif defined(OS_UNIX)


[FILE:354:patches/patch-common_message.c]
--- common/message.c.orig	2023-10-24 12:58:49 UTC
+++ common/message.c
@@ -41,7 +41,9 @@
  * Oh god. glibc is nasty. Changes behavior and definitions of POSIX
  * functions to completely different signatures depending on defines
  */
+#ifdef __linux__
 #define _POSIX_C_SOURCE 200112L
+#endif
 
 #include "compat.h"
 #define P11_DEBUG_FLAG P11_DEBUG_LIB


[FILE:214:patches/patch-p11-kit_lists.c]
--- p11-kit/lists.c.orig	2024-01-03 12:31:03 UTC
+++ p11-kit/lists.c
@@ -44,6 +44,7 @@
 #include <stdint.h>
 #include <string.h>
 #include <stdio.h>
+#include <stdint.h>
 #include <stdlib.h>
 #include <unistd.h>
 


[FILE:222:patches/patch-p11-kit_rpc-server.c]
--- p11-kit/rpc-server.c.orig	2024-07-01 13:53:16 UTC
+++ p11-kit/rpc-server.c
@@ -57,6 +57,7 @@
 #include <errno.h>
 #include <stdlib.h>
 #include <string.h>
+#include <limits.h>
 #include <unistd.h>
 
 #ifdef ENABLE_NLS

