# Buildsheet autogenerated by ravenadm tool -- Do not edit.

NAMEBASE=		libcaca
VERSION=		0.99.b20
REVISION=		3
KEYWORDS=		graphics
VARIANTS=		std
SDESC[std]=		Graphics library to output text instead of pixels
HOMEPAGE=		http://caca.zoy.org/
CONTACT=		Michael_Reim[kraileth@elderlinux.org]

DOWNLOAD_GROUPS=	main
SITES[main]=		GITHUB/cacalabs:libcaca:v0.99.beta20
DISTFILE[1]=		libcaca-0.99.beta20.tar.gz:main
DF_INDEX=		1
SPKGS[std]=		set
			primary
			dev
			man
			docs
			bindpython
			bindruby
			tools

OPTIONS_AVAILABLE=	none
OPTIONS_STANDARD=	none

BUILD_DEPENDS=		doxygen:primary:std
			freeglut:dev:std
			ftgl:dev:std
			libglvnd:dev:std
			imlib2:dev:std
BUILDRUN_DEPENDS=	imlib2:primary:std
			freeglut:primary:std
			ftgl:primary:std
			libglvnd:primary:std
			slang:primary:std
EXRUN[bindruby]=	primary
			ruby
EXRUN[tools]=		primary
EXRUN[bindpython]=	primary
			python

USES=			autoreconf gettext libtool ncurses zlib cpe
			python:build ruby:build
GNOME_COMPONENTS=	pango
XORG_COMPONENTS=	x11

DISTNAME=		libcaca-0.99.beta20

LICENSE=		CUSTOM1:primary GPLv2+:primary LGPL20+:primary
LICENSE_TERMS=		primary:{{WRKDIR}}/TERMS
LICENSE_NAME=		CUSTOM1:"DO WHAT THE FUCK YOU WANT TO PUBLIC LICENSE v2"
LICENSE_FILE=		CUSTOM1:{{WRKSRC}}/COPYING
			GPLv2+:{{WRKSRC}}/COPYING.GPL
			LGPL20+:{{WRKSRC}}/COPYING.LGPL
LICENSE_SCHEME=		multi

CPE_UPDATE=		beta20
CPE_VENDOR=		libcaca_project
CPE_VERSION=		0.99
FPC_EQUIVALENT=		graphics/libcaca

MUST_CONFIGURE=		gnu
CONFIGURE_ARGS=		--enable-ncurses
			--enable-slang
			--enable-x11
			--enable-gl

INSTALL_TARGET=		install-strip
INSTALL_REQ_TOOLCHAIN=	yes
SOVERSION=		0.99.20

CFLAGS=			-Wno-bidi-chars
			-Wno-incompatible-pointer-types
			-Wno-implicit-function-declaration
			-Wno-int-conversion
CVE_FIXED=		CVE-2022-0856

post-extract:
			${ECHO} "Terms extracted from 'caca/caca.h':" > ${WRKDIR}/TERMS
			${SED} -n '/more details/!p;//q' ${WRKSRC}/caca/caca.h >> ${WRKDIR}/TERMS
			${ECHO} "Terms extracted from 'kernel/multiboot.h':" >> ${WRKDIR}/TERMS
			${SED} -n '/Mass Ave/!p;//q' ${WRKSRC}/kernel/multiboot.h >> ${WRKDIR}/TERMS
			${ECHO} "Terms extracted from 'src/aafire.c':" >> ${WRKDIR}/TERMS
			${SED} -n '/02111/!p;//q' ${WRKSRC}/src/aafire.c >> ${WRKDIR}/TERMS

[FILE:372:descriptions/desc.primary]
libcaca is a graphics library that outputs text instead of pixels, so that 
it can work on older video cards or text terminals. It is similar to the 
famous AAlib library, with the following improvements:

 * Unicode support
 * 2048 available colours (some devices can only handle 16)
 * dithering of colour images
 * advanced text canvas operations (blitting, rotations)


[FILE:58:descriptions/desc.bindpython]
This subpackage contains the Python bindings for libcaca.


[FILE:53:descriptions/desc.bindruby]
This package contains the ruby bindings for libcaca.


[FILE:54:descriptions/desc.tools]
This package contains programs based on caca library.


[FILE:105:distinfo]
3edb8763a8f888ed4d4b85b3a056e81c840d5d27f79bdebc0b991688b23084f2       729604 libcaca-0.99.beta20.tar.gz


[FILE:109:manifests/plist.primary]
lib/
 libcaca++.so.%%SOMAJOR%%
 libcaca++.so.%%SOVERSION%%
 libcaca.so.%%SOMAJOR%%
 libcaca.so.%%SOVERSION%%


[FILE:170:manifests/plist.dev]
bin/caca-config
include/
 caca++.h
 caca.h
 caca0.h
 caca_conio.h
 caca_types.h
lib/
 libcaca++.a
 libcaca++.so
 libcaca.a
 libcaca.so
lib/pkgconfig/
 caca++.pc
 caca.pc


[FILE:8533:manifests/plist.man]
share/man/man1/
 caca-config.1
 cacademo.1
 cacafire.1
 cacaplay.1
 cacaserver.1
 cacaview.1
 img2txt.1
share/man/man3/
 CACA_API_VERSION_1.3caca
 CACA_BLACK.3caca
 CACA_BLINK.3caca
 CACA_BLUE.3caca
 CACA_BOLD.3caca
 CACA_BROWN.3caca
 CACA_CONIO_COLORS.3caca
 CACA_CONIO_CURSOR.3caca
 CACA_CONIO_MODE.3caca
 CACA_CYAN.3caca
 CACA_DARKGRAY.3caca
 CACA_DEFAULT.3caca
 CACA_EVENT_ANY.3caca
 CACA_EVENT_KEY_PRESS.3caca
 CACA_EVENT_KEY_RELEASE.3caca
 CACA_EVENT_MOUSE_MOTION.3caca
 CACA_EVENT_MOUSE_PRESS.3caca
 CACA_EVENT_MOUSE_RELEASE.3caca
 CACA_EVENT_NONE.3caca
 CACA_EVENT_QUIT.3caca
 CACA_EVENT_RESIZE.3caca
 CACA_GREEN.3caca
 CACA_ITALICS.3caca
 CACA_KEY_BACKSPACE.3caca
 CACA_KEY_CTRL_A.3caca
 CACA_KEY_CTRL_B.3caca
 CACA_KEY_CTRL_C.3caca
 CACA_KEY_CTRL_D.3caca
 CACA_KEY_CTRL_E.3caca
 CACA_KEY_CTRL_F.3caca
 CACA_KEY_CTRL_G.3caca
 CACA_KEY_CTRL_J.3caca
 CACA_KEY_CTRL_K.3caca
 CACA_KEY_CTRL_L.3caca
 CACA_KEY_CTRL_N.3caca
 CACA_KEY_CTRL_O.3caca
 CACA_KEY_CTRL_P.3caca
 CACA_KEY_CTRL_Q.3caca
 CACA_KEY_CTRL_R.3caca
 CACA_KEY_CTRL_T.3caca
 CACA_KEY_CTRL_U.3caca
 CACA_KEY_CTRL_V.3caca
 CACA_KEY_CTRL_W.3caca
 CACA_KEY_CTRL_X.3caca
 CACA_KEY_CTRL_Y.3caca
 CACA_KEY_CTRL_Z.3caca
 CACA_KEY_DELETE.3caca
 CACA_KEY_DOWN.3caca
 CACA_KEY_END.3caca
 CACA_KEY_ESCAPE.3caca
 CACA_KEY_F1.3caca
 CACA_KEY_F10.3caca
 CACA_KEY_F11.3caca
 CACA_KEY_F12.3caca
 CACA_KEY_F13.3caca
 CACA_KEY_F14.3caca
 CACA_KEY_F15.3caca
 CACA_KEY_F2.3caca
 CACA_KEY_F3.3caca
 CACA_KEY_F4.3caca
 CACA_KEY_F5.3caca
 CACA_KEY_F6.3caca
 CACA_KEY_F7.3caca
 CACA_KEY_F8.3caca
 CACA_KEY_F9.3caca
 CACA_KEY_HOME.3caca
 CACA_KEY_INSERT.3caca
 CACA_KEY_LEFT.3caca
 CACA_KEY_PAGEDOWN.3caca
 CACA_KEY_PAGEUP.3caca
 CACA_KEY_PAUSE.3caca
 CACA_KEY_RETURN.3caca
 CACA_KEY_RIGHT.3caca
 CACA_KEY_TAB.3caca
 CACA_KEY_UNKNOWN.3caca
 CACA_KEY_UP.3caca
 CACA_LIGHTBLUE.3caca
 CACA_LIGHTCYAN.3caca
 CACA_LIGHTGRAY.3caca
 CACA_LIGHTGREEN.3caca
 CACA_LIGHTMAGENTA.3caca
 CACA_LIGHTRED.3caca
 CACA_MAGENTA.3caca
 CACA_MAGIC_FULLWIDTH.3caca
 CACA_RED.3caca
 CACA_TRANSPARENT.3caca
 CACA_UNDERLINE.3caca
 CACA_WHITE.3caca
 CACA_YELLOW.3caca
 attribute.3caca
 caca.h.3caca
 caca_add_dirty_rect.3caca
 caca_attr.3caca
 caca_attr_to_ansi.3caca
 caca_attr_to_ansi_bg.3caca
 caca_attr_to_ansi_fg.3caca
 caca_attr_to_argb64.3caca
 caca_attr_to_rgb12_bg.3caca
 caca_attr_to_rgb12_fg.3caca
 caca_attributes.3caca
 caca_blit.3caca
 caca_canvas.3caca
 caca_canvas_set_figfont.3caca
 caca_canvas_t.3caca
 caca_charfont.3caca
 caca_charfont_t.3caca
 caca_charset.3caca
 caca_clear_canvas.3caca
 caca_clear_dirty_rect_list.3caca
 caca_color.3caca
 caca_conio__setcursortype.3caca
 caca_conio__wscroll.3caca
 caca_conio_cgets.3caca
 caca_conio_clreol.3caca
 caca_conio_clrscr.3caca
 caca_conio_cprintf.3caca
 caca_conio_cputs.3caca
 caca_conio_cscanf.3caca
 caca_conio_delay.3caca
 caca_conio_delline.3caca
 caca_conio_directvideo.3caca
 caca_conio_getch.3caca
 caca_conio_getche.3caca
 caca_conio_getpass.3caca
 caca_conio_gettext.3caca
 caca_conio_gettextinfo.3caca
 caca_conio_gotoxy.3caca
 caca_conio_highvideo.3caca
 caca_conio_insline.3caca
 caca_conio_kbhit.3caca
 caca_conio_lowvideo.3caca
 caca_conio_movetext.3caca
 caca_conio_normvideo.3caca
 caca_conio_nosound.3caca
 caca_conio_printf.3caca
 caca_conio_putch.3caca
 caca_conio_puttext.3caca
 caca_conio_sleep.3caca
 caca_conio_sound.3caca
 caca_conio_text_info.3caca
 caca_conio_textattr.3caca
 caca_conio_textbackground.3caca
 caca_conio_textcolor.3caca
 caca_conio_textmode.3caca
 caca_conio_ungetch.3caca
 caca_conio_wherex.3caca
 caca_conio_wherey.3caca
 caca_conio_window.3caca
 caca_cp437_to_utf32.3caca
 caca_create_canvas.3caca
 caca_create_display.3caca
 caca_create_display_with_driver.3caca
 caca_create_dither.3caca
 caca_create_frame.3caca
 caca_dirty.3caca
 caca_disable_dirty_rect.3caca
 caca_display.3caca
 caca_display_t.3caca
 caca_dither.3caca
 caca_dither_bitmap.3caca
 caca_dither_t.3caca
 caca_draw_box.3caca
 caca_draw_circle.3caca
 caca_draw_cp437_box.3caca
 caca_draw_ellipse.3caca
 caca_draw_line.3caca
 caca_draw_polyline.3caca
 caca_draw_thin_box.3caca
 caca_draw_thin_ellipse.3caca
 caca_draw_thin_line.3caca
 caca_draw_thin_polyline.3caca
 caca_draw_thin_triangle.3caca
 caca_draw_triangle.3caca
 caca_enable_dirty_rect.3caca
 caca_event.3caca
 caca_event_t.3caca
 caca_event_type.3caca
 caca_export_area_to_memory.3caca
 caca_export_canvas_to_memory.3caca
 caca_figfont.3caca
 caca_file.3caca
 caca_file_close.3caca
 caca_file_eof.3caca
 caca_file_gets.3caca
 caca_file_open.3caca
 caca_file_read.3caca
 caca_file_t.3caca
 caca_file_tell.3caca
 caca_file_write.3caca
 caca_fill_box.3caca
 caca_fill_ellipse.3caca
 caca_fill_triangle.3caca
 caca_fill_triangle_textured.3caca
 caca_flip.3caca
 caca_flop.3caca
 caca_flush_figlet.3caca
 caca_font.3caca
 caca_font_t.3caca
 caca_frame.3caca
 caca_free_canvas.3caca
 caca_free_charfont.3caca
 caca_free_display.3caca
 caca_free_dither.3caca
 caca_free_font.3caca
 caca_free_frame.3caca
 caca_get_attr.3caca
 caca_get_canvas.3caca
 caca_get_canvas_attrs.3caca
 caca_get_canvas_chars.3caca
 caca_get_canvas_handle_x.3caca
 caca_get_canvas_handle_y.3caca
 caca_get_canvas_height.3caca
 caca_get_canvas_width.3caca
 caca_get_char.3caca
 caca_get_dirty_rect.3caca
 caca_get_dirty_rect_count.3caca
 caca_get_display_driver.3caca
 caca_get_display_driver_list.3caca
 caca_get_display_height.3caca
 caca_get_display_time.3caca
 caca_get_display_width.3caca
 caca_get_dither_algorithm.3caca
 caca_get_dither_algorithm_list.3caca
 caca_get_dither_antialias.3caca
 caca_get_dither_antialias_list.3caca
 caca_get_dither_brightness.3caca
 caca_get_dither_charset.3caca
 caca_get_dither_charset_list.3caca
 caca_get_dither_color.3caca
 caca_get_dither_color_list.3caca
 caca_get_dither_contrast.3caca
 caca_get_dither_gamma.3caca
 caca_get_event.3caca
 caca_get_event_key_ch.3caca
 caca_get_event_key_utf32.3caca
 caca_get_event_key_utf8.3caca
 caca_get_event_mouse_button.3caca
 caca_get_event_mouse_x.3caca
 caca_get_event_mouse_y.3caca
 caca_get_event_resize_height.3caca
 caca_get_event_resize_width.3caca
 caca_get_event_type.3caca
 caca_get_export_list.3caca
 caca_get_font_blocks.3caca
 caca_get_font_height.3caca
 caca_get_font_list.3caca
 caca_get_font_width.3caca
 caca_get_frame_count.3caca
 caca_get_frame_name.3caca
 caca_get_import_list.3caca
 caca_get_mouse_x.3caca
 caca_get_mouse_y.3caca
 caca_get_version.3caca
 caca_getopt.3caca
 caca_gotoxy.3caca
 caca_import_area_from_file.3caca
 caca_import_area_from_memory.3caca
 caca_import_canvas_from_file.3caca
 caca_import_canvas_from_memory.3caca
 caca_importexport.3caca
 caca_invert.3caca
 caca_key.3caca
 caca_load_charfont.3caca
 caca_load_font.3caca
 caca_manage_canvas.3caca
 caca_optarg.3caca
 caca_optind.3caca
 caca_option.3caca
 caca_primitives.3caca
 caca_printf.3caca
 caca_process.3caca
 caca_put_attr.3caca
 caca_put_char.3caca
 caca_put_figchar.3caca
 caca_put_str.3caca
 caca_rand.3caca
 caca_refresh_display.3caca
 caca_remove_dirty_rect.3caca
 caca_render_canvas.3caca
 caca_rotate_180.3caca
 caca_rotate_left.3caca
 caca_rotate_right.3caca
 caca_set_attr.3caca
 caca_set_canvas_boundaries.3caca
 caca_set_canvas_handle.3caca
 caca_set_canvas_size.3caca
 caca_set_color_ansi.3caca
 caca_set_color_argb.3caca
 caca_set_cursor.3caca
 caca_set_display_driver.3caca
 caca_set_display_time.3caca
 caca_set_display_title.3caca
 caca_set_dither_algorithm.3caca
 caca_set_dither_antialias.3caca
 caca_set_dither_brightness.3caca
 caca_set_dither_charset.3caca
 caca_set_dither_color.3caca
 caca_set_dither_contrast.3caca
 caca_set_dither_gamma.3caca
 caca_set_dither_palette.3caca
 caca_set_figfont_smush.3caca
 caca_set_figfont_width.3caca
 caca_set_frame.3caca
 caca_set_frame_name.3caca
 caca_set_mouse.3caca
 caca_stretch_left.3caca
 caca_stretch_right.3caca
 caca_style.3caca
 caca_toggle_attr.3caca
 caca_transform.3caca
 caca_unmanage_canvas.3caca
 caca_unset_attr.3caca
 caca_utf32_is_fullwidth.3caca
 caca_utf32_to_ascii.3caca
 caca_utf32_to_cp437.3caca
 caca_utf32_to_utf8.3caca
 caca_utf8_to_utf32.3caca
 caca_vprintf.3caca
 caca_wherex.3caca
 caca_wherey.3caca
 conio.3caca
 currmode.3caca
 curx.3caca
 cury.3caca
 data.3caca
 flag.3caca
 has_arg.3caca
 libcaca-canvas.3caca
 libcaca-env.3caca
 libcaca-font.3caca
 libcaca-migrating.3caca
 libcaca-ruby-api.3caca
 libcaca-ruby.3caca
 libcaca-style.3caca
 libcaca-tutorial.3caca
 libcaca.3caca
 name.3caca
 normattr.3caca
 screenheight.3caca
 screenwidth.3caca
 type.3caca
 val.3caca
 winbottom.3caca
 winleft.3caca
 winright.3caca
 wintop.3caca


[FILE:1227:manifests/plist.docs]
share/doc/libcaca-dev/html/
 annotated.html
 caca_8h.html
 classes.html
 dir_6cbd432a5407ce84e196e3d6b6ed44bb.html
 dir_7b9b0372e4696222cf94f86c4cd8628c.html
 dir_84e2e033a81102a788e4edade55db3ec.html
 dir_fc3819ee57455ede807bdc5475030cac.html
 doxygen.css
 doxygen_crawl.html
 files.html
 functions.html
 functions_vars.html
 globals.html
 globals_defs.html
 globals_enum.html
 globals_eval.html
 globals_func.html
 globals_type.html
 globals_vars.html
 group__caca__attr.html
 group__caca__attributes.html
 group__caca__canvas.html
 group__caca__charfont.html
 group__caca__charset.html
 group__caca__dirty.html
 group__caca__display.html
 group__caca__dither.html
 group__caca__event.html
 group__caca__figfont.html
 group__caca__file.html
 group__caca__font.html
 group__caca__frame.html
 group__caca__importexport.html
 group__caca__primitives.html
 group__caca__process.html
 group__caca__transform.html
 group__conio.html
 group__libcaca.html
 index.html
 libcaca-canvas.html
 libcaca-env.html
 libcaca-font.html
 libcaca-migrating.html
 libcaca-ruby-api.html
 libcaca-ruby.html
 libcaca-style.html
 libcaca-tutorial.html
 structcaca__conio__text__info.html
 structcaca__event.html
 structcaca__option.html
 topics.html


[FILE:1200:manifests/plist.bindpython]
%%PYTHON_SITELIBDIR%%/caca/
 __init__.py
 canvas.py
 common.py
 display.py
 dither.py
 font.py
%%PYTHON_SITELIBDIR%%/caca/__pycache__/
 __init__.cpython-%%PYTHON_SUFFIX%%%%PYTHON_ABIVER%%.opt-1.pyc
 __init__.cpython-%%PYTHON_SUFFIX%%%%PYTHON_ABIVER%%.opt-2.pyc
 __init__.cpython-%%PYTHON_SUFFIX%%%%PYTHON_ABIVER%%.pyc
 canvas.cpython-%%PYTHON_SUFFIX%%%%PYTHON_ABIVER%%.opt-1.pyc
 canvas.cpython-%%PYTHON_SUFFIX%%%%PYTHON_ABIVER%%.opt-2.pyc
 canvas.cpython-%%PYTHON_SUFFIX%%%%PYTHON_ABIVER%%.pyc
 common.cpython-%%PYTHON_SUFFIX%%%%PYTHON_ABIVER%%.opt-1.pyc
 common.cpython-%%PYTHON_SUFFIX%%%%PYTHON_ABIVER%%.opt-2.pyc
 common.cpython-%%PYTHON_SUFFIX%%%%PYTHON_ABIVER%%.pyc
 display.cpython-%%PYTHON_SUFFIX%%%%PYTHON_ABIVER%%.opt-1.pyc
 display.cpython-%%PYTHON_SUFFIX%%%%PYTHON_ABIVER%%.opt-2.pyc
 display.cpython-%%PYTHON_SUFFIX%%%%PYTHON_ABIVER%%.pyc
 dither.cpython-%%PYTHON_SUFFIX%%%%PYTHON_ABIVER%%.opt-1.pyc
 dither.cpython-%%PYTHON_SUFFIX%%%%PYTHON_ABIVER%%.opt-2.pyc
 dither.cpython-%%PYTHON_SUFFIX%%%%PYTHON_ABIVER%%.pyc
 font.cpython-%%PYTHON_SUFFIX%%%%PYTHON_ABIVER%%.opt-1.pyc
 font.cpython-%%PYTHON_SUFFIX%%%%PYTHON_ABIVER%%.opt-2.pyc
 font.cpython-%%PYTHON_SUFFIX%%%%PYTHON_ABIVER%%.pyc


[FILE:60:manifests/plist.bindruby]
%%RUBY_SITEARCHLIBDIR%%/caca.so
%%RUBY_SITELIBDIR%%/caca.rb


[FILE:100:manifests/plist.tools]
bin/
 cacaclock
 cacademo
 cacafire
 cacaplay
 cacaserver
 cacaview
 img2txt
share/libcaca/caca.txt


[FILE:424:patches/patch-caca_dither.c]
--- caca/dither.c.orig	2021-10-19 13:58:30 UTC
+++ caca/dither.c
@@ -1324,7 +1324,11 @@ static void get_rgba_default(caca_dither
         case 3:
         {
 #if defined(HAVE_ENDIAN_H)
+  #if defined(__NetBSD__)
+            if(0)
+  #else
             if(__BYTE_ORDER == __BIG_ENDIAN)
+  #endif
 #else
             /* This is compile-time optimised with at least -O1 or -Os */
             uint32_t const tmp = 0x12345678;


[FILE:425:patches/patch-configure.ac]
--- configure.ac.orig	2021-10-19 13:58:30 UTC
+++ configure.ac
@@ -269,7 +269,7 @@ if test "${enable_cocoa}" != "no"; then
    [ac_cv_my_have_cocoa="yes"])
   CFLAGS="$save_CFLAGS"
   if test "${ac_cv_my_have_cocoa}" = "yes"; then
-    [[[ "$target_os" =~ [0-9]+ ]]] && darwin_ver="${BASH_REMATCH[[0]]}"
+    [[[ "$target_os" =~ "SKIP" ]]]
     case x${target} in
     xpowerpc*darwin*)
       # 10.3 needed to link with X11


[FILE:378:patches/patch-examples_font.c]
--- examples/font.c.orig	2021-10-19 13:58:30 UTC
+++ examples/font.c
@@ -79,7 +79,11 @@ int main(int argc, char *argv[])
 
     {
 #if defined(HAVE_ENDIAN_H)
+ #if defined(__NetBSD__)
+        if(0)
+ #else
         if(__BYTE_ORDER == __BIG_ENDIAN)
+ #endif
 #else
         /* This is compile-time optimised with at least -O1 or -Os */
         uint32_t const tmp = 0x12345678;


[FILE:1072:patches/patch-fix-CVE-2022-0856]
From d33a9ca2b7e9f32483c1aee4c3944c56206d456b Mon Sep 17 00:00:00 2001
From: Josef Moellers <jmoellers@suse.de>
Date: Fri, 18 Mar 2022 11:52:22 +0100
Subject: [PATCH] Prevent a divide-by-zero by checking for a zero width or
 height.

---
 src/img2txt.c | 10 ++++++++--
 1 file changed, 8 insertions(+), 2 deletions(-)

--- src/img2txt.c.orig
+++ src/img2txt.c
@@ -177,7 +177,13 @@ int main(int argc, char **argv)
     }
 
     /* Assume a 6Ã—10 font */
-    if(!cols && !lines)
+    if(!i->w || !i->h)
+    {
+	fprintf(stderr, "%s: image size is 0\n", argv[0]);
+        lines = 0;
+	cols = 0;
+    }
+    else if(!cols && !lines)
     {
         cols = 60;
         lines = cols * i->h * font_width / i->w / font_height;
@@ -214,7 +220,7 @@ int main(int argc, char **argv)
     export = caca_export_canvas_to_memory(cv, format?format:"ansi", &len);
     if(!export)
     {
-        fprintf(stderr, "%s: Can't export to format '%s'\n", argv[0], format);
+        fprintf(stderr, "%s: Can't export to format '%s'\n", argv[0], format?format:"ansi");
     }
     else
     {

