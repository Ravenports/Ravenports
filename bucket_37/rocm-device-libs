# Buildsheet autogenerated by ravenadm tool -- Do not edit.

NAMEBASE=		rocm-device-libs
VERSION=		5.4.4
KEYWORDS=		devel graphics
VARIANTS=		standard
SDESC[standard]=	Radeon Open Compute Device Libraries
HOMEPAGE=		https://github.com/RadeonOpenCompute/ROCm-Device-Libs
CONTACT=		nobody

DOWNLOAD_GROUPS=	main
SITES[main]=		GITHUB/RadeonOpenCompute:ROCm-Device-Libs:rocm-5.4.4
DISTFILE[1]=		generated:main
DF_INDEX=		1
SPKGS[standard]=	single

OPTIONS_AVAILABLE=	none
OPTIONS_STANDARD=	none

BUILD_DEPENDS=		llvm15:dev:standard
			llvm15:tools:standard
			clang15:compiler:standard
			clang15:extra:standard
BUILDRUN_DEPENDS=	clang15:dynlibs:standard

USES=			cmake zlib ncurses execinfo
GNOME_COMPONENTS=	libxml2

LICENSE=		CUSTOM1:single
LICENSE_NAME=		CUSTOM1:"ROCm-Device-Libs Release License"
LICENSE_FILE=		CUSTOM1:{{WRKSRC}}/LICENSE.TXT
LICENSE_SCHEME=		solo

LDFLAGS=		-lpthread

post-patch:
	# fix build on linux
	echo 'target_link_options(prepare-builtins PUBLIC "-Wl,-rpath,${LOCALBASE}/lib")'\
		>> ${WRKSRC}/utils/prepare-builtins/CMakeLists.txt

post-install:
	${RM} -r ${STAGEDIR}${STD_DOCDIR}

[FILE:401:descriptions/desc.single]
AMD ROCm is the first open-source software development platform for
HPC/Hyperscale-class GPU computing.

This package contains a set of AMD specific device-side language runtime
libraries. Specifically:

oclc	Open Compute library controls
ocml	Open Compute Math library
ockl	Open Compute Kernel library
opencl	OpenCL built-in library
hip	HIP built-in library
hc	Heterogeneous Compute built-in library


[FILE:131:distinfo]
04bdfda8293779ca254596339607686633fc20d54490127b1d542884f777d9e3       246122 RadeonOpenCompute-ROCm-Device-Libs-rocm-5.4.4.tar.gz


[FILE:1397:manifests/plist.single]
amdgcn/bitcode/
 asanrtl.bc
 hip.bc
 ockl.bc
 oclc_abi_version_400.bc
 oclc_abi_version_500.bc
 oclc_correctly_rounded_sqrt_off.bc
 oclc_correctly_rounded_sqrt_on.bc
 oclc_daz_opt_off.bc
 oclc_daz_opt_on.bc
 oclc_finite_only_off.bc
 oclc_finite_only_on.bc
 oclc_isa_version_1010.bc
 oclc_isa_version_1011.bc
 oclc_isa_version_1012.bc
 oclc_isa_version_1013.bc
 oclc_isa_version_1030.bc
 oclc_isa_version_1031.bc
 oclc_isa_version_1032.bc
 oclc_isa_version_1033.bc
 oclc_isa_version_1034.bc
 oclc_isa_version_1035.bc
 oclc_isa_version_1036.bc
 oclc_isa_version_1100.bc
 oclc_isa_version_1101.bc
 oclc_isa_version_1102.bc
 oclc_isa_version_1103.bc
 oclc_isa_version_600.bc
 oclc_isa_version_601.bc
 oclc_isa_version_602.bc
 oclc_isa_version_700.bc
 oclc_isa_version_701.bc
 oclc_isa_version_702.bc
 oclc_isa_version_703.bc
 oclc_isa_version_704.bc
 oclc_isa_version_705.bc
 oclc_isa_version_801.bc
 oclc_isa_version_802.bc
 oclc_isa_version_803.bc
 oclc_isa_version_805.bc
 oclc_isa_version_810.bc
 oclc_isa_version_900.bc
 oclc_isa_version_902.bc
 oclc_isa_version_904.bc
 oclc_isa_version_906.bc
 oclc_isa_version_908.bc
 oclc_isa_version_909.bc
 oclc_isa_version_90a.bc
 oclc_isa_version_90c.bc
 oclc_isa_version_940.bc
 oclc_unsafe_math_off.bc
 oclc_unsafe_math_on.bc
 oclc_wavefrontsize64_off.bc
 oclc_wavefrontsize64_on.bc
 ocml.bc
 opencl.bc
lib/cmake/AMDDeviceLibs/AMDDeviceLibsConfig.cmake


[FILE:615:patches/patch-ockl_src_mtime.cl]
--- ockl/src/mtime.cl.orig	2022-11-04 13:01:30 UTC
+++ ockl/src/mtime.cl
@@ -14,12 +14,6 @@ mem_realtime(void)
     return __builtin_amdgcn_s_memrealtime();
 }
 
-__attribute__((target("gfx11-insts"))) static ulong
-msg_realtime(void)
-{
-    return __builtin_amdgcn_s_sendmsg_rtnl(0x83);
-}
-
 // Deprecated
 __attribute__((target("s-memtime-inst"))) ulong
 OCKL_MANGLE_U64(memtime)(void)
@@ -43,10 +37,6 @@ OCKL_MANGLE_U64(cyclectr)(void)
 ulong
 OCKL_MANGLE_U64(steadyctr)(void)
 {
-    if (__oclc_ISA_version >= 11000) {
-        return msg_realtime();
-    } else {
         return mem_realtime();
-    }
 }
 

