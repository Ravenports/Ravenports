# Buildsheet autogenerated by ravenadm tool -- Do not edit.

NAMEBASE=		bash
VERSION=		5.1.p16
KEYWORDS=		shells
VARIANTS=		standard static
SDESC[standard]=	GNU Bourne Again SHell
SDESC[static]=		Static GNU Bourne Again SHell
HOMEPAGE=		http://www.gnu.org/software/bash/bash.html
CONTACT=		nobody

DOWNLOAD_GROUPS=	main patches
SITES[main]=		GNU/bash
SITES[patches]=		GNU/bash/bash-5.1-patches
DISTFILE[1]=		bash-5.1.tar.gz:main
DISTFILE[2]=		bash51-001:patches
DISTFILE[3]=		bash51-002:patches
DISTFILE[4]=		bash51-003:patches
DISTFILE[5]=		bash51-004:patches
DISTFILE[6]=		bash51-005:patches
DISTFILE[7]=		bash51-006:patches
DISTFILE[8]=		bash51-007:patches
DISTFILE[9]=		bash51-008:patches
DISTFILE[10]=		bash51-009:patches
DISTFILE[11]=		bash51-010:patches
DISTFILE[12]=		bash51-011:patches
DISTFILE[13]=		bash51-012:patches
DISTFILE[14]=		bash51-013:patches
DISTFILE[15]=		bash51-014:patches
DISTFILE[16]=		bash51-015:patches
DISTFILE[17]=		bash51-016:patches
DIST_SUBDIR=		bash
DF_INDEX=		1
SPKGS[standard]=	complete
			primary
			nls
			docs
SPKGS[static]=		primary

OPTIONS_AVAILABLE=	STATIC NLS NOTSTD
OPTIONS_STANDARD=	STATIC NLS
VOPTS[static]=		STATIC=ON NLS=OFF NOTSTD=ON
OPT_ON[all]=		NLS

USES=			bison cpe solaris-funcs

DISTNAME=		bash-5.1

LICENSE=		GPLv3+:primary
LICENSE_TERMS=		primary:{{WRKDIR}}/TERMS
LICENSE_FILE=		GPLv3+:{{WRKSRC}}/COPYING
LICENSE_AWK=		TERMS:"<config.h>"
LICENSE_SOURCE=		TERMS:{{WRKSRC}}/version.c
LICENSE_SCHEME=		solo

CPE_VENDOR=		gnu
INFO_SUBDIR=		.
SOL_FUNCTIONS=		mkdtemp:lib/sh/tmpfile.c

PATCHFILES=		2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17

MUST_CONFIGURE=		gnu
CONFIGURE_ARGS=		--enable-readline
			--enable-progcomp
			--enable-process-substitution
			--enable-history
			--enable-help-builtin
			--enable-extended-glob
			--enable-dparen-arithmetic
			--enable-directory-stack
			--enable-debugger
			--enable-cond-regexp
			--enable-alias
			--enable-brace-expansion
			--enable-array-variables
			--without-bash-malloc

INSTALL_REQ_TOOLCHAIN=	yes

CPPFLAGS=		-DDEFAULT_PATH_VALUE='\"{{STANDARD_PATH}}:{{LOCALBASE}}/sbin:{{LOCALBASE}}/bin\"'
			-DSTANDARD_UTILS_PATH='\"{{STANDARD_PATH}}\"'
VAR_OPSYS[freebsd]=	VAR1=-Wl,--export-dynamic
VAR_OPSYS[linux]=	VAR1=-Wl,--export-dynamic
VAR_OPSYS[dragonfly]=	VAR1=-Wl,--export-dynamic

[NOTSTD].DESCRIPTION=			Non-standard designation
[NOTSTD].INFO_OFF=			primary:bash
[NOTSTD].USES_OFF=			makeinfo

[STATIC].BUILDRUN_DEPENDS_OFF=		ncurses:primary:standard
[STATIC].BUILD_DEPENDS_ON=		ncurses:primary:static
[STATIC].CFLAGS_ON=			-fcommon

[NLS].CONFIGURE_ARGS_ON=		--with-libiconv-prefix={{ICONV_PREFIX}}
[NLS].CONFIGURE_ENABLE_BOTH=		nls
[NLS].USES_ON=				gettext-runtime
					iconv

post-patch:
	# Ensure y.tab.c is regenerated
	${TOUCH} ${WRKSRC}/parse.y
	${RM} ${WRKSRC}/y.tab.c
	${REINPLACE_CMD} -e "s|%%PREFIX%%|${PREFIX}|g" ${WRKSRC}/doc/bash.1

post-install-NOTSTD-ON:
	${RM} -r ${STAGEDIR}${STD_DOCDIR}

post-install-STATIC-ON:
	# These are not installed when --enable-static-link set
	${RM} -r ${STAGEDIR}${PREFIX}/include
	${RM} -r ${STAGEDIR}${PREFIX}/lib

post-install:
	${LN} -sf bash ${STAGEDIR}${PREFIX}/bin/rbash
	${RM} ${STAGEDIR}${STD_DOCDIR}/CHANGES

post-configure:
	${FIND} ${WRKSRC} -name Makefile -print0 | ${XARGS} -0 \
		${REINPLACE_CMD} -e "s|^DESTDIR *=|& ${DESTDIR}|"

[FILE:310:descriptions/desc.primary]
This is GNU Bash.  Bash is the GNU Project's Bourne Again SHell,
a complete implementation of the POSIX.2 shell spec, but also
with interactive command line editing, job control on architectures
that support it, csh-like features such as history substitution and
brace expansion, and a slew of other features.


[FILE:1603:distinfo]
cc012bc860406dcf42f64431bcd3d2fa7560c02915a601aba9cd597a39329baa     10458638 bash/bash-5.1.tar.gz
ebb07b3dbadd98598f078125d0ae0d699295978a5cdaef6282fe19adef45b5fa         2894 bash/bash51-001
15ea6121a801e48e658ceee712ea9b88d4ded022046a6147550790caf04f5dbe         1575 bash/bash51-002
22f2cc262f056b22966281babf4b0a2f84cb7dd2223422e5dcd013c3dcbab6b1         1800 bash/bash51-003
9aaeb65664ef0d28c0067e47ba5652b518298b3b92d33327d84b98b28d873c86         3745 bash/bash51-004
cccbb5e9e6763915d232d29c713007a62b06e65126e3dd2d1128a0dc5ef46da5         2577 bash/bash51-005
75e17d937de862615c6375def40a7574462210dce88cf741f660e2cc29473d14         1412 bash/bash51-006
acfcb8c7e9f73457c0fb12324afb613785e0c9cef3315c9bbab4be702f40393a         2621 bash/bash51-007
f22cf3c51a28f084a25aef28950e8777489072628f972b12643b4534a17ed2d1         1821 bash/bash51-008
e45cda953ab4b4b4bde6dc34d0d8ca40d1cc502046eb28070c9ebcd47e33c3ee         1627 bash/bash51-009
a2c8d7b2704eeceff7b1503b7ad9500ea1cb6e9393faebdb3acd2afdd7aeae2a         1700 bash/bash51-010
58191f164934200746f48459a05bca34d1aec1180b08ca2deeee3bb29622027b         2229 bash/bash51-011
10f189c8367c4a15c7392e7bf70d0ff6953f78c9b312ed7622303a779273ab98         6372 bash/bash51-012
c7acb66df435d284304c16ca83a5265f9edd9368612095b01a733d45c77ed5ad         1277 bash/bash51-013
6a4ee0c81b437b96279a792c1efcec4ba56f009195a318083db6b53b096f83d0         1456 bash/bash51-014
1b37692ef1f6cc3dcec246773443276066e6b1379868f8c14e01f4dfd4df80f0         1409 bash/bash51-015
8899144f76a5db1fb41a89ed881c9f19add95728dd71db324f772ef225c5384f         2122 bash/bash51-016


[FILE:1188:manifests/plist.primary]
@shell bin/bash
@shell bin/rbash
%%NOTSTD-OFF%%share/man/man1/
 bash.1.gz
 bashbug.1.gz
%%STATIC-OFF%%include/bash/
 alias.h
 array.h
 arrayfunc.h
 assoc.h
 bashansi.h
 bashintl.h
 bashjmp.h
 bashtypes.h
 builtins.h
 command.h
 config-bot.h
 config-top.h
 config.h
 conftypes.h
 dispose_cmd.h
 error.h
 externs.h
 general.h
 hashlib.h
 jobs.h
 make_cmd.h
 pathnames.h
 quit.h
 shell.h
 sig.h
 siglist.h
 signames.h
 subst.h
 syntax.h
 unwind_prot.h
 variables.h
 version.h
 xmalloc.h
 y.tab.h
%%STATIC-OFF%%include/bash/builtins/
 bashgetopt.h
 builtext.h
 common.h
 getopt.h
%%STATIC-OFF%%include/bash/include/
 ansi_stdlib.h
 chartypes.h
 filecntl.h
 gettext.h
 maxpath.h
 memalloc.h
 ocache.h
 posixdir.h
 posixjmp.h
 posixstat.h
 posixtime.h
 posixwait.h
 shmbchar.h
 shmbutil.h
 shtty.h
 stat-time.h
 stdc.h
 systimes.h
 typemax.h
 unionwait.h
%%STATIC-OFF%%lib/bash/
 Makefile.inc
 accept
 basename
 csv
 cut
 dirname
 fdflags
 finfo
 head
 id
 ln
 loadables.h
 logname
 mkdir
 mkfifo
 mktemp
 mypid
 pathchk
 print
 printenv
 push
 realpath
 rm
 rmdir
 seq
 setpgid
 sleep
 strftime
 sync
 tee
 truefalse
 tty
 uname
 unlink
 whoami
%%STATIC-OFF%%lib/pkgconfig/bash.pc
bin/bashbug


[FILE:1427:manifests/plist.nls]
share/locale/af/LC_MESSAGES/bash.mo
share/locale/bg/LC_MESSAGES/bash.mo
share/locale/ca/LC_MESSAGES/bash.mo
share/locale/cs/LC_MESSAGES/bash.mo
share/locale/da/LC_MESSAGES/bash.mo
share/locale/de/LC_MESSAGES/bash.mo
share/locale/el/LC_MESSAGES/bash.mo
share/locale/en@boldquot/LC_MESSAGES/bash.mo
share/locale/en@quot/LC_MESSAGES/bash.mo
share/locale/eo/LC_MESSAGES/bash.mo
share/locale/es/LC_MESSAGES/bash.mo
share/locale/et/LC_MESSAGES/bash.mo
share/locale/fi/LC_MESSAGES/bash.mo
share/locale/fr/LC_MESSAGES/bash.mo
share/locale/ga/LC_MESSAGES/bash.mo
share/locale/gl/LC_MESSAGES/bash.mo
share/locale/hr/LC_MESSAGES/bash.mo
share/locale/hu/LC_MESSAGES/bash.mo
share/locale/id/LC_MESSAGES/bash.mo
share/locale/it/LC_MESSAGES/bash.mo
share/locale/ja/LC_MESSAGES/bash.mo
share/locale/ko/LC_MESSAGES/bash.mo
share/locale/lt/LC_MESSAGES/bash.mo
share/locale/nb/LC_MESSAGES/bash.mo
share/locale/nl/LC_MESSAGES/bash.mo
share/locale/pl/LC_MESSAGES/bash.mo
share/locale/pt/LC_MESSAGES/bash.mo
share/locale/pt_BR/LC_MESSAGES/bash.mo
share/locale/ro/LC_MESSAGES/bash.mo
share/locale/ru/LC_MESSAGES/bash.mo
share/locale/sk/LC_MESSAGES/bash.mo
share/locale/sl/LC_MESSAGES/bash.mo
share/locale/sr/LC_MESSAGES/bash.mo
share/locale/sv/LC_MESSAGES/bash.mo
share/locale/tr/LC_MESSAGES/bash.mo
share/locale/uk/LC_MESSAGES/bash.mo
share/locale/vi/LC_MESSAGES/bash.mo
share/locale/zh_CN/LC_MESSAGES/bash.mo
share/locale/zh_TW/LC_MESSAGES/bash.mo


[FILE:89:manifests/plist.docs]
share/doc/bash/
 COMPAT
 FAQ
 INTRO
 NEWS
 POSIX
 RBASH
 README
 bash.html
 bashref.html


[FILE:314:patches/patch-config-top.h]
--- config-top.h.orig	2020-11-16 15:34:26 UTC
+++ config-top.h
@@ -78,7 +78,7 @@
 #endif
 
 /* Default primary and secondary prompt strings. */
-#define PPROMPT "\\s-\\v\\$ "
+#define PPROMPT "[\\u@\\h \\w]\\$ "
 #define SPROMPT "> "
 
 /* Undefine this if you don't want the ksh-compatible behavior of reprinting


[FILE:747:patches/patch-doc_Makefile.in]
--- doc/Makefile.in.orig	2020-05-20 20:41:49 UTC
+++ doc/Makefile.in
@@ -175,7 +175,7 @@ pdf: ${PDFFILES}
 bashref.dvi: $(BASHREF_FILES) $(HSUSER) $(RLUSER)
 	${SET_TEXINPUTS} $(TEXI2DVI) $(srcdir)/bashref.texi || { ${RM} $@ ; exit 1; }
 
-bashref.info: $(BASHREF_FILES) $(HSUSER) $(RLUSER)
+bash.info: $(BASHREF_FILES) $(HSUSER) $(RLUSER)
 	$(MAKEINFO) --no-split -I$(TEXINPUTDIR) $(srcdir)/bashref.texi
 
 # experimental
@@ -188,9 +188,6 @@ bashref.pdf: $(BASHREF_FILES) $(HSUSER)
 bashref.html: $(BASHREF_FILES) $(HSUSER) $(RLUSER)
 	$(MAKEINFO) --html --no-split -I$(TEXINPUTDIR) $(srcdir)/bashref.texi
 
-bash.info: bashref.info
-	${SHELL} ${INFOPOST} < $(srcdir)/bashref.info > $@ ; \
-
 bash.txt: bash.1
 bash.ps: bash.1
 bash.html: bash.1


[FILE:498:patches/patch-doc_bash.1]
--- doc/bash.1.orig	2020-11-18 20:03:59 UTC
+++ doc/bash.1
@@ -2503,7 +2503,7 @@ The value of this parameter is expanded
 .SM
 .B PROMPTING
 below) and used as the primary prompt string.  The default value is
-``\fB\es\-\ev\e$ \fP''.
+``\fB\eu\@\eh\e$ \fP''.
 .TP
 .B PS2
 The value of this parameter is expanded as with
@@ -11199,7 +11199,7 @@ http://tiswww.case.edu/~chet/bash/POSIX
 .SH FILES
 .PD 0
 .TP
-.FN /bin/bash
+.FN %%PREFIX%%/bin/bash
 The \fBbash\fP executable
 .TP
 .FN /etc/profile


[FILE:944:patches/patch-doc_bashref.texi]
--- doc/bashref.texi.orig	2020-11-18 20:12:13 UTC
+++ doc/bashref.texi
@@ -1,6 +1,6 @@
 \input texinfo.tex @c -*- texinfo -*-
 @c %**start of header
-@setfilename bashref.info
+@setfilename bash.info
 @settitle Bash Reference Manual
 
 @include version.texi
@@ -8,7 +8,7 @@
 
 @copying
 This text is a brief description of the features that are present in
-the Bash shell (version @value{VERSION}, @value{UPDATED}).
+the Bash shell (version @value{VERSION}, @value{UPDATED})
 
 This is Edition @value{EDITION}, last updated @value{UPDATED},
 of @cite{The GNU Bash Reference Manual},
@@ -5635,7 +5635,7 @@ A null directory name may appear as two
 or trailing colon.
 
 @item PS1
-The primary prompt string.  The default value is @samp{\s-\v\$ }.
+The primary prompt string.  The default value is @samp{[\u@@\h \w]\$ }.
 @xref{Controlling the Prompt}, for the complete list of escape
 sequences that are expanded before @env{PS1} is displayed.
 


[FILE:226:patches/patch-examples_loadables_fdflags.c]
--- examples/loadables/fdflags.c.orig	2019-03-01 19:25:23 UTC
+++ examples/loadables/fdflags.c
@@ -109,6 +109,8 @@ static const struct
 
 #ifdef O_CLOEXEC
   { "cloexec",	O_CLOEXEC	},
+#else
+#define O_CLOEXEC 0
 #endif
 };
 


[FILE:533:patches/patch-lib_readline_display.c]
--- lib/readline/display.c.orig	2020-09-08 12:56:42 UTC
+++ lib/readline/display.c
@@ -932,7 +932,10 @@ rl_redisplay (void)
      the line breaks in the prompt string in expand_prompt, taking invisible
      characters into account, and if lpos exceeds the screen width, we copy
      the data in the loop below. */
+  if (local_prompt)
   lpos = prompt_physical_chars + modmark;
+  else
+    lpos = 0;
 
 #if defined (HANDLE_MULTIBYTE)
   memset (line_state_invisible->wrapped_line, 0, line_state_invisible->wbsize * sizeof (int));


[FILE:266:patches/patch-lib_termcap_ltcap.h]
--- lib/termcap/ltcap.h.orig	2009-01-04 19:32:36 UTC
+++ lib/termcap/ltcap.h
@@ -19,9 +19,7 @@
 #ifndef _LTCAP_H_
 #define _LTCAP_H_ 1
 
-#if !defined (__APPLE__)
 #  define __private_extern__
-#endif
 
 #ifndef MAX_TGETENT_BUFSIZ
 #  define MAX_TGETENT_BUFSIZ 2048


[FILE:364:patches/patch-support_Makefile.in]
--- support/Makefile.in.orig	2018-05-11 18:28:43 UTC
+++ support/Makefile.in
@@ -77,7 +77,7 @@ OBJ1 =	man2html.o
 all: man2html$(EXEEXT)
 
 man2html$(EXEEXT): $(OBJ1)
-	$(CC_FOR_BUILD) $(CCFLAGS_FOR_BUILD) $(OBJ1) -o $@ ${LIBS_FOR_BUILD}
+	$(CC_FOR_BUILD) $(CCFLAGS_FOR_BUILD) $(OBJ1) -o $@ ${LIBS_FOR_BUILD} ${LDFLAGS}
 
 clean:
 	$(RM) man2html$(EXEEXT) $(OBJ1)


[FILE:630:patches/patch-support_shobj-conf]
--- support/shobj-conf.orig	2019-12-13 14:51:17 UTC
+++ support/shobj-conf
@@ -113,7 +113,7 @@ sunos5*-*gcc*|solaris2*-*gcc*)
 	SHLIB_LIBVERSION='$(SHLIB_LIBSUFF).$(SHLIB_MAJOR)'
 	;;
 
-sunos5*|solaris2*)
+sunos5*)
 	SHOBJ_CFLAGS='-K pic'
 	SHOBJ_LD=/usr/ccs/bin/ld
 	SHOBJ_LDFLAGS='-G -dy -z text -i -h $@'
@@ -123,7 +123,7 @@ sunos5*|solaris2*)
 	;;
 
 # All versions of Linux (including Gentoo/FreeBSD) or the semi-mythical GNU Hurd.
-linux*-*|gnu*-*|k*bsd*-gnu-*|freebsd*|dragonfly*)
+linux*-*|gnu*-*|k*bsd*-gnu-*|freebsd*|dragonfly*|solaris*)
 	SHOBJ_CFLAGS=-fPIC
 	SHOBJ_LD='${CC}'
 	SHOBJ_LDFLAGS='-shared -Wl,-soname,$@'


[FILE:757:files/special.mk]
# On linux with glibc, we can't build a fully static bash because
# of absurd restrictions put on static linking with nss, dlopen, etc.
# So we build it dynamic but with libtinfo static.  Leaving glibc-based
# libraries like libc, libm, pthread, etc, is okay.

.if ${OPSYS} == Linux
.  if "${PLIST_SUB:MSTATIC-ON=*}" == "STATIC-ON="
CONFIGURE_ARGS:=	${CONFIGURE_ARGS:N--enable-static-link}
CONFIGURE_ENV+=		ac_cv_func_dlopen=no

TINFOLIBS=		${LOCALBASE}/lib/libtinfo.a \
			${LOCALBASE}/lib/db5/libdb.a \
			-lpthread

post-configure-opsys:
	${REINPLACE_CMD} -e 's|-ltinfo|${TINFOLIBS}|' ${WRKSRC}/Makefile
.  endif
.endif

# we could have used LDFLAGS_OFF options helper, but it doesn't
# currently exist

.if ${VARIANT} != static
LDFLAGS+=	${VAR1}
.endif


[FILE:2609:sunos/patch-configure]
--- configure.orig	2020-12-04 14:05:14 UTC
+++ configure
@@ -5009,14 +5009,18 @@ prefer_static=no
 if test "$opt_static_link" = yes; then
 	prefer_static=yes
 	prefer_shared=no
+	TINFO_LIBRARY=${prefix}/lib/libtinfo.a
 	# if we're using gcc, add `-static' to LDFLAGS, except on Solaris >= 2
 	if test -n "$GCC" || test "$ac_cv_c_compiler_gnu" = "yes"; then
 		STATIC_LD="-static"
 		case "$host_os" in
-		solaris2*|linux*)	;;
+		linux*)	;;
+		solaris*)	STATIC_LD= ;;
 		*)		LDFLAGS="$LDFLAGS -static" ;;	# XXX experimental
 		esac
 	fi
+else
+	TINFO_LIBRARY=-ltinfo
 fi
 
 # set the appropriate make variables for building the "build tools"
@@ -5160,13 +5164,13 @@ $as_echo "$ac_cv_lib_termcap_tgetent" >&
 if test "x$ac_cv_lib_termcap_tgetent" = xyes; then :
   bash_cv_termcap_lib=libtermcap
 else
-  { $as_echo "$as_me:${as_lineno-$LINENO}: checking for tgetent in -ltinfo" >&5
-$as_echo_n "checking for tgetent in -ltinfo... " >&6; }
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking for tgetent in ${TINFO_LIBRARY}" >&5
+$as_echo_n "checking for tgetent in ${TINFO_LIBRARY}... " >&6; }
 if ${ac_cv_lib_tinfo_tgetent+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   ac_check_lib_save_LIBS=$LIBS
-LIBS="-ltinfo  $LIBS"
+LIBS="${TINFO_LIBRARY}  $LIBS"
 cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
@@ -5345,7 +5349,7 @@ elif test $bash_cv_termcap_lib = libterm
 TERMCAP_LIB=-ltermcap
 TERMCAP_DEP=
 elif test $bash_cv_termcap_lib = libtinfo; then
-TERMCAP_LIB=-ltinfo
+TERMCAP_LIB=${TINFO_LIBRARY}
 TERMCAP_DEP=
 elif test $bash_cv_termcap_lib = libncurses; then
 TERMCAP_LIB=-lncurses
@@ -20076,13 +20080,13 @@ $as_echo "$ac_cv_lib_termcap_tgetent" >&
 if test "x$ac_cv_lib_termcap_tgetent" = xyes; then :
   bash_cv_termcap_lib=libtermcap
 else
-  { $as_echo "$as_me:${as_lineno-$LINENO}: checking for tgetent in -ltinfo" >&5
-$as_echo_n "checking for tgetent in -ltinfo... " >&6; }
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking for tgetent in ${TINFO_LIBRARY}" >&5
+$as_echo_n "checking for tgetent in ${TINFO_LIBRARY}... " >&6; }
 if ${ac_cv_lib_tinfo_tgetent+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   ac_check_lib_save_LIBS=$LIBS
-LIBS="-ltinfo  $LIBS"
+LIBS="${TINFO_LIBRARY}  $LIBS"
 cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
@@ -20261,7 +20265,7 @@ elif test $bash_cv_termcap_lib = libterm
 TERMCAP_LIB=-ltermcap
 TERMCAP_DEP=
 elif test $bash_cv_termcap_lib = libtinfo; then
-TERMCAP_LIB=-ltinfo
+TERMCAP_LIB=${TINFO_LIBRARY}
 TERMCAP_DEP=
 elif test $bash_cv_termcap_lib = libncurses; then
 TERMCAP_LIB=-lncurses

