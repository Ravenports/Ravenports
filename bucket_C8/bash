# Buildsheet autogenerated by ravenadm tool -- Do not edit.

NAMEBASE=		bash
VERSION=		4.4.12
REVISION=		1
KEYWORDS=		shells
VARIANTS=		standard static nls
SDESC[nls]=		GNU Bourne Again SHell with native lang support
SDESC[standard]=	GNU Bourne Again SHell
SDESC[static]=		Static GNU Bourne Again SHell
HOMEPAGE=		http://www.gnu.org/software/bash/bash.html
CONTACT=		nobody

DOWNLOAD_GROUPS=	main patches
SITES[main]=		GNU/bash
SITES[patches]=		GNU/bash/bash-4.4-patches
DISTFILE[1]=		bash-4.4.tar.gz:main
DISTFILE[2]=		bash44-001:patches
DISTFILE[3]=		bash44-002:patches
DISTFILE[4]=		bash44-003:patches
DISTFILE[5]=		bash44-004:patches
DISTFILE[6]=		bash44-005:patches
DISTFILE[7]=		bash44-006:patches
DISTFILE[8]=		bash44-007:patches
DISTFILE[9]=		bash44-008:patches
DISTFILE[10]=		bash44-009:patches
DISTFILE[11]=		bash44-010:patches
DISTFILE[12]=		bash44-011:patches
DISTFILE[13]=		bash44-012:patches
DIST_SUBDIR=		bash
DF_INDEX=		1
SPKGS[nls]=		primary
SPKGS[standard]=	complete
			primary
			docs
SPKGS[static]=		primary

OPTIONS_AVAILABLE=	STATIC NLS NOTSTD
OPTIONS_STANDARD=	STATIC NLS
VOPTS[nls]=		STATIC=OFF NLS=ON NOTSTD=ON
VOPTS[static]=		STATIC=ON NLS=OFF NOTSTD=ON

USES=			bison cpe makeinfo

DISTNAME=		bash-4.4

LICENSE=		GPLv3+:primary
LICENSE_SCHEME=		solo
LICENSE_FILE=		GPLv3+:{{WRKSRC}}/COPYING
INFO=			primary:bash
CPE_VENDOR=		gnu
INFO_SUBDIR=		.

PATCHFILES=		2 3 4 5 6 7 8 9 10 11 12

MUST_CONFIGURE=		gnu
CONFIGURE_ARGS=		--enable-readline
			--enable-progcomp
			--enable-process-substitution
			--enable-history
			--enable-help-builtin
			--enable-extended-glob
			--enable-dparen-arithmetic
			--enable-directory-stack
			--enable-debugger
			--enable-cond-regexp
			--enable-alias
			--enable-brace-expansion
			--enable-array-variables
			--without-bash-malloc

INSTALL_REQ_TOOLCHAIN=	yes

CPPFLAGS=		-DDEFAULT_PATH_VALUE='\"{{STANDARD_PATH}}:{{LOCALBASE}}/sbin:{{LOCALBASE}}/bin\"'
			-DSTANDARD_UTILS_PATH='\"{{STANDARD_PATH}}\"'

[NOTSTD].DESCRIPTION=			Non-standard designation

[STATIC].BUILDRUN_DEPENDS_OFF=		ncurses:primary:standard
[STATIC].BUILD_DEPENDS_ON=		ncurses:primary:standard
[STATIC].CFLAGS_OFF=			-Wl,-export-dynamic
[STATIC].CONFIGURE_ENABLE_BOTH=		static-link

[NLS].CONFIGURE_ARGS_ON=		--with-libiconv-prefix={{ICONV_PREFIX}}
[NLS].CONFIGURE_ENABLE_BOTH=		nls
[NLS].USES_ON=				gettext-runtime
					iconv

post-patch:
	# Ensure y.tab.c is regenerated
	${TOUCH} ${WRKSRC}/parse.y
	${RM} ${WRKSRC}/y.tab.c
	@${REINPLACE_CMD} -e "s|%%PREFIX%%|${PREFIX}|g" ${WRKSRC}/doc/bash.1

post-install-NOTSTD-ON:
	${RM} -r ${STAGEDIR}${STD_DOCDIR}

post-install:
	${LN} -sf bash ${STAGEDIR}${PREFIX}/bin/rbash
	${RM} ${STAGEDIR}${STD_DOCDIR}/CHANGES

post-configure:
	@${FIND} ${WRKSRC} -name Makefile -print0 | ${XARGS} -0 \
		${REINPLACE_CMD} -e "s|^DESTDIR *=|& ${DESTDIR}|"

[FILE:310:descriptions/desc.primary]
This is GNU Bash.  Bash is the GNU Project's Bourne Again SHell,
a complete implementation of the POSIX.2 shell spec, but also
with interactive command line editing, job control on architectures
that support it, csh-like features such as history substitution and
brace expansion, and a slew of other features.


[FILE:1227:distinfo]
d86b3392c1202e8ff5a423b302e6284db7f8f435ea9f39b5b1b20fd3ac36dfcb      9377313 bash/bash-4.4.tar.gz
3e28d91531752df9a8cb167ad07cc542abaf944de9353fe8c6a535c9f1f17f0f         1896 bash/bash44-001
7020a0183e17a7233e665b979c78c184ea369cfaf3e8b4b11f5547ecb7c13c53         1946 bash/bash44-002
51df5a9192fdefe0ddca4bdf290932f74be03ffd0503a3d112e4199905e718b2         1593 bash/bash44-003
ad080a30a4ac6c1273373617f29628cc320a35c8cd06913894794293dc52c8b3         2350 bash/bash44-004
221e4b725b770ad0bb6924df3f8d04f89eeca4558f6e4c777dfa93e967090529         1439 bash/bash44-005
6a8e2e2a6180d0f1ce39dcd651622fb6d2fd05db7c459f64ae42d667f1e344b8         1805 bash/bash44-006
de1ccc07b7bfc9e25243ad854f3bbb5d3ebf9155b0477df16aaf00a7b0d5edaf         4640 bash/bash44-007
86144700465933636d7b945e89b77df95d3620034725be161ca0ca5a42e239ba         2223 bash/bash44-008
0b6bdd1a18a0d20e330cc3bc71e048864e4a13652e29dc0ebf3918bea729343c         3117 bash/bash44-009
8465c6f2c56afe559402265b39d9e94368954930f9aa7f3dfa6d36dd66868e06         1670 bash/bash44-010
dd56426ef7d7295e1107c0b3d06c192eb9298f4023c202ca2ba6266c613d170d         1603 bash/bash44-011
fac271d2bf6372c9903e3b353cb9eda044d7fe36b5aab52f21f3f21cd6a2063e         5768 bash/bash44-012


[FILE:2890:manifests/plist.primary]
%%NLS-ON%%share/locale/af/LC_MESSAGES/bash.mo
%%NLS-ON%%share/locale/bg/LC_MESSAGES/bash.mo
%%NLS-ON%%share/locale/ca/LC_MESSAGES/bash.mo
%%NLS-ON%%share/locale/cs/LC_MESSAGES/bash.mo
%%NLS-ON%%share/locale/da/LC_MESSAGES/bash.mo
%%NLS-ON%%share/locale/de/LC_MESSAGES/bash.mo
%%NLS-ON%%share/locale/el/LC_MESSAGES/bash.mo
%%NLS-ON%%share/locale/en@boldquot/LC_MESSAGES/bash.mo
%%NLS-ON%%share/locale/en@quot/LC_MESSAGES/bash.mo
%%NLS-ON%%share/locale/eo/LC_MESSAGES/bash.mo
%%NLS-ON%%share/locale/es/LC_MESSAGES/bash.mo
%%NLS-ON%%share/locale/et/LC_MESSAGES/bash.mo
%%NLS-ON%%share/locale/fi/LC_MESSAGES/bash.mo
%%NLS-ON%%share/locale/fr/LC_MESSAGES/bash.mo
%%NLS-ON%%share/locale/ga/LC_MESSAGES/bash.mo
%%NLS-ON%%share/locale/gl/LC_MESSAGES/bash.mo
%%NLS-ON%%share/locale/hr/LC_MESSAGES/bash.mo
%%NLS-ON%%share/locale/hu/LC_MESSAGES/bash.mo
%%NLS-ON%%share/locale/id/LC_MESSAGES/bash.mo
%%NLS-ON%%share/locale/it/LC_MESSAGES/bash.mo
%%NLS-ON%%share/locale/ja/LC_MESSAGES/bash.mo
%%NLS-ON%%share/locale/lt/LC_MESSAGES/bash.mo
%%NLS-ON%%share/locale/nb/LC_MESSAGES/bash.mo
%%NLS-ON%%share/locale/nl/LC_MESSAGES/bash.mo
%%NLS-ON%%share/locale/pl/LC_MESSAGES/bash.mo
%%NLS-ON%%share/locale/pt_BR/LC_MESSAGES/bash.mo
%%NLS-ON%%share/locale/ro/LC_MESSAGES/bash.mo
%%NLS-ON%%share/locale/ru/LC_MESSAGES/bash.mo
%%NLS-ON%%share/locale/sk/LC_MESSAGES/bash.mo
%%NLS-ON%%share/locale/sl/LC_MESSAGES/bash.mo
%%NLS-ON%%share/locale/sr/LC_MESSAGES/bash.mo
%%NLS-ON%%share/locale/sv/LC_MESSAGES/bash.mo
%%NLS-ON%%share/locale/tr/LC_MESSAGES/bash.mo
%%NLS-ON%%share/locale/uk/LC_MESSAGES/bash.mo
%%NLS-ON%%share/locale/vi/LC_MESSAGES/bash.mo
%%NLS-ON%%share/locale/zh_CN/LC_MESSAGES/bash.mo
%%NLS-ON%%share/locale/zh_TW/LC_MESSAGES/bash.mo
@shell bin/bash
@shell bin/rbash
bin/bashbug
%%STATIC-OFF%%include/bash/
 alias.h
 array.h
 arrayfunc.h
 assoc.h
 bashansi.h
 bashintl.h
 bashjmp.h
 bashtypes.h
 builtins.h
%%STATIC-OFF%%include/bash/builtins/
 bashgetopt.h
 builtext.h
 common.h
 getopt.h
%%STATIC-OFF%%include/bash/
 command.h
 config-bot.h
 config-top.h
 config.h
 conftypes.h
 dispose_cmd.h
 error.h
 externs.h
 general.h
 hashlib.h
%%STATIC-OFF%%include/bash/include/
 ansi_stdlib.h
 chartypes.h
 filecntl.h
 gettext.h
 maxpath.h
 memalloc.h
 ocache.h
 posixdir.h
 posixjmp.h
 posixstat.h
 posixtime.h
 posixwait.h
 shmbchar.h
 shmbutil.h
 shtty.h
 stat-time.h
 stdc.h
 systimes.h
 typemax.h
 unionwait.h
%%STATIC-OFF%%include/bash/
 jobs.h
 make_cmd.h
 pathnames.h
 quit.h
 shell.h
 sig.h
 siglist.h
 signames.h
 subst.h
 syntax.h
 unwind_prot.h
 variables.h
 version.h
 xmalloc.h
 y.tab.h
%%STATIC-OFF%%lib/bash/
 Makefile.inc
 basename
 dirname
 finfo
 head
 id
 ln
 logname
 mkdir
 mypid
 pathchk
 print
 printenv
 push
 realpath
 rmdir
 setpgid
 sleep
 strftime
 sync
 tee
 truefalse
 tty
 uname
 unlink
 whoami
%%STATIC-OFF%%lib/pkgconfig/bash.pc
share/man/man1/
 bash.1.gz
 bashbug.1.gz


[FILE:89:manifests/plist.docs]
share/doc/bash/
 FAQ
 INTRO
 COMPAT
 NEWS
 POSIX
 RBASH
 README
 bash.html
 bashref.html


[FILE:314:patches/patch-config-top.h]
--- config-top.h.orig	2016-05-19 18:34:02 UTC
+++ config-top.h
@@ -74,7 +74,7 @@
 #endif
 
 /* Default primary and secondary prompt strings. */
-#define PPROMPT "\\s-\\v\\$ "
+#define PPROMPT "[\\u@\\h \\w]\\$ "
 #define SPROMPT "> "
 
 /* Undefine this if you don't want the ksh-compatible behavior of reprinting


[FILE:748:patches/patch-doc_Makefile.in]
--- doc/Makefile.in.orig	2015-12-07 00:55:56 UTC
+++ doc/Makefile.in
@@ -175,7 +175,7 @@ pdf: ${PDFFILES}
 bashref.dvi: $(BASHREF_FILES) $(HSUSER) $(RLUSER)
 	${SET_TEXINPUTS} $(TEXI2DVI) $(srcdir)/bashref.texi || { ${RM} $@ ; exit 1; }
 
-bashref.info: $(BASHREF_FILES) $(HSUSER) $(RLUSER)
+bash.info: $(BASHREF_FILES) $(HSUSER) $(RLUSER)
 	$(MAKEINFO) --no-split -I$(TEXINPUTDIR) $(srcdir)/bashref.texi
 
 # experimental
@@ -188,9 +188,6 @@ bashref.pdf: $(BASHREF_FILES) $(HSUSER) 
 bashref.html: $(BASHREF_FILES) $(HSUSER) $(RLUSER)
 	$(MAKEINFO) --html --no-split -I$(TEXINPUTDIR) $(srcdir)/bashref.texi
 
-bash.info: bashref.info
-	${SHELL} ${INFOPOST} < $(srcdir)/bashref.info > $@ ; \
-
 bash.txt: bash.1
 bash.ps: bash.1
 bash.html: bash.1


[FILE:500:patches/patch-doc_bash.1]
--- doc/bash.1.orig	2016-09-29 22:30:30 UTC
+++ doc/bash.1
@@ -2364,7 +2364,7 @@ The value of this parameter is expanded 
 .SM
 .B PROMPTING
 below) and used as the primary prompt string.  The default value is
-``\fB\es\-\ev\e$ \fP''.
+``\fB\eu\@\eh\e$ \fP''.
 .TP
 .B PS2
 The value of this parameter is expanded as with
@@ -10556,7 +10556,7 @@ http://tiswww.case.edu/~chet/bash/POSIX 
 .SH FILES
 .PD 0
 .TP
-.FN /bin/bash
+.FN %%PREFIX%%/bin/bash
 The \fBbash\fP executable
 .TP
 .FN /etc/profile


[FILE:945:patches/patch-doc_bashref.texi]
--- doc/bashref.texi.orig	2016-09-29 22:30:30 UTC
+++ doc/bashref.texi
@@ -1,6 +1,6 @@
 \input texinfo.tex @c -*- texinfo -*-
 @c %**start of header
-@setfilename bashref.info
+@setfilename bash.info
 @settitle Bash Reference Manual
 
 @include version.texi
@@ -8,7 +8,7 @@
 
 @copying
 This text is a brief description of the features that are present in
-the Bash shell (version @value{VERSION}, @value{UPDATED}).
+the Bash shell (version @value{VERSION}, @value{UPDATED})
 
 This is Edition @value{EDITION}, last updated @value{UPDATED},
 of @cite{The GNU Bash Reference Manual},
@@ -5443,7 +5443,7 @@ A null directory name may appear as two 
 or trailing colon.
 
 @item PS1
-The primary prompt string.  The default value is @samp{\s-\v\$ }.
+The primary prompt string.  The default value is @samp{[\u@@\h \w]\$ }.
 @xref{Controlling the Prompt}, for the complete list of escape
 sequences that are expanded before @env{PS1} is displayed.
 


[FILE:511:patches/patch-lib_readline_display.c]
--- lib/readline/display.c.orig	2016-07-28 18:49:33 UTC
+++ lib/readline/display.c
@@ -743,7 +743,10 @@ rl_redisplay ()
   inv_lbreaks[newlines = 0] = 0;
   /* lpos is a physical cursor position, so it needs to be adjusted by the
      number of invisible characters in the prompt, per line */
+  if (local_prompt)
   lpos = prompt_physical_chars + modmark;
+  else
+    lpos = 0;
 
 #if defined (HANDLE_MULTIBYTE)
   memset (line_state_invisible->wrapped_line, 0, line_state_invisible->wbsize * sizeof (int));


[FILE:652:files/special.mk]
# On linux with glibc, we can't build a fully static bash because
# of absurd restrictions put on static linking with nss, dlopen, etc.
# So we build it dynamic but with libtinfo static.  Leaving glibc-based
# libraries like libc, libm, pthread, etc, is okay.

.if ${OPSYS} == Linux
.  if "${PLIST_SUB:MSTATIC-ON=*}" == "STATIC-ON="
CONFIGURE_ARGS:=	${CONFIGURE_ARGS:N--enable-static-link}
CFLAGS+=		-Wl,-export-dynamic
CONFIGURE_ENV+=		ac_cv_func_dlopen=no

TINFOLIBS=		${LOCALBASE}/lib/libtinfo.a \
			${LOCALBASE}/lib/db5/libdb.a \
			-lpthread

post-configure-opsys:
	${REINPLACE_CMD} -e 's|-ltinfo|${TINFOLIBS}|' ${WRKSRC}/Makefile
.  endif
.endif
