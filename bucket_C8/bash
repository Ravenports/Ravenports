# Buildsheet autogenerated by ravenadm tool -- Do not edit.

NAMEBASE=		bash
VERSION=		5.0.11
KEYWORDS=		shells
VARIANTS=		standard static nls
SDESC[nls]=		GNU Bourne Again SHell with native lang support
SDESC[standard]=	GNU Bourne Again SHell
SDESC[static]=		Static GNU Bourne Again SHell
HOMEPAGE=		http://www.gnu.org/software/bash/bash.html
CONTACT=		nobody

DOWNLOAD_GROUPS=	main patches
SITES[main]=		GNU/bash
SITES[patches]=		GNU/bash/bash-5.0-patches
DISTFILE[1]=		bash-5.0.tar.gz:main
DISTFILE[2]=		bash50-001:patches
DISTFILE[3]=		bash50-002:patches
DISTFILE[4]=		bash50-003:patches
DISTFILE[5]=		bash50-004:patches
DISTFILE[6]=		bash50-005:patches
DISTFILE[7]=		bash50-006:patches
DISTFILE[8]=		bash50-007:patches
DISTFILE[9]=		bash50-008:patches
DISTFILE[10]=		bash50-009:patches
DISTFILE[11]=		bash50-010:patches
DISTFILE[12]=		bash50-011:patches
DIST_SUBDIR=		bash
DF_INDEX=		1
SPKGS[nls]=		primary
SPKGS[standard]=	complete
			primary
			docs
SPKGS[static]=		primary

OPTIONS_AVAILABLE=	STATIC NLS NOTSTD
OPTIONS_STANDARD=	STATIC NLS
VOPTS[nls]=		STATIC=OFF NLS=ON NOTSTD=ON
VOPTS[static]=		STATIC=ON NLS=OFF NOTSTD=ON

USES=			bison cpe

DISTNAME=		bash-5.0

LICENSE=		GPLv3+:primary
LICENSE_TERMS=		primary:{{WRKDIR}}/TERMS
LICENSE_FILE=		GPLv3+:{{WRKSRC}}/COPYING
LICENSE_AWK=		TERMS:"<config.h>"
LICENSE_SOURCE=		TERMS:{{WRKSRC}}/version.c
LICENSE_SCHEME=		solo

INFO=			primary:bash
CPE_VENDOR=		gnu
FPC_EQUIVALENT=		shells/bash
INFO_SUBDIR=		.

PATCHFILES=		2 3 4 5 6 7 8 9 10 11 12

INVALID_RPATH=		yes
MUST_CONFIGURE=		gnu
CONFIGURE_ARGS=		--enable-readline
			--enable-progcomp
			--enable-process-substitution
			--enable-history
			--enable-help-builtin
			--enable-extended-glob
			--enable-dparen-arithmetic
			--enable-directory-stack
			--enable-debugger
			--enable-cond-regexp
			--enable-alias
			--enable-brace-expansion
			--enable-array-variables
			--without-bash-malloc

INSTALL_REQ_TOOLCHAIN=	yes

CPPFLAGS=		-DDEFAULT_PATH_VALUE='\"{{STANDARD_PATH}}:{{LOCALBASE}}/sbin:{{LOCALBASE}}/bin\"'
			-DSTANDARD_UTILS_PATH='\"{{STANDARD_PATH}}\"'
VAR_OPSYS[freebsd]=	VAR1=-Wl,--export-dynamic
VAR_OPSYS[linux]=	VAR1=-Wl,--export-dynamic
VAR_OPSYS[dragonfly]=	VAR1=-Wl,--export-dynamic

[NOTSTD].DESCRIPTION=			Non-standard designation
[NOTSTD].USES_OFF=			makeinfo

[STATIC].BUILDRUN_DEPENDS_OFF=		ncurses:primary:standard
[STATIC].BUILD_DEPENDS_ON=		ncurses:primary:static

[NLS].CONFIGURE_ARGS_ON=		--with-libiconv-prefix={{ICONV_PREFIX}}
[NLS].CONFIGURE_ENABLE_BOTH=		nls
[NLS].USES_ON=				gettext-runtime
					iconv

post-patch:
	# Ensure y.tab.c is regenerated
	${TOUCH} ${WRKSRC}/parse.y
	${RM} ${WRKSRC}/y.tab.c
	${REINPLACE_CMD} -e "s|%%PREFIX%%|${PREFIX}|g" ${WRKSRC}/doc/bash.1

post-install-NOTSTD-ON:
	${RM} -r ${STAGEDIR}${STD_DOCDIR}

post-install-STATIC-ON:
	# These are not installed when --enable-static-link set
	${RM} -r ${STAGEDIR}${PREFIX}/include
	${RM} -r ${STAGEDIR}${PREFIX}/lib

post-install:
	${LN} -sf bash ${STAGEDIR}${PREFIX}/bin/rbash
	${RM} ${STAGEDIR}${STD_DOCDIR}/CHANGES

post-configure:
	${FIND} ${WRKSRC} -name Makefile -print0 | ${XARGS} -0 \
		${REINPLACE_CMD} -e "s|^DESTDIR *=|& ${DESTDIR}|"

[FILE:310:descriptions/desc.primary]
This is GNU Bash.  Bash is the GNU Project's Bourne Again SHell,
a complete implementation of the POSIX.2 shell spec, but also
with interactive command line editing, job control on architectures
that support it, csh-like features such as history substitution and
brace expansion, and a slew of other features.


[FILE:1133:distinfo]
b4a80f2ac66170b2913efbfb9f2594f1f76c7b1afd11f799e22035d63077fb4d     10135110 bash/bash-5.0.tar.gz
f2fe9e1f0faddf14ab9bfa88d450a75e5d028fedafad23b88716bd657c737289         4133 bash/bash50-001
87e87d3542e598799adb3e7e01c8165bc743e136a400ed0de015845f7ff68707         4380 bash/bash50-002
4eebcdc37b13793a232c5f2f498a5fcbf7da0ecb3da2059391c096db620ec85b         6434 bash/bash50-003
14447ad832add8ecfafdce5384badd933697b559c4688d6b9e3d36ff36c62f08         1664 bash/bash50-004
5bf54dd9bd2c211d2bfb34a49e2c741f2ed5e338767e9ce9f4d41254bf9f8276         3732 bash/bash50-005
d68529a6ff201b6ff5915318ab12fc16b8a0ebb77fda3308303fcc1e13398420         1275 bash/bash50-006
17b41e7ee3673d8887dd25992417a398677533ab8827938aa41fad70df19af9b         1640 bash/bash50-007
eec64588622a82a5029b2776e218a75a3640bef4953f09d6ee1f4199670ad7e3         2622 bash/bash50-008
ed3ca21767303fc3de93934aa524c2e920787c506b601cc40a4897d4b094d903         1095 bash/bash50-009
d6fbc325f0b5dc54ddbe8ee43020bced8bd589ddffea59d128db14b2e52a8a11         6407 bash/bash50-010
2c4de332b91eaf797abbbd6c79709690b5cbd48b12e8dfe748096dbd7bf474ea         1870 bash/bash50-011


[FILE:2921:manifests/plist.primary]
@shell bin/bash
@shell bin/rbash
%%NLS-ON%%share/locale/af/LC_MESSAGES/bash.mo
%%NLS-ON%%share/locale/bg/LC_MESSAGES/bash.mo
%%NLS-ON%%share/locale/ca/LC_MESSAGES/bash.mo
%%NLS-ON%%share/locale/cs/LC_MESSAGES/bash.mo
%%NLS-ON%%share/locale/da/LC_MESSAGES/bash.mo
%%NLS-ON%%share/locale/de/LC_MESSAGES/bash.mo
%%NLS-ON%%share/locale/el/LC_MESSAGES/bash.mo
%%NLS-ON%%share/locale/en@boldquot/LC_MESSAGES/bash.mo
%%NLS-ON%%share/locale/en@quot/LC_MESSAGES/bash.mo
%%NLS-ON%%share/locale/eo/LC_MESSAGES/bash.mo
%%NLS-ON%%share/locale/es/LC_MESSAGES/bash.mo
%%NLS-ON%%share/locale/et/LC_MESSAGES/bash.mo
%%NLS-ON%%share/locale/fi/LC_MESSAGES/bash.mo
%%NLS-ON%%share/locale/fr/LC_MESSAGES/bash.mo
%%NLS-ON%%share/locale/ga/LC_MESSAGES/bash.mo
%%NLS-ON%%share/locale/gl/LC_MESSAGES/bash.mo
%%NLS-ON%%share/locale/hr/LC_MESSAGES/bash.mo
%%NLS-ON%%share/locale/hu/LC_MESSAGES/bash.mo
%%NLS-ON%%share/locale/id/LC_MESSAGES/bash.mo
%%NLS-ON%%share/locale/it/LC_MESSAGES/bash.mo
%%NLS-ON%%share/locale/ja/LC_MESSAGES/bash.mo
%%NLS-ON%%share/locale/lt/LC_MESSAGES/bash.mo
%%NLS-ON%%share/locale/nb/LC_MESSAGES/bash.mo
%%NLS-ON%%share/locale/nl/LC_MESSAGES/bash.mo
%%NLS-ON%%share/locale/pl/LC_MESSAGES/bash.mo
%%NLS-ON%%share/locale/pt/LC_MESSAGES/bash.mo
%%NLS-ON%%share/locale/pt_BR/LC_MESSAGES/bash.mo
%%NLS-ON%%share/locale/ro/LC_MESSAGES/bash.mo
%%NLS-ON%%share/locale/ru/LC_MESSAGES/bash.mo
%%NLS-ON%%share/locale/sk/LC_MESSAGES/bash.mo
%%NLS-ON%%share/locale/sl/LC_MESSAGES/bash.mo
%%NLS-ON%%share/locale/sr/LC_MESSAGES/bash.mo
%%NLS-ON%%share/locale/sv/LC_MESSAGES/bash.mo
%%NLS-ON%%share/locale/tr/LC_MESSAGES/bash.mo
%%NLS-ON%%share/locale/uk/LC_MESSAGES/bash.mo
%%NLS-ON%%share/locale/vi/LC_MESSAGES/bash.mo
%%NLS-ON%%share/locale/zh_CN/LC_MESSAGES/bash.mo
%%NLS-ON%%share/locale/zh_TW/LC_MESSAGES/bash.mo
%%NOTSTD-OFF%%share/man/man1/
 bash.1.gz
 bashbug.1.gz
%%STATIC-OFF%%include/bash/
 alias.h
 array.h
 arrayfunc.h
 assoc.h
 bashansi.h
 bashintl.h
 bashjmp.h
 bashtypes.h
 builtins.h
 command.h
 config-bot.h
 config-top.h
 config.h
 conftypes.h
 dispose_cmd.h
 error.h
 externs.h
 general.h
 hashlib.h
 jobs.h
 make_cmd.h
 pathnames.h
 quit.h
 shell.h
 sig.h
 siglist.h
 signames.h
 subst.h
 syntax.h
 unwind_prot.h
 variables.h
 version.h
 xmalloc.h
 y.tab.h
%%STATIC-OFF%%include/bash/builtins/
 bashgetopt.h
 builtext.h
 common.h
 getopt.h
%%STATIC-OFF%%include/bash/include/
 ansi_stdlib.h
 chartypes.h
 filecntl.h
 gettext.h
 maxpath.h
 memalloc.h
 ocache.h
 posixdir.h
 posixjmp.h
 posixstat.h
 posixtime.h
 posixwait.h
 shmbchar.h
 shmbutil.h
 shtty.h
 stat-time.h
 stdc.h
 systimes.h
 typemax.h
 unionwait.h
%%STATIC-OFF%%lib/bash/
 Makefile.inc
 basename
 dirname
 fdflags
 finfo
 head
 id
 ln
 loadables.h
 logname
 mkdir
 mypid
 pathchk
 print
 printenv
 push
 realpath
 rmdir
 seq
 setpgid
 sleep
 strftime
 sync
 tee
 truefalse
 tty
 uname
 unlink
 whoami
%%STATIC-OFF%%lib/pkgconfig/bash.pc
bin/bashbug


[FILE:89:manifests/plist.docs]
share/doc/bash/
 COMPAT
 FAQ
 INTRO
 NEWS
 POSIX
 RBASH
 README
 bash.html
 bashref.html


[FILE:314:patches/patch-config-top.h]
--- config-top.h.orig	2018-10-12 19:35:23 UTC
+++ config-top.h
@@ -78,7 +78,7 @@
 #endif
 
 /* Default primary and secondary prompt strings. */
-#define PPROMPT "\\s-\\v\\$ "
+#define PPROMPT "[\\u@\\h \\w]\\$ "
 #define SPROMPT "> "
 
 /* Undefine this if you don't want the ksh-compatible behavior of reprinting


[FILE:747:patches/patch-doc_Makefile.in]
--- doc/Makefile.in.orig	2015-12-07 00:55:56 UTC
+++ doc/Makefile.in
@@ -175,7 +175,7 @@ pdf: ${PDFFILES}
 bashref.dvi: $(BASHREF_FILES) $(HSUSER) $(RLUSER)
 	${SET_TEXINPUTS} $(TEXI2DVI) $(srcdir)/bashref.texi || { ${RM} $@ ; exit 1; }
 
-bashref.info: $(BASHREF_FILES) $(HSUSER) $(RLUSER)
+bash.info: $(BASHREF_FILES) $(HSUSER) $(RLUSER)
 	$(MAKEINFO) --no-split -I$(TEXINPUTDIR) $(srcdir)/bashref.texi
 
 # experimental
@@ -188,9 +188,6 @@ bashref.pdf: $(BASHREF_FILES) $(HSUSER)
 bashref.html: $(BASHREF_FILES) $(HSUSER) $(RLUSER)
 	$(MAKEINFO) --html --no-split -I$(TEXINPUTDIR) $(srcdir)/bashref.texi
 
-bash.info: bashref.info
-	${SHELL} ${INFOPOST} < $(srcdir)/bashref.info > $@ ; \
-
 bash.txt: bash.1
 bash.ps: bash.1
 bash.html: bash.1


[FILE:498:patches/patch-doc_bash.1]
--- doc/bash.1.orig	2019-01-02 14:14:30 UTC
+++ doc/bash.1
@@ -2444,7 +2444,7 @@ The value of this parameter is expanded
 .SM
 .B PROMPTING
 below) and used as the primary prompt string.  The default value is
-``\fB\es\-\ev\e$ \fP''.
+``\fB\eu\@\eh\e$ \fP''.
 .TP
 .B PS2
 The value of this parameter is expanded as with
@@ -10880,7 +10880,7 @@ http://tiswww.case.edu/~chet/bash/POSIX
 .SH FILES
 .PD 0
 .TP
-.FN /bin/bash
+.FN %%PREFIX%%/bin/bash
 The \fBbash\fP executable
 .TP
 .FN /etc/profile


[FILE:944:patches/patch-doc_bashref.texi]
--- doc/bashref.texi.orig	2019-01-02 14:14:27 UTC
+++ doc/bashref.texi
@@ -1,6 +1,6 @@
 \input texinfo.tex @c -*- texinfo -*-
 @c %**start of header
-@setfilename bashref.info
+@setfilename bash.info
 @settitle Bash Reference Manual
 
 @include version.texi
@@ -8,7 +8,7 @@
 
 @copying
 This text is a brief description of the features that are present in
-the Bash shell (version @value{VERSION}, @value{UPDATED}).
+the Bash shell (version @value{VERSION}, @value{UPDATED})
 
 This is Edition @value{EDITION}, last updated @value{UPDATED},
 of @cite{The GNU Bash Reference Manual},
@@ -5598,7 +5598,7 @@ A null directory name may appear as two
 or trailing colon.
 
 @item PS1
-The primary prompt string.  The default value is @samp{\s-\v\$ }.
+The primary prompt string.  The default value is @samp{[\u@@\h \w]\$ }.
 @xref{Controlling the Prompt}, for the complete list of escape
 sequences that are expanded before @env{PS1} is displayed.
 


[FILE:230:patches/patch-examples_loadables_fdflags.c]
--- examples/loadables/fdflags.c.orig	2017-02-02 16:40:42 UTC
+++ examples/loadables/fdflags.c
@@ -73,6 +73,8 @@ static const struct
 #endif
 #ifdef O_CLOEXEC
   { "cloexec",	O_CLOEXEC	},
+#else
+#define O_CLOEXEC 0
 #endif
 };
 


[FILE:533:patches/patch-lib_readline_display.c]
--- lib/readline/display.c.orig	2018-10-01 01:37:48 UTC
+++ lib/readline/display.c
@@ -837,7 +837,10 @@ rl_redisplay (void)
      the line breaks in the prompt string in expand_prompt, taking invisible
      characters into account, and if lpos exceeds the screen width, we copy
      the data in the loop below. */
+  if (local_prompt)
   lpos = prompt_physical_chars + modmark;
+  else
+    lpos = 0;
 
 #if defined (HANDLE_MULTIBYTE)
   memset (line_state_invisible->wrapped_line, 0, line_state_invisible->wbsize * sizeof (int));


[FILE:266:patches/patch-lib_termcap_ltcap.h]
--- lib/termcap/ltcap.h.orig	2009-01-04 19:32:36 UTC
+++ lib/termcap/ltcap.h
@@ -19,9 +19,7 @@
 #ifndef _LTCAP_H_
 #define _LTCAP_H_ 1
 
-#if !defined (__APPLE__)
 #  define __private_extern__
-#endif
 
 #ifndef MAX_TGETENT_BUFSIZ
 #  define MAX_TGETENT_BUFSIZ 2048


[FILE:364:patches/patch-support_Makefile.in]
--- support/Makefile.in.orig	2018-05-11 18:28:43 UTC
+++ support/Makefile.in
@@ -77,7 +77,7 @@ OBJ1 =	man2html.o
 all: man2html$(EXEEXT)
 
 man2html$(EXEEXT): $(OBJ1)
-	$(CC_FOR_BUILD) $(CCFLAGS_FOR_BUILD) $(OBJ1) -o $@ ${LIBS_FOR_BUILD}
+	$(CC_FOR_BUILD) $(CCFLAGS_FOR_BUILD) $(OBJ1) -o $@ ${LIBS_FOR_BUILD} ${LDFLAGS}
 
 clean:
 	$(RM) man2html$(EXEEXT) $(OBJ1)


[FILE:558:patches/patch-support_shobj-conf]
--- support/shobj-conf.orig	2016-10-05 20:02:11 UTC
+++ support/shobj-conf
@@ -113,7 +113,7 @@ sunos5*-*gcc*|solaris2*-*gcc*)
 	SHLIB_LIBVERSION='$(SHLIB_LIBSUFF).$(SHLIB_MAJOR)'
 	;;
 
-sunos5*|solaris2*)
+sunos5*)
 	SHOBJ_CFLAGS='-K pic'
 	SHOBJ_LD=/usr/ccs/bin/ld
 	SHOBJ_LDFLAGS='-G -dy -z text -i -h $@'
@@ -160,7 +160,7 @@ freebsd3*|freebsdaout*)
 	;;
 
 # FreeBSD-4.x and later have only ELF
-freebsd[4-9]*|freebsd1[0-9]*|freebsdelf*|dragonfly*)
+freebsd[4-9]*|freebsd1[0-9]*|freebsdelf*|dragonfly*|solaris*)
 	SHOBJ_CFLAGS=-fPIC
 	SHOBJ_LD='${CC}'
 


[FILE:757:files/special.mk]
# On linux with glibc, we can't build a fully static bash because
# of absurd restrictions put on static linking with nss, dlopen, etc.
# So we build it dynamic but with libtinfo static.  Leaving glibc-based
# libraries like libc, libm, pthread, etc, is okay.

.if ${OPSYS} == Linux
.  if "${PLIST_SUB:MSTATIC-ON=*}" == "STATIC-ON="
CONFIGURE_ARGS:=	${CONFIGURE_ARGS:N--enable-static-link}
CONFIGURE_ENV+=		ac_cv_func_dlopen=no

TINFOLIBS=		${LOCALBASE}/lib/libtinfo.a \
			${LOCALBASE}/lib/db5/libdb.a \
			-lpthread

post-configure-opsys:
	${REINPLACE_CMD} -e 's|-ltinfo|${TINFOLIBS}|' ${WRKSRC}/Makefile
.  endif
.endif

# we could have used LDFLAGS_OFF options helper, but it doesn't
# currently exist

.if ${VARIANT} != static
LDFLAGS+=	${VAR1}
.endif


[FILE:2609:sunos/patch-configure]
--- configure.orig	2019-01-02 14:43:31 UTC
+++ configure
@@ -4953,14 +4953,18 @@ prefer_static=no
 if test "$opt_static_link" = yes; then
 	prefer_static=yes
 	prefer_shared=no
+	TINFO_LIBRARY=${prefix}/lib/libtinfo.a
 	# if we're using gcc, add `-static' to LDFLAGS, except on Solaris >= 2
 	if test -n "$GCC" || test "$ac_cv_c_compiler_gnu" = "yes"; then
 		STATIC_LD="-static"
 		case "$host_os" in
-		solaris2*|linux*)	;;
+		linux*)	;;
+		solaris*)	STATIC_LD= ;;
 		*)		LDFLAGS="$LDFLAGS -static" ;;	# XXX experimental
 		esac
 	fi
+else
+	TINFO_LIBRARY=-ltinfo
 fi
 
 # set the appropriate make variables for building the "build tools"
@@ -5100,13 +5104,13 @@ $as_echo "$ac_cv_lib_termcap_tgetent" >&
 if test "x$ac_cv_lib_termcap_tgetent" = xyes; then :
   bash_cv_termcap_lib=libtermcap
 else
-  { $as_echo "$as_me:${as_lineno-$LINENO}: checking for tgetent in -ltinfo" >&5
-$as_echo_n "checking for tgetent in -ltinfo... " >&6; }
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking for tgetent in ${TINFO_LIBRARY}" >&5
+$as_echo_n "checking for tgetent in ${TINFO_LIBRARY}... " >&6; }
 if ${ac_cv_lib_tinfo_tgetent+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   ac_check_lib_save_LIBS=$LIBS
-LIBS="-ltinfo  $LIBS"
+LIBS="${TINFO_LIBRARY}  $LIBS"
 cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
@@ -5285,7 +5289,7 @@ elif test $bash_cv_termcap_lib = libterm
 TERMCAP_LIB=-ltermcap
 TERMCAP_DEP=
 elif test $bash_cv_termcap_lib = libtinfo; then
-TERMCAP_LIB=-ltinfo
+TERMCAP_LIB=${TINFO_LIBRARY}
 TERMCAP_DEP=
 elif test $bash_cv_termcap_lib = libncurses; then
 TERMCAP_LIB=-lncurses
@@ -15981,13 +15985,13 @@ $as_echo "$ac_cv_lib_termcap_tgetent" >&
 if test "x$ac_cv_lib_termcap_tgetent" = xyes; then :
   bash_cv_termcap_lib=libtermcap
 else
-  { $as_echo "$as_me:${as_lineno-$LINENO}: checking for tgetent in -ltinfo" >&5
-$as_echo_n "checking for tgetent in -ltinfo... " >&6; }
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking for tgetent in ${TINFO_LIBRARY}" >&5
+$as_echo_n "checking for tgetent in ${TINFO_LIBRARY}... " >&6; }
 if ${ac_cv_lib_tinfo_tgetent+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   ac_check_lib_save_LIBS=$LIBS
-LIBS="-ltinfo  $LIBS"
+LIBS="${TINFO_LIBRARY}  $LIBS"
 cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
@@ -16166,7 +16170,7 @@ elif test $bash_cv_termcap_lib = libterm
 TERMCAP_LIB=-ltermcap
 TERMCAP_DEP=
 elif test $bash_cv_termcap_lib = libtinfo; then
-TERMCAP_LIB=-ltinfo
+TERMCAP_LIB=${TINFO_LIBRARY}
 TERMCAP_DEP=
 elif test $bash_cv_termcap_lib = libncurses; then
 TERMCAP_LIB=-lncurses

