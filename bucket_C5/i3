# Buildsheet autogenerated by ravenadm tool -- Do not edit.

NAMEBASE=		i3
VERSION=		4.24
KEYWORDS=		x11_wm
VARIANTS=		std
SDESC[std]=		Improved dynamic tiling window manager
HOMEPAGE=		https://i3wm.org/
CONTACT=		nobody

DOWNLOAD_GROUPS=	main
SITES[main]=		https://i3wm.org/downloads/
DISTFILE[1]=		i3-4.24.tar.xz:main
DF_INDEX=		1
SPKGS[std]=		set
			primary
			dev
			man
			docs

OPTIONS_AVAILABLE=	none
OPTIONS_STANDARD=	none

BUILD_DEPENDS=		bash:primary:std
			libev:dev:std
			glib:dev:std
			harfbuzz:dev:std
			libxkbcommon:dev:std
			gettext:solinks:std
			yajl:dev:std
BUILDRUN_DEPENDS=	startup-notification:single:std
			yajl:primary:std
			libxkbcommon:primary:std
			libev:primary:std
RUN_DEPENDS=		perl-IPC-Run:single:perl_default
			perl-Try-Tiny:single:perl_default
			perl-AnyEvent-I3:single:perl_default

USES=			meson perl zlib gettext:build fontconfig:build
GNOME_COMPONENTS=	cairo pango
XORG_COMPONENTS=	xcb xcb-util xcb-util-cursor xcb-util-keysyms
			xcb-util-wm xcb-util-xrm

FPC_EQUIVALENT=		x11-wm/i3

INSTALL_TARGET=		install-strip

VAR_OPSYS[linux]=	CFLAGS=-DHAVE_strndup=1

post-install:
	${INSTALL_DATA} ${WRKSRC}/man/*.1 ${STAGEDIR}${MANPREFIX}/man/man1/

[FILE:257:descriptions/desc.primary]
i3 is a tiling window manager, completely written from scratch. The target
platforms are GNU/Linux and BSD operating systems, the code is Free and
Open Source Software (FOSS) under the BSD license. i3 is primarily targeted
at advanced users and developers.


[FILE:93:distinfo]
5baefd0e5e78f1bafb7ac85deea42bcd3cbfe65f1279aa96f7e49661637ac981      1358292 i3-4.24.tar.xz


[FILE:326:manifests/plist.primary]
bin/
 i3
 i3-config-wizard
 i3-dmenu-desktop
 i3-dump-log
 i3-input
 i3-migrate-config-to-v4
 i3-msg
 i3-nagbar
 i3-save-tree
 i3-sensible-editor
 i3-sensible-pager
 i3-sensible-terminal
 i3-with-shmlog
 i3bar
etc/i3/
 config
 config.keycodes
share/applications/i3.desktop
share/xsessions/
 i3-with-shmlog.desktop
 i3.desktop


[FILE:17:manifests/plist.dev]
include/i3/ipc.h


[FILE:231:manifests/plist.man]
share/man/man1/
 i3-config-wizard.1
 i3-dmenu-desktop.1
 i3-dump-log.1
 i3-input.1
 i3-migrate-config-to-v4.1
 i3-msg.1
 i3-nagbar.1
 i3-save-tree.1
 i3-sensible-editor.1
 i3-sensible-pager.1
 i3-sensible-terminal.1
 i3.1
 i3bar.1


[FILE:562:manifests/plist.docs]
share/doc/i3/
 bigpicture.png
 debugging.html
 gaps1920.png
 hacking-howto.html
 i3-sync-working.png
 i3-sync.png
 i3bar-protocol.html
 i3bar-workspace-protocol.html
 ipc.html
 keyboard-layer1.png
 keyboard-layer2.png
 layout-saving-1.png
 layout-saving.html
 logo-30.png
 modes.png
 multi-monitor.html
 refcard.html
 refcard_style.css
 single_terminal.png
 snapping.png
 testsuite.html
 tree-layout1.png
 tree-layout2.png
 tree-shot1.png
 tree-shot2.png
 tree-shot3.png
 tree-shot4.png
 two_columns.png
 two_terminals.png
 userguide.html
 wsbar.html
 wsbar.png


[FILE:729:patches/patch-libi3_get__exe__path.c]
--- libi3/get_exe_path.c.orig	2024-11-06 17:26:52 UTC
+++ libi3/get_exe_path.c
@@ -25,11 +25,12 @@ char *get_exe_path(const char *argv0) {
     char *destpath = smalloc(destpath_size);
     char *tmp = smalloc(tmp_size);
 
-#if defined(__linux__) || defined(__FreeBSD__) || defined(__FreeBSD_kernel__)
+#if defined(__linux__) || defined(__DragonFly__) \
+ || defined(__FreeBSD__) || defined(__FreeBSD_kernel__)
 /* Linux and Debian/kFreeBSD provide /proc/self/exe */
 #if defined(__linux__) || defined(__FreeBSD_kernel__)
     const char *exepath = "/proc/self/exe";
-#elif defined(__FreeBSD__)
+#elif defined(__FreeBSD__) || defined(__DragonFly__)
     const char *exepath = "/proc/curproc/file";
 #endif
     ssize_t linksize;


[FILE:723:patches/patch-src_log.c]
--- src/log.c.orig	2024-11-06 17:26:52 UTC
+++ src/log.c
@@ -143,7 +143,7 @@ void open_logbuffer(void) {
         logbuffer_size = physical_mem_bytes * 0.01;
     }
 
-#if defined(__FreeBSD__)
+#if defined(__FreeBSD__) || defined(__DragonFly__)
     sasprintf(&shmlogname, "/tmp/i3-log-%d", getpid());
 #else
     sasprintf(&shmlogname, "/i3-log-%d", getpid());
@@ -154,7 +154,7 @@ void open_logbuffer(void) {
         return;
     }
 
-#if defined(__OpenBSD__) || defined(__APPLE__)
+#if defined(__OpenBSD__) || defined(__APPLE__) || defined(__DragonFly__)
     if (ftruncate(logbuffer_shm, logbuffer_size) == -1) {
         fprintf(stderr, "Could not ftruncate SHM segment for the i3 log: %s\n", strerror(errno));
 #else

