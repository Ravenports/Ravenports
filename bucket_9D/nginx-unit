# Buildsheet autogenerated by ravenadm tool -- Do not edit.

NAMEBASE=		nginx-unit
VERSION=		1.16.0
KEYWORDS=		www
VARIANTS=		standard
SDESC[standard]=	Dynamic web application server
HOMEPAGE=		https://unit.nginx.org/
CONTACT=		nobody

DOWNLOAD_GROUPS=	main
SITES[main]=		https://unit.nginx.org/download/
DISTFILE[1]=		unit-1.16.0.tar.gz:main
DF_INDEX=		1
SPKGS[standard]=	complete
			unitd
			python
			perl
			php72
			php73
			php74

OPTIONS_AVAILABLE=	none
OPTIONS_STANDARD=	none

BUILD_DEPENDS=		python27:single:standard
			php74:single:standard
			php72:single:standard
			php73:single:standard
EXRUN[php72]=		php72:single:standard
EXRUN[php73]=		php73:single:standard
EXRUN[php74]=		php74:single:standard
EXRUN[python]=		python
EXRUN[perl]=		perl

USES=			cpe python:build perl:build

DISTNAME=		unit-1.16.0

LICENSE=		APACHE20:unitd
LICENSE_TERMS=		unitd:{{WRKSRC}}/NOTICE
LICENSE_FILE=		APACHE20:{{WRKSRC}}/LICENSE
LICENSE_SCHEME=		solo

CPE_PRODUCT=		unit
CPE_VENDOR=		nginx
FPC_EQUIVALENT=		www/unit

MUST_CONFIGURE=		yes
CONFIGURE_ARGS=		--prefix={{PREFIX}}
			--modules=libexec/unit/modules
			--state=libexec/unit
			--log=/var/log/nginx-unit/unit.log
			--pid=/var/run/nginx-unit/unit.pid
			--control=unix:/var/run/nginx-unit/control.unit.sock
			--ld-opt="-L{{LOCALBASE}}/lib -Wl,-rpath,{{LOCALBASE}}/lib"

SINGLE_JOB=		yes

PLIST_SUB=		PY3VER={{PYTHON_VER}}
RC_SUBR=		unitd:unitd
SUB_LIST=		UNIT_PIDFILE=/var/log/nginx-unit/unit.log
			UNIT_SOCK=/var/run/nginx-unit/control.unit.sock

post-install:
	${MKDIR} ${STAGEDIR}/var/log/nginx-unit
	${MKDIR} ${STAGEDIR}/var/run/nginx-unit
	${STRIP_CMD} ${STAGEDIR}${PREFIX}/sbin/unitd
	${STRIP_CMD} ${STAGEDIR}${PREFIX}/libexec/unit/modules/*.so

post-configure:
	(cd ${CONFIGURE_WRKSRC} \
	  && ./configure python --config=python${PYTHON_VER}-config \
	  && ./configure perl --module=perl${PERL_VER} \
	  && ./configure php --module=php74\
			--config=php-config74\
			--lib-path=${PREFIX}/lib/php74 \
	  && ./configure php --module=php72\
			--config=php-config72\
			--lib-path=${PREFIX}/lib/php72 \
	  && ./configure php --module=php73\
			--config=php-config73\
			--lib-path=${PREFIX}/lib/php73 \
	)

[FILE:337:descriptions/desc.unitd]
NGINX Unit is a dynamic web application server, designed to run
applications in multiple languages. Unit is lightweight, polyglot, and
dynamically configured via API. The design of the server allows
reconfiguration of specific application parameters as needed by the
engineering or operations.

This subpackage contains the Unit server.


[FILE:74:descriptions/desc.python]
This subpackage contains NGINX Unit server module for the default python.


[FILE:72:descriptions/desc.perl]
This subpackage contains NGINX Unit server module for the default perl.


[FILE:67:descriptions/desc.php72]
This subpackage contains NGINX Unit server module for the PHP 7.2.


[FILE:67:descriptions/desc.php73]
This subpackage contains NGINX Unit server module for the PHP 7.3.


[FILE:67:descriptions/desc.php74]
This subpackage contains NGINX Unit server module for the PHP 7.4.


[FILE:97:distinfo]
6a5954c16a9f940b4ef6e40331e854f5ae7b954838991fef1db4148b8b97d563       722942 unit-1.16.0.tar.gz


[FILE:61:manifests/plist.unitd]
sbin/unitd
@dir /var/log/nginx-unit
@dir /var/run/nginx-unit


[FILE:61:manifests/plist.python]
libexec/unit/modules/python%%PY3VER%%.unit.%%SHARED_OBJECT%%


[FILE:61:manifests/plist.perl]
libexec/unit/modules/perl%%PERL_VER%%.unit.%%SHARED_OBJECT%%


[FILE:50:manifests/plist.php72]
libexec/unit/modules/php72.unit.%%SHARED_OBJECT%%


[FILE:50:manifests/plist.php73]
libexec/unit/modules/php73.unit.%%SHARED_OBJECT%%


[FILE:50:manifests/plist.php74]
libexec/unit/modules/php74.unit.%%SHARED_OBJECT%%


[FILE:877:files/unitd.in]
#!/bin/sh
#
# PROVIDE: unitd
# REQUIRE: LOGIN cleanvar
# KEYWORD: shutdown

#
# Add the following lines to /etc/rc.conf to enable nginx:
# unitd_enable (bool):          Set to "NO" by default.
#                               Set it to "YES" to enable unit
# unitd_sockfile (str):         Set to "" by default.
#                               Set it to "127.0.0.1:8443" to enable the unit control
#                               socket on the network address

. /etc/rc.subr

name="unitd"
rcvar=unitd_enable

command="%%PREFIX%%/sbin/unitd"
start_precmd=start_precmd

start_precmd()
{
    rm -f %%UNIT_SOCK%%
}

load_rc_config $name

# Default value
: ${unitd_sockfile=""}

pidfile=${unit_pidfile:-"%%UNIT_PIDFILE%%"}
unitd_enable=${unitd_enable:-"NO"}
sockfile=${unitd_sockfile}

if [ x${sockfile} != "x" ]
then
    command_args="--control ${sockfile}"
fi

run_rc_command "$1"

