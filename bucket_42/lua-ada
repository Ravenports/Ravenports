# Buildsheet autogenerated by ravenadm tool -- Do not edit.

NAMEBASE=		lua-ada
VERSION=		1.01
KEYWORDS=		lang devel
VARIANTS=		standard
SDESC[standard]=	Ada binding for Lua
HOMEPAGE=		https://github.com/AdaCore/ada-lua
CONTACT=		John_Marino[draco@marino.st]

DOWNLOAD_GROUPS=	main
SITES[main]=		GITHUB/AdaCore:ada-lua:1c4c9a9
DISTFILE[1]=		generated:main
DF_INDEX=		1
SPKGS[standard]=	complete
			primary
			examples

OPTIONS_AVAILABLE=	none
OPTIONS_STANDARD=	none

USES=			gprbuild lua:5.3

LICENSE=		GPLv3:primary GPLv3RLE:primary
LICENSE_SCHEME=		multi
LICENSE_FILE=		GPLv3:{{WRKSRC}}/LICENSE
			GPLv3RLE:{{WRKSRC}}/LICENSE.RUNTIME

MAKEFILE=		USE_64=1

SUB_FILES=		lua.gpr
SUB_LIST=		LUA_VER={{LUA_VER}}

post-patch:
	@${REINPLACE_CMD} -e 's|with "Lua"|with "../../lua.gpr"|' \
		-e 's|"-L../..", "-llua"|"-L${LOCALBASE}/lib", "-Wl,-R,${LOCALBASE}/lib","-llua-${LUA_VER}"|' \
		${WRKSRC}/examples/example1/example1.gpr \
		${WRKSRC}/examples/example2/example2.gpr

do-build:
	(cd ${WRKSRC} && ${SETENV} ${MAKE_ENV} \
		gprbuild -Plua --create-missing-dirs)
	(cd ${WRKSRC}/examples/example1 && ${SETENV} ${MAKE_ENV} \
		gprbuild -Pexample1 --create-missing-dirs)
	(cd ${WRKSRC}/examples/example2 && ${SETENV} ${MAKE_ENV} \
		gprbuild -Pexample2 --create-missing-dirs)

do-install:
	${MKDIR} ${STAGEDIR}${PREFIX}/lib/lua-ada \
		${STAGEDIR}${PREFIX}/lib/gnat \
		${STAGEDIR}${PREFIX}/include/lua-ada \
		${STAGEDIR}${STD_EXAMPLESDIR}/example1/bin \
		${STAGEDIR}${STD_EXAMPLESDIR}/example2/bin
	${INSTALL_DATA} ${WRKSRC}/lib/* ${STAGEDIR}${PREFIX}/lib/lua-ada
	${INSTALL_DATA} ${WRKSRC}/lua.gpr ${STAGEDIR}${PREFIX}/lib/gnat
	${INSTALL_DATA} ${WRKSRC}/src/*.ad[bs] \
		${STAGEDIR}${PREFIX}/include/lua-ada
	${INSTALL_DATA} ${WRKSRC}/examples/example1/example1.lua \
		${WRKSRC}/examples/example1/src/main.adb \
		${STAGEDIR}${STD_EXAMPLESDIR}/example1
	${INSTALL_PROGRAM} ${WRKSRC}/examples/example1/obj/main \
		${STAGEDIR}${STD_EXAMPLESDIR}/example1/bin/hello-lua
	${INSTALL_DATA} ${WRKSRC}/examples/example2/example2.lua \
		${WRKSRC}/examples/example2/src/main.adb \
		${STAGEDIR}${STD_EXAMPLESDIR}/example2
	${INSTALL_PROGRAM} ${WRKSRC}/examples/example2/obj/main \
		${STAGEDIR}${STD_EXAMPLESDIR}/example2/bin/hello-function

[FILE:288:descriptions/desc.primary]
These are bindings to a Lua library for Ada.  The gpr file is written for
the version of Lua that is default on the system that builds the port.
(see Mk/bsd.default-versions.mk)

There is no documentation available, but two examples with sources are
built and installed for illustration.


[FILE:109:distinfo]
533ac2b4d4f96508644dee5579b912d7f2dc296fe376c0c458facb3f70c0807a        26230 AdaCore-ada-lua-1c4c9a9.tar.gz


[FILE:270:manifests/plist.primary]
include/lua-ada/
 lua-ada_limited_types.adb
 lua-ada_limited_types.ads
 lua-ada_types.adb
 lua-ada_types.ads
 lua-utils.adb
 lua-utils.ads
 lua.adb
 lua.ads
lib/lua-ada/
 libadalua.a
 lua-ada_limited_types.ali
 lua-ada_types.ali
 lua-utils.ali
 lua.ali
lib/gnat/lua.gpr


[FILE:253:patches/patch-lua.gpr]
--- lua.gpr.orig	2015-08-24 23:49:07 UTC
+++ lua.gpr
@@ -14,4 +14,8 @@ project Lua is
                                         "-gnatyg");
     end Compiler;
 
+    package Linker is
+       for Linker_Options use ("-ldl");
+    end Linker;
+
 end Lua;


[FILE:426:files/lua.gpr.in]
library project Lua is

   for Languages use ("Ada");

   for Source_Dirs use ("../../include/lua-ada");
   for Library_Dir use "../../lib/lua-ada";
   for Library_Name use "adalua";
   for Library_Kind use "static";
   for Externally_Built use "True";

   package Linker is
      for Linker_Options use ("-L%%PREFIX%%/lib", "-Wl,-R,%%PREFIX%%/lib",
                              "-llua-%%LUA_VER%%);
   end Linker;

end Lua;

