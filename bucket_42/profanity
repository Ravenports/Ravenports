# Buildsheet autogenerated by ravenadm tool -- Do not edit.

NAMEBASE=		profanity
VERSION=		0.15.0
KEYWORDS=		net net_im
VARIANTS=		std
SDESC[std]=		Console based XMPP client
HOMEPAGE=		https://profanity-im.github.io/
CONTACT=		nobody

DOWNLOAD_GROUPS=	main
SITES[main]=		https://profanity-im.github.io/tarballs/
DISTFILE[1]=		profanity-0.15.0.tar.gz:main
DF_INDEX=		1
SPKGS[std]=		set
			primary
			tools
			dev
			man

OPTIONS_AVAILABLE=	none
OPTIONS_STANDARD=	none

BUILD_DEPENDS=		autoconf-archive:primary:std
			libnotify:dev:std
			gpgme:dev:std
			libgcrypt:dev:std
			libuuid:dev:std
			libstrophe:dev:std
			libotr:dev:std
BUILDRUN_DEPENDS=	gpgme:primary:std
			libmesode:single:std
			libnotify:primary:std
			libotr:primary:std
			libuuid:primary:std
			libstrophe:primary:std
EXRUN[primary]=		tools

USES=			libtool:build ncurses pkgconfig readline ssl gmake
			curl autoreconf:build python sqlite expat
GNOME_COMPONENTS=	glib

LICENSE=		GPLv3+:primary
LICENSE_TERMS=		primary:{{WRKSRC}}/LICENSE.txt
LICENSE_FILE=		GPLv3+:{{WRKSRC}}/COPYING
LICENSE_SCHEME=		solo

FPC_EQUIVALENT=		net-im/profanity

MUST_CONFIGURE=		gnu
CONFIGURE_ARGS=		--enable-c-plugins
			--enable-notifications
			--enable-otr
			--enable-pgp
			--disable-omemo
			--with-xscreensaver=no
CONFIGURE_ENV=		LIBS="{{CFLAGS}} -lcrypto"

INSTALL_TARGET=		install-strip

CFLAGS=			-I{{NCURSESINC}}
VAR_OPSYS[linux]=	CFLAGS=-D_XOPEN_SOURCE=700

pre-configure:
	${MKDIR} ${WRKSRC}/m4
	(cd ${WRKSRC} && autoreconf -fiv)

[FILE:328:descriptions/desc.primary]
Profanity is a console based XMPP client written in C using ncurses and
libstrophe, inspired by Irssi.

Features:

* Supports XMPP chat services, including GoogleTalk
* MUC chat room support
* OTR and PGP encryption
* Roster management
* Flexible resource and priority settings
* Desktop notifications
* Plugins in Python and C


[FILE:45:descriptions/desc.tools]
This package contains the profanity program.


[FILE:102:distinfo]
4a9f578f750ec9a7c2a4412ba22e601811b92bba877c636631cc3ccc7ceac7fb       967640 profanity-0.15.0.tar.gz


[FILE:47:manifests/plist.primary]
lib/
 libprofanity.so.0
 libprofanity.so.0.0.0


[FILE:355:manifests/plist.tools]
bin/profanity
share/profanity/icons/
 proIcon.png
 proIconMsg.png
share/profanity/themes/
 aqua
 batman
 bios
 boothj5
 boothj5_laptop
 boothj5_slack
 complex
 forest
 gruvbox
 gruvbox_transparent
 hacker
 headache
 irssi
 joker
 jubalian
 mono
 orange
 original
 original_bright
 shade
 simple
 snikket
 solarized-dark
 solarized-light
 spawn
 whiteness


[FILE:38:manifests/plist.dev]
include/profapi.h
lib/libprofanity.so


[FILE:2178:manifests/plist.man]
share/man/man1/
 profanity-about.1
 profanity-account.1
 profanity-affiliation.1
 profanity-alias.1
 profanity-autoaway.1
 profanity-autoconnect.1
 profanity-autoping.1
 profanity-avatar.1
 profanity-ban.1
 profanity-beep.1
 profanity-blocked.1
 profanity-bookmark.1
 profanity-caps.1
 profanity-carbons.1
 profanity-changepassword.1
 profanity-charset.1
 profanity-clear.1
 profanity-close.1
 profanity-cmd.1
 profanity-color.1
 profanity-connect.1
 profanity-console.1
 profanity-correct-editor.1
 profanity-correct.1
 profanity-correction.1
 profanity-disco.1
 profanity-disconnect.1
 profanity-editor.1
 profanity-executable.1
 profanity-export.1
 profanity-flash.1
 profanity-form.1
 profanity-gone.1
 profanity-help.1
 profanity-history.1
 profanity-info.1
 profanity-inpblock.1
 profanity-inputwin.1
 profanity-intype.1
 profanity-invite.1
 profanity-join.1
 profanity-kick.1
 profanity-lastactivity.1
 profanity-log.1
 profanity-logging.1
 profanity-mainwin.1
 profanity-mam.1
 profanity-mood.1
 profanity-msg.1
 profanity-nick.1
 profanity-notify.1
 profanity-occupants.1
 profanity-omemo.1
 profanity-otr.1
 profanity-outtype.1
 profanity-ox-setup.1
 profanity-ox.1
 profanity-paste.1
 profanity-pgp.1
 profanity-ping.1
 profanity-plugins.1
 profanity-prefs.1
 profanity-presence.1
 profanity-priority.1
 profanity-privacy.1
 profanity-privileges.1
 profanity-quit.1
 profanity-receipts.1
 profanity-reconnect.1
 profanity-redraw.1
 profanity-register.1
 profanity-reload.1
 profanity-resource.1
 profanity-role.1
 profanity-room.1
 profanity-rooms.1
 profanity-roster.1
 profanity-save.1
 profanity-script.1
 profanity-sendfile.1
 profanity-serversoftware.1
 profanity-silence.1
 profanity-slashguard.1
 profanity-software.1
 profanity-splash.1
 profanity-stamp.1
 profanity-states.1
 profanity-status.1
 profanity-statusbar.1
 profanity-strophe.1
 profanity-sub.1
 profanity-subject.1
 profanity-theme.1
 profanity-time.1
 profanity-titlebar.1
 profanity-tls.1
 profanity-tray.1
 profanity-url.1
 profanity-vcard.1
 profanity-vercheck.1
 profanity-who.1
 profanity-win.1
 profanity-wins.1
 profanity-wintitle.1
 profanity-wrap.1
 profanity-xmlconsole.1
 profanity.1


[FILE:333:patches/patch-configure.ac]
--- configure.ac.orig	2025-03-27 19:07:29 UTC
+++ configure.ac
@@ -16,6 +16,7 @@ AC_CANONICAL_TARGET
 PLATFORM="unknown"
 AS_CASE([$target_os],
     [freebsd*], [PLATFORM="freebsd"],
+    [midnight*], [PLATFORM="freebsd"],
     [netbsd*], [PLATFORM="netbsd"],
     [openbsd*], [PLATFORM="openbsd"],
     [darwin*], [PLATFORM="osx"],


[FILE:486:patches/patch-src_pgp_gpg.c]
--- src/pgp/gpg.c.orig	2025-03-27 19:07:29 UTC
+++ src/pgp/gpg.c
@@ -656,7 +656,7 @@ p_gpg_decrypt(const char* const cipher)
             error = gpgme_get_key(ctx, recipient->keyid, &key, 1);
 
             if (!error && key) {
-                const char* addr = gpgme_key_get_string_attr(key, GPGME_ATTR_EMAIL, NULL, 0);
+                const char* addr = key->uids->email;
                 if (addr) {
                     g_string_append(recipients_str, addr);
                 }

