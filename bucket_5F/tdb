# Buildsheet autogenerated by ravenadm tool -- Do not edit.

NAMEBASE=		tdb
VERSION=		1.3.16
KEYWORDS=		databases
VARIANTS=		standard
SDESC[standard]=	Trivial Database
HOMEPAGE=		https://tdb.samba.org/
CONTACT=		Leonid_Bobrov[mazocomp@disroot.org]

DOWNLOAD_GROUPS=	main
SITES[main]=		https://download.samba.org/pub/tdb/
			https://ftp.samba.org/pub/tdb/
DISTFILE[1]=		tdb-1.3.16.tar.gz:main
DF_INDEX=		1
SPKGS[standard]=	single

OPTIONS_AVAILABLE=	none
OPTIONS_STANDARD=	none

BUILD_DEPENDS=		autoselect-python:single:standard
			docbook-xsl:primary:standard
			libxslt:single:standard

USES=			compiler pkgconfig python:py27

LICENSE=		LGPL3+:single
LICENSE_TERMS=		single:{{WRKSRC}}/TERMS
LICENSE_FILE=		LGPL3+:stock
LICENSE_AWK=		TERMS:"^\#include"
LICENSE_SOURCE=		TERMS:{{WRKSRC}}/pytdb.c
LICENSE_SCHEME=		solo

FPC_EQUIVALENT=		databases/tdb

MUST_CONFIGURE=		yes
CONFIGURE_ARGS=		--prefix={{PREFIX}}
			--mandir={{MANPREFIX}}/man
			--without-gettext

INSTALL_REQ_TOOLCHAIN=	yes
SOVERSION=		1.3.16

post-patch:
	# enable docbook to build manpages
	${REINPLACE_CMD} -e 's|/docbook.sourceforge.net/|/cdn.docbook.org/|' \
		${WRKSRC}/buildtools/wafsamba/wafsamba.py \
		${WRKSRC}/buildtools/wafsamba/samba_conftests.py

post-install:
	${STRIP_CMD} ${STAGEDIR}${PREFIX}/bin/tdb*
	${STRIP_CMD} ${STAGEDIR}${PREFIX}/lib/libtdb.${LIBEXT}
	${STRIP_CMD} ${STAGEDIR}${PYTHON_SITELIBDIR}/tdb.${LIBEXT}

[FILE:234:descriptions/desc.single]
TDB is a Trivial Database. In concept, it is very much like GDBM, and
BSD's DB except that it allows multiple simultaneous writers and uses
locking internally to keep writers from trampling on each other. TDB is
also extremely small.


[FILE:96:distinfo]
6a3fc2616567f23993984ada3cea97d953a27669ffd1bfbbe961f26e0cf96cc5       504330 tdb-1.3.16.tar.gz


[FILE:267:manifests/plist.single]
%%PYTHON_SITELIBDIR%%/
 _tdb_text.py
 tdb.so
bin/
 tdbbackup
 tdbdump
 tdbrestore
 tdbtool
include/tdb.h
lib/
 libtdb.so
 libtdb.so.%%SOMAJOR%%
 libtdb.so.%%SOVERSION%%
lib/pkgconfig/tdb.pc
share/man/man8/
 tdbbackup.8.gz
 tdbdump.8.gz
 tdbrestore.8.gz
 tdbtool.8.gz


[FILE:1012:patches/patch-buildtools_wafsamba_samba__autoconf.py]
Disable libssp -- it causes segfaults on several platforms, likly some
kind of missing os-specific support or consideration.

--- buildtools/wafsamba/samba_autoconf.py.orig	2018-07-12 05:51:30 UTC
+++ buildtools/wafsamba/samba_autoconf.py
@@ -673,25 +673,6 @@ def SAMBA_CONFIG_H(conf, path=None):
     if not IN_LAUNCH_DIR(conf):
         return
 
-    # we need to build real code that can't be optimized away to test
-    if conf.check(fragment='''
-        #include <stdio.h>
-
-        int main(void)
-        {
-            char t[100000];
-            while (fgets(t, sizeof(t), stdin));
-            return 0;
-        }
-        ''',
-        execute=0,
-        ccflags='-fstack-protector',
-        ldflags='-fstack-protector',
-        mandatory=False,
-        msg='Checking if toolchain accepts -fstack-protector'):
-            conf.ADD_CFLAGS('-fstack-protector')
-            conf.ADD_LDFLAGS('-fstack-protector')
-
     if Options.options.debug:
         conf.ADD_CFLAGS('-g', testflags=True)
 

