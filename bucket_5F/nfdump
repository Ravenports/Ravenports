# Buildsheet autogenerated by ravenadm tool -- Do not edit.

NAMEBASE=		nfdump
VERSION=		1.7.5
KEYWORDS=		net_mgmt
VARIANTS=		std
SDESC[std]=		Tools to collect and process netflow data
HOMEPAGE=		https://github.com/phaag/nfdump
CONTACT=		nobody

DOWNLOAD_GROUPS=	main
SITES[main]=		GITHUB/phaag:nfdump:v1.7.5
DISTFILE[1]=		generated:main
DF_INDEX=		1
SPKGS[std]=		set
			primary
			dev
			man

OPTIONS_AVAILABLE=	PCAP
OPTIONS_STANDARD=	PCAP
OPT_ON[freebsd]=	PCAP
OPT_ON[netbsd]=		PCAP
OPT_ON[dragonfly]=	PCAP
OPT_ON[midnightbsd]=	PCAP

BUILD_DEPENDS=		rrdtool:dev:std
BUILDRUN_DEPENDS=	flex:primary:std
			rrdtool:primary:std

USES=			cpe autoreconf libtool pkgconfig bz2:build

LICENSE=		BSD3CLAUSE:primary
LICENSE_FILE=		BSD3CLAUSE:{{WRKSRC}}/BSD-license.txt
LICENSE_SCHEME=		solo

CPE_VENDOR=		nfdump_project
FPC_EQUIVALENT=		net-mgmt/nfdump

MUST_CONFIGURE=		gnu
CONFIGURE_ARGS=		--with-rrdpath={{LOCALBASE}}
			--enable-nftrack
			--enable-sflow
			--enable-nfprofile
			--enable-fixtimebug
			--enable-nsel
			--disable-influxdb

SINGLE_JOB=		yes

INSTALL_TARGET=		install-strip
INSTALL_REQ_TOOLCHAIN=	yes
PLIST_SUB=		VERSION=1.7.5

[PCAP].DESCRIPTION=			Include Package Capture capability
[PCAP].BUILDRUN_DEPENDS_ON=		libpcap:primary:std
[PCAP].BUILD_DEPENDS_ON=		libpcap:dev:std
[PCAP].CONFIGURE_ARGS_ON=		--enable-readpcap
					--enable-nfpcapd

post-install:
	${MV} ${STAGEDIR}${PREFIX}/etc/nfdump.conf.dist \
		${STAGEDIR}${PREFIX}/etc/nfdump.conf.sample

[FILE:735:descriptions/desc.primary]
NFDUMP tools support netflow v5, v7 and v9 capturing and processing.

nfcapd - netflow capture daemon.
Reads the netflow data from the network and stores the data into files.

nfdump - netflow dump.
Reads the netflow data from the files stored by nfcapd. It's syntax is
similar to tcpdump. If you like tcpdump you will like nfdump.

nfprofile - netflow profiler.
Reads the netflow data from the files stored by nfcapd. Filters the netflow
data according to the specified filter sets (profiles) and stores the
filtered data into files for later use.

nfreplay - netflow replay.
Reads the netflow data from the files stored by nfcapd and sends it over
the network to another host.

ft2nfdump - flow-tools to nfdump - optional component.


[FILE:104:distinfo]
f7d1df04fe66a173613a13d1b632062150cd63d08ed9299cc2560f519ed33e2e       835261 phaag-nfdump-1.7.5.tar.gz


[FILE:188:manifests/plist.primary]
@sample etc/nfdump.conf.sample
%%PCAP-ON%%bin/nfpcapd
bin/
 nfanon
 nfcapd
 nfdump
 nfexpire
 nfprofile
 nfreplay
 nftrack
 sfcapd
lib/
 libnfdump-%%VERSION%%.so
 libnffile-%%VERSION%%.so


[FILE:59:manifests/plist.dev]
lib/
 libnfdump.a
 libnfdump.so
 libnffile.a
 libnffile.so


[FILE:129:manifests/plist.man]
%%PCAP-ON%%share/man/man1/nfpcapd.1
share/man/man1/
 nfanon.1
 nfcapd.1
 nfdump.1
 nfexpire.1
 nfprofile.1
 nfreplay.1
 sfcapd.1


[FILE:871:patches/patch-src_collector_expire.c]
--- src/collector/expire.c.orig	2024-10-23 17:57:56 UTC
+++ src/collector/expire.c
@@ -65,7 +65,11 @@ static uint32_t timeout = 0;
 
 static void PrepareDirLists(channel_t *channel);
 
+#if defined(__linux__)
 static int compare(const FTSENT **f1, const FTSENT **f2);
+#else
+static int compare(const FTSENT * const *f1, const FTSENT * const *f2);
+#endif
 
 static void IntHandler(int signal) {
     switch (signal) {
@@ -250,7 +254,11 @@ uint64_t ParseTimeDef(char *s, uint64_t
 
 }  // End of ParseTimeDef
 
+#if defined(__linux__)
 static int compare(const FTSENT **f1, const FTSENT **f2) { return strcmp((*f1)->fts_name, (*f2)->fts_name); }  // End of compare
+#else
+static int compare(const FTSENT * const *f1, const FTSENT * const *f2) { return strcmp((*f1)->fts_name, (*f2)->fts_name); }
+#endif
 
 void RescanDir(char *dir, dirstat_t *dirstat) {
     FTS *fts;


[FILE:516:patches/patch-src_libnffile_flist.c]
--- src/libnffile/flist.c.orig	2024-10-23 17:57:56 UTC
+++ src/libnffile/flist.c
@@ -235,7 +235,11 @@ static int CheckTimeWindow(char *filenam
 
 /* Functions */
 
+#if defined(__linux__)
 static int compare(const FTSENT **f1, const FTSENT **f2) { return strcmp((*f1)->fts_name, (*f2)->fts_name); }  // End of compare
+#else
+static int compare(const FTSENT * const *f1, const FTSENT * const *f2) { return strcmp((*f1)->fts_name, (*f2)->fts_name); }
+#endif
 
 static void CleanPath(char *entry) {
     char *p, *q;


[FILE:397:patches/patch-src_nfpcapd_packet__bpf.c]
--- src/nfpcapd/packet_bpf.c.orig	2024-10-23 17:57:56 UTC
+++ src/nfpcapd/packet_bpf.c
@@ -37,6 +37,7 @@
 #endif
 #include <errno.h>
 #include <fcntl.h>
+#include <sys/types.h>
 #include <net/bpf.h>
 #include <net/if.h>
 #include <pthread.h>
@@ -49,7 +50,6 @@
 #include <sys/ioctl.h>
 #include <sys/param.h>
 #include <sys/time.h>
-#include <sys/types.h>
 #include <time.h>
 #include <unistd.h>
 


[FILE:252:patches/patch-src_nfpcapd_pcapdump.c]
--- src/nfpcapd/pcapdump.c.orig	2024-10-23 17:57:56 UTC
+++ src/nfpcapd/pcapdump.c
@@ -41,6 +41,7 @@
 #include <sys/param.h>
 #include <sys/stat.h>
 #include <sys/types.h>
+#include <sys/stat.h> // for S_IFREG
 #include <time.h>
 #include <unistd.h>
 


[FILE:217:patches/patch-src_nfpcapd_pcaproc.h]
--- src/nfpcapd/pcaproc.h.orig	2024-10-23 17:57:56 UTC
+++ src/nfpcapd/pcaproc.h
@@ -40,6 +40,7 @@
 #endif
 #include <stdint.h>
 
+#include <sys/types.h>
 #ifdef HAVE_NET_ETHERNET_H
 #include <net/ethernet.h>
 #endif

