# Buildsheet autogenerated by ravenadm tool -- Do not edit.

NAMEBASE=		ruby23
VERSION=		2.3.7
REVISION=		1
KEYWORDS=		lang ruby
VARIANTS=		standard
SDESC[standard]=	Object-oriented interpreted scripting language
HOMEPAGE=		http://www.ruby-lang.org/en/
CONTACT=		nobody

DOWNLOAD_GROUPS=	main
SITES[main]=		RUBY/2.3
DISTFILE[1]=		ruby-2.3.7.tar.xz:main
DIST_SUBDIR=		ruby
DF_INDEX=		1
SPKGS[standard]=	complete
			primary
			rdoc
			docs
			examples

OPTIONS_AVAILABLE=	none
OPTIONS_STANDARD=	none

BUILDRUN_DEPENDS=	libyaml:single:standard
			libffi:single:standard
			gdbm:single:standard
			gmp:complete:standard

USES=			autoreconf cpe execinfo readline ssl ruby:v23,interp
			zlib

DISTNAME=		ruby-2.3.7

LICENSE=		BSD2CLAUSE:primary RUBY:primary
LICENSE_SCHEME=		dual
LICENSE_FILE=		BSD2CLAUSE:{{WRKSRC}}/COPYING
			RUBY:{{WRKSRC}}/BSDL

CPE_UPDATE=		p0
CPE_VENDOR=		ruby-lang
CPE_VERSION=		2.3.7
FPC_EQUIVALENT=		lang/ruby23

MUST_CONFIGURE=		gnu
CONFIGURE_ARGS=		--enable-pthread
			--enable-shared
			--enable-install-static-library
			--with-ruby-version=minor
			--with-sitedir="{{PREFIX}}/lib/ruby/site_ruby"
			--with-vendordir="{{PREFIX}}/lib/ruby/vendor_ruby"
			--disable-libedit
			--disable-dtrace
			--with-readline-dir={{LOCALBASE}}
			--with-gmp
			--without-gmp
			{{RUBY_CONFIGURE_ARGS}}
CONFIGURE_ENV=		debugflags=
			ac_cv_build={{CONFIGURE_TARGET}}

SINGLE_JOB=		yes

INSTALL_REQ_TOOLCHAIN=	yes
PLIST_SUB=		XY={{RUBY_SUFFIX}}
			XDOTY={{RUBY_VER}}
			LINUX_SOVER=2.3.0

LDFLAGS=		-L{{LOCALBASE}}/lib
			-Wl,-rpath,{{LOCALBASE}}/lib
			-lpthread

post-patch:
	${REINPLACE_CMD} -E \
		-e 's,-l$$pthread_lib,-lpthread,g' \
		-e '/^RUBY_LIB_PATH/s,\.\$$\{TEENY\},,' \
		-e '/^RUBY_SITE_LIB_PATH2/s,\.\$$\{TEENY\},,' \
		-e '/^RUBY_VENDOR_LIB_PATH2/s,\.\$$\{TEENY\},,' \
		${WRKSRC}/configure
	${FIND} ${WRKSRC}/ -name "*.orig" -delete
	# We install these from other ports
.for d in bin/rake doc/rake lib/rake test/rake man/rake.1 lib/rake.rb ext/win32ole bin/gem
	${RM} -r ${BUILD_WRKSRC}/${d}
.endfor
	# Prepare modules we are wanting to build via external ports
.for d in gdbm tk
	${MV} ${BUILD_WRKSRC}/ext/${d} ${WRKDIR}/
.endfor

pre-install:
	${MKDIR} ${STAGEDIR}${RUBY_SITEARCHLIBDIR}
	${MKDIR} ${STAGEDIR}${RUBY_VENDORARCHLIBDIR}
	${MKDIR} ${STAGEDIR}${RUBY_RIDIR}
	${MKDIR} ${STAGEDIR}${RUBY_SITERIDIR}
	${MKDIR} ${STAGEDIR}${RUBY_EXAMPLESDIR}
	${MKDIR} ${STAGEDIR}${RUBY_DOCDIR}

post-install:
	# strip ruby binaries
	${STRIP_CMD} ${STAGEDIR}${PREFIX}/bin/${RUBY_NAME}
	${STRIP_CMD} ${STAGEDIR}${PREFIX}/lib/libruby${RUBY_SHLIBVER}.so
	${FIND} ${STAGEDIR}${RUBY_ARCHLIBDIR} -type f -name '*\.so' -exec ${STRIP_CMD} {} \;
	# install docs
	(cd ${WRKSRC}/doc/ && ${COPYTREE_SHARE} . ${STAGEDIR}${RUBY_DOCDIR}/)
	(cd ${STAGEDIR}${RUBY_DOCDIR} && ${MKDIR} readline ripper stringio syslog)
	${INSTALL_DATA} ${WRKSRC}/ext/readline/README* ${STAGEDIR}${RUBY_DOCDIR}/readline/
	${INSTALL_DATA} ${WRKSRC}/ext/ripper/README ${STAGEDIR}${RUBY_DOCDIR}/ripper/
	${INSTALL_DATA} ${WRKSRC}/ext/stringio/README ${STAGEDIR}${RUBY_DOCDIR}/stringio/
	${INSTALL_DATA} ${WRKSRC}/ext/syslog/syslog.txt ${STAGEDIR}${RUBY_DOCDIR}/syslog/
	# remove docs
	${RM} ${STAGEDIR}${STD_DOCDIR}/NEWS-*
	${RM} ${STAGEDIR}${STD_DOCDIR}/ChangeLog-*
	${RM} ${STAGEDIR}${STD_DOCDIR}/.document
	# install examples
	${MKDIR} ${STAGEDIR}${RUBY_EXAMPLESDIR}/bigdecimal
	${INSTALL_DATA} ${WRKSRC}/ext/bigdecimal/sample/*.rb \
		${STAGEDIR}${RUBY_EXAMPLESDIR}/bigdecimal/
	(cd ${WRKSRC}/sample/ && ${COPYTREE_SHARE} . ${STAGEDIR}${RUBY_EXAMPLESDIR}/)

post-build:
	# Hack to allow modules to be installed into separate PREFIX and/or under
	# user privilegies
	${RB_SET_CONF_VAR} "prefix" "ENV['PREFIX'] || \3"
	${RB_SET_CONF_VAR} "INSTALL" "'/usr/bin/install -c'"
	${RB_SET_CONF_VAR} "INSTALL_PROGRAM" "ENV['RB_USER_INSTALL'] ? '${INSTALL} ${COPY} ${STRIP} -m ${BINMODE}' : '${INSTALL_PROGRAM}'"
	${RB_SET_CONF_VAR} "INSTALL_SCRIPT" "ENV['RB_USER_INSTALL'] ? '${INSTALL} ${COPY} -m ${BINMODE}' : '${INSTALL_SCRIPT}'"
	${RB_SET_CONF_VAR} "INSTALL_DATA" "ENV['RB_USER_INSTALL'] ? '${INSTALL} ${COPY} -m ${SHAREMODE}' : '${INSTALL_DATA}'"

[FILE:665:descriptions/desc.primary]
Ruby is the interpreted scripting language for quick and
easy object-oriented programming.  It has many features to
process text files and to do system management tasks (as in
Perl).  It is simple, straight-forward, and extensible.

Features of Ruby are shown below.

  + Simple Syntax
  + *Normal* Object-Oriented features(ex. class, method calls)
  + *Advanced* Object-Oriented features(ex. Mix-in, Singleton-method)
  + Operator Overloading
  + Exception Handling
  + Iterators and Closures
  + Garbage Collection
  + Dynamic Loading of Object files(on some architecture)
  + Highly Portable(works on many UNIX machines, and on DOS,
    Windows, Mac, BeOS etc.)


[FILE:64:descriptions/desc.rdoc]
This package contains the Ruby Documentation System for Ruby24.


[FILE:101:distinfo]
c61f8f2b9d3ffff5567e186421fa191f0d5e7c2b189b426bb84498825d548edb     11438124 ruby/ruby-2.3.7.tar.xz


[FILE:17516:manifests/plist.primary]
bin/
 erb%%XY%%
 irb%%XY%%
 rdoc%%XY%%
 ri%%XY%%
 ruby%%XY%%
include/ruby-%%XDOTY%%/%%RUBY_ARCH%%/ruby/config.h
include/ruby-%%XDOTY%%/ruby.h
include/ruby-%%XDOTY%%/ruby/backward/
 classext.h
 rubyio.h
 rubysig.h
 st.h
 util.h
include/ruby-%%XDOTY%%/ruby/
 debug.h
 defines.h
 digest.h
 encoding.h
 intern.h
 io.h
 missing.h
 oniguruma.h
 re.h
 regex.h
 ruby.h
 st.h
 subst.h
 thread.h
 thread_native.h
 util.h
 version.h
 vm.h
lib/
 libruby%%XY%%-static.a
 libruby%%XY%%.so
%%ONLY-DRAGONFLY%%lib/libruby%%XY%%.so.%%RUBY_SHLIBVER%%
%%ONLY-FREEBSD%%lib/libruby%%XY%%.so.%%RUBY_SHLIBVER%%
%%ONLY-SUNOS%%lib/libruby%%XY%%.so.%%RUBY_SHLIBVER%%
%%ONLY-LINUX%%lib/
 libruby%%XY%%.so.%%XDOTY%%
 libruby%%XY%%.so.%%LINUX_SOVER%%
lib/pkgconfig/ruby-%%XDOTY%%.pc
lib/ruby/%%XDOTY%%/%%RUBY_ARCH%%/
 bigdecimal.so
lib/ruby/%%XDOTY%%/%%RUBY_ARCH%%/cgi/escape.so
 continuation.so
 coverage.so
 date_core.so
 dbm.so
 digest.so
lib/ruby/%%XDOTY%%/%%RUBY_ARCH%%/digest/
 bubblebabble.so
 md5.so
 rmd160.so
 sha1.so
 sha2.so
lib/ruby/%%XDOTY%%/%%RUBY_ARCH%%/enc/
 big5.so
 cp949.so
 emacs_mule.so
 encdb.so
 euc_jp.so
 euc_kr.so
 euc_tw.so
 gb18030.so
 gb2312.so
 gbk.so
 iso_8859_1.so
 iso_8859_10.so
 iso_8859_11.so
 iso_8859_13.so
 iso_8859_14.so
 iso_8859_15.so
 iso_8859_16.so
 iso_8859_2.so
 iso_8859_3.so
 iso_8859_4.so
 iso_8859_5.so
 iso_8859_6.so
 iso_8859_7.so
 iso_8859_8.so
 iso_8859_9.so
 koi8_r.so
 koi8_u.so
 shift_jis.so
lib/ruby/%%XDOTY%%/%%RUBY_ARCH%%/enc/trans/
 big5.so
 chinese.so
 ebcdic.so
 emoji.so
 emoji_iso2022_kddi.so
 emoji_sjis_docomo.so
 emoji_sjis_kddi.so
 emoji_sjis_softbank.so
 escape.so
 gb18030.so
 gbk.so
 iso2022.so
 japanese.so
 japanese_euc.so
 japanese_sjis.so
 korean.so
 single_byte.so
 transdb.so
 utf8_mac.so
 utf_16_32.so
lib/ruby/%%XDOTY%%/%%RUBY_ARCH%%/enc/
 utf_16be.so
 utf_16le.so
 utf_32be.so
 utf_32le.so
 windows_1250.so
 windows_1251.so
 windows_1252.so
 windows_31j.so
lib/ruby/%%XDOTY%%/%%RUBY_ARCH%%/
 etc.so
 fcntl.so
 fiber.so
 fiddle.so
lib/ruby/%%XDOTY%%/%%RUBY_ARCH%%/io/
 console.so
 nonblock.so
 wait.so
lib/ruby/%%XDOTY%%/%%RUBY_ARCH%%/json/ext/
 generator.so
 parser.so
lib/ruby/%%XDOTY%%/%%RUBY_ARCH%%/mathn/
 complex.so
 rational.so
lib/ruby/%%XDOTY%%/%%RUBY_ARCH%%/
 nkf.so
 objspace.so
 openssl.so
 pathname.so
 psych.so
 pty.so
lib/ruby/%%XDOTY%%/%%RUBY_ARCH%%/racc/cparse.so
 rbconfig.rb
lib/ruby/%%XDOTY%%/%%RUBY_ARCH%%/rbconfig/sizeof.so
 readline.so
 ripper.so
 sdbm.so
 socket.so
 stringio.so
 strscan.so
 syslog.so
 thread.so
 zlib.so
lib/ruby/%%XDOTY%%/
 English.rb
 abbrev.rb
 base64.rb
 benchmark.rb
lib/ruby/%%XDOTY%%/bigdecimal/
 jacobian.rb
 ludcmp.rb
 math.rb
 newton.rb
 util.rb
lib/ruby/%%XDOTY%%/
 cgi.rb
lib/ruby/%%XDOTY%%/cgi/
 cookie.rb
 core.rb
 html.rb
 session.rb
lib/ruby/%%XDOTY%%/cgi/session/pstore.rb
 util.rb
lib/ruby/%%XDOTY%%/
 cmath.rb
 csv.rb
 date.rb
 debug.rb
 delegate.rb
 digest.rb
lib/ruby/%%XDOTY%%/digest/sha2.rb
 drb.rb
lib/ruby/%%XDOTY%%/drb/
 acl.rb
 drb.rb
 eq.rb
 extserv.rb
 extservm.rb
 gw.rb
 invokemethod.rb
 observer.rb
 ssl.rb
 timeridconv.rb
 unix.rb
lib/ruby/%%XDOTY%%/
 e2mmap.rb
 erb.rb
 expect.rb
 fiddle.rb
lib/ruby/%%XDOTY%%/fiddle/
 closure.rb
 cparser.rb
 function.rb
 import.rb
 pack.rb
 struct.rb
 types.rb
 value.rb
lib/ruby/%%XDOTY%%/
 fileutils.rb
 find.rb
 forwardable.rb
 getoptlong.rb
lib/ruby/%%XDOTY%%/io/console/size.rb
 ipaddr.rb
 irb.rb
lib/ruby/%%XDOTY%%/irb/cmd/
 chws.rb
 fork.rb
 help.rb
 load.rb
 nop.rb
 pushws.rb
 subirb.rb
lib/ruby/%%XDOTY%%/irb/
 completion.rb
 context.rb
lib/ruby/%%XDOTY%%/irb/ext/
 change-ws.rb
 history.rb
 loader.rb
 math-mode.rb
 multi-irb.rb
 save-history.rb
 tracer.rb
 use-loader.rb
 workspaces.rb
lib/ruby/%%XDOTY%%/irb/
 extend-command.rb
 frame.rb
 help.rb
 init.rb
 input-method.rb
 inspector.rb
lib/ruby/%%XDOTY%%/irb/lc/
 error.rb
 help-message
lib/ruby/%%XDOTY%%/irb/lc/ja/
 encoding_aliases.rb
 error.rb
 help-message
lib/ruby/%%XDOTY%%/irb/
 locale.rb
 magic-file.rb
 notifier.rb
 output-method.rb
 ruby-lex.rb
 ruby-token.rb
 slex.rb
 src_encoding.rb
 version.rb
 workspace.rb
 ws-for-case-2.rb
 xmp.rb
lib/ruby/%%XDOTY%%/
 json.rb
lib/ruby/%%XDOTY%%/json/add/
 bigdecimal.rb
 complex.rb
 core.rb
 date.rb
 date_time.rb
 exception.rb
 ostruct.rb
 range.rb
 rational.rb
 regexp.rb
 struct.rb
 symbol.rb
 time.rb
lib/ruby/%%XDOTY%%/json/
 common.rb
 ext.rb
 generic_object.rb
 version.rb
lib/ruby/%%XDOTY%%/
 kconv.rb
 logger.rb
 mathn.rb
 matrix.rb
lib/ruby/%%XDOTY%%/matrix/
 eigenvalue_decomposition.rb
 lup_decomposition.rb
lib/ruby/%%XDOTY%%/
 mkmf.rb
 monitor.rb
 mutex_m.rb
lib/ruby/%%XDOTY%%/net/
 ftp.rb
 http.rb
lib/ruby/%%XDOTY%%/net/http/
 backward.rb
 exceptions.rb
 generic_request.rb
 header.rb
 proxy_delta.rb
 request.rb
 requests.rb
 response.rb
 responses.rb
lib/ruby/%%XDOTY%%/net/
 https.rb
 imap.rb
 pop.rb
 protocol.rb
 smtp.rb
lib/ruby/%%XDOTY%%/
 observer.rb
 open-uri.rb
 open3.rb
 openssl.rb
lib/ruby/%%XDOTY%%/openssl/
 bn.rb
 buffering.rb
 cipher.rb
 config.rb
 digest.rb
 pkey.rb
 ssl.rb
 x509.rb
lib/ruby/%%XDOTY%%/
 optionparser.rb
 optparse.rb
lib/ruby/%%XDOTY%%/optparse/
 ac.rb
 date.rb
 shellwords.rb
 time.rb
 uri.rb
 version.rb
lib/ruby/%%XDOTY%%/
 ostruct.rb
 pathname.rb
 pp.rb
 prettyprint.rb
 prime.rb
 profile.rb
 profiler.rb
 pstore.rb
 psych.rb
lib/ruby/%%XDOTY%%/psych/
 class_loader.rb
 coder.rb
 core_ext.rb
 deprecated.rb
 exception.rb
 handler.rb
lib/ruby/%%XDOTY%%/psych/handlers/
 document_stream.rb
 recorder.rb
lib/ruby/%%XDOTY%%/psych/json/
 ruby_events.rb
 stream.rb
 tree_builder.rb
 yaml_events.rb
lib/ruby/%%XDOTY%%/psych/
 nodes.rb
lib/ruby/%%XDOTY%%/psych/nodes/
 alias.rb
 document.rb
 mapping.rb
 node.rb
 scalar.rb
 sequence.rb
 stream.rb
lib/ruby/%%XDOTY%%/psych/
 omap.rb
 parser.rb
 scalar_scanner.rb
 set.rb
 stream.rb
 streaming.rb
 syntax_error.rb
 tree_builder.rb
 versions.rb
 visitors.rb
lib/ruby/%%XDOTY%%/psych/visitors/
 depth_first.rb
 emitter.rb
 json_tree.rb
 to_ruby.rb
 visitor.rb
 yaml_tree.rb
lib/ruby/%%XDOTY%%/psych/
 y.rb
lib/ruby/%%XDOTY%%/
 psych_jars.rb
lib/ruby/%%XDOTY%%/racc/parser.rb
lib/ruby/%%XDOTY%%/rbconfig/datadir.rb
 rdoc.rb
lib/ruby/%%XDOTY%%/rdoc/
 alias.rb
 anon_class.rb
 any_method.rb
 attr.rb
 class_module.rb
 code_object.rb
 code_objects.rb
 comment.rb
 constant.rb
 context.rb
lib/ruby/%%XDOTY%%/rdoc/context/section.rb
 cross_reference.rb
 encoding.rb
 erb_partial.rb
 erbio.rb
 extend.rb
 generator.rb
lib/ruby/%%XDOTY%%/rdoc/generator/
 darkfish.rb
 json_index.rb
 markup.rb
 pot.rb
lib/ruby/%%XDOTY%%/rdoc/generator/pot/
 message_extractor.rb
 po.rb
 po_entry.rb
lib/ruby/%%XDOTY%%/rdoc/generator/
 ri.rb
lib/ruby/%%XDOTY%%/rdoc/generator/template/darkfish/
 _footer.rhtml
 _head.rhtml
 _sidebar_VCS_info.rhtml
 _sidebar_classes.rhtml
 _sidebar_extends.rhtml
 _sidebar_in_files.rhtml
 _sidebar_includes.rhtml
 _sidebar_installed.rhtml
 _sidebar_methods.rhtml
 _sidebar_navigation.rhtml
 _sidebar_pages.rhtml
 _sidebar_parent.rhtml
 _sidebar_search.rhtml
 _sidebar_sections.rhtml
 _sidebar_table_of_contents.rhtml
 class.rhtml
lib/ruby/%%XDOTY%%/rdoc/generator/template/darkfish/css/
 fonts.css
 rdoc.css
lib/ruby/%%XDOTY%%/rdoc/generator/template/darkfish/fonts/
 Lato-Light.ttf
 Lato-LightItalic.ttf
 Lato-Regular.ttf
 Lato-RegularItalic.ttf
 SourceCodePro-Bold.ttf
 SourceCodePro-Regular.ttf
lib/ruby/%%XDOTY%%/rdoc/generator/template/darkfish/images/
 add.png
 arrow_up.png
 brick.png
 brick_link.png
 bug.png
 bullet_black.png
 bullet_toggle_minus.png
 bullet_toggle_plus.png
 date.png
 delete.png
 find.png
 loadingAnimation.gif
 macFFBgHack.png
 package.png
 page_green.png
 page_white_text.png
 page_white_width.png
 plugin.png
 ruby.png
 tag_blue.png
 tag_green.png
 transparent.png
 wrench.png
 wrench_orange.png
 zoom.png
lib/ruby/%%XDOTY%%/rdoc/generator/template/darkfish/
 index.rhtml
lib/ruby/%%XDOTY%%/rdoc/generator/template/darkfish/js/
 darkfish.js
 jquery.js
 search.js
lib/ruby/%%XDOTY%%/rdoc/generator/template/darkfish/
 page.rhtml
 servlet_not_found.rhtml
 servlet_root.rhtml
 table_of_contents.rhtml
lib/ruby/%%XDOTY%%/rdoc/generator/template/json_index/js/
 navigation.js
 searcher.js
lib/ruby/%%XDOTY%%/rdoc/
 ghost_method.rb
 i18n.rb
lib/ruby/%%XDOTY%%/rdoc/i18n/
 locale.rb
 text.rb
lib/ruby/%%XDOTY%%/rdoc/
 include.rb
 known_classes.rb
 markdown.rb
lib/ruby/%%XDOTY%%/rdoc/markdown/
 entities.rb
 literals_1_9.rb
lib/ruby/%%XDOTY%%/rdoc/
 markup.rb
lib/ruby/%%XDOTY%%/rdoc/markup/
 attr_changer.rb
 attr_span.rb
 attribute_manager.rb
 attributes.rb
 blank_line.rb
 block_quote.rb
 document.rb
 formatter.rb
 formatter_test_case.rb
 hard_break.rb
 heading.rb
 include.rb
 indented_paragraph.rb
 inline.rb
 list.rb
 list_item.rb
 paragraph.rb
 parser.rb
 pre_process.rb
 raw.rb
 rule.rb
 special.rb
 text_formatter_test_case.rb
 to_ansi.rb
 to_bs.rb
 to_html.rb
 to_html_crossref.rb
 to_html_snippet.rb
 to_joined_paragraph.rb
 to_label.rb
 to_markdown.rb
 to_rdoc.rb
 to_table_of_contents.rb
 to_test.rb
 to_tt_only.rb
 verbatim.rb
lib/ruby/%%XDOTY%%/rdoc/
 meta_method.rb
 method_attr.rb
 mixin.rb
 normal_class.rb
 normal_module.rb
 options.rb
 parser.rb
lib/ruby/%%XDOTY%%/rdoc/parser/
 c.rb
 changelog.rb
 markdown.rb
 rd.rb
 ruby.rb
 ruby_tools.rb
 simple.rb
 text.rb
lib/ruby/%%XDOTY%%/rdoc/
 rd.rb
lib/ruby/%%XDOTY%%/rdoc/rd/
 block_parser.rb
 inline.rb
 inline_parser.rb
lib/ruby/%%XDOTY%%/rdoc/
 rdoc.rb
 require.rb
 ri.rb
lib/ruby/%%XDOTY%%/rdoc/ri/
 driver.rb
 formatter.rb
 paths.rb
 store.rb
 task.rb
lib/ruby/%%XDOTY%%/rdoc/
 ruby_lex.rb
 ruby_token.rb
 rubygems_hook.rb
 servlet.rb
 single_class.rb
 stats.rb
lib/ruby/%%XDOTY%%/rdoc/stats/
 normal.rb
 quiet.rb
 verbose.rb
lib/ruby/%%XDOTY%%/rdoc/
 store.rb
 task.rb
 test_case.rb
 text.rb
 token_stream.rb
 tom_doc.rb
 top_level.rb
lib/ruby/%%XDOTY%%/
 resolv-replace.rb
 resolv.rb
lib/ruby/%%XDOTY%%/rexml/
 attlistdecl.rb
 attribute.rb
 cdata.rb
 child.rb
 comment.rb
 doctype.rb
 document.rb
lib/ruby/%%XDOTY%%/rexml/dtd/
 attlistdecl.rb
 dtd.rb
 elementdecl.rb
 entitydecl.rb
 notationdecl.rb
lib/ruby/%%XDOTY%%/rexml/
 element.rb
 encoding.rb
 entity.rb
lib/ruby/%%XDOTY%%/rexml/formatters/
 default.rb
 pretty.rb
 transitive.rb
lib/ruby/%%XDOTY%%/rexml/
 functions.rb
 instruction.rb
lib/ruby/%%XDOTY%%/rexml/light/node.rb
 namespace.rb
 node.rb
 output.rb
 parent.rb
 parseexception.rb
lib/ruby/%%XDOTY%%/rexml/parsers/
 baseparser.rb
 lightparser.rb
 pullparser.rb
 sax2parser.rb
 streamparser.rb
 treeparser.rb
 ultralightparser.rb
 xpathparser.rb
lib/ruby/%%XDOTY%%/rexml/
 quickpath.rb
 rexml.rb
 sax2listener.rb
 security.rb
 source.rb
 streamlistener.rb
 syncenumerator.rb
 text.rb
 undefinednamespaceexception.rb
lib/ruby/%%XDOTY%%/rexml/validation/
 relaxng.rb
 validation.rb
 validationexception.rb
lib/ruby/%%XDOTY%%/rexml/
 xmldecl.rb
 xmltokens.rb
 xpath.rb
 xpath_parser.rb
lib/ruby/%%XDOTY%%/rinda/
 rinda.rb
 ring.rb
 tuplespace.rb
lib/ruby/%%XDOTY%%/
 ripper.rb
lib/ruby/%%XDOTY%%/ripper/
 core.rb
 filter.rb
 lexer.rb
 sexp.rb
lib/ruby/%%XDOTY%%/
 rss.rb
lib/ruby/%%XDOTY%%/rss/
 0.9.rb
 1.0.rb
 2.0.rb
 atom.rb
 content.rb
lib/ruby/%%XDOTY%%/rss/content/
 1.0.rb
 2.0.rb
lib/ruby/%%XDOTY%%/rss/
 converter.rb
 dublincore.rb
lib/ruby/%%XDOTY%%/rss/dublincore/
 1.0.rb
 2.0.rb
 atom.rb
lib/ruby/%%XDOTY%%/rss/
 image.rb
 itunes.rb
 maker.rb
lib/ruby/%%XDOTY%%/rss/maker/
 0.9.rb
 1.0.rb
 2.0.rb
 atom.rb
 base.rb
 content.rb
 dublincore.rb
 entry.rb
 feed.rb
 image.rb
 itunes.rb
 slash.rb
 syndication.rb
 taxonomy.rb
 trackback.rb
lib/ruby/%%XDOTY%%/rss/
 parser.rb
 rexmlparser.rb
 rss.rb
 slash.rb
 syndication.rb
 taxonomy.rb
 trackback.rb
 utils.rb
 xml-stylesheet.rb
 xml.rb
 xmlparser.rb
 xmlscanner.rb
lib/ruby/%%XDOTY%%/
 rubygems.rb
lib/ruby/%%XDOTY%%/rubygems/
 available_set.rb
 basic_specification.rb
 command.rb
 command_manager.rb
lib/ruby/%%XDOTY%%/rubygems/commands/
 build_command.rb
 cert_command.rb
 check_command.rb
 cleanup_command.rb
 contents_command.rb
 dependency_command.rb
 environment_command.rb
 fetch_command.rb
 generate_index_command.rb
 help_command.rb
 install_command.rb
 list_command.rb
 lock_command.rb
 mirror_command.rb
 open_command.rb
 outdated_command.rb
 owner_command.rb
 pristine_command.rb
 push_command.rb
 query_command.rb
 rdoc_command.rb
 search_command.rb
 server_command.rb
 setup_command.rb
 sources_command.rb
 specification_command.rb
 stale_command.rb
 uninstall_command.rb
 unpack_command.rb
 update_command.rb
 which_command.rb
 yank_command.rb
lib/ruby/%%XDOTY%%/rubygems/
 compatibility.rb
 config_file.rb
lib/ruby/%%XDOTY%%/rubygems/core_ext/
 kernel_gem.rb
 kernel_require.rb
lib/ruby/%%XDOTY%%/rubygems/
 defaults.rb
 dependency.rb
 dependency_installer.rb
 dependency_list.rb
 deprecate.rb
 doctor.rb
 errors.rb
 exceptions.rb
 ext.rb
lib/ruby/%%XDOTY%%/rubygems/ext/
 build_error.rb
 builder.rb
 cmake_builder.rb
 configure_builder.rb
 ext_conf_builder.rb
 rake_builder.rb
lib/ruby/%%XDOTY%%/rubygems/
 gem_runner.rb
 gemcutter_utilities.rb
 indexer.rb
 install_default_message.rb
 install_message.rb
 install_update_options.rb
 installer.rb
 installer_test_case.rb
 local_remote_options.rb
 mock_gem_ui.rb
 name_tuple.rb
 package.rb
lib/ruby/%%XDOTY%%/rubygems/package/
 digest_io.rb
 file_source.rb
 io_source.rb
 old.rb
 source.rb
 tar_header.rb
 tar_reader.rb
lib/ruby/%%XDOTY%%/rubygems/package/tar_reader/entry.rb
 tar_test_case.rb
 tar_writer.rb
lib/ruby/%%XDOTY%%/rubygems/
 package_task.rb
 path_support.rb
 platform.rb
 psych_additions.rb
 psych_tree.rb
 rdoc.rb
 remote_fetcher.rb
 request.rb
lib/ruby/%%XDOTY%%/rubygems/request/
 connection_pools.rb
 http_pool.rb
 https_pool.rb
lib/ruby/%%XDOTY%%/rubygems/
 request_set.rb
lib/ruby/%%XDOTY%%/rubygems/request_set/
 gem_dependency_api.rb
 lockfile.rb
lib/ruby/%%XDOTY%%/rubygems/request_set/lockfile/
 parser.rb
 tokenizer.rb
lib/ruby/%%XDOTY%%/rubygems/
 requirement.rb
 resolver.rb
lib/ruby/%%XDOTY%%/rubygems/resolver/
 activation_request.rb
 api_set.rb
 api_specification.rb
 best_set.rb
 composed_set.rb
 conflict.rb
 current_set.rb
 dependency_request.rb
 git_set.rb
 git_specification.rb
 index_set.rb
 index_specification.rb
 installed_specification.rb
 installer_set.rb
 local_specification.rb
 lock_set.rb
 lock_specification.rb
 molinillo.rb
lib/ruby/%%XDOTY%%/rubygems/resolver/molinillo/lib/molinillo.rb
lib/ruby/%%XDOTY%%/rubygems/resolver/molinillo/lib/molinillo/
 dependency_graph.rb
 errors.rb
 gem_metadata.rb
lib/ruby/%%XDOTY%%/rubygems/resolver/molinillo/lib/molinillo/modules/
 specification_provider.rb
 ui.rb
lib/ruby/%%XDOTY%%/rubygems/resolver/molinillo/lib/molinillo/
 resolution.rb
 resolver.rb
 state.rb
lib/ruby/%%XDOTY%%/rubygems/resolver/
 requirement_list.rb
 set.rb
 source_set.rb
 spec_specification.rb
 specification.rb
 stats.rb
 vendor_set.rb
 vendor_specification.rb
lib/ruby/%%XDOTY%%/rubygems/
 safe_yaml.rb
 security.rb
lib/ruby/%%XDOTY%%/rubygems/security/
 policies.rb
 policy.rb
 signer.rb
 trust_dir.rb
lib/ruby/%%XDOTY%%/rubygems/
 server.rb
 source.rb
lib/ruby/%%XDOTY%%/rubygems/source/
 git.rb
 installed.rb
 local.rb
 lock.rb
 specific_file.rb
 vendor.rb
lib/ruby/%%XDOTY%%/rubygems/
 source_list.rb
 source_local.rb
 source_specific_file.rb
 spec_fetcher.rb
 specification.rb
lib/ruby/%%XDOTY%%/rubygems/ssl_certs/
 AddTrustExternalCARoot-2048.pem
 AddTrustExternalCARoot.pem
 Class3PublicPrimaryCertificationAuthority.pem
 DigiCertHighAssuranceEVRootCA.pem
 EntrustnetSecureServerCertificationAuthority.pem
 GeoTrustGlobalCA.pem
 GlobalSignRootCA.pem
lib/ruby/%%XDOTY%%/rubygems/
 stub_specification.rb
 syck_hack.rb
 test_case.rb
 test_utilities.rb
 text.rb
 uninstaller.rb
 uri_formatter.rb
 user_interaction.rb
 util.rb
lib/ruby/%%XDOTY%%/rubygems/util/
 licenses.rb
 list.rb
lib/ruby/%%XDOTY%%/rubygems/
 validator.rb
 version.rb
 version_option.rb
lib/ruby/%%XDOTY%%/
 scanf.rb
 securerandom.rb
 set.rb
 shell.rb
lib/ruby/%%XDOTY%%/shell/
 builtin-command.rb
 command-processor.rb
 error.rb
 filter.rb
 process-controller.rb
 system-command.rb
 version.rb
lib/ruby/%%XDOTY%%/
 shellwords.rb
 singleton.rb
 socket.rb
 sync.rb
lib/ruby/%%XDOTY%%/syslog/logger.rb
 tempfile.rb
 thwait.rb
 time.rb
 timeout.rb
 tmpdir.rb
 tracer.rb
 tsort.rb
 ubygems.rb
 un.rb
 unicode_normalize.rb
lib/ruby/%%XDOTY%%/unicode_normalize/
 normalize.rb
 tables.rb
lib/ruby/%%XDOTY%%/
 uri.rb
lib/ruby/%%XDOTY%%/uri/
 common.rb
 ftp.rb
 generic.rb
 http.rb
 https.rb
 ldap.rb
 ldaps.rb
 mailto.rb
 rfc2396_parser.rb
 rfc3986_parser.rb
lib/ruby/%%XDOTY%%/
 weakref.rb
 webrick.rb
lib/ruby/%%XDOTY%%/webrick/
 accesslog.rb
 cgi.rb
 compat.rb
 config.rb
 cookie.rb
 htmlutils.rb
 httpauth.rb
lib/ruby/%%XDOTY%%/webrick/httpauth/
 authenticator.rb
 basicauth.rb
 digestauth.rb
 htdigest.rb
 htgroup.rb
 htpasswd.rb
 userdb.rb
lib/ruby/%%XDOTY%%/webrick/
 httpproxy.rb
 httprequest.rb
 httpresponse.rb
 https.rb
 httpserver.rb
 httpservlet.rb
lib/ruby/%%XDOTY%%/webrick/httpservlet/
 abstract.rb
 cgi_runner.rb
 cgihandler.rb
 erbhandler.rb
 filehandler.rb
 prochandler.rb
lib/ruby/%%XDOTY%%/webrick/
 httpstatus.rb
 httputils.rb
 httpversion.rb
 log.rb
 server.rb
 ssl.rb
 utils.rb
 version.rb
lib/ruby/%%XDOTY%%/
 xmlrpc.rb
lib/ruby/%%XDOTY%%/xmlrpc/
 base64.rb
 client.rb
 config.rb
 create.rb
 datetime.rb
 marshal.rb
 parser.rb
 server.rb
 utils.rb
lib/ruby/%%XDOTY%%/
 yaml.rb
lib/ruby/%%XDOTY%%/yaml/
 dbm.rb
 store.rb
share/man/man1/
 erb%%XY%%.1.gz
 irb%%XY%%.1.gz
 ri%%XY%%.1.gz
 ruby%%XY%%.1.gz
@dir lib/ruby/%%XDOTY%%/racc/rdoc
@dir %%RUBY_SITEARCHLIBDIR%%
@dir %%RUBY_VENDORARCHLIBDIR%%
@dir %%RUBY_EXAMPLESDIR%%/curses
@dir %%RUBY_SITERIDIR%%


[FILE:867:manifests/plist.docs]
share/doc/ruby%%XY%%/
 contributing.rdoc
 contributors.rdoc
 dtrace_probes.rdoc
 etc.rd.ja
 extension.ja.rdoc
 extension.rdoc
 forwardable.rd.ja
 globals.rdoc
share/doc/ruby%%XY%%/images/boottime-classes.png
share/doc/ruby%%XY%%/irb/
 irb-tools.rd.ja
 irb.rd.ja
share/doc/ruby%%XY%%/
 keywords.rdoc
 maintainers.rdoc
 marshal.rdoc
share/doc/ruby%%XY%%/pty/
 README.expect.ja
 README.ja
share/doc/ruby%%XY%%/readline/
 README.ja
 README
share/doc/ruby%%XY%%/
 regexp.rdoc
share/doc/ruby%%XY%%/ripper/README
 security.rdoc
 shell.rd.ja
 standard_library.rdoc
share/doc/ruby%%XY%%/stringio/README
 syntax.rdoc
share/doc/ruby%%XY%%/syntax/
 assignment.rdoc
 calling_methods.rdoc
 control_expressions.rdoc
 exceptions.rdoc
 literals.rdoc
 methods.rdoc
 miscellaneous.rdoc
 modules_and_classes.rdoc
 precedence.rdoc
 refinements.rdoc
share/doc/ruby%%XY%%/syslog/syslog.txt


[FILE:3375:manifests/plist.examples]
share/examples/ruby%%XY%%/
 README
 benchmark.rb
share/examples/ruby%%XY%%/bigdecimal/
 linear.rb
 nlsolve.rb
 pi.rb
share/examples/ruby%%XY%%/
 biorhythm.rb
 cal.rb
 cbreak.rb
 cgi-session-pstore.rb
 clnt.rb
 coverage.rb
 delegate.rb
 dir.rb
share/examples/ruby%%XY%%/drb/
 README.ja.rdoc
 README.rdoc
 acl.rb
 darray.rb
 darrayc.rb
 dbiff.rb
 dcdbiff.rb
 dchatc.rb
 dchats.rb
 dhasen.rb
 dhasenc.rb
 dlogc.rb
 dlogd.rb
 dqin.rb
 dqlib.rb
 dqout.rb
 dqueue.rb
 drbc.rb
 drbch.rb
 drbm.rb
 drbmc.rb
 drbs-acl.rb
 drbs.rb
 drbssl_c.rb
 drbssl_s.rb
 extserv_test.rb
 gw_ct.rb
 gw_cu.rb
 gw_s.rb
 holderc.rb
 holders.rb
 http0.rb
 http0serv.rb
 name.rb
 namec.rb
 old_tuplespace.rb
 rinda_ts.rb
 rindac.rb
 rindas.rb
 ring_echo.rb
 ring_inspect.rb
 ring_place.rb
 simpletuple.rb
 speedc.rb
 speeds.rb
share/examples/ruby%%XY%%/
 dualstack-fetch.rb
 dualstack-httpd.rb
 eval.rb
 export.rb
 exyacc.rb
 fact.rb
 fib.awk
 fib.pl
 fib.py
 fib.rb
 fib.scm
 freq.rb
 from.rb
 fullpath.rb
 iseq_loader.rb
 less.rb
 list.rb
 list2.rb
 list3.rb
share/examples/ruby%%XY%%/logger/
 app.rb
 log.rb
 shifting.rb
share/examples/ruby%%XY%%/
 mine.rb
 mkproto.rb
 mpart.rb
 net-imap.rb
 observ.rb
 occur.pl
 occur.rb
 occur2.rb
 open3.rb
share/examples/ruby%%XY%%/openssl/
 c_rehash.rb
 cert2text.rb
 certstore.rb
 cipher.rb
 crlstore.rb
 echo_cli.rb
 echo_svr.rb
 gen_csr.rb
 smime_read.rb
 smime_write.rb
 wget.rb
share/examples/ruby%%XY%%/optparse/
 opttest.rb
 subcommand.rb
share/examples/ruby%%XY%%/
 philos.rb
 pi.rb
 pstore.rb
share/examples/ruby%%XY%%/pty/
 expect_sample.rb
 script.rb
 shl.rb
share/examples/ruby%%XY%%/
 rcs.awk
 rcs.dat
 rcs.rb
share/examples/ruby%%XY%%/rdoc/markup/
 rdoc2latex.rb
 sample.rb
share/examples/ruby%%XY%%/
 rinda-ring.rb
share/examples/ruby%%XY%%/ripper/
 ruby2html.rb
 strip-comment.rb
share/examples/ruby%%XY%%/rss/
 blend.rb
 convert.rb
 list_description.rb
 re_read.rb
 rss_recent.rb
share/examples/ruby%%XY%%/
 sieve.rb
 simple-bench.rb
 svr.rb
 tempfile.rb
 test.rb
share/examples/ruby%%XY%%/testunit/
 adder.rb
 subtracter.rb
 tc_adder.rb
 tc_subtracter.rb
 ts_examples.rb
share/examples/ruby%%XY%%/
 time.rb
 timeout.rb
share/examples/ruby%%XY%%/trick2013/README.md
share/examples/ruby%%XY%%/trick2013/kinaba/
 authors.markdown
 entry.rb
 remarks.markdown
share/examples/ruby%%XY%%/trick2013/mame/
 authors.markdown
 entry.rb
 music-box.mp4
 remarks.markdown
share/examples/ruby%%XY%%/trick2013/shinh/
 authors.markdown
 entry.rb
 remarks.markdown
share/examples/ruby%%XY%%/trick2013/yhara/
 authors.markdown
 entry.rb
 remarks.en.markdown
 remarks.markdown
share/examples/ruby%%XY%%/trick2015/README.md
share/examples/ruby%%XY%%/trick2015/eregon/
 authors.markdown
 entry.rb
 remarks.markdown
share/examples/ruby%%XY%%/trick2015/kinaba/
 authors.markdown
 entry.rb
 remarks.markdown
share/examples/ruby%%XY%%/trick2015/ksk_1/
 authors.markdown
 entry.rb
 remarks.markdown
share/examples/ruby%%XY%%/trick2015/ksk_2/
 abnormal.cnf
 authors.markdown
 entry.rb
 quinn.cnf
 remarks.markdown
 sample.cnf
 uf20-01.cnf
 unsat.cnf
share/examples/ruby%%XY%%/trick2015/monae/
 authors.markdown
 entry.rb
 remarks.markdown
share/examples/ruby%%XY%%/
 trojan.rb
 tsvr.rb
 uumerge.rb
 weakref.rb
share/examples/ruby%%XY%%/webrick/
 demo-app.rb
 demo-multipart.cgi
 demo-servlet.rb
 demo-urlencoded.cgi
 hello.cgi
 hello.rb
 httpd.rb
 httpproxy.rb
 httpsd.rb


[FILE:666:patches/patch-ccan_list_list.h]
--- ccan/list/list.h.orig	2015-09-06 07:10:54 UTC
+++ ccan/list/list.h
@@ -57,7 +57,7 @@ struct list_head
  * Example:
  *	static struct list_head my_list = LIST_HEAD_INIT(my_list);
  */
-#define LIST_HEAD_INIT(name) { { &name.n, &name.n } }
+#define CCAN_LIST_HEAD_INIT(name) { { &name.n, &name.n } }
 
 /**
  * LIST_HEAD - define and initialize an empty list_head
@@ -72,8 +72,8 @@ struct list_head
  * Example:
  *	static LIST_HEAD(my_global_list);
  */
-#define LIST_HEAD(name) \
-	struct list_head name = LIST_HEAD_INIT(name)
+#define CCAN_LIST_HEAD(name) \
+	struct list_head name = CCAN_LIST_HEAD_INIT(name)
 
 /**
  * list_head_init - initialize a list_head


[FILE:2569:patches/patch-configure.in]
--- configure.in.orig	2017-09-14 20:41:49 UTC
+++ configure.in
@@ -1278,10 +1278,10 @@ main()
   ],
 [	LIBS="-lm $LIBS"])
 
-AC_CHECK_LIB(crypt, crypt)      # glibc (GNU/Linux, GNU/Hurd, GNU/kFreeBSD)
-AC_CHECK_LIB(dl, dlopen)	# Dynamic linking for SunOS/Solaris and SYSV
-AC_CHECK_LIB(dld, shl_load)	# Dynamic linking for HP-UX
-AC_CHECK_LIB(socket, shutdown)  # SunOS/Solaris
+AC_SEARCH_LIBS(crypt, crypt)      # glibc (GNU/Linux, GNU/Hurd, GNU/kFreeBSD)
+AC_SEARCH_LIBS(dlopen, dl)	# Dynamic linking for SunOS/Solaris and SYSV
+AC_SEARCH_LIBS(shl_load, dld)	# Dynamic linking for HP-UX
+AC_SEARCH_LIBS(shutdown, socket)  # SunOS/Solaris
 
 dnl Checks for header files.
 AC_HEADER_DIRENT
@@ -2531,7 +2531,7 @@ main(int argc, char **argv)
 if test x"$ac_cv_func_clock_gettime" != xyes; then
     # glibc 2.17 moves clock_* functions from librt to the main C library.
     # http://sourceware.org/ml/libc-announce/2012/msg00001.html
-    AC_CHECK_LIB(rt, clock_gettime)
+    AC_SEARCH_LIBS(clock_gettime, rt)
     if test x"$ac_cv_lib_rt_clock_gettime" = xyes; then
 	AC_DEFINE(HAVE_CLOCK_GETTIME, 1)
     fi
@@ -2938,7 +2938,7 @@ else
 fi
 
 if test x"$enable_pthread" = xyes; then
-    for pthread_lib in thr pthread pthreads c c_r root; do
+    for pthread_lib in pthread thr pthreads c c_r root; do
 	AC_CHECK_LIB($pthread_lib, pthread_kill,
 		     rb_with_pthread=yes, rb_with_pthread=no)
 	if test "$rb_with_pthread" = "yes"; then break; fi
@@ -2952,6 +2952,7 @@ if test x"$enable_pthread" = xyes; then
 	[c],    [],
 	[root], [],
 	[c_r],  [MAINLIBS="-pthread $MAINLIBS"],
+	[pthread],  [MAINLIBS="-pthread $MAINLIBS"],
 	        [AS_CASE(["$target_os"],
 		    [openbsd*|mirbsd*], [LIBS="-pthread $LIBS"],
 		    [LIBS="-l$pthread_lib $LIBS"])])
@@ -3260,7 +3261,6 @@ if test "$with_dln_a_out" != yes; then
 			: ${LDSHARED='$(CC) -shared'}
 			if test "$rb_cv_binary_elf" = yes; then
 			    LDFLAGS="$LDFLAGS -rdynamic"
-			    DLDFLAGS="$DLDFLAGS "'-Wl,-soname,$@'
 			else
 			  test "$GCC" = yes && test "$rb_cv_prog_gnu_ld" = yes || LDSHARED='$(LD) -Bshareable'
 			fi
@@ -3730,13 +3730,10 @@ AS_CASE("$enable_shared", [yes], [
 	    LIBRUBY_RELATIVE=yes
 	fi
 	],
-    [freebsd*|dragonfly*], [
+    [freebsd*|dragonfly*|solaris*], [
 	SOLIBS='$(LIBS)'
 	LIBRUBY_SO='lib$(RUBY_SO_NAME).so.$(MAJOR)$(MINOR)'
-	if test "$rb_cv_binary_elf" != "yes" ; then
-	    LIBRUBY_SO="$LIBRUBY_SO.\$(TEENY)"
-	    LIBRUBY_ALIASES=''
-	fi
+	LIBRUBY_DLDFLAGS='-L$(PREFIX)/lib -Wl,-rpath,$(PREFIX)/lib -Wl,-soname,$(LIBRUBY_SO)'
 	],
     [netbsd*], [
 	SOLIBS='$(LIBS)'


[FILE:729:patches/patch-ext_bigdecimal_bigdecimal.c]
--- ext/bigdecimal/bigdecimal.c.orig	2017-09-14 04:16:51 UTC
+++ ext/bigdecimal/bigdecimal.c
@@ -102,29 +102,6 @@ static ID id_eq;
 # define RB_OBJ_STRING(obj) StringValueCStr(obj)
 #endif
 
-#ifndef HAVE_RB_RATIONAL_NUM
-static inline VALUE
-rb_rational_num(VALUE rat)
-{
-#ifdef HAVE_TYPE_STRUCT_RRATIONAL
-    return RRATIONAL(rat)->num;
-#else
-    return rb_funcall(rat, rb_intern("numerator"));
-#endif
-}
-#endif
-
-#ifndef HAVE_RB_RATIONAL_DEN
-static inline VALUE
-rb_rational_den(VALUE rat)
-{
-#ifdef HAVE_TYPE_STRUCT_RRATIONAL
-    return RRATIONAL(rat)->den;
-#else
-    return rb_funcall(rat, rb_intern("denominator"));
-#endif
-}
-#endif
 
 /*
  * ================== Ruby Interface part ==========================


[FILE:469:patches/patch-lib_mkmf.rb]
--- lib/mkmf.rb.orig	2017-07-07 06:00:04 UTC
+++ lib/mkmf.rb
@@ -235,7 +235,7 @@ module MakeMakefile
   end
   $extmk ||= false
   if not $extmk and File.exist?(($hdrdir = RbConfig::CONFIG["rubyhdrdir"]) + "/ruby/ruby.h")
-    $topdir = $hdrdir
+    $topdir = $hdrdir + "/" + "#{CONFIG['arch']}/ruby/"
     $top_srcdir = $hdrdir
     $arch_hdrdir = RbConfig::CONFIG["rubyarchhdrdir"]
   elsif File.exist?(($hdrdir = ($top_srcdir ||= topdir) + "/include")  + "/ruby.h")


[FILE:307:patches/patch-thread__pthread.c]
--- thread_pthread.c.orig	2017-08-09 08:24:37 UTC
+++ thread_pthread.c
@@ -1154,7 +1154,7 @@ native_sleep(rb_thread_t *th, struct tim
 }
 
 #ifdef USE_UBF_LIST
-static LIST_HEAD(ubf_list_head);
+static CCAN_LIST_HEAD(ubf_list_head);
 
 /* The thread 'th' is registered to be trying unblock. */
 static void


[FILE:563:patches/patch-tool_mkconfig.rb]
--- tool/mkconfig.rb.orig	2017-06-30 10:58:32 UTC
+++ tool/mkconfig.rb
@@ -168,8 +168,9 @@ def vars.expand(val, config = self)
   val.replace(newval) unless newval == val
   val
 end
-prefix = vars.expand(vars["prefix"] ||= "")
-rubyarchdir = vars.expand(vars["rubyarchdir"] ||= "")
+prefix = vars.expand(vars["rubyarchdir"])
+major, minor, *rest = RUBY_VERSION.split('.')
+rubyarchdir = "/lib/ruby/#{major}.#{minor}/#{arch}"
 relative_archdir = rubyarchdir.rindex(prefix, 0) ? rubyarchdir[prefix.size..-1] : rubyarchdir
 puts %[\
 # frozen-string-literal: false


[FILE:3125:patches/patch-tool_rbinstall.rb]
--- tool/rbinstall.rb.orig	2017-03-27 15:18:38 UTC
+++ tool/rbinstall.rb
@@ -695,93 +695,6 @@ end
 
 # :startdoc:
 
-install?(:ext, :comm, :gem) do
-  gem_dir = Gem.default_dir
-  directories = Gem.ensure_gem_subdirectories(gem_dir, :mode => $dir_mode)
-  prepare "default gems", gem_dir, directories
-
-  spec_dir = File.join(gem_dir, directories.grep(/^spec/)[0])
-  default_spec_dir = "#{spec_dir}/default"
-  makedirs(default_spec_dir)
-
-  gems = {}
-
-  Dir.glob(srcdir+"/{lib,ext}/**/*.gemspec").each do |src|
-    specgen   = RbInstall::Specs::Reader.new(src)
-    gems[specgen.gemspec.name] ||= specgen
-  end
-
-  gems.sort.each do |name, specgen|
-    gemspec   = specgen.gemspec
-    full_name = "#{gemspec.name}-#{gemspec.version}"
-
-    puts "#{" "*30}#{gemspec.name} #{gemspec.version}"
-    gemspec_path = File.join(default_spec_dir, "#{full_name}.gemspec")
-    open_for_install(gemspec_path, $data_mode) do
-      specgen.spec_source
-    end
-
-    unless gemspec.executables.empty? then
-      bin_dir = File.join(gem_dir, 'gems', full_name, 'bin')
-      makedirs(bin_dir)
-
-      execs = gemspec.executables.map {|exec| File.join(srcdir, 'bin', exec)}
-      install(execs, bin_dir, :mode => $script_mode)
-    end
-  end
-end
-
-install?(:ext, :comm, :gem) do
-  gem_dir = Gem.default_dir
-  directories = Gem.ensure_gem_subdirectories(gem_dir, :mode => $dir_mode)
-  prepare "bundle gems", gem_dir, directories
-  install_dir = with_destdir(gem_dir)
-  installed_gems = {}
-  options = {
-    :install_dir => install_dir,
-    :bin_dir => with_destdir(bindir),
-    :domain => :local,
-    :ignore_dependencies => true,
-    :dir_mode => $dir_mode,
-    :data_mode => $data_mode,
-    :prog_mode => $prog_mode,
-    :wrappers => true,
-    :format_executable => true,
-  }
-  Gem::Specification.each_spec([srcdir+'/gems/*']) do |spec|
-    ins = RbInstall::UnpackedInstaller.new(spec, options)
-    puts "#{" "*30}#{spec.name} #{spec.version}"
-    ins.install
-    File.chmod($data_mode, File.join(install_dir, "specifications", "#{spec.full_name}.gemspec"))
-    installed_gems[spec.full_name] = true
-  end
-  installed_gems, gems = Dir.glob(srcdir+'/gems/*.gem').partition {|gem| installed_gems.key?(File.basename(gem, '.gem'))}
-  unless installed_gems.empty?
-    install installed_gems, gem_dir+"/cache"
-  end
-  next if gems.empty?
-  if defined?(Zlib)
-    Gem.instance_variable_set(:@ruby, with_destdir(File.join(bindir, ruby_install_name)))
-    gems.each do |gem|
-      begin
-        File.umask(022)
-        Gem.install(gem, Gem::Requirement.default, options)
-      ensure
-        File.umask(0222)
-      end
-      gemname = File.basename(gem)
-      puts "#{" "*30}#{gemname}"
-    end
-    # fix directory permissions
-    # TODO: Gem.install should accept :dir_mode option or something
-    File.chmod($dir_mode, *Dir.glob(install_dir+"/**/"))
-    # fix .gemspec permissions
-    File.chmod($data_mode, *Dir.glob(install_dir+"/specifications/*.gemspec"))
-  else
-    puts "skip installing bundle gems because of lacking zlib"
-  end
-end
-
 parse_args()
 
 include FileUtils


[FILE:378:files/special.mk]
# Macros to change variables in rbconfig.rb
RB_SET_CONF_VAR=${SH} -c '${REINPLACE_CMD} -E -e "s,(CONFIG\[\"$$0\"\][[:space:]]*=[[:space:]]*)(\(?)(.*)(\)?),\1\2$$1\4," ${WRKSRC}/rbconfig.rb' --

POST_PLIST_TARGET=	rdoc-autolist

rdoc-autolist:
	@(cd ${STAGEDIR}${PREFIX} && ${FIND} share/ri \
	\( -type f -o -type l \) 2>/dev/null | ${SORT}) \
	>> ${WRKDIR}/.manifest.rdoc.mktmp

