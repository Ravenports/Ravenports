# Buildsheet autogenerated by ravenadm tool -- Do not edit.

NAMEBASE=		mpv
VERSION=		0.36.0
REVISION=		1
KEYWORDS=		multimedia
VARIANTS=		standard
SDESC[standard]=	Advanced general-purpose multimedia player
HOMEPAGE=		https://mpv.io/
CONTACT=		nobody

DOWNLOAD_GROUPS=	main waf
SITES[main]=		GITHUB/mpv-player:mpv:v0.36.0
SITES[waf]=		https://gitlab.com/ita1024/waf/-/archive/waf-2.0.24/
DISTFILE[1]=		generated:main
DISTFILE[2]=		waf-waf-2.0.24.tar.bz2:waf
DF_INDEX=		1 2
SPKGS[standard]=	complete
			primary
			examples
			docs

OPTIONS_AVAILABLE=	none
OPTIONS_STANDARD=	none

BUILD_DEPENDS=		python-docutils:single:python_used
			harfbuzz:dev:standard
			libarchive:dev:standard
			libass:dev:standard
			ffmpeg:dev:standard
			libva:dev:standard
BUILDRUN_DEPENDS=	ffmpeg:primary:standard
			libarchive:primary:standard
			libass:primary:standard
			libdvdnav:single:standard
			libvdpau:single:standard
			libva:primary:standard
			uchardet:single:standard
RUN_DEPENDS=		youtube-dl:single:standard

USES=			cpe iconv jpeg lua:5.2 pkgconfig fontconfig:build
			perl:build python:build,sutools ssl:build
			desktop-utils:primary gnome-icons:primary
SDL_COMPONENTS=		sdl2
XORG_COMPONENTS=	x11 xext xinerama xrandr xscrnsaver xv xxf86vm

LICENSE=		GPLv2+:primary
LICENSE_TERMS=		primary:{{WRKSRC}}/Copyright
LICENSE_FILE=		GPLv2+:{{WRKSRC}}/LICENSE.GPL
LICENSE_SCHEME=		solo

FPC_EQUIVALENT=		multimedia/mpv

MUST_CONFIGURE=		yes
CONFIGURE_ARGS=		--prefix="{{PREFIX}}"
			--docdir="{{STD_EXAMPLESDIR}}"
			--htmldir="{{STD_DOCDIR}}/html"
			--mandir="{{MANPREFIX}}/man"
			--lua={{LUA_VER_STR}}fbsd
			--enable-libmpv-shared
			--enable-libarchive
			--enable-html
			--enable-dvdnav
			--enable-sdl2
			--disable-debug-build
			--disable-optimize
			--disable-pdf
			--disable-rubberband
			--disable-vaapi-wayland
			--disable-vapoursynth
			--disable-wayland
			--disable-alsa
			--disable-caca
			--disable-jack
			--disable-lcms2
			--disable-libbluray
			-j{{MAKE_JOBS_NUMBER}}
CONFIGURE_ENV=		BIN_PYTHON="{{PYTHON_CMD}}"
			BIN_PERL="{{PERL}}"

BUILD_TARGET=		build
DESTDIRNAME=		--destdir

SOVERSION=		2.1.0

post-patch:
	${FIND} ${WRKSRC}/DOCS/man -name '*.rst' | \
		${XARGS} ${REINPLACE_CMD} -e 's|/usr/local|${PREFIX}|g'

post-install:
	${STRIP_CMD} ${STAGEDIR}${PREFIX}/bin/mpv
	${STRIP_CMD} ${STAGEDIR}${PREFIX}/lib/libmpv.so

[FILE:364:descriptions/desc.primary]
Mpv is based on the MPlayer and mplayer2 projects which it greatly improves.
It supports a wide variety of video file formats, audio and video codecs, and
subtitle types. Special input URL types are available to read input from
a variety of sources other than disk files. Depending on platform, a variety of
different video and audio output methods are supported.


[FILE:208:distinfo]
29abc44f8ebee013bb2f9fe14d80b30db19b534c679056e4851ceadf5a5e8bf6      3409178 mpv-player-mpv-0.36.0.tar.gz
599ab1903b6f12f0683878d2cd4f73546e0ce26031efd05f3fbe5178e4ef8cda       582903 waf-waf-2.0.24.tar.bz2


[FILE:589:manifests/plist.primary]
bin/mpv
etc/mpv/encoding-profiles.conf
include/mpv/
 client.h
 render.h
 render_gl.h
 stream_cb.h
lib/
 libmpv.so
 libmpv.so.%%SOMAJOR%%
 libmpv.so.%%SOVERSION%%
lib/pkgconfig/mpv.pc
share/applications/mpv.desktop
share/bash-completion/completions/mpv
share/icons/hicolor/128x128/apps/mpv.png
share/icons/hicolor/16x16/apps/mpv.png
share/icons/hicolor/32x32/apps/mpv.png
share/icons/hicolor/64x64/apps/mpv.png
share/icons/hicolor/scalable/apps/mpv.svg
share/icons/hicolor/symbolic/apps/mpv-symbolic.svg
share/man/man1/mpv.1.gz
share/metainfo/mpv.metainfo.xml
share/zsh/site-functions/_mpv


[FILE:89:manifests/plist.examples]
share/examples/mpv/
 input.conf
 mplayer-input.conf
 mpv.conf
 restore-old-bindings.conf


[FILE:28:manifests/plist.docs]
share/doc/mpv/html/mpv.html


[FILE:573:patches/patch-stream_stream__libarchive.c]
$NetBSD: patch-stream_stream__libarchive.c,v 1.1 2022/05/17 13:12:13 ryoon Exp $

* NetBSD does not implement uselocale().

--- stream/stream_libarchive.c.orig	2023-07-23 17:10:36 UTC
+++ stream/stream_libarchive.c
@@ -29,6 +29,10 @@
 #define MP_ARCHIVE_FLAG_MAYBE_RAR       (MP_ARCHIVE_FLAG_PRIV << 1)
 #define MP_ARCHIVE_FLAG_MAYBE_VOLUMES   (MP_ARCHIVE_FLAG_PRIV << 2)
 
+#if defined(__NetBSD__)
+#define uselocale(locale) NULL
+#endif
+
 struct mp_archive_volume {
     struct mp_archive *mpa;
     int index; // volume number (starting with 0, mp_archive.primary_src)


[FILE:392:patches/patch-video_out_drm__common.c]
$NetBSD: patch-video_out_drm__common.c,v 1.4 2020/12/19 11:27:51 leot Exp $

Enable support for DRM on NetBSD.

--- video/out/drm_common.c.orig	2023-07-23 17:10:36 UTC
+++ video/out/drm_common.c
@@ -31,6 +31,9 @@
 
 #if HAVE_CONSIO_H
 #include <sys/consio.h>
+#elif HAVE_WSDISPLAY_USL_IO_H
+#include <sys/types.h>
+#include <dev/wscons/wsdisplay_usl_io.h>
 #else
 #include <sys/vt.h>
 #endif


[FILE:1500:patches/patch-wscript]
$NetBSD: patch-wscript,v 1.9 2022/11/16 11:27:32 leot Exp $

- Enable support for DRM on NetBSD.
- Check for OSSv4 features that could not be on some platforms
  (e.g. NetBSD)

--- wscript.orig	2023-07-23 17:10:36 UTC
+++ wscript
@@ -288,6 +288,11 @@ iconv support use --disable-iconv.",
         'func': check_statement(['sys/consio.h', 'sys/ioctl.h'],
                                 'int m; ioctl(0, VT_GETMODE, &m)'),
     }, {
+        'name': 'wsdisplay_usl_io.h',
+        'desc': 'wsdisplay_usl_io.h',
+        'func': check_statement(['sys/types.h', 'dev/wscons/wsdisplay_usl_io.h', 'sys/ioctl.h'],
+                                'int m; ioctl(0, VT_GETMODE, &m)'),
+    }, {
         'name': 'gbm.h',
         'desc': 'gbm.h',
         'func': check_cc(header_name=['stdio.h', 'gbm.h']),
@@ -459,7 +464,7 @@ audio_output_features = [
     }, {
         'name': '--oss-audio',
         'desc': 'OSSv4 audio output',
-        'func': check_statement(['sys/soundcard.h'], 'int x = SNDCTL_DSP_SETPLAYVOL'),
+        'func': check_statement(['sys/soundcard.h'], 'int x = SNDCTL_DSP_SETPLAYVOL; int y = SNDCTL_DSP_HALT;'),
         'deps': 'posix && gpl',
     }, {
         'name': '--pipewire',
@@ -526,7 +531,7 @@ video_output_features = [
     }, {
         'name': '--drm',
         'desc': 'DRM',
-        'deps': 'vt.h || consio.h',
+        'deps': 'vt.h || consio.h || wsdisplay_usl_io.h',
         'func': check_pkg_config('libdrm', '>= 2.4.75'),
     }, {
         'name': '--gbm',


[FILE:178:files/special.mk]
# Emulate USES=waf
MAKE_CMD=	${PYTHON_CMD} ${WRKDIR}/waf-*/waf-light
CONFIGURE_CMD=	${PYTHON_CMD} ${WRKDIR}/waf-*/waf-light configure
MAKEFILE=
MAKE_FLAGS=
MAKE_ARGS+=	--verbose


[FILE:168:dragonfly/patch-libmpv_mpv.def]
--- libmpv/mpv.def.orig	2023-07-23 17:10:36 UTC
+++ libmpv/mpv.def
@@ -1,3 +1,5 @@
+__progname
+environ
 mpv_abort_async_command
 mpv_client_api_version
 mpv_client_id


[FILE:168:freebsd/patch-libmpv_mpv.def]
--- libmpv/mpv.def.orig	2023-07-23 17:10:36 UTC
+++ libmpv/mpv.def
@@ -1,3 +1,5 @@
+__progname
+environ
 mpv_abort_async_command
 mpv_client_api_version
 mpv_client_id


[FILE:168:midnightbsd/patch-libmpv_mpv.def]
--- libmpv/mpv.def.orig	2023-07-23 17:10:36 UTC
+++ libmpv/mpv.def
@@ -1,3 +1,5 @@
+__progname
+environ
 mpv_abort_async_command
 mpv_client_api_version
 mpv_client_id

