# Buildsheet autogenerated by ravenadm tool -- Do not edit.

NAMEBASE=		subversion
VERSION=		1.10.0
KEYWORDS=		devel
VARIANTS=		standard
SDESC[standard]=	Version control system
HOMEPAGE=		https://subversion.apache.org/
CONTACT=		nobody

DOWNLOAD_GROUPS=	main
SITES[main]=		APACHE/subversion
DISTFILE[1]=		subversion-1.10.0.tar.bz2:main
DF_INDEX=		1
SPKGS[standard]=	single

OPTIONS_AVAILABLE=	none
OPTIONS_STANDARD=	none

BUILD_DEPENDS=		expat:static:standard
			lz4:static:standard
BUILDRUN_DEPENDS=	serf:single:standard
			lz4:shared:standard
			utf8proc:single:standard

USES=			bdb:5 cpe libtool pkgconfig gettext-runtime
			gettext-tools zlib shebangfix

CPE_VENDOR=		apache
FPC_EQUIVALENT=		devel/subversion
SHEBANG_FILES=		tools/server-side/svnpubsub/rc.d/svnpubsub.solaris
			tools/server-side/svnpubsub/rc.d/svnwcsub.solaris
SHEBANG_OLD_PYTHON=	{{LOCALBASE}}/bin/python2
			"/bin/env python"
SHEBANG_REGEX=		./tools/.*

MUST_CONFIGURE=		gnu
CONFIGURE_ARGS=		--without-swig
			--with-serf
			--with-sqlite={{LOCALBASE}}
			--with-expat={{LOCALBASE}}/include:{{LOCALBASE}}/lib:expat
			--with-apr={{LOCALBASE}}/bin/apr-1-config
			--with-apr-util={{LOCALBASE}}/bin/apu-1-config
			--with-berkeley-db
			--enable-bdb6

MAKE_ARGS=		pkgconfig_dir={{PREFIX}}/lib/pkgconfig

INSTALL_REQ_TOOLCHAIN=	yes
RC_SUBR=		svnserve:single

VAR_ARCH[x86_64]=	CFLAGS=-fpic
			CFLAGS=-DPIC

post-patch:
	${REINPLACE_CMD} "s#/etc/subversion#${PREFIX}/etc/subversion#g" ${WRKSRC}/subversion/libsvn_subr/config_file.c
	${REINPLACE_CMD} "s#/etc/subversion#${PREFIX}/etc/subversion#g" ${WRKSRC}/subversion/libsvn_subr/config_impl.h
	${REINPLACE_CMD} "s#^swig_pydir =.*#swig_pydir = ${PYTHON_SITELIBDIR}/libsvn#" ${WRKSRC}/Makefile.in
	${REINPLACE_CMD} "s#^swig_pydir_extra =.*#swig_pydir_extra = ${PYTHON_SITELIBDIR}/svn#" ${WRKSRC}/Makefile.in
	# remove all .bak files to clean the stage
	${FIND} ${WRKSRC} -name '*.bak' -delete

post-install:
	(cd ${WRKSRC}/tools.examples && \
		${COPYTREE_SHARE} . ${STAGEDIR}${PREFIX}/share/subversion)
	(cd ${STAGEDIR}${PREFIX}/share/subversion && \
		${RM} backup/hot-backup.py.in \
		hook-scripts/commit-access-control.pl.in)
	(cd ${WRKSRC} && ${SETENV} ${MAKE_ENV} \
		${MAKE_CMD} -C ${WRKSRC} install-tools ${MAKE_ARGS})
	${STRIP_CMD} ${STAGEDIR}${PREFIX}/bin/svn*
	${STRIP_CMD} ${STAGEDIR}${PREFIX}/bin/x509-parser
	${STRIP_CMD} ${STAGEDIR}${PREFIX}/bin/fsfs-access-map
	${STRIP_CMD} ${STAGEDIR}${PREFIX}/lib/*.so

post-build:
	(cd ${WRKSRC} && ${SETENV} ${MAKE_ENV} \
		${MAKE_CMD} -C ${WRKSRC} tools ${MAKE_ARGS})

post-configure:
	# Enable GNOME Keyring / KWallet support in main code, as it is harmless
	${REINPLACE_CMD} -E 's%.*#undef SVN_HAVE_(GNOME_KEYRING|KWALLET).*%#define SVN_HAVE_\1 1%' ${WRKSRC}/subversion/svn_private_config.h
	# ugly hack: save tools directory so we don't have to cleanup before installing
	${CP} -R ${WRKSRC}/tools ${WRKSRC}/tools.examples
	${CHMOD} -R a-st,o+rX ${WRKSRC}/tools.examples

[FILE:407:descriptions/desc.single]
Subversion is an open source version control system.

Subversion exists to be universally recognized and adopted as an
open-source, centralized version control system characterized by its
reliability as a safe haven for valuable data; the simplicity of its
model and usage; and its ability to support the needs of a wide variety
of users and projects, from individuals to large-scale enterprise
operations.


[FILE:104:distinfo]
2cf23f3abb837dea0585a6b0ebd70e80e01f95bddef7c1aa097c18e3eaa6b584      8369823 subversion-1.10.0.tar.bz2


[FILE:10003:manifests/plist.single]
bin/
 fsfs-access-map
 fsfs-stats
 svn
 svn-mergeinfo-normalizer
 svn-populate-node-origins-index
 svnadmin
 svnauthz
 svnauthz-validate
 svnbench
 svnconflict
 svndiff
 svndiff3
 svndiff4
 svndumpfilter
 svnfsfs
 svnlook
 svnmover
 svnmucc
 svnraisetreeconflict
 svnrdump
 svnserve
 svnsync
 svnversion
 x509-parser
include/subversion-1/
 mod_authz_svn.h
 mod_dav_svn.h
 svn-revision.txt
 svn_auth.h
 svn_base64.h
 svn_cache_config.h
 svn_checksum.h
 svn_client.h
 svn_cmdline.h
 svn_compat.h
 svn_config.h
 svn_ctype.h
 svn_dav.h
 svn_delta.h
 svn_diff.h
 svn_dirent_uri.h
 svn_dso.h
 svn_error.h
 svn_error_codes.h
 svn_fs.h
 svn_hash.h
 svn_io.h
 svn_iter.h
 svn_md5.h
 svn_mergeinfo.h
 svn_nls.h
 svn_opt.h
 svn_path.h
 svn_pools.h
 svn_props.h
 svn_quoprint.h
 svn_ra.h
 svn_ra_svn.h
 svn_repos.h
 svn_sorts.h
 svn_string.h
 svn_subst.h
 svn_time.h
 svn_types.h
 svn_user.h
 svn_utf.h
 svn_version.h
 svn_wc.h
 svn_x509.h
 svn_xml.h
lib/
 libsvn_client-1.a
 libsvn_client-1.so
 libsvn_client-1.so.0
 libsvn_client-1.so.0.0.0
 libsvn_delta-1.a
 libsvn_delta-1.so
 libsvn_delta-1.so.0
 libsvn_delta-1.so.0.0.0
 libsvn_diff-1.a
 libsvn_diff-1.so
 libsvn_diff-1.so.0
 libsvn_diff-1.so.0.0.0
 libsvn_fs-1.a
 libsvn_fs-1.so
 libsvn_fs-1.so.0
 libsvn_fs-1.so.0.0.0
 libsvn_fs_base-1.a
 libsvn_fs_base-1.so
 libsvn_fs_base-1.so.0
 libsvn_fs_base-1.so.0.0.0
 libsvn_fs_fs-1.a
 libsvn_fs_fs-1.so
 libsvn_fs_fs-1.so.0
 libsvn_fs_fs-1.so.0.0.0
 libsvn_fs_util-1.a
 libsvn_fs_util-1.so
 libsvn_fs_util-1.so.0
 libsvn_fs_util-1.so.0.0.0
 libsvn_fs_x-1.a
 libsvn_fs_x-1.so
 libsvn_fs_x-1.so.0
 libsvn_fs_x-1.so.0.0.0
 libsvn_ra-1.a
 libsvn_ra-1.so
 libsvn_ra-1.so.0
 libsvn_ra-1.so.0.0.0
 libsvn_ra_local-1.a
 libsvn_ra_local-1.so
 libsvn_ra_local-1.so.0
 libsvn_ra_local-1.so.0.0.0
 libsvn_ra_serf-1.a
 libsvn_ra_serf-1.so
 libsvn_ra_serf-1.so.0
 libsvn_ra_serf-1.so.0.0.0
 libsvn_ra_svn-1.a
 libsvn_ra_svn-1.so
 libsvn_ra_svn-1.so.0
 libsvn_ra_svn-1.so.0.0.0
 libsvn_repos-1.a
 libsvn_repos-1.so
 libsvn_repos-1.so.0
 libsvn_repos-1.so.0.0.0
 libsvn_subr-1.a
 libsvn_subr-1.so
 libsvn_subr-1.so.0
 libsvn_subr-1.so.0.0.0
 libsvn_wc-1.a
 libsvn_wc-1.so
 libsvn_wc-1.so.0
 libsvn_wc-1.so.0.0.0
lib/pkgconfig/
 libsvn_client.pc
 libsvn_delta.pc
 libsvn_diff.pc
 libsvn_fs.pc
 libsvn_fs_base.pc
 libsvn_fs_fs.pc
 libsvn_fs_util.pc
 libsvn_fs_x.pc
 libsvn_ra.pc
 libsvn_ra_local.pc
 libsvn_ra_serf.pc
 libsvn_ra_svn.pc
 libsvn_repos.pc
 libsvn_subr.pc
 libsvn_wc.pc
share/locale/de/LC_MESSAGES/subversion.mo
share/locale/es/LC_MESSAGES/subversion.mo
share/locale/fr/LC_MESSAGES/subversion.mo
share/locale/it/LC_MESSAGES/subversion.mo
share/locale/ja/LC_MESSAGES/subversion.mo
share/locale/ko/LC_MESSAGES/subversion.mo
share/locale/nb/LC_MESSAGES/subversion.mo
share/locale/pl/LC_MESSAGES/subversion.mo
share/locale/pt_BR/LC_MESSAGES/subversion.mo
share/locale/sv/LC_MESSAGES/subversion.mo
share/locale/zh_CN/LC_MESSAGES/subversion.mo
share/locale/zh_TW/LC_MESSAGES/subversion.mo
share/man/man1/
 svn.1.gz
 svnadmin.1.gz
 svndumpfilter.1.gz
 svnlook.1.gz
 svnmucc.1.gz
 svnrdump.1.gz
 svnsync.1.gz
 svnversion.1.gz
share/man/man5/svnserve.conf.5.gz
share/man/man8/svnserve.8.gz
share/subversion/backup/hot-backup.py
share/subversion/bdb/
 erase-all-text-data.py
 skel.py
 svn-bdb-view.py
 svnfs.py
 whatis-rep.py
share/subversion/buildbot/master/README
share/subversion/buildbot/slaves/README
share/subversion/buildbot/slaves/bb-openbsd/
 svnbuild.sh
 svncheck-bindings.sh
 svncheck.sh
 svnclean.sh
share/subversion/buildbot/slaves/i686-debian-sarge1/
 mount-ramdrive.c
 svnbuild.sh
 svncheck.sh
 svnclean.sh
 svnlog.sh
 unmount-ramdrive.c
share/subversion/buildbot/slaves/svn-sparc-solaris/
 mount-tmpfs.c
 rebuild-svn-bits.sh
 serf.patch
 svnbuild.sh
 svncheck.sh
 svncleanup.sh
 svnenv.sh
 twisted.patch
share/subversion/buildbot/slaves/svn-x64-centos/
 list-svn-deps.sh
 svnbuild.sh
 svncheck-bindings.sh
 svncheck.sh
 svnclean.sh
 svnlog.sh
share/subversion/buildbot/slaves/svn-x64-macosx/
 mkramdisk.sh
 rmramdisk.sh
 setenv.sh
 svnbuild-bindings.sh
 svnbuild.sh
 svncheck-bindings.sh
 svncheck.sh
 svnclean.sh
share/subversion/buildbot/slaves/svn-x64-macosx-gnu-shared/
 svnbuild.sh
 svncheck.sh
 svnclean.sh
 svnlog.sh
share/subversion/buildbot/slaves/svn-x64-macosx-gnu-shared-daily-ra_serf/
 svnbuild.sh
 svncheck.sh
 svnclean.sh
 svnlog.sh
share/subversion/buildbot/slaves/ubuntu-x64/
 svnbuild.sh
 svncheck-bindings.sh
 svncheck.sh
 svnclean.sh
 svnlog.sh
share/subversion/buildbot/slaves/win32-SharpSvn/
 svn-config.cmd.template
 svntest-bindings.cmd
 svntest-build-bindings.cmd
 svntest-build.cmd
 svntest-cleanup.cmd
 svntest-javahl.cmd
 svntest-template.cmd
 svntest-test.cmd
share/subversion/buildbot/slaves/win32-xp-VS2005/
 config.bat
 do_all.bat
 svnbuild.bat
 svncheck.bat
 svnclean.bat
 svnlog.bat
share/subversion/buildbot/slaves/xp-vc60-ia32/
 config.bat.tmpl
 svnbuild.bat
 svncheck.bat
 svnclean.bat
 svnlog.bat
share/subversion/client-side/
 bash_completion
 bash_completion_test
 change-svn-wc-format.py
 mergeinfo-sanitizer.py
 server-version.py
 svn-graph.pl
 svn-ssl-fingerprints.sh
 svn-vendor.py
 svn-viewspec.py
 wcfind
share/subversion/client-side/svn-mergeinfo-normalizer/
 analyze-cmd.c
 help-cmd.c
 log.c
 logic.c
 mergeinfo-normalizer.h
 missing-branches.c
 normalize-cmd.c
 remove-branches-cmd.c
 svn-mergeinfo-normalizer.c
 wc_mergeinfo.c
share/subversion/client-side/svnconflict/
 README
 svnconflict.c
share/subversion/dev/
 analyze-svnlogs.py
 aprerr.txt
 build-svn-deps-win.pl
 check-license.py
 contribulyze.py
 datecheck.py
 find-bad-style.py
 find-control-statements.py
 find-unmoved-deprecated.sh
 fsfs-access-map.c
 gen-javahl-errors.py
 gen-py-errors.py
 gen_junit_report.py
 gnuify-changelog.pl
 graph-dav-servers.py
 histogram.py
 lock-check.py
 log_revnum_change_asf.py
 merge-graph.py
 min-includes.sh
 mklog.py
 mlpatch.py
 normalize-dump.py
 po-merge.py
 prebuild-cleanup.sh
 random-commits.py
 remove-trailing-whitespace.sh
 sbox-ospath.py
 scramble-tree.py
 stress.pl
 svn-dev.el
 svn-dev.vim
 svn-entries.el
 svn-merge-revs.py
 svnqlite3-dump
 trails.py
 verify-history.py
 warn-ignored-err.sh
 wc-format.py
 which-error.py
 x509-parser.c
share/subversion/dev/benchmarks/RepoPerf/
 ClearMemory.cpp
 TimeWin.cpp
 copy_repo.py
 win_repo_bench.py
share/subversion/dev/benchmarks/large_dirs/create_bigdir.sh
share/subversion/dev/benchmarks/suite1/
 benchmark.py
 cronjob
 crontab.entry
 generate_charts
 run
 run.bat
share/subversion/dev/gdb-py/README
share/subversion/dev/gdb-py/svndbg/
 __init__.py
 printers.py
share/subversion/dev/iz/
 defect.dem
 ff2csv.command
 ff2csv.py
 find-fix.py
 run-queries.sh
share/subversion/dev/mergegraph/
 __init__.py
 mergegraph.py
 save_as_sh.py
share/subversion/dev/svnmover/
 merge3.c
 ra.c
 scanlog.c
 svnmover.c
 svnmover.h
 util.c
share/subversion/dev/svnmover/linenoise/
 LICENSE
 README.markdown
 linenoise.c
 linenoise.h
share/subversion/dev/svnraisetreeconflict/svnraisetreeconflict.c
share/subversion/dev/unix-build/
 Makefile.svn
 README
share/subversion/dev/wc-ng/
 bump-to-19.py
 count-progress.py
 gather-data.sh
 graph-data.py
 populate-pristine.py
 svn-wc-db-tester.c
share/subversion/dev/windows-build/
 Makefile
 README
 document-version.pl
share/subversion/diff/
 diff.c
 diff3.c
 diff4.c
share/subversion/dist/
 README.advisory
 README.backport
 advisory.py
 backport.pl
 backport_tests.py
 backport_tests_pl.py
 backport_tests_py.py
 checksums.py
 detect-conflicting-backports.py
 dist.sh
 extract-for-examination.sh
 merge-approved-backports.py
 nightly.sh
 nominate.pl
 rat-excludes
 release.py
 test.sh
share/subversion/dist/backport/
 __init__.py
 merger.py
 status.py
share/subversion/dist/backport_tests_data/
 backport_accept.dump
 backport_branch_with_original_revision.dump
 backport_branches.dump
 backport_indented_entry.dump
 backport_multirevisions.dump
 backport_two_approveds.dump
 backport_unicode_entry.dump
share/subversion/dist/security/
 __init__.py
 _gnupg.py
 adviser.py
 mailer.py
 mailinglist.py
 parser.py
share/subversion/dist/templates/
 download.ezt
 rc-news.ezt
 rc-release-ann.ezt
 stable-news.ezt
 stable-release-ann.ezt
share/subversion/examples/
 ExampleAuthn.java
 ExampleAuthnOld.java
 ExampleAuthnVeryOld.java
 SvnCLBrowse
 blame.py
 check-modified.py
 dumpprops.py
 get-location-segments.py
 getfile.py
 getlocks_test.c
 geturl.py
 headrev.c
 info.rb
 minimal_client.c
 putfile.py
 revplist.py
 svnlog2html.rb
 svnlook.py
 svnlook.rb
 svnput.c
 svnserve-sgid.c
 svnshell.py
 svnshell.rb
 testwrite.c
 walk-config-auth.py
share/subversion/hook-scripts/
 CVE-2017-9800-pre-commit.py
 commit-access-control.cfg.example
 commit-access-control.pl
 commit-email.rb
 control-chars.py
 log-police.py
 persist-ephemeral-txnprops.py
 reject-detected-sha1-collisions.sh
 reject-known-sha1-collisions.sh
 svn2feed.py
 svnperms.conf.example
 svnperms.py
 validate-extensions.py
 validate-files.conf.example
 validate-files.py
 verify-po.py
share/subversion/hook-scripts/mailer/
 mailer.conf.example
 mailer.py
share/subversion/hook-scripts/mailer/tests/
 mailer-init.sh
 mailer-t1.output
 mailer-t1.sh
 mailer-tweak.py
 mailer.conf
share/subversion/po/
 l10n-report.py
 po-update.sh
share/subversion/server-side/
 fsfs-reshard.py
 svn-backup-dumps.py
 svn-populate-node-origins-index.c
 svn_server_log_parse.py
 svnauthz.c
 svnpredumpfilter.py
 test_svn_server_log_parse.py
share/subversion/server-side/mod_dontdothat/
 README
 mod_dontdothat.c
share/subversion/server-side/svnpubsub/
 README.txt
 commit-hook.py
 daemonize.py
 irkerbridge.py
 revprop-change-hook.py
 svnpubsub.tac
 svntweet.py
 svnwcsub.conf.example
 svnwcsub.py
 testserver.py
 watcher.py
share/subversion/server-side/svnpubsub/rc.d/
 svnpubsub
 svnpubsub.debian
 svnpubsub.freebsd
 svnpubsub.solaris
 svnwcsub
 svnwcsub.debian
 svnwcsub.freebsd
 svnwcsub.solaris
share/subversion/server-side/svnpubsub/svnpubsub/
 __init__.py
 client.py
 server.py
 util.py
share/subversion/xslt/
 svnindex.css
 svnindex.xsl


[FILE:379:patches/patch-Makefile.in]
--- Makefile.in.orig	2015-09-18 15:56:29.000000000 +0300
+++ Makefile.in	2015-10-15 01:29:59.889146000 +0300
@@ -86,7 +86,7 @@
 swig_pydir_extra = @libdir@/svn-python/svn
 swig_pldir = @libdir@/svn-perl
 swig_rbdir = $(SWIG_RB_SITE_ARCH_DIR)/svn/ext
-toolsdir = @bindir@/svn-tools
+toolsdir = @bindir@
 
 # where to install pkg-config files
 pkgconfig_dir = $(datadir)/pkgconfig


[FILE:1234:patches/patch-build-outputs.mk]
--- build-outputs.mk.orig	2015-10-15 01:24:35.493881000 +0300
+++ build-outputs.mk	2015-10-15 01:25:35.653321000 +0300
@@ -1316,11 +1316,11 @@
 
 install-tools: tools/diff/diff$(EXEEXT) tools/diff/diff3$(EXEEXT) tools/diff/diff4$(EXEEXT) tools/dev/fsfs-access-map$(EXEEXT) tools/server-side/mod_dontdothat/mod_dontdothat.la tools/server-side/svn-populate-node-origins-index$(EXEEXT) tools/server-side/svnauthz$(EXEEXT) tools/server-side/svnauthz-validate$(EXEEXT) tools/dev/svnraisetreeconflict/svnraisetreeconflict$(EXEEXT) tools/dev/x509-parser$(EXEEXT)
 	$(MKDIR) $(DESTDIR)$(toolsdir)
-	cd tools/diff ; $(INSTALL_TOOLS) diff$(EXEEXT) $(DESTDIR)$(toolsdir)/diff$(EXEEXT)
+	cd tools/diff ; $(INSTALL_TOOLS) diff$(EXEEXT) $(DESTDIR)$(toolsdir)/svndiff$(EXEEXT)
 	
-	cd tools/diff ; $(INSTALL_TOOLS) diff3$(EXEEXT) $(DESTDIR)$(toolsdir)/diff3$(EXEEXT)
+	cd tools/diff ; $(INSTALL_TOOLS) diff3$(EXEEXT) $(DESTDIR)$(toolsdir)/svndiff3$(EXEEXT)
 	
-	cd tools/diff ; $(INSTALL_TOOLS) diff4$(EXEEXT) $(DESTDIR)$(toolsdir)/diff4$(EXEEXT)
+	cd tools/diff ; $(INSTALL_TOOLS) diff4$(EXEEXT) $(DESTDIR)$(toolsdir)/svndiff4$(EXEEXT)
 	
 	cd tools/dev ; $(INSTALL_TOOLS) fsfs-access-map$(EXEEXT) $(DESTDIR)$(toolsdir)/fsfs-access-map$(EXEEXT)
 	


[FILE:1009:files/svnserve.in]
#!/bin/sh
#
# svnserve.sh for rc.d usage (c) 2005 Thomas E. Spanjaard.

# PROVIDE: svnserve
# REQUIRE: DAEMON
# BEFORE: LOGIN
# KEYWORD: shutdown
#
# Add the following line to /etc/rc.conf to enable SVNServe:
#
#  svnserve_enable="YES"
#  # optional
#  svnserve_flags="-d --listen-port=3690 --listen-host 0.0.0.0"
#  svnserve_data="/data/repositories"
#  svnserve_user="svn"
#  svnserve_group="svn"
#
# Note:
# svnserve bind per default at the ipv6 address!
# If you want svnserve binding at ipv4 address, you have
# to use option 'svnserve_flags' with --listen-host parameter

. /etc/rc.subr

# Set some defaults
svnserve_enable=${svnserve_enable:-"NO"}
svnserve_flags=${svnserve_flags:-"-d --listen-port=3690 --listen-host 0.0.0.0"}
svnserve_data=${svnserve_data:-"/home/svn/repos"}
svnserve_user=${svnserve_user:-"svn"}
svnserve_group=${svnserve_group:-"svn"}

name=svnserve
rcvar=svnserve_enable
load_rc_config $name
command=%%PREFIX%%/bin/svnserve
command_args="-r ${svnserve_data}"

run_rc_command "$1"

