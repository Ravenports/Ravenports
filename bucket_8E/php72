# Buildsheet autogenerated by ravenadm tool -- Do not edit.

NAMEBASE=		php72
VERSION=		7.2.0RC1
KEYWORDS=		lang www php
VARIANTS=		standard
SDESC[standard]=	PHP Hypertext Preprocessor version 7.2
HOMEPAGE=		http://php.net/
CONTACT=		nobody

DOWNLOAD_GROUPS=	main
SITES[main]=		PHP/distributions
DISTFILE[1]=		php-7.2.0RC1.tar.xz:main
DF_INDEX=		1
SPKGS[standard]=	single

OPTIONS_AVAILABLE=	CLI CGI FPM EMBED DEBUGGER
OPTIONS_STANDARD=	CLI CGI FPM EMBED DEBUGGER
OPTGROUP_RESTRICTED=	SAPI
OPTDESCR[SAPI]=		Server Application Programming Interface
OPTGROUP[SAPI]=		CLI CGI FPM DEBUGGER
OPT_ON[all]=		CLI CGI FPM EMBED DEBUGGER

BUILD_DEPENDS=		pcre:static:standard
			autoconf:single:standard
BUILDRUN_DEPENDS=	pcre:shared:standard

USES=			cpe gmake
GNOME_COMPONENTS=	libxml2

DISTNAME=		php-7.2.0RC1

CPE_PRODUCT=		php
FPC_EQUIVALENT=		lang/php72

MUST_CONFIGURE=		gnu
CONFIGURE_ARGS=		--with-layout=GNU
			--localstatedir=/var
			--with-config-file-scan-dir={{PREFIX}}/etc/php72
			--sysconfdir={{PREFIX}}/etc/php72
			--libdir={{PREFIX}}/lib/php72
			--datadir={{PREFIX}}/share/php72
			--disable-all
			--enable-libxml
			--enable-mysqlnd
			--with-libxml-dir={{LOCALBASE}}
			--with-pcre-regex={{LOCALBASE}}
			--program-suffix=72
CONFIGURE_ENV=		ac_cv_decimal_fp_supported="no"
			lt_cv_path_SED="sed"

DESTDIRNAME=		INSTALL_ROOT

PLIST_SUB=		SUFFIX=72
			SOMAJOR=7
RC_SUBR=		php-fpm:single

[CLI].DESCRIPTION=			Enable Command Line Interface SAPI
[CLI].CONFIGURE_ARGS_OFF=		--disable-cli
[CLI].MAKEFILE_ON=			PHP_SAPI+=cli

[FPM].DESCRIPTION=			Enable FastCGI Process Manager SAPI
[FPM].CONFIGURE_ARGS_ON=		--enable-fpm
					--with-fpm-user={{WWWOWN}}
					--with-fpm-group={{WWWGRP}}
[FPM].MAKEFILE_ON=			PHP_SAPI+=fpm

[DEBUGGER].DESCRIPTION=			Enable interactive debugger SAPI module support
[DEBUGGER].CONFIGURE_ENABLE_BOTH=	phpdbg
[DEBUGGER].MAKEFILE_ON=			PHP_SAPI+=phpdbg

[CGI].DESCRIPTION=			Enable Common Gateway Interface SAPI
[CGI].CONFIGURE_ARGS_OFF=		--disable-cgi
[CGI].MAKEFILE_ON=			PHP_SAPI+=cgi

[EMBED].DESCRIPTION=			Build embedded SAPI library
[EMBED].CONFIGURE_ARGS_ON=		--enable-embed
[EMBED].MAKEFILE_ON=			PHP_SAPI+=embed

post-install-CLI-ON:
	${STRIP_CMD} ${STAGEDIR}${PREFIX}/bin/php72

post-patch:
	@${TOUCH} ${WRKSRC}/ext/php_config.h
	@${REINPLACE_CMD} "s|^\(extension_dir\)|; \1|" ${WRKSRC}/php.ini-*
	@${REINPLACE_CMD} -e "/phpincludedir =/ s|/php|/php72|" \
		${WRKSRC}/scripts/Makefile.frag
	@${REINPLACE_CMD} -e "/includedir=/ s|php|php72|" \
		${WRKSRC}/scripts/phpize.in
	@${REINPLACE_CMD} -e "/include_dir=/ s|php|php72|" \
		${WRKSRC}/scripts/php-config.in

post-install-DEBUGGER-ON:
	${STRIP_CMD} ${STAGEDIR}${PREFIX}/bin/phpdbg72

post-patch-FPM-ON:
	@${REINPLACE_CMD} -e "s|^;\(pid\)|\1|;s|^;\(pm\.[a-z_]*_servers\)|\1|" \
		${WRKSRC}/sapi/fpm/php-fpm.conf.in

post-install:
	@${MKDIR} ${STAGEDIR}${PREFIX}/etc/php72
	${RM} -r ${STAGEDIR}/var
	${INSTALL_DATA} ${WRKSRC}/php.ini-development \
		${WRKSRC}/php.ini-production \
		${WRKDIR}/php.conf ${STAGEDIR}${PREFIX}/etc/php72

post-build:
	@${ECHO_CMD} "PHP_VER=72" > ${WRKDIR}/php.conf
	@${ECHO_CMD} "PHP_VERSION=7.2.0RC1" >> ${WRKDIR}/php.conf
	@${ECHO_CMD} "PHP_SAPI=${PHP_SAPI}" >> ${WRKDIR}/php.conf
	@${ECHO_CMD} "PHP_EXT_INC=pcre spl" >> ${WRKDIR}/php.conf
	@${ECHO_CMD} -n "PHP_EXT_DIR=" >> ${WRKDIR}/php.conf
	@${SH} ${WRKSRC}/scripts/php-config --extension-dir | \
		${SED} -ne 's,^${PREFIX}/lib/php72/,,p' >> ${WRKDIR}/php.conf

post-install-EMBED-ON:
	${STRIP_CMD} ${STAGEDIR}${PREFIX}/lib/libphp7.so
	${MV} ${STAGEDIR}${PREFIX}/lib/libphp7.so \
		${STAGEDIR}${PREFIX}/lib/php72/

pre-configure:
	# Work around issues with newer (>=2.64) autoconf
	${REINPLACE_CMD} -E 's:^((m4_)?divert)[(]([0-9]*)[)]:\1(600\3):' \
		${WRKSRC}/configure.in `${FIND} ${WRKSRC} -name '*.m4'`
	${CAT} ${WRKSRC}/acinclude.m4 ${WRKSRC}/build/libtool.m4 \
		> ${WRKSRC}/aclocal.m4
	(cd ${CONFIGURE_WRKSRC} && ${LOCALBASE}/bin/autoconf-2.69)

post-install-CGI-ON:
	${STRIP_CMD} ${STAGEDIR}${PREFIX}/bin/php-cgi72

post-install-FPM-ON:
	${STRIP_CMD} ${STAGEDIR}${PREFIX}/sbin/php-fpm72

[FILE:917:descriptions/desc.single]
PHP is a widely-used open source general-purpose scripting language
that is especially suited for web development and can be embedded
into HTML. It is modular, and object-oriented. Much of its syntax
is borrowed from C, Java and Perl with a couple of unique PHP-specific
features thrown in.  The language is designed to allow web developers
to write dynamically generated pages quickly.

This package provides PHP version 7.1.x.  New feature added over
version 7.0.x include:

 * Nullable types
 * Void return type
 * Iterable pseudo-type
 * Class constant visibility modifiers
 * Square bracket syntax for array destructuring assignment
 * Catching multiple exceptions types
 * HTTP/2 Server Push Support in ext/curl & other ext/curl improvements
 * Fix inconsistent behavior in $this variable
 * Create closure from callable
 * More precise float values
 * Asynchronous Signal Handling (without ticks) in ext/pcntl


[FILE:98:distinfo]
876d58e8cbae6851ebf9f32139d39406c5f75b97ccfa9c6fe0b7d86156454207          954 php-7.2.0RC1.tar.xz


[FILE:5209:manifests/plist.single]
%%CLI-ON%%bin/php%%SUFFIX%%
%%CGI-ON%%bin/php-cgi%%SUFFIX%%
bin/
 php-config%%SUFFIX%%
%%DEBUGGER-ON%%bin/phpdbg%%SUFFIX%%
 phpize%%SUFFIX%%
etc/php%%SUFFIX%%/
 php.conf
 php.ini-development
 php.ini-production
%%FPM-ON%%@sample etc/php%%SUFFIX%%/php-fpm.conf.default etc/php%%SUFFIX%%/php-fpm.conf
%%FPM-ON%%@sample etc/php%%SUFFIX%%/php-fpm.d/www.conf.default etc/php%%SUFFIX%%/php-fpm.d/www.conf
include/php%%SUFFIX%%/TSRM/
 TSRM.h
 readdir.h
 tsrm_config.h
 tsrm_config.w32.h
 tsrm_config_common.h
 tsrm_nw.h
 tsrm_strtok_r.h
 tsrm_win32.h
include/php%%SUFFIX%%/Zend/
 zend.h
 zend_API.h
 zend_alloc.h
 zend_alloc_sizes.h
 zend_arena.h
 zend_ast.h
 zend_bitset.h
 zend_build.h
 zend_builtin_functions.h
 zend_closures.h
 zend_compile.h
 zend_config.h
 zend_config.nw.h
 zend_config.w32.h
 zend_constants.h
 zend_dtrace.h
 zend_errors.h
 zend_exceptions.h
 zend_execute.h
 zend_extensions.h
 zend_float.h
 zend_gc.h
 zend_generators.h
 zend_globals.h
 zend_globals_macros.h
 zend_hash.h
 zend_highlight.h
 zend_inheritance.h
 zend_ini.h
 zend_ini_parser.h
 zend_ini_scanner.h
 zend_ini_scanner_defs.h
 zend_interfaces.h
 zend_istdiostream.h
 zend_iterators.h
 zend_language_parser.h
 zend_language_scanner.h
 zend_language_scanner_defs.h
 zend_list.h
 zend_llist.h
 zend_long.h
 zend_modules.h
 zend_multibyte.h
 zend_multiply.h
 zend_object_handlers.h
 zend_objects.h
 zend_objects_API.h
 zend_operators.h
 zend_portability.h
 zend_ptr_stack.h
 zend_range_check.h
 zend_signal.h
 zend_smart_str.h
 zend_smart_str_public.h
 zend_sort.h
 zend_stack.h
 zend_stream.h
 zend_string.h
 zend_strtod.h
 zend_strtod_int.h
 zend_ts_hash.h
 zend_type_info.h
 zend_types.h
 zend_variables.h
 zend_virtual_cwd.h
 zend_vm.h
 zend_vm_def.h
 zend_vm_execute.h
 zend_vm_opcodes.h
include/php%%SUFFIX%%/ext/date/lib/
 timelib.h
 timelib_config.h
 timelib_structs.h
include/php%%SUFFIX%%/ext/date/php_date.h
include/php%%SUFFIX%%/ext/libxml/php_libxml.h
include/php%%SUFFIX%%/ext/mysqlnd/
 config-win.h
 mysql_float_to_double.h
 mysqlnd.h
 mysqlnd_alloc.h
 mysqlnd_auth.h
 mysqlnd_block_alloc.h
 mysqlnd_charset.h
 mysqlnd_commands.h
 mysqlnd_connection.h
 mysqlnd_debug.h
 mysqlnd_enum_n_def.h
 mysqlnd_ext_plugin.h
 mysqlnd_libmysql_compat.h
 mysqlnd_plugin.h
 mysqlnd_portability.h
 mysqlnd_priv.h
 mysqlnd_protocol_frame_codec.h
 mysqlnd_ps.h
 mysqlnd_read_buffer.h
 mysqlnd_result.h
 mysqlnd_result_meta.h
 mysqlnd_reverse_api.h
 mysqlnd_statistics.h
 mysqlnd_structs.h
 mysqlnd_vio.h
 mysqlnd_wireprotocol.h
 php_mysqlnd.h
include/php%%SUFFIX%%/ext/pcre/php_pcre.h
include/php%%SUFFIX%%/ext/spl/
 php_spl.h
 spl_array.h
 spl_directory.h
 spl_dllist.h
 spl_engine.h
 spl_exceptions.h
 spl_fixedarray.h
 spl_functions.h
 spl_heap.h
 spl_iterators.h
 spl_observer.h
include/php%%SUFFIX%%/ext/standard/
 base64.h
 basic_functions.h
 crc32.h
 credits.h
 credits_ext.h
 credits_sapi.h
 crypt_blowfish.h
 crypt_freesec.h
 css.h
 cyr_convert.h
 datetime.h
 dl.h
 exec.h
 file.h
 flock_compat.h
 fsock.h
 head.h
 html.h
 html_tables.h
 info.h
 md5.h
 microtime.h
 pack.h
 pageinfo.h
 php_array.h
 php_assert.h
 php_browscap.h
 php_crypt.h
 php_crypt_r.h
 php_dir.h
 php_dns.h
 php_ext_syslog.h
 php_filestat.h
 php_fopen_wrappers.h
 php_ftok.h
 php_http.h
 php_image.h
 php_incomplete_class.h
 php_iptc.h
 php_lcg.h
 php_link.h
 php_mail.h
 php_math.h
 php_metaphone.h
 php_mt_rand.h
 php_password.h
 php_rand.h
 php_random.h
 php_smart_string.h
 php_smart_string_public.h
 php_standard.h
 php_string.h
 php_type.h
 php_uuencode.h
 php_var.h
 php_versioning.h
 proc_open.h
 quot_print.h
 scanf.h
 sha1.h
 streamsfuncs.h
 uniqid.h
 url.h
 url_scanner_ex.h
 winver.h
@postexec touch %D/include/php%%SUFFIX%%/ext/php_config.h
@postunexec [ -s %D/include/php%%SUFFIX%%/ext/php_config.h ] || rm %D/include/php%%SUFFIX%%/ext/php_config.h
include/php%%SUFFIX%%/main/
 SAPI.h
 build-defs.h
 fastcgi.h
 fopen_wrappers.h
 http_status_codes.h
 php.h
 php_compat.h
 php_config.h
 php_content_types.h
 php_getopt.h
 php_globals.h
 php_ini.h
 php_main.h
 php_memory_streams.h
 php_network.h
 php_open_temporary_file.h
 php_output.h
 php_reentrancy.h
 php_scandir.h
 php_stdint.h
 php_streams.h
 php_syslog.h
 php_ticks.h
 php_variables.h
 php_version.h
 rfc1867.h
 snprintf.h
 spprintf.h
include/php%%SUFFIX%%/main/streams/
 php_stream_context.h
 php_stream_filter_api.h
 php_stream_glob_wrapper.h
 php_stream_mmap.h
 php_stream_plain_wrapper.h
 php_stream_transport.h
 php_stream_userspace.h
 php_streams_int.h
include/php%%SUFFIX%%/main/
 win95nt.h
%%CLI-ON%%include/php%%SUFFIX%%/sapi/cli/cli.h
%%EMBED-ON%%include/php%%SUFFIX%%/sapi/embed/php_embed.h
lib/php%%SUFFIX%%/build/
 Makefile.global
 acinclude.m4
 ax_check_compile_flag.m4
 config.guess
 config.sub
 libtool.m4
 ltmain.sh
 mkdep.awk
 phpize.m4
 run-tests.php
 scan_makefile_in.awk
 shtool
%%EMBED-ON%%lib/php%%SUFFIX%%/libphp%%SOMAJOR%%.so
%%FPM-ON%%sbin/php-fpm%%SUFFIX%%
%%CLI-ON%%share/man/man1/php%%SUFFIX%%.1.gz
%%CGI-ON%%share/man/man1/php-cgi%%SUFFIX%%.1.gz
share/man/man1/
 php-config%%SUFFIX%%.1.gz
%%DEBUGGER-ON%%share/man/man1/phpdbg%%SUFFIX%%.1.gz
 phpize%%SUFFIX%%.1.gz
%%FPM-ON%%share/man/man8/php-fpm%%SUFFIX%%.8.gz
%%FPM-ON%%share/php%%SUFFIX%%/fpm/status.html


[FILE:1176:patches/patch-Makefile.global]
--- Makefile.global.orig	2016-08-17 19:50:48 UTC
+++ Makefile.global
@@ -89,14 +89,14 @@ test: all
 	@if test ! -z "$(PHP_EXECUTABLE)" && test -x "$(PHP_EXECUTABLE)"; then \
 		INI_FILE=`$(PHP_EXECUTABLE) -d 'display_errors=stderr' -r 'echo php_ini_loaded_file();' 2> /dev/null`; \
 		if test "$$INI_FILE"; then \
-			$(EGREP) -h -v $(PHP_DEPRECATED_DIRECTIVES_REGEX) "$$INI_FILE" > $(top_builddir)/tmp-php.ini; \
+			$(EGREP) -h -v $(PHP_DEPRECATED_DIRECTIVES_REGEX) "$$INI_FILE" > $(top_builddir)/tmp-php.ini || :; \
 		else \
 			echo > $(top_builddir)/tmp-php.ini; \
 		fi; \
 		INI_SCANNED_PATH=`$(PHP_EXECUTABLE) -d 'display_errors=stderr' -r '$$a = explode(",\n", trim(php_ini_scanned_files())); echo $$a[0];' 2> /dev/null`; \
 		if test "$$INI_SCANNED_PATH"; then \
 			INI_SCANNED_PATH=`$(top_srcdir)/build/shtool path -d $$INI_SCANNED_PATH`; \
-			$(EGREP) -h -v $(PHP_DEPRECATED_DIRECTIVES_REGEX) "$$INI_SCANNED_PATH"/*.ini >> $(top_builddir)/tmp-php.ini; \
+			$(EGREP) -h -v $(PHP_DEPRECATED_DIRECTIVES_REGEX) "$$INI_SCANNED_PATH"/*.ini >> $(top_builddir)/tmp-php.ini || :; \
 		fi; \
 		TEST_PHP_EXECUTABLE=$(PHP_EXECUTABLE) \
 		TEST_PHP_SRCDIR=$(top_srcdir) \


[FILE:3059:patches/patch-acinclude.m4]
--- acinclude.m4.orig	2016-07-20 13:11:26 UTC
+++ acinclude.m4
@@ -985,15 +985,9 @@ dnl ------------------------------------
   if test "$3" != "shared" && test "$3" != "yes" && test "$4" = "cli"; then
 dnl ---------------------------------------------- CLI static module
     [PHP_]translit($1,a-z_-,A-Z__)[_SHARED]=no
-    case "$PHP_SAPI" in
-      cgi|embed[)]
-        PHP_ADD_SOURCES($ext_dir,$2,$ac_extra,)
-        EXT_STATIC="$EXT_STATIC $1;$ext_dir"
-        ;;
-      *[)]
-        PHP_ADD_SOURCES($ext_dir,$2,$ac_extra,cli)
-        ;;
-    esac
+
+	PHP_ADD_SOURCES(PHP_EXT_DIR($1),$2,$ac_extra,cgi)
+	PHP_ADD_SOURCES(PHP_EXT_DIR($1),$2,$ac_extra,fpm)
     EXT_CLI_STATIC="$EXT_CLI_STATIC $1;$ext_dir"
   fi
   PHP_ADD_BUILD_DIR($ext_builddir)
@@ -1043,12 +1037,6 @@ You either need to build $1 shared or bu
 build to be successful.
 ])
   fi
-  if test "x$is_it_enabled" = "xno" && test "x$3" != "xtrue"; then
-    AC_MSG_ERROR([
-You've configured extension $1, which depends on extension $2,
-but you've either not enabled $2, or have disabled it.
-])
-  fi
   dnl Some systems require that we link $2 to $1 when building
 ])
 
@@ -2975,8 +2963,7 @@ dnl in GNU Make which causes the .d file
 $abs_srcdir/$ac_provsrc:;
 
 $ac_bdir[$]ac_hdrobj: $abs_srcdir/$ac_provsrc
-	CFLAGS="\$(CFLAGS_CLEAN)" dtrace -h -C -s $ac_srcdir[$]ac_provsrc -o \$[]@.bak && \$(SED) -e 's,PHP_,DTRACE_,g' \$[]@.bak > \$[]@
-
+	CFLAGS="\$(CFLAGS_CLEAN)" dtrace -xnolibs -h -C -s $ac_srcdir[$]ac_provsrc -o \$[]@.bak && \$(SED) -e 's,PHP_,DTRACE_,g' \$[]@.bak > \$[]@
 \$(PHP_DTRACE_OBJS): $ac_bdir[$]ac_hdrobj
 
 EOF
@@ -2995,12 +2982,12 @@ dnl Always attempt to create both PIC an
 $ac_bdir[$]ac_provsrc.lo: \$(PHP_DTRACE_OBJS)
 	echo "[#] Generated by Makefile for libtool" > \$[]@
 	@test -d "$dtrace_lib_dir" || mkdir $dtrace_lib_dir
-	if CFLAGS="\$(CFLAGS_CLEAN)" dtrace -G -o $dtrace_d_obj -s $abs_srcdir/$ac_provsrc $dtrace_lib_objs 2> /dev/null && test -f "$dtrace_d_obj"; then [\\]
+	if CFLAGS="\$(CFLAGS_CLEAN)" dtrace -xnolibs -G -o $dtrace_d_obj -s $abs_srcdir/$ac_provsrc $dtrace_lib_objs 2> /dev/null && test -f "$dtrace_d_obj"; then [\\]
 	  echo "pic_object=['].libs/$dtrace_prov_name[']" >> \$[]@ [;\\]
 	else [\\]
 	  echo "pic_object='none'" >> \$[]@ [;\\]
 	fi
-	if CFLAGS="\$(CFLAGS_CLEAN)" dtrace -G -o $ac_bdir[$]ac_provsrc.o -s $abs_srcdir/$ac_provsrc $dtrace_nolib_objs 2> /dev/null && test -f "$ac_bdir[$]ac_provsrc.o"; then [\\]
+	if CFLAGS="\$(CFLAGS_CLEAN)" dtrace -xnolibs -G -o $ac_bdir[$]ac_provsrc.o -s $abs_srcdir/$ac_provsrc $dtrace_nolib_objs 2> /dev/null && test -f "$ac_bdir[$]ac_provsrc.o"; then [\\]
 	  echo "non_pic_object=[']$dtrace_prov_name[']" >> \$[]@ [;\\]
 	else [\\]
 	  echo "non_pic_object='none'" >> \$[]@ [;\\]
@@ -3012,7 +2999,7 @@ EOF
   *)
 cat>>Makefile.objects<<EOF
 $ac_bdir[$]ac_provsrc.o: \$(PHP_DTRACE_OBJS)
-	CFLAGS="\$(CFLAGS_CLEAN)" dtrace -G -o \$[]@ -s $abs_srcdir/$ac_provsrc $dtrace_objs
+	CFLAGS="\$(CFLAGS_CLEAN)" dtrace -xnolibs -G -o \$[]@ -s $abs_srcdir/$ac_provsrc $dtrace_objs
 
 EOF
     ;;


[FILE:1540:patches/patch-configure.in]
--- configure.in.orig	2016-07-20 13:11:23 UTC
+++ configure.in
@@ -370,7 +370,6 @@ sinclude(TSRM/tsrm.m4)
 dnl .
 dnl -------------------------------------------------------------------------
 
-PTHREADS_CHECK
 PHP_HELP_SEPARATOR([SAPI modules:])
 PHP_SHLIB_SUFFIX_NAMES
 PHP_BUILD_PROGRAM
@@ -401,15 +400,9 @@ else
   AC_MSG_RESULT([none])
 fi
 
-dnl Exit early
-if test -z "$PHP_INSTALLED_SAPIS"; then
-  AC_MSG_ERROR([Nothing to build.])
-fi
-
 dnl force ZTS
 if test "$enable_maintainer_zts" = "yes"; then
   PTHREADS_ASSIGN_VARS
-  PTHREADS_FLAGS
 fi
 
 dnl Starting system checks.
@@ -700,7 +693,7 @@ nanosleep \
 )
 
 dnl Some systems (like OpenSolaris) do not have nanosleep in libc
-PHP_CHECK_FUNC_LIB(nanosleep, rt)
+PHP_CHECK_FUNC(nanosleep, rt)
 
 dnl Check for getaddrinfo, should be a better way, but...
 dnl Also check for working getaddrinfo
@@ -1251,7 +1244,7 @@ EXPANDED_SYSCONFDIR=`eval echo $sysconfd
 EXPANDED_DATADIR=$datadir
 EXPANDED_PHP_CONFIG_FILE_PATH=`eval echo "$PHP_CONFIG_FILE_PATH"`
 EXPANDED_PHP_CONFIG_FILE_SCAN_DIR=`eval echo "$PHP_CONFIG_FILE_SCAN_DIR"`
-INCLUDE_PATH=.:$EXPANDED_PEAR_INSTALLDIR
+INCLUDE_PATH=.:${prefix}/share/pear
 
 exec_prefix=$old_exec_prefix
 libdir=$old_libdir
@@ -1460,7 +1453,7 @@ PHP_SUBST(all_targets)
 PHP_SUBST(install_targets)
 PHP_SUBST(install_binary_targets)
 
-PHP_INSTALL_HEADERS([Zend/ TSRM/ include/ main/ main/streams/])
+PHP_INSTALL_HEADERS([Zend/ TSRM/ main/ main/streams/])
 
 PHP_ADD_SOURCES(TSRM, TSRM.c tsrm_strtok_r.c, -DZEND_ENABLE_STATIC_TSRMLS_CACHE=1)
 


[FILE:323:patches/patch-main__php_config.h.in]
--- main/php_config.h.in.orig	2016-07-20 13:12:32 UTC
+++ main/php_config.h.in
@@ -2426,6 +2426,9 @@
 /* Define if processor uses big-endian word */
 #undef WORDS_BIGENDIAN
 
+/* Include external shared modules configurations */
+#include "ext/php_config.h"
+
 /* Whether sprintf is broken */
 #undef ZEND_BROKEN_SPRINTF
 


[FILE:429:patches/patch-sapi_apache2handler_config.m4]
--- sapi/apache2handler/config.m4.orig	2016-07-20 13:11:37 UTC
+++ sapi/apache2handler/config.m4
@@ -67,7 +67,7 @@ if test "$PHP_APXS2" != "no"; then
   fi
 
   APXS_LIBEXECDIR='$(INSTALL_ROOT)'`$APXS -q LIBEXECDIR`
-  if test -z `$APXS -q SYSCONFDIR`; then
+  if true; then
     INSTALL_IT="\$(mkinstalldirs) '$APXS_LIBEXECDIR' && \
                  $APXS -S LIBEXECDIR='$APXS_LIBEXECDIR' \
                        -i -n php7"


[FILE:603:patches/patch-sapi_fpm_config.m4]
--- sapi/fpm/config.m4.orig	2016-07-20 13:11:36 UTC
+++ sapi/fpm/config.m4
@@ -317,14 +317,14 @@ AC_DEFUN([AC_FPM_LQ],
 
   AC_MSG_CHECKING([for TCP_INFO])
 
-  AC_TRY_COMPILE([ #include <netinet/tcp.h> ], [struct tcp_info ti; int x = TCP_INFO;], [
+  AC_TRY_COMPILE([ #include <netinet/tcp.h> ], [struct tcp_info ti; ti.tcpi_sacked = 0; int x = TCP_INFO;], [
     have_lq=tcp_info
     AC_MSG_RESULT([yes])
   ], [
     AC_MSG_RESULT([no])
   ])
 
-  if test "$have_lq" = "tcp_info"; then
+  if test "$have_lq" = "so_listenq"; then
     AC_DEFINE([HAVE_LQ_TCP_INFO], 1, [do we have TCP_INFO?])
   fi
 


[FILE:1214:files/php-fpm.in]
#!/bin/sh
#

# PROVIDE: php-fpm
# REQUIRE: LOGIN
# KEYWORD: shutdown

#
# Add the following line to /etc/rc.conf to enable php-fpm:
# php_fpm_enable="YES"
#

. /etc/rc.subr

name="php_fpm"
rcvar=php_fpm_enable

start_precmd="php_fpm_prestart"
restart_precmd="php_fpm_checkconfig"
reload_precmd="php_fpm_checkconfig"
configtest_cmd="php_fpm_checkconfig"

load_rc_config "$name"

: ${php_fpm_enable="NO"}
: ${php_fpm_umask=""}

extra_commands="reload configtest logrotate"

command="%%PREFIX%%/sbin/php-fpm"
pidfile="/var/run/php-fpm.pid"
sig_stop="QUIT"
sig_reload="USR2"
logrotate_cmd="php_fpm_logrotate"

required_files="%%PREFIX%%/etc/php-fpm.conf"

php_fpm_logrotate() {
        if [ -z "$rc_pid" ]; then
                _run_rc_notrunning
                return 1
        fi
        echo "Rotating logs $name."
        kill -USR1 $rc_pid
}

php_fpm_checkconfig()
{
        echo "Performing sanity check on php-fpm configuration:"
        eval ${command} -t
}

php_fpm_prestart()
{
	php_fpm_checkconfig
	checkconfig=$?
	if [ $checkconfig -ne 0  ]; then
		return $checkconfig
	fi

	if [ ! -z "$php_fpm_umask"  ]; then
		echo "Setting umask to: ${php_fpm_umask}"
		umask $php_fpm_umask
	fi
}

run_rc_command "$1"

