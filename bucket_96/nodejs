# Buildsheet autogenerated by ravenadm tool -- Do not edit.

NAMEBASE=		nodejs
VERSION=		11.1.0
KEYWORDS=		www lang
VARIANTS=		standard
SDESC[standard]=	Evented I/O for V8 JavaScript
HOMEPAGE=		https://nodejs.org/
CONTACT=		nobody

DOWNLOAD_GROUPS=	main
SITES[main]=		http://nodejs.org/dist/v11.1.0/
DISTFILE[1]=		node-v11.1.0.tar.gz:main
DF_INDEX=		1
SPKGS[standard]=	complete
			primary
			docs

OPTIONS_AVAILABLE=	none
OPTIONS_STANDARD=	none

BUILDRUN_DEPENDS=	icu:single:standard
			libuv:single:standard
			c-ares:single:standard

USES=			execinfo gmake python:build,py27 pkgconfig
			shebangfix zlib

DISTNAME=		node-v11.1.0

LICENSE=		MIT:primary
LICENSE_FILE=		MIT:{{WRKSRC}}/LICENSE
LICENSE_SCHEME=		solo

FPC_EQUIVALENT=		www/node
SHEBANG_FILES=		tools/specialize_node_d.py
			tools/genv8constants.py

MUST_CONFIGURE=		yes
CONFIGURE_ARGS=		--prefix={{PREFIX}}
			--without-snapshot
			--without-npm
			--shared-cares
			--shared-libuv
			--shared-zlib
			--with-intl=system-icu
			--openssl-no-asm

MAKE_ENV=		CC.host={{CC}}
			CXX.host={{CXX}}
			LINK.host={{CXX}}
			LINK.target={{CXX}}

post-patch:
	${GREP} -rl "/usr/local" ${WRKSRC} | \
		${XARGS} ${REINPLACE_CMD} -e 's|/usr/local|${LOCALBASE}|g'
	${FIND} ${WRKSRC} -name "*.bak" -delete
	# So many different ways to run python. Fix them all.
	${REINPLACE_CMD} -e 's|/usr/bin/env python|${PYTHON_CMD}|' \
		${WRKSRC}/configure
	${FIND} ${WRKSRC} -type f -name '*.gyp*' -print0 | \
		${XARGS} -0 ${REINPLACE_CMD} \
			-e "s|'python'|'${PYTHON_CMD}'|" \
			-e 's|<!(python |<!(${PYTHON_CMD} |' \
			-e 's|\&\& python |\&\& ${PYTHON_CMD} |'
	# fix inability for torque to find libz
	${REINPLACE_CMD} -e 's|@RAVRPATH@|-Wl,-rpath,${PREFIX}/lib|' \
		${WRKSRC}/deps/v8/gypfiles/v8.gyp
	${FIND} ${WRKSRC} -name "*.bak" -delete

post-install:
	${STRIP_CMD} ${STAGEDIR}${PREFIX}/bin/node
	${CHOWN} ${MANMODE} ${STAGEDIR}${PREFIX}/share/man/man1/node.1

post-patch-freebsd:
	${REINPLACE_CMD} -e '/define HAVE_CRYPTODEV/d' \
		${WRKSRC}/deps/openssl/openssl/crypto/engine/eng_cryptodev.c

[FILE:263:descriptions/desc.primary]
Node.js is a JavaScript runtime built on Chrome's V8 JavaScript
engine. Node.js uses an event-driven, non-blocking I/O model that
makes it lightweight and efficient. Node.js' package ecosystem,
npm, is the largest ecosystem of open source libraries in the world.


[FILE:98:distinfo]
3f53b5ac25b2d36ad538267083c0e603d9236867a936c22a9116d95fa10c60d5     36334066 node-v11.1.0.tar.gz


[FILE:12329:manifests/plist.primary]
bin/node
include/node/
 common.gypi
 config.gypi
 node.h
 node_api.h
 node_api_types.h
 node_buffer.h
 node_object_wrap.h
 node_version.h
 v8-platform.h
 v8-profiler.h
 v8-testing.h
 v8-util.h
 v8-value-serializer-version.h
 v8-version-string.h
 v8-version.h
 v8.h
 v8config.h
include/node/libplatform/
 libplatform-export.h
 libplatform.h
 v8-tracing.h
include/node/openssl/
 aes.h
 asn1.h
 asn1_mac.h
 asn1t.h
 async.h
 bio.h
 blowfish.h
 bn.h
 bn_conf.h
 bn_conf_asm.h
 bn_conf_no-asm.h
 buffer.h
 camellia.h
 cast.h
 cmac.h
 cms.h
 comp.h
 conf.h
 conf_api.h
 crypto.h
 ct.h
 des.h
 dh.h
 dsa.h
 dso_conf.h
 dso_conf_asm.h
 dso_conf_no-asm.h
 dtls1.h
 e_os2.h
 ebcdic.h
 ec.h
 ecdh.h
 ecdsa.h
 engine.h
 err.h
 evp.h
 hmac.h
 idea.h
 kdf.h
 lhash.h
 md2.h
 md4.h
 md5.h
 mdc2.h
 modes.h
 obj_mac.h
 objects.h
 ocsp.h
 opensslconf.h
 opensslconf_asm.h
 opensslconf_no-asm.h
 opensslv.h
 ossl_typ.h
 pem.h
 pem2.h
 pkcs12.h
 pkcs7.h
 rand.h
 rc2.h
 rc4.h
 rc5.h
 ripemd.h
 rsa.h
 safestack.h
 seed.h
 sha.h
 srp.h
 srtp.h
 ssl.h
 ssl2.h
 ssl3.h
 stack.h
 symhacks.h
 tls1.h
 ts.h
 txt_db.h
 ui.h
 whrlpool.h
 x509.h
 x509_vfy.h
 x509v3.h
include/node/openssl/archs/BSD-x86_64/asm/crypto/buildinf.h
include/node/openssl/archs/BSD-x86_64/asm/crypto/include/internal/
 bn_conf.h
 dso_conf.h
include/node/openssl/archs/BSD-x86_64/asm/include/progs.h
include/node/openssl/archs/BSD-x86_64/asm/include/openssl/opensslconf.h
include/node/openssl/archs/BSD-x86_64/no-asm/crypto/buildinf.h
include/node/openssl/archs/BSD-x86_64/no-asm/crypto/include/internal/
 bn_conf.h
 dso_conf.h
include/node/openssl/archs/BSD-x86_64/no-asm/include/progs.h
include/node/openssl/archs/BSD-x86_64/no-asm/include/openssl/opensslconf.h
include/node/openssl/archs/VC-WIN32/asm/crypto/buildinf.h
include/node/openssl/archs/VC-WIN32/asm/crypto/include/internal/
 bn_conf.h
 dso_conf.h
include/node/openssl/archs/VC-WIN32/asm/include/progs.h
include/node/openssl/archs/VC-WIN32/asm/include/openssl/opensslconf.h
include/node/openssl/archs/VC-WIN32/no-asm/crypto/buildinf.h
include/node/openssl/archs/VC-WIN32/no-asm/crypto/include/internal/
 bn_conf.h
 dso_conf.h
include/node/openssl/archs/VC-WIN32/no-asm/include/progs.h
include/node/openssl/archs/VC-WIN32/no-asm/include/openssl/opensslconf.h
include/node/openssl/archs/VC-WIN64A/asm/crypto/buildinf.h
include/node/openssl/archs/VC-WIN64A/asm/crypto/include/internal/
 bn_conf.h
 dso_conf.h
include/node/openssl/archs/VC-WIN64A/asm/include/progs.h
include/node/openssl/archs/VC-WIN64A/asm/include/openssl/opensslconf.h
include/node/openssl/archs/VC-WIN64A/no-asm/crypto/buildinf.h
include/node/openssl/archs/VC-WIN64A/no-asm/crypto/include/internal/
 bn_conf.h
 dso_conf.h
include/node/openssl/archs/VC-WIN64A/no-asm/include/progs.h
include/node/openssl/archs/VC-WIN64A/no-asm/include/openssl/opensslconf.h
include/node/openssl/archs/aix-gcc/asm/crypto/buildinf.h
include/node/openssl/archs/aix-gcc/asm/crypto/include/internal/
 bn_conf.h
 dso_conf.h
include/node/openssl/archs/aix-gcc/asm/include/progs.h
include/node/openssl/archs/aix-gcc/asm/include/openssl/opensslconf.h
include/node/openssl/archs/aix-gcc/no-asm/crypto/buildinf.h
include/node/openssl/archs/aix-gcc/no-asm/crypto/include/internal/
 bn_conf.h
 dso_conf.h
include/node/openssl/archs/aix-gcc/no-asm/include/progs.h
include/node/openssl/archs/aix-gcc/no-asm/include/openssl/opensslconf.h
include/node/openssl/archs/aix64-gcc/asm/crypto/buildinf.h
include/node/openssl/archs/aix64-gcc/asm/crypto/include/internal/
 bn_conf.h
 dso_conf.h
include/node/openssl/archs/aix64-gcc/asm/include/progs.h
include/node/openssl/archs/aix64-gcc/asm/include/openssl/opensslconf.h
include/node/openssl/archs/aix64-gcc/no-asm/crypto/buildinf.h
include/node/openssl/archs/aix64-gcc/no-asm/crypto/include/internal/
 bn_conf.h
 dso_conf.h
include/node/openssl/archs/aix64-gcc/no-asm/include/progs.h
include/node/openssl/archs/aix64-gcc/no-asm/include/openssl/opensslconf.h
include/node/openssl/archs/darwin-i386-cc/asm/crypto/buildinf.h
include/node/openssl/archs/darwin-i386-cc/asm/crypto/include/internal/
 bn_conf.h
 dso_conf.h
include/node/openssl/archs/darwin-i386-cc/asm/include/progs.h
include/node/openssl/archs/darwin-i386-cc/asm/include/openssl/opensslconf.h
include/node/openssl/archs/darwin-i386-cc/no-asm/crypto/buildinf.h
include/node/openssl/archs/darwin-i386-cc/no-asm/crypto/include/internal/
 bn_conf.h
 dso_conf.h
include/node/openssl/archs/darwin-i386-cc/no-asm/include/progs.h
include/node/openssl/archs/darwin-i386-cc/no-asm/include/openssl/opensslconf.h
include/node/openssl/archs/darwin64-x86_64-cc/asm/crypto/buildinf.h
include/node/openssl/archs/darwin64-x86_64-cc/asm/crypto/include/internal/
 bn_conf.h
 dso_conf.h
include/node/openssl/archs/darwin64-x86_64-cc/asm/include/progs.h
include/node/openssl/archs/darwin64-x86_64-cc/asm/include/openssl/opensslconf.h
include/node/openssl/archs/darwin64-x86_64-cc/no-asm/crypto/buildinf.h
include/node/openssl/archs/darwin64-x86_64-cc/no-asm/crypto/include/internal/
 bn_conf.h
 dso_conf.h
include/node/openssl/archs/darwin64-x86_64-cc/no-asm/include/progs.h
include/node/openssl/archs/darwin64-x86_64-cc/no-asm/include/openssl/opensslconf.h
include/node/openssl/archs/linux-aarch64/asm/crypto/buildinf.h
include/node/openssl/archs/linux-aarch64/asm/crypto/include/internal/
 bn_conf.h
 dso_conf.h
include/node/openssl/archs/linux-aarch64/asm/include/progs.h
include/node/openssl/archs/linux-aarch64/asm/include/openssl/opensslconf.h
include/node/openssl/archs/linux-aarch64/no-asm/crypto/buildinf.h
include/node/openssl/archs/linux-aarch64/no-asm/crypto/include/internal/
 bn_conf.h
 dso_conf.h
include/node/openssl/archs/linux-aarch64/no-asm/include/progs.h
include/node/openssl/archs/linux-aarch64/no-asm/include/openssl/opensslconf.h
include/node/openssl/archs/linux-armv4/asm/crypto/buildinf.h
include/node/openssl/archs/linux-armv4/asm/crypto/include/internal/
 bn_conf.h
 dso_conf.h
include/node/openssl/archs/linux-armv4/asm/include/progs.h
include/node/openssl/archs/linux-armv4/asm/include/openssl/opensslconf.h
include/node/openssl/archs/linux-armv4/no-asm/crypto/buildinf.h
include/node/openssl/archs/linux-armv4/no-asm/crypto/include/internal/
 bn_conf.h
 dso_conf.h
include/node/openssl/archs/linux-armv4/no-asm/include/progs.h
include/node/openssl/archs/linux-armv4/no-asm/include/openssl/opensslconf.h
include/node/openssl/archs/linux-elf/asm/crypto/buildinf.h
include/node/openssl/archs/linux-elf/asm/crypto/include/internal/
 bn_conf.h
 dso_conf.h
include/node/openssl/archs/linux-elf/asm/include/progs.h
include/node/openssl/archs/linux-elf/asm/include/openssl/opensslconf.h
include/node/openssl/archs/linux-elf/no-asm/crypto/buildinf.h
include/node/openssl/archs/linux-elf/no-asm/crypto/include/internal/
 bn_conf.h
 dso_conf.h
include/node/openssl/archs/linux-elf/no-asm/include/progs.h
include/node/openssl/archs/linux-elf/no-asm/include/openssl/opensslconf.h
include/node/openssl/archs/linux-ppc/asm/crypto/buildinf.h
include/node/openssl/archs/linux-ppc/asm/crypto/include/internal/
 bn_conf.h
 dso_conf.h
include/node/openssl/archs/linux-ppc/asm/include/progs.h
include/node/openssl/archs/linux-ppc/asm/include/openssl/opensslconf.h
include/node/openssl/archs/linux-ppc/no-asm/crypto/buildinf.h
include/node/openssl/archs/linux-ppc/no-asm/crypto/include/internal/
 bn_conf.h
 dso_conf.h
include/node/openssl/archs/linux-ppc/no-asm/include/progs.h
include/node/openssl/archs/linux-ppc/no-asm/include/openssl/opensslconf.h
include/node/openssl/archs/linux-ppc64/asm/crypto/buildinf.h
include/node/openssl/archs/linux-ppc64/asm/crypto/include/internal/
 bn_conf.h
 dso_conf.h
include/node/openssl/archs/linux-ppc64/asm/include/progs.h
include/node/openssl/archs/linux-ppc64/asm/include/openssl/opensslconf.h
include/node/openssl/archs/linux-ppc64/no-asm/crypto/buildinf.h
include/node/openssl/archs/linux-ppc64/no-asm/crypto/include/internal/
 bn_conf.h
 dso_conf.h
include/node/openssl/archs/linux-ppc64/no-asm/include/progs.h
include/node/openssl/archs/linux-ppc64/no-asm/include/openssl/opensslconf.h
include/node/openssl/archs/linux-ppc64le/asm/crypto/buildinf.h
include/node/openssl/archs/linux-ppc64le/asm/crypto/include/internal/
 bn_conf.h
 dso_conf.h
include/node/openssl/archs/linux-ppc64le/asm/include/progs.h
include/node/openssl/archs/linux-ppc64le/asm/include/openssl/opensslconf.h
include/node/openssl/archs/linux-ppc64le/no-asm/crypto/buildinf.h
include/node/openssl/archs/linux-ppc64le/no-asm/crypto/include/internal/
 bn_conf.h
 dso_conf.h
include/node/openssl/archs/linux-ppc64le/no-asm/include/progs.h
include/node/openssl/archs/linux-ppc64le/no-asm/include/openssl/opensslconf.h
include/node/openssl/archs/linux-x32/asm/crypto/buildinf.h
include/node/openssl/archs/linux-x32/asm/crypto/include/internal/
 bn_conf.h
 dso_conf.h
include/node/openssl/archs/linux-x32/asm/include/progs.h
include/node/openssl/archs/linux-x32/asm/include/openssl/opensslconf.h
include/node/openssl/archs/linux-x32/no-asm/crypto/buildinf.h
include/node/openssl/archs/linux-x32/no-asm/crypto/include/internal/
 bn_conf.h
 dso_conf.h
include/node/openssl/archs/linux-x32/no-asm/include/progs.h
include/node/openssl/archs/linux-x32/no-asm/include/openssl/opensslconf.h
include/node/openssl/archs/linux-x86_64/asm/crypto/buildinf.h
include/node/openssl/archs/linux-x86_64/asm/crypto/include/internal/
 bn_conf.h
 dso_conf.h
include/node/openssl/archs/linux-x86_64/asm/include/progs.h
include/node/openssl/archs/linux-x86_64/asm/include/openssl/opensslconf.h
include/node/openssl/archs/linux-x86_64/no-asm/crypto/buildinf.h
include/node/openssl/archs/linux-x86_64/no-asm/crypto/include/internal/
 bn_conf.h
 dso_conf.h
include/node/openssl/archs/linux-x86_64/no-asm/include/progs.h
include/node/openssl/archs/linux-x86_64/no-asm/include/openssl/opensslconf.h
include/node/openssl/archs/linux32-s390x/asm/crypto/buildinf.h
include/node/openssl/archs/linux32-s390x/asm/crypto/include/internal/
 bn_conf.h
 dso_conf.h
include/node/openssl/archs/linux32-s390x/asm/include/progs.h
include/node/openssl/archs/linux32-s390x/asm/include/openssl/opensslconf.h
include/node/openssl/archs/linux32-s390x/no-asm/crypto/buildinf.h
include/node/openssl/archs/linux32-s390x/no-asm/crypto/include/internal/
 bn_conf.h
 dso_conf.h
include/node/openssl/archs/linux32-s390x/no-asm/include/progs.h
include/node/openssl/archs/linux32-s390x/no-asm/include/openssl/opensslconf.h
include/node/openssl/archs/linux64-s390x/asm/crypto/buildinf.h
include/node/openssl/archs/linux64-s390x/asm/crypto/include/internal/
 bn_conf.h
 dso_conf.h
include/node/openssl/archs/linux64-s390x/asm/include/progs.h
include/node/openssl/archs/linux64-s390x/asm/include/openssl/opensslconf.h
include/node/openssl/archs/linux64-s390x/no-asm/crypto/buildinf.h
include/node/openssl/archs/linux64-s390x/no-asm/crypto/include/internal/
 bn_conf.h
 dso_conf.h
include/node/openssl/archs/linux64-s390x/no-asm/include/progs.h
include/node/openssl/archs/linux64-s390x/no-asm/include/openssl/opensslconf.h
include/node/openssl/archs/solaris-x86-gcc/asm/crypto/buildinf.h
include/node/openssl/archs/solaris-x86-gcc/asm/crypto/include/internal/
 bn_conf.h
 dso_conf.h
include/node/openssl/archs/solaris-x86-gcc/asm/include/progs.h
include/node/openssl/archs/solaris-x86-gcc/asm/include/openssl/opensslconf.h
include/node/openssl/archs/solaris-x86-gcc/no-asm/crypto/buildinf.h
include/node/openssl/archs/solaris-x86-gcc/no-asm/crypto/include/internal/
 bn_conf.h
 dso_conf.h
include/node/openssl/archs/solaris-x86-gcc/no-asm/include/progs.h
include/node/openssl/archs/solaris-x86-gcc/no-asm/include/openssl/opensslconf.h
include/node/openssl/archs/solaris64-x86_64-gcc/asm/crypto/buildinf.h
include/node/openssl/archs/solaris64-x86_64-gcc/asm/crypto/include/internal/
 bn_conf.h
 dso_conf.h
include/node/openssl/archs/solaris64-x86_64-gcc/asm/include/progs.h
include/node/openssl/archs/solaris64-x86_64-gcc/asm/include/openssl/opensslconf.h
include/node/openssl/archs/solaris64-x86_64-gcc/no-asm/crypto/buildinf.h
include/node/openssl/archs/solaris64-x86_64-gcc/no-asm/crypto/include/internal/
 bn_conf.h
 dso_conf.h
include/node/openssl/archs/solaris64-x86_64-gcc/no-asm/include/progs.h
include/node/openssl/archs/solaris64-x86_64-gcc/no-asm/include/openssl/opensslconf.h
share/man/man1/node.1.gz
share/systemtap/tapset/node.stp


[FILE:43:manifests/plist.docs]
share/doc/node/
 gdbinit
 lldb_commands.py


[FILE:1220:patches/patch-deps_v8_gypfiles_v8.gyp]
--- deps/v8/gypfiles/v8.gyp.orig	2018-11-02 08:38:34 UTC
+++ deps/v8/gypfiles/v8.gyp
@@ -2025,6 +2025,7 @@
         ['OS=="linux"', {
             'link_settings': {
               'libraries': [
+		'@RAVRPATH@',
                 '-ldl',
                 '-lrt'
               ],
@@ -2201,7 +2202,7 @@
         ['OS=="freebsd"', {
             'link_settings': {
               'libraries': [
-                '-L/usr/local/lib -lexecinfo',
+                '-L/usr/local/lib @RAVRPATH@ -lexecinfo',
             ]},
             'sources': [
               '../src/base/debug/stack_trace_posix.cc',
@@ -2231,7 +2232,7 @@
         ['OS=="netbsd"', {
             'link_settings': {
               'libraries': [
-                '-L/usr/pkg/lib -Wl,-R/usr/pkg/lib -lexecinfo',
+                '-L/usr/pkg/lib @RAVRPATH@ -lexecinfo',
             ]},
             'sources': [
               '../src/base/debug/stack_trace_posix.cc',
@@ -2246,7 +2247,7 @@
         ['OS=="solaris"', {
             'link_settings': {
               'libraries': [
-                '-lnsl -lrt',
+                '-lnsl -lrt @RAVRPATH@',
             ]},
             'sources': [
               '../src/base/debug/stack_trace_posix.cc',


[FILE:439:patches/patch-deps_v8_src_base_cpu.cc]
--- deps/v8/src/base/cpu.cc.orig	2018-11-02 08:38:34 UTC
+++ deps/v8/src/base/cpu.cc
@@ -424,6 +424,7 @@ CPU::CPU()
 
 #if V8_OS_LINUX
 
+#if V8_OS_LINUX
   CPUInfo cpu_info;
 
   // Extract implementor from the "CPU implementer" field.
@@ -604,6 +605,8 @@ CPU::CPU()
 #elif V8_HOST_ARCH_ARM64
 // Implementer, variant and part are currently unused under ARM64.
 
+#endif  // V8_OS_LINUX
+
 #elif V8_HOST_ARCH_PPC
 
 #ifndef USE_SIMULATOR


[FILE:394:patches/patch-tools_gyp_pylib_gyp_common.py]
--- tools/gyp/pylib/gyp/common.py.orig	2018-11-02 08:38:39 UTC
+++ tools/gyp/pylib/gyp/common.py
@@ -423,6 +423,8 @@ def GetFlavor(params):
     return 'solaris'
   if sys.platform.startswith('freebsd'):
     return 'freebsd'
+  if sys.platform.startswith('dragon'):
+    return 'freebsd'
   if sys.platform.startswith('openbsd'):
     return 'openbsd'
   if sys.platform.startswith('netbsd'):


[FILE:424:patches/patch-tools_install.py]
--- tools/install.py.orig	2018-11-02 08:38:39 UTC
+++ tools/install.py
@@ -146,7 +146,7 @@ def files(action):
   action(['deps/v8/tools/gdbinit'], 'share/doc/node/')
   action(['deps/v8/tools/lldb_commands.py'], 'share/doc/node/')
 
-  if 'freebsd' in sys.platform or 'openbsd' in sys.platform:
+  if 'skipme' in sys.platform:
     action(['doc/node.1'], 'man/man1/')
   else:
     action(['doc/node.1'], 'share/man/man1/')

