# Buildsheet autogenerated by ravenadm tool -- Do not edit.

NAMEBASE=		lp_solve
VERSION=		5.5.2.9
KEYWORDS=		math
VARIANTS=		standard
SDESC[standard]=	Linear Programming Solver
HOMEPAGE=		http://lpsolve.sourceforge.net/5.5/
CONTACT=		nobody

DOWNLOAD_GROUPS=	main
SITES[main]=		SF/lpsolve/lpsolve/5.5.2.9
DISTFILE[1]=		lp_solve_5.5.2.9_source.tar.gz:main
DISTFILE[2]=		lp_solve_5.5.2.9_bfp_LUSOL_source.tar.gz:main
DF_INDEX=		1 2
SPKGS[standard]=	single

OPTIONS_AVAILABLE=	none
OPTIONS_STANDARD=	none

DISTNAME=		lp_solve_5.5

LICENSE=		LGPL21:single
LICENSE_TERMS=		single:{{WRKDIR}}/TERMS
LICENSE_FILE=		LGPL21:stock
LICENSE_AWK=		TERMS:"Release notes"
LICENSE_SOURCE=		TERMS:{{WRKSRC}}/lp_lib.h
LICENSE_SCHEME=		solo

FPC_EQUIVALENT=		math/lp_solve

post-patch:
	${REINPLACE_CMD} -e "s/ FALSE/ LP_FALSE/; s/ TRUE/ LP_TRUE/" \
		${WRKSRC}/shared/commonlib.[ch] ${WRKSRC}/shared/myblas.c

pre-build:
	${FIND} ${WRKSRC} -name "ccc" | ${XARGS} ${REINPLACE_CMD} -e \
		"s|^c=.*$$|c='${CC}'|g ; \
		 s|^opts=.*$$|opts='${CFLAGS}'|g ; \
		 s|-fpic|-fPIC|g"

do-build:
	(cd ${WRKSRC}/lp_solve  && ${SETENV} TMPDIR="${WRKDIR}" ${SH} -x ccc)
	(cd ${WRKSRC}/demo      && ${SETENV} TMPDIR="${WRKDIR}" ${SH} -x ccc)
	(cd ${WRKSRC}/lpsolve55 && ${SETENV} TMPDIR="${WRKDIR}" ${SH} -x ccc)

do-install:
	${INSTALL_PROGRAM} ${WRKSRC}/lp_solve/bin/ux64/lp_solve \
		${STAGEDIR}${PREFIX}/bin
	${INSTALL_DATA} ${WRKSRC}/lpsolve55/bin/ux64/liblpsolve55.a \
		${STAGEDIR}${PREFIX}/lib
	${INSTALL_LIB} ${WRKSRC}/lpsolve55/bin/ux64/liblpsolve55.so \
		${STAGEDIR}${PREFIX}/lib
	${LN} -sf liblpsolve55.so ${STAGEDIR}${PREFIX}/lib/liblpsolve55.so.1
	${MKDIR} ${STAGEDIR}${PREFIX}/include/lpsolve
.for i in declare.h fortify.h ini.h lp_*.h lpkit.h lpsolve.h ufortify.h yacc_read.h
	${INSTALL_DATA} ${WRKSRC}/${i} ${STAGEDIR}${PREFIX}/include/lpsolve
.endfor

[FILE:172:descriptions/desc.single]
This is the lp_solve, A free linear programming solver that can process
standard MPL format, LP format or be accessed directly from your code
via API calls from a library.


[FILE:228:distinfo]
2cbd1f07057762d1f5fcec748b70f06bf1d0e2e50f2a6dfd0ba4c5ba3475f908      9897466 lp_solve_5.5.2.9_source.tar.gz
e00e63425d4c26bfc26c3b4a925b404ef52bec67a75f7931c998c177ae849b2f       106427 lp_solve_5.5.2.9_bfp_LUSOL_source.tar.gz


[FILE:428:manifests/plist.single]
bin/lp_solve
include/lpsolve/
 declare.h
 fortify.h
 ini.h
 lp_Hash.h
 lp_MDO.h
 lp_MPS.h
 lp_SOS.h
 lp_bit.h
 lp_crash.h
 lp_explicit.h
 lp_fortify.h
 lp_lib.h
 lp_matrix.h
 lp_mipbb.h
 lp_presolve.h
 lp_price.h
 lp_pricePSE.h
 lp_report.h
 lp_rlp.h
 lp_scale.h
 lp_simplex.h
 lp_solveDLL.h
 lp_types.h
 lp_utils.h
 lp_wlp.h
 lpkit.h
 lpsolve.h
 ufortify.h
 yacc_read.h
lib/
 liblpsolve55.a
 liblpsolve55.so
 liblpsolve55.so.1


[FILE:1991:patches/patch-lp__solve55_ccc]
Respect TMPDIR

--- lpsolve55/ccc.orig	2016-12-10 09:04:17 UTC
+++ lpsolve55/ccc
@@ -2,29 +2,31 @@
 src='../lp_MDO.c ../shared/commonlib.c ../shared/mmio.c ../shared/myblas.c ../ini.c ../fortify.c ../colamd/colamd.c ../lp_rlp.c ../lp_crash.c ../bfp/bfp_LUSOL/lp_LUSOL.c ../bfp/bfp_LUSOL/LUSOL/lusol.c ../lp_Hash.c ../lp_lib.c ../lp_wlp.c ../lp_matrix.c ../lp_mipbb.c ../lp_MPS.c ../lp_params.c ../lp_presolve.c ../lp_price.c ../lp_pricePSE.c ../lp_report.c ../lp_scale.c ../lp_simplex.c ../lp_SOS.c ../lp_utils.c ../yacc_read.c'
 c=cc
 
+tmp="${TMPDIR:-/tmp}"
+
 #determine platform (32/64 bit)
->/tmp/platform.c
-echo '#include <stdlib.h>'>>/tmp/platform.c
-echo '#include <stdio.h>'>>/tmp/platform.c
-echo 'main(){printf("ux%d", (int) (sizeof(void *)*8));}'>>/tmp/platform.c
-$c /tmp/platform.c -o /tmp/platform
-PLATFORM=`/tmp/platform`
-rm /tmp/platform /tmp/platform.c >/dev/null 2>&1
+>"${tmp}"/platform.c
+echo '#include <stdlib.h>'>>"${tmp}"/platform.c
+echo '#include <stdio.h>'>>"${tmp}"/platform.c
+echo 'main(){printf("ux%d", (int) (sizeof(void *)*8));}'>>"${tmp}"/platform.c
+$c "${tmp}"/platform.c -o "${tmp}"/platform
+PLATFORM=`"${tmp}"/platform`
+rm "${tmp}"/platform "${tmp}"/platform.c >/dev/null 2>&1
 
 mkdir bin bin/$PLATFORM >/dev/null 2>&1
 
 #check if this system has the isnan function
->/tmp/isnan.c
-echo '#include <stdio.h>'>>/tmp/isnan.c
-echo '#include <stdlib.h>'>>/tmp/isnan.c
-echo '#include <math.h>'>>/tmp/isnan.c
-echo 'main(){isnan(0.0);return 0;}'>>/tmp/isnan.c
-$c /tmp/isnan.c -o /tmp/isnan $math >/dev/null 2>&1
+>"${tmp}"/isnan.c
+echo '#include <stdio.h>'>>"${tmp}"/isnan.c
+echo '#include <stdlib.h>'>>"${tmp}"/isnan.c
+echo '#include <math.h>'>>"${tmp}"/isnan.c
+echo 'main(){isnan(0.0);return 0;}'>>"${tmp}"/isnan.c
+$c "${tmp}"/isnan.c -o "${tmp}"/isnan $math >/dev/null 2>&1
 if [ $? = 0 ]
 then NOISNAN=
 else NOISNAN=-DNOISNAN
 fi
-rm /tmp/isnan.c /tmp/isnan >/dev/null 2>&1
+rm "${tmp}"/isnan.c "${tmp}"/isnan >/dev/null 2>&1
 
 def=
 so=


[FILE:2015:patches/patch-lp__solve_ccc]
Respect TMPDIR

--- lp_solve/ccc.orig	2016-12-10 09:05:02 UTC
+++ lp_solve/ccc
@@ -2,31 +2,33 @@
 src='../lp_MDO.c ../shared/commonlib.c ../colamd/colamd.c ../shared/mmio.c ../shared/myblas.c ../ini.c ../fortify.c ../lp_rlp.c ../lp_crash.c ../bfp/bfp_LUSOL/lp_LUSOL.c ../bfp/bfp_LUSOL/LUSOL/lusol.c ../lp_Hash.c ../lp_lib.c ../lp_wlp.c ../lp_matrix.c ../lp_mipbb.c ../lp_MPS.c ../lp_params.c ../lp_presolve.c ../lp_price.c ../lp_pricePSE.c ../lp_report.c ../lp_scale.c ../lp_simplex.c lp_solve.c ../lp_SOS.c ../lp_utils.c ../yacc_read.c'
 c=cc
 
+tmp="${TMPDIR:-/tmp}"
+
 #determine platform (32/64 bit)
->/tmp/platform.c
-echo '#include <stdlib.h>'>>/tmp/platform.c
-echo '#include <stdio.h>'>>/tmp/platform.c
-echo 'main(){printf("ux%d", (int) (sizeof(void *)*8));}'>>/tmp/platform.c
-$c /tmp/platform.c -o /tmp/platform
-PLATFORM=`/tmp/platform`
-rm /tmp/platform /tmp/platform.c >/dev/null 2>&1
+>"${tmp}"/platform.c
+echo '#include <stdlib.h>'>>"${tmp}"/platform.c
+echo '#include <stdio.h>'>>"${tmp}"/platform.c
+echo 'main(){printf("ux%d", (int) (sizeof(void *)*8));}'>>"${tmp}"/platform.c
+$c "${tmp}"/platform.c -o "${tmp}"/platform
+PLATFORM=`"${tmp}"/platform`
+rm "${tmp}"/platform "${tmp}"/platform.c >/dev/null 2>&1
 
 mkdir bin bin/$PLATFORM >/dev/null 2>&1
 
 math=-lm
 
 #check if this system has the isnan function
->/tmp/isnan.c
-echo '#include <stdio.h>'>>/tmp/isnan.c
-echo '#include <stdlib.h>'>>/tmp/isnan.c
-echo '#include <math.h>'>>/tmp/isnan.c
-echo 'main(){isnan(0.0);return 0;}'>>/tmp/isnan.c
-$c /tmp/isnan.c -o /tmp/isnan $math >/dev/null 2>&1
+>"${tmp}"/isnan.c
+echo '#include <stdio.h>'>>"${tmp}"/isnan.c
+echo '#include <stdlib.h>'>>"${tmp}"/isnan.c
+echo '#include <math.h>'>>"${tmp}"/isnan.c
+echo 'main(){isnan(0.0);return 0;}'>>"${tmp}"/isnan.c
+$c "${tmp}"/isnan.c -o "${tmp}"/isnan $math >/dev/null 2>&1
 if [ $? = 0 ]
 then NOISNAN=
 else NOISNAN=-DNOISNAN
 fi
-rm /tmp/isnan.c /tmp/isnan >/dev/null 2>&1
+rm "${tmp}"/isnan.c "${tmp}"/isnan >/dev/null 2>&1
 
 opts='-O3'
 


[FILE:595:patches/patch-shared_commonlib.c]
--- shared/commonlib.c.orig	2020-11-07 10:18:30 UTC
+++ shared/commonlib.c
@@ -6,7 +6,7 @@
 #elif defined EnhTime
 # include <windows.h>
 #else
-# include <sys/timeb.h>
+# include <sys/time.h>
 #endif
 
 #include <stdlib.h>
@@ -844,10 +844,12 @@ double timeNow(void)
   }
   return( timeBase + (double) now.QuadPart/(double) freq.QuadPart );
 #else
-  struct timeb buf;
+  struct timeval tv;
+  struct timezone tz;
+
+  gettimeofday(&tv, &tz);
+  return((double)tv.tv_sec+((double)tv.tv_usec)/1000000.0);
 
-  ftime(&buf);
-  return((double)buf.time+((double) buf.millitm)/1000.0);
 #endif
 }
 

