# Buildsheet autogenerated by ravenadm tool -- Do not edit.

NAMEBASE=		meson
VERSION=		1.9.2
KEYWORDS=		devel python
VARIANTS=		std v13 v14
SDESC[std]=		High performance build system
SDESC[v13]=		High performance build system (py 3.13)
SDESC[v14]=		High performance build system (py 3.14)
HOMEPAGE=		https://mesonbuild.com
CONTACT=		John_Marino[draco@marino.st]

DOWNLOAD_GROUPS=	main
SITES[main]=		PYPIWHL/d7/ab/115470e7c6dcce024e43e2e00986864c56e48c59554bb19f4b02ed72814c
DISTFILE[1]=		meson-1.9.2-py3-none-any.whl:main
DIST_SUBDIR=		python-src
DF_INDEX=		1
SPKGS[std]=		single
SPKGS[v13]=		single
SPKGS[v14]=		single

OPTIONS_AVAILABLE=	PY313 PY314
OPTIONS_STANDARD=	none
VOPTS[v13]=		PY313=ON PY314=OFF
VOPTS[v14]=		PY313=OFF PY314=ON

LICENSE=		APACHE20:single
LICENSE_TERMS=		single:{{WRKDIR}}/TERMS
LICENSE_FILE=		APACHE20:stock
LICENSE_SCHEME=		solo

FPC_EQUIVALENT=		devel/meson

PATCH_WRKSRC=		{{WRKSRC}}/{{PYTHON_SITELIBDIR}}

[PY314].RUN_DEPENDS_OFF=		python-ninja:single:v13
[PY314].RUN_DEPENDS_ON=			python-ninja:single:v13
[PY314].USES_OFF=			python:v13,wheel
[PY314].USES_ON=			python:v14,wheel

pre-configure:
	${FIND} ${WRKSRC} -name "*.orig" -type f -delete

post-extract:
	${MKDIR} ${WRKSRC}
	${SETENV} AUTOPYTHON=${_PYTHON_VERSION} \
	pip install --verbose \
		--no-deps \
		--no-index \
		--no-compile \
		--progress-bar off \
		--root ${WRKSRC} \
		${DISTDIR}/${DIST_SUBDIR}/${DISTFILE_1:C/:.*//}
	# extract license terms
	${AWK} '/^from / {exit}; {print}' ${PATCH_WRKSRC}/mesonbuild/mesonmain.py > ${WRKDIR}/TERMS

do-install:
	${MKDIR} ${STAGEDIR}
	${MV} ${WRKSRC}${PREFIX} ${STAGEDIR}/
	(cd ${STAGEDIR} && ${PYTHON_CMD} -m compileall -d / . ||:)

[FILE:473:descriptions/desc.single]
Meson is a cross-platform build system designed to be both as fast and as
user friendly as possible. It supports many languages and compilers,
including GCC, Clang and Visual Studio. Its build definitions are written
in a simple non-turing complete DSL. The main design point of Meson is
that every moment a developer spends writing or debugging build
definitions is a second wasted.  So is every second spent waiting for the
build system to actually start compiling code.


[FILE:118:distinfo]
1a284dc1912929098a6462401af58dc49ae3f324e94814a38a8f1020cee07cba      1033657 python-src/meson-1.9.2-py3-none-any.whl


[FILE:85:manifests/plist.single]
@comment rest is auto-generated
share/polkit-1/actions/com.mesonbuild.install.policy


[FILE:329:patches/patch-mesonbuild_cmake_toolchain.py]
--- mesonbuild/cmake/toolchain.py.orig	2025-08-24 17:28:31 UTC
+++ mesonbuild/cmake/toolchain.py
@@ -149,6 +149,7 @@ class CMakeToolchain:
             'linux': 'Linux',
             'windows': 'Windows',
             'freebsd': 'FreeBSD',
+            'midnightbsd': 'MidnightBSD',
             'darwin': 'Darwin',
         }
 


[FILE:683:patches/patch-mesonbuild_compilers_mixins_clike.py]
--- mesonbuild/compilers/mixins/clike.py.orig	2025-04-06 19:57:59 UTC
+++ mesonbuild/compilers/mixins/clike.py
@@ -73,7 +73,7 @@ class CLikeCompilerArgs(arglist.Compiler
         # This covers all ld.bfd, ld.gold, ld.gold, and xild on Linux, which
         # all act like (or are) gnu ld
         # TODO: this could probably be added to the DynamicLinker instead
-        if isinstance(self.compiler.linker, (GnuLikeDynamicLinkerMixin, SolarisDynamicLinker, CompCertDynamicLinker)):
+        if isinstance(self.compiler.linker, (GnuLikeDynamicLinkerMixin, CompCertDynamicLinker)):
             group_start = -1
             group_end = -1
             for i, each in enumerate(new):


[FILE:785:patches/patch-mesonbuild_compilers_mixins_gnu.py]
Do not default to -z ignore on SunOS, it breaks for example -fstack-protector.

--- mesonbuild/compilers/mixins/gnu.py.orig	2025-08-24 17:28:31 UTC
+++ mesonbuild/compilers/mixins/gnu.py
@@ -364,7 +364,7 @@ class GnuLikeCompiler(Compiler, metaclas
                                    'b_ndebug', 'b_staticpic', 'b_pie']}
         if not (self.info.is_windows() or self.info.is_cygwin() or self.info.is_openbsd()):
             self.base_options.add(OptionKey('b_lundef'))
-        if not self.info.is_windows() or self.info.is_cygwin():
+        if not (self.info.is_windows() or self.info.is_sunos()) or self.info.is_cygwin():
             self.base_options.add(OptionKey('b_asneeded'))
         if not self.info.is_hurd():
             self.base_options.add(OptionKey('b_sanitize'))


[FILE:407:patches/patch-mesonbuild_envconfig.py]
--- mesonbuild/envconfig.py.orig	2025-08-24 17:28:31 UTC
+++ mesonbuild/envconfig.py
@@ -354,7 +354,7 @@ class MachineInfo(HoldableObject):
 
     def is_freebsd(self) -> bool:
         """Machine is FreeBSD?"""
-        return self.system == 'freebsd'
+        return self.system == 'freebsd' or self.system == 'midnightbsd'
 
     def is_sunos(self) -> bool:
         """Machine is illumos or Solaris?"""


[FILE:962:patches/patch-mesonbuild_environment.py]
--- mesonbuild/environment.py.orig	2025-11-10 20:57:42 UTC
+++ mesonbuild/environment.py
@@ -386,6 +386,8 @@ def detect_cpu_family(compilers: Compile
         trial = detect_windows_arch(compilers)
     elif mesonlib.is_freebsd() or mesonlib.is_netbsd() or mesonlib.is_openbsd() or mesonlib.is_qnx() or mesonlib.is_aix():
         trial = platform.processor().lower()
+    elif mesonlib.is_dragonflybsd():
+        trial = platform.processor().lower()
     else:
         trial = platform.machine().lower()
     if trial.startswith('i') and trial.endswith('86'):
@@ -452,6 +454,8 @@ def detect_cpu(compilers: CompilersDict)
         trial = detect_windows_arch(compilers)
     elif mesonlib.is_freebsd() or mesonlib.is_netbsd() or mesonlib.is_openbsd() or mesonlib.is_aix():
         trial = platform.processor().lower()
+    elif mesonlib.is_dragonflybsd():
+        trial = platform.processor().lower()
     else:
         trial = platform.machine().lower()
 


[FILE:1048:patches/patch-mesonbuild_linkers_linkers.py]
--- mesonbuild/linkers/linkers.py.orig	2025-08-24 17:28:31 UTC
+++ mesonbuild/linkers/linkers.py
@@ -687,7 +687,7 @@ class GnuLikeDynamicLinkerMixin(DynamicL
         return ['-pthread']
 
     def no_undefined_args(self) -> T.List[str]:
-        return self._apply_prefix('--no-undefined')
+        return []
 
     def fatal_warnings(self) -> T.List[str]:
         return self._apply_prefix('--fatal-warnings')
@@ -1488,7 +1488,12 @@ class SolarisDynamicLinker(PosixDynamicL
     def get_link_whole_for(self, args: T.List[str]) -> T.List[str]:
         if not args:
             return args
-        return self._apply_prefix('--whole-archive') + args + self._apply_prefix('--no-whole-archive')
+        result = [self.prefix_arg + '-z', self.prefix_arg + 'allextract']
+        for a in args:
+            result.append(a)
+        result.append(self.prefix_arg + '-z')
+        result.append(self.prefix_arg + 'defaultextract')
+        return result
 
     def get_pie_args(self) -> T.List[str]:
         # Available in Solaris 11.2 and later


[FILE:632:patches/patch-mesonbuild_modules_pkgconfig.py]
--- mesonbuild/modules/pkgconfig.py.orig	2025-08-24 17:28:31 UTC
+++ mesonbuild/modules/pkgconfig.py
@@ -716,7 +716,7 @@ class PkgConfigModule(NewExtensionModule
         pkgroot = pkgroot_name = kwargs['install_dir'] or default_install_dir
         if pkgroot is None:
             m = state.environment.machines.host
-            if m.is_freebsd():
+            if False:
                 pkgroot = os.path.join(_as_str(state.environment.coredata.optstore.get_value_for(OptionKey('prefix'))), 'libdata', 'pkgconfig')
                 pkgroot_name = os.path.join('{prefix}', 'libdata', 'pkgconfig')
             elif m.is_haiku():


[FILE:491:patches/patch-mesonbuild_scripts_depfixer.py]
--- mesonbuild/scripts/depfixer.py.orig	2025-04-06 19:57:59 UTC
+++ mesonbuild/scripts/depfixer.py
@@ -468,7 +468,7 @@ def fix_rpath(fname: str, rpath_dirs_to_
             return
         if isinstance(new_rpath, str):
             new_rpath = new_rpath.encode('utf8')
-        fix_elf(fname, rpath_dirs_to_remove, new_rpath, verbose)
+        # never adjust rpath (meson authors are idiots)
         return
     except SystemExit as e:
         if isinstance(e.code, int) and e.code == 0:


[FILE:502:patches/patch-mesonbuild_scripts_symbolextractor.py]
--- mesonbuild/scripts/symbolextractor.py.orig	2025-11-10 20:43:53 UTC
+++ mesonbuild/scripts/symbolextractor.py
@@ -281,6 +281,8 @@ def gen_symbols(libfilename: str, impfil
         openbsd_syms(libfilename, outfilename)
     elif mesonlib.is_freebsd():
         freebsd_syms(libfilename, outfilename)
+    elif mesonlib.is_dragonflybsd():
+        freebsd_syms(libfilename, outfilename)
     elif mesonlib.is_netbsd():
         freebsd_syms(libfilename, outfilename)
     elif mesonlib.is_windows():


[FILE:25:files/special.mk]
stage-dir:
	# do nothing

