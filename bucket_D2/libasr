# Buildsheet autogenerated by ravenadm tool -- Do not edit.

NAMEBASE=		libasr
VERSION=		1.0.3
REVISION=		2
KEYWORDS=		dns
VARIANTS=		standard
SDESC[standard]=	Asynchronous DNS resolver library
HOMEPAGE=		https://github.com/OpenSMTPD/libasr
CONTACT=		nobody

DOWNLOAD_GROUPS=	main
SITES[main]=		https://www.opensmtpd.org/archives/
DISTFILE[1]=		libasr-1.0.3.tar.gz:main
DF_INDEX=		1
SPKGS[standard]=	single

OPTIONS_AVAILABLE=	none
OPTIONS_STANDARD=	none

BUILD_DEPENDS=		groff:primary:standard
BUILDRUN_DEPENDS=	nss:caroot:standard

USES=			cpe autoreconf libtool

LICENSE=		ISCL:single BSD2CLAUSE:single BSD3CLAUSE:single
			CUSTOM1:single
LICENSE_TERMS=		single:{{WRKSRC}}/LICENCE
LICENSE_NAME=		CUSTOM1:"ISC License - OpenBSD Compat"
LICENSE_FILE=		ISCL:{{WRKDIR}}/ISCL_MAIN
			BSD2CLAUSE:{{WRKDIR}}/BSD2
			BSD3CLAUSE:{{WRKDIR}}/BSD3
			CUSTOM1:{{WRKDIR}}/ISCL_OPENBSD
LICENSE_AWK=		ISCL:"^$$"
LICENSE_SOURCE=		ISCL:{{WRKSRC}}/src/asr.h
LICENSE_SCHEME=		multi

CPE_VENDOR=		openbsd
FPC_EQUIVALENT=		dns/libasr

INVALID_RPATH=		yes
MUST_CONFIGURE=		gnu
CONFIGURE_ARGS=		--with-mantype="man"

INSTALL_TARGET=		install-strip
SOVERSION=		0.0.3

post-extract:
	${AWK} '/Jakob Schlyter/,/POSSIBILITY OF SUCH DAMAGE/' \
		${WRKSRC}/LICENCE > ${WRKDIR}/BSD2
	${AWK} '/3-clause BSD license/,/\* SUCH DAMAGE/' \
		${WRKSRC}/LICENCE > ${WRKDIR}/BSD3
	${AWK} '/work by Damien Miller/,/\* OR IN CONNECTION/' \
		${WRKSRC}/LICENCE > ${WRKDIR}/ISCL_OPENBSD

[FILE:236:descriptions/desc.single]
libasr is a FREE asynchronous DNS resolver.

libasr runs on top of the OpenBSD operating system but also has a portable
version that can build and run on several systems, including:

 * Linux
 * FreeBSD
 * NetBSD
 * DragonFly
 * MacOSX


[FILE:98:distinfo]
9cd88e0172e6d426438875e09229d1d473d56db546d02b630f9dd14db226d68d       657592 libasr-1.0.3.tar.gz


[FILE:88:manifests/plist.single]
include/asr.h
lib/
 libasr.a
 libasr.so
 libasr.so.%%SOMAJOR%%
 libasr.so.%%SOVERSION%%


[FILE:333:patches/patch-openbsd-compat_recallocarray.c]
--- openbsd-compat/recallocarray.c.orig	2019-09-28 14:09:47 UTC
+++ openbsd-compat/recallocarray.c
@@ -79,7 +79,11 @@ recallocarray(void *ptr, size_t oldnmemb
 	} else
 		memcpy(newptr, ptr, newsize);
 
+#ifdef HAVE_EXPLICIT_BZERO
 	explicit_bzero(ptr, oldsize);
+#else
+	bzero(ptr, oldsize);
+#endif
 	free(ptr);
 
 	return newptr;


[FILE:172:patches/patch-src_asr__private.h]
--- src/asr_private.h.orig	2019-09-28 14:09:47 UTC
+++ src/asr_private.h
@@ -16,6 +16,7 @@
  */
 
 #include <stdio.h>
+#include <netinet/in.h>
 
 #include "asr_compat.h"
 


[FILE:860:patches/patch-src_getaddrinfo__async.c]
--- src/getaddrinfo_async.c.orig	2019-09-28 14:09:47 UTC
+++ src/getaddrinfo_async.c
@@ -144,7 +144,7 @@ getaddrinfo_async_run(struct asr_query *
 		}
 
 		if (as->as.ai.hostname && as->as.ai.hostname[0] == '\0') {
-			ar->ar_gai_errno = EAI_NODATA;
+			ar->ar_gai_errno = EAI_NONAME;
 			async_set_state(as, ASR_STATE_HALT);
 			break;
 		}
@@ -259,7 +259,7 @@ getaddrinfo_async_run(struct asr_query *
 				}
 			}
 			if (ar->ar_gai_errno == 0 && as->as_count == 0) {
-				ar->ar_gai_errno = EAI_NODATA;
+				ar->ar_gai_errno = EAI_NONAME;
 			}
 			async_set_state(as, ASR_STATE_HALT);
 			break;
@@ -442,7 +442,7 @@ getaddrinfo_async_run(struct asr_query *
 		if (as->as_flags & ASYNC_AGAIN)
 			ar->ar_gai_errno = EAI_AGAIN;
 		else
-			ar->ar_gai_errno = EAI_NODATA;
+			ar->ar_gai_errno = EAI_NONAME;
 		async_set_state(as, ASR_STATE_HALT);
 		break;
 


[FILE:293:patches/patch-src_res__search__async.c]
--- src/res_search_async.c.orig	2019-09-28 14:09:47 UTC
+++ src/res_search_async.c
@@ -22,6 +22,9 @@
 #include <sys/uio.h>
 #include <arpa/nameser.h>
 #include <netdb.h>
+#if defined __DragonFly__ || defined __FreeBSD__
+#include <netinet/in.h>
+#endif
 
 #include <asr.h>
 #include <errno.h>

