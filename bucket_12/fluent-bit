# Buildsheet autogenerated by ravenadm tool -- Do not edit.

NAMEBASE=		fluent-bit
VERSION=		1.6.9
KEYWORDS=		sysutils
VARIANTS=		standard
SDESC[standard]=	Fast and Lightweight Log processor and forwarder
HOMEPAGE=		https://fluentbit.io/
CONTACT=		nobody

DOWNLOAD_GROUPS=	main
SITES[main]=		GITHUB/fluent:fluent-bit:v1.6.9
DISTFILE[1]=		generated:main
DF_INDEX=		1
SPKGS[standard]=	complete
			primary
			library

OPTIONS_AVAILABLE=	none
OPTIONS_STANDARD=	none

USES=			cmake bison zlib gmake shebangfix
			cclibs:primary,library

FPC_EQUIVALENT=		sysutils/fluent-bit
SHEBANG_ADD_SH=		lib/luajit-2.1.0-dd5032e/configure

RC_SUBR=		fluent-bit:primary

CMAKE_ARGS=		-DFLB_DEBUG=Off
			-DFLB_TRACE=Off
			-DFLB_CORO_STACK_SIZE=24576
			-DFLB_TLS=On
			-DFLB_EXAMPLES=On
			-DFLB_OUT_PGSQL=Off

post-install:
	${MV} ${STAGEDIR}${ETCDIR}/fluent-bit.conf \
		${STAGEDIR}${ETCDIR}/fluent-bit.conf.sample
	${MV} ${STAGEDIR}${ETCDIR}/parsers.conf \
		${STAGEDIR}${ETCDIR}/parsers.conf.sample
	${STRIP_CMD} ${STAGEDIR}${PREFIX}/bin/fluent-bit
	${STRIP_CMD} ${STAGEDIR}${PREFIX}/lib/fluent-bit/libfluent-bit.so

[FILE:284:descriptions/desc.primary]
Fluent Bit is a Fast and Lightweight Data Forwarder for Linux, OSX and BSD
family operating systems. It has been made with a strong focus on
performance to allow the collection of events from different sources
without complexity.

Fluent Bit is part of the Fluentd project ecosystem.


[FILE:151:descriptions/desc.library]
Fluent Bit is a Fast and Lightweight Data Forwarder for Linux, OSX and BSD
family operating systems. This subpackage contains the library and headers.


[FILE:109:distinfo]
fb39b3aa92e673f80bbb29ceaf67aa46ad2b90885f0f3ac49b9489f34e7ddda4     13639184 fluent-fluent-bit-1.6.9.tar.gz


[FILE:132:manifests/plist.primary]
@sample etc/fluent-bit/fluent-bit.conf.sample
@sample etc/fluent-bit/parsers.conf.sample
bin/fluent-bit
etc/fluent-bit/plugins.conf


[FILE:1427:manifests/plist.library]
include/fluent-bit.h
include/fluent-bit/
 flb_api.h
 flb_aws_credentials.h
 flb_aws_util.h
 flb_bits.h
 flb_callback.h
 flb_compat.h
 flb_config.h
 flb_config_map.h
 flb_dlfcn_win32.h
 flb_dump.h
 flb_endian.h
 flb_engine.h
 flb_engine_dispatch.h
 flb_env.h
 flb_error.h
 flb_filter.h
 flb_filter_plugin.h
 flb_fstore.h
 flb_gzip.h
 flb_hash.h
 flb_http_client.h
 flb_http_client_debug.h
 flb_http_server.h
 flb_info.h
 flb_input.h
 flb_input_chunk.h
 flb_input_plugin.h
 flb_intermediate_metric.h
 flb_io.h
 flb_io_tls.h
 flb_io_tls_rw.h
 flb_kernel.h
 flb_kv.h
 flb_langinfo.h
 flb_lib.h
 flb_log.h
 flb_luajit.h
 flb_macros.h
 flb_mem.h
 flb_meta.h
 flb_metrics.h
 flb_metrics_exporter.h
 flb_mp.h
 flb_network.h
 flb_oauth2.h
 flb_output.h
 flb_output_plugin.h
 flb_pack.h
 flb_parser.h
 flb_parser_decoder.h
 flb_pipe.h
 flb_plugin.h
 flb_plugin_proxy.h
 flb_ra_key.h
 flb_random.h
 flb_record_accessor.h
 flb_regex.h
 flb_router.h
 flb_s3_local_buffer.h
 flb_scheduler.h
 flb_sds.h
 flb_sha512.h
 flb_signv4.h
 flb_slist.h
 flb_socket.h
 flb_sosreport.h
 flb_sqldb.h
 flb_stacktrace.h
 flb_storage.h
 flb_str.h
 flb_strptime.h
 flb_task.h
 flb_task_map.h
 flb_thread.h
 flb_thread_libco.h
 flb_thread_storage.h
 flb_time.h
 flb_time_utils.h
 flb_tls.h
 flb_unescape.h
 flb_upstream.h
 flb_upstream_ha.h
 flb_upstream_node.h
 flb_uri.h
 flb_utf8.h
 flb_utils.h
 flb_version.h
 flb_worker.h
lib/fluent-bit/libfluent-bit.so


[FILE:376:patches/patch-lib_chunkio_deps_crc32_crc32.c]
--- lib/chunkio/deps/crc32/crc32.c.orig	2020-12-18 00:40:07 UTC
+++ lib/chunkio/deps/crc32/crc32.c
@@ -31,7 +31,7 @@
 #  define htole16(x) (x)
 #  define be16toh(x) ntohs(x)
 #  define le16toh(x) (x)
-#elif defined(__FreeBSD__)
+#elif defined(__FreeBSD__) || defined(__DragonFly__)
 #  include <sys/endian.h>
 #elif defined(__sun) || defined(sun)
 # include <sys/byteorder.h>


[FILE:378:patches/patch-lib_luajit__src__lj_prng.c]
--- lib/luajit-2.1.0-dd5032e/src/lj_prng.c.orig	2020-12-18 00:40:07 UTC
+++ lib/luajit-2.1.0-dd5032e/src/lj_prng.c
@@ -116,7 +116,7 @@ static PRGR libfunc_rgr;
 #define LJ_TARGET_HAS_GETENTROPY	1
 #endif
 #elif LJ_TARGET_BSD || LJ_TARGET_SOLARIS || LJ_TARGET_CYGWIN
-#define LJ_TARGET_HAS_GETENTROPY	1
+#define LJ_TARGET_HAS_GETENTROPY	0
 #endif
 
 #if LJ_TARGET_HAS_GETENTROPY


[FILE:712:files/fluent-bit.in]
#!/bin/sh
# $FreeBSD$

# PROVIDE: fluent-bit
# REQUIRE: DAEMON
# BEFORE: LOGIN
# KEYWORD: shutdown

# Add the following lines to /etc/rc.conf to enable fluent-bit:
#
# fluent_bit_enable (bool):	Set to YES to enable fluent-bit
# 				Default: NO
# fluent_bit_config (str):	config files to use
#				Default: %%ETCDIR%%/fluent-bit.conf
# fluent_bit_flags (str):	Extra flags passed to fluent-bit
# fluent_bit_user (str):        Default run as user nobody

. /etc/rc.subr

name="fluent_bit"
rcvar=${name}_enable
load_rc_config $name

: ${fluent_bit_enable:="NO"}
: ${fluent_bit_user:="nobody"}

command=%%PREFIX%%/bin/fluent-bit
command_args="--quiet --daemon --config %%ETCDIR%%/fluent-bit.conf"

run_rc_command "$1"

