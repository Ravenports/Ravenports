# Buildsheet autogenerated by ravenadm tool -- Do not edit.

NAMEBASE=		libarchive
VERSION=		3.4.0
KEYWORDS=		archivers
VARIANTS=		standard static extended
SDESC[standard]=	Library to handle many streaming archive formats
SDESC[extended]=	Extended libarchive with lzo and lz4 capability
SDESC[static]=		Static build of libarchive
HOMEPAGE=		http://libarchive.org/
CONTACT=		nobody

DOWNLOAD_GROUPS=	main
SITES[main]=		http://libarchive.org/downloads/
			https://www.libarchive.de/downloads/
DISTFILE[1]=		libarchive-3.4.0.tar.gz:main
DF_INDEX=		1
SPKGS[standard]=	single
SPKGS[extended]=	single
SPKGS[static]=		single

OPTIONS_AVAILABLE=	STATIC EXTENDED
OPTIONS_STANDARD=	none
VOPTS[extended]=	STATIC=OFF EXTENDED=ON
VOPTS[static]=		STATIC=ON EXTENDED=OFF

BUILD_DEPENDS=		bzip2:static:standard
			zlib:static:standard
			expat:static:standard
			Zstandard:static:standard

USES=			cpe libtool

LICENSE=		BSD2CLAUSE:single BSD3CLAUSE:single PUBDOM:single
LICENSE_FILE=		BSD2CLAUSE:{{WRKSRC}}/COPYING
			BSD3CLAUSE:{{WRKSRC}}/COPYING
			PUBDOM:{{WRKSRC}}/COPYING
LICENSE_SCHEME=		multi

FPC_EQUIVALENT=		archivers/libarchive

MUST_CONFIGURE=		gnu
CONFIGURE_ARGS=		--without-xml2
			--without-iconv
			--disable-acl

INSTALL_TARGET=		install-strip
SOVERSION=		13.4.0

LDFLAGS=		-lpthread

[STATIC].BUILDRUN_DEPENDS_OFF=		libressl:single:standard
					xz:single:standard
					bzip2:shared:standard
					zlib:shared:standard
					expat:shared:standard
					Zstandard:shared:standard
[STATIC].BUILD_DEPENDS_ON=		libressl:single:static
					xz:single:static
[STATIC].CONFIGURE_ARGS_OFF=		--enable-shared=yes
[STATIC].CONFIGURE_ARGS_ON=		--enable-shared=no
					--enable-static=yes

[EXTENDED].DESCRIPTION=			Add support for lz4 and lzo compression
[EXTENDED].BUILDRUN_DEPENDS_ON=		lzo:shared:standard
					lz4:shared:standard
[EXTENDED].BUILD_DEPENDS_ON=		lzo:static:standard
					lz4:static:standard
[EXTENDED].CONFIGURE_ARGS_ON=		--with-lzo2
					--with-lz4

do-test:
	(cd ${WRKSRC} && ${SETENV} ${MAKE_ENV} ${MAKE_CMD} check)

[FILE:1042:descriptions/desc.single]
The libarchive library features:
 * Support for a variety of archive and compression formats.
 * Robust automatic format detection, including archive/compression
   combinations such as tar.gz.
 * Zero-copy internal architecture for high performance.
 * Streaming architecture eliminates all limits on size of archive,
   limits on entry sizes depend on particular formats.
 * Carefully factored code to minimize bloat when programs are
   statically linked.
 * Growing test suite to verify correctness of new ports.
 * Works on most POSIX-like systems (including FreeBSD, Linux,
   Solaris, etc.)

The bsdtar and bsdcpio command-line utilities are feature- and
performance-competitive with other tar and cpio implementations:
 * Reads a variety of formats, including tar, pax, cpio, zip, xar,
   lha, ar, cab, mtree, rar, and ISO images.
 * Writes tar, pax, cpio, zip, xar, ar, ISO, mtree, and shar archives.
 * Automatically handles archives compressed with gzip, bzip2, lzip,
   xz, lzma, or compress.
 * Unique format conversion feature.


[FILE:102:distinfo]
8643d50ed40c759f5412a3af4e353cffbce4fdf3b5cf321cb72cacf06b2d825e      6908093 libarchive-3.4.0.tar.gz


[FILE:1281:manifests/plist.single]
bin/
 bsdcat
 bsdcpio
 bsdtar
include/
 archive.h
 archive_entry.h
lib/
 libarchive.a
 libarchive.so
 libarchive.so.%%SOMAJOR%%
 libarchive.so.%%SOVERSION%%
lib/pkgconfig/libarchive.pc
share/man/man1/
 bsdcat.1.gz
 bsdcpio.1.gz
 bsdtar.1.gz
share/man/man3/
 archive_entry.3.gz
 archive_entry_acl.3.gz
 archive_entry_linkify.3.gz
 archive_entry_misc.3.gz
 archive_entry_paths.3.gz
 archive_entry_perms.3.gz
 archive_entry_stat.3.gz
 archive_entry_time.3.gz
 archive_read.3.gz
 archive_read_add_passphrase.3.gz
 archive_read_data.3.gz
 archive_read_disk.3.gz
 archive_read_extract.3.gz
 archive_read_filter.3.gz
 archive_read_format.3.gz
 archive_read_free.3.gz
 archive_read_header.3.gz
 archive_read_new.3.gz
 archive_read_open.3.gz
 archive_read_set_options.3.gz
 archive_util.3.gz
 archive_write.3.gz
 archive_write_blocksize.3.gz
 archive_write_data.3.gz
 archive_write_disk.3.gz
 archive_write_filter.3.gz
 archive_write_finish_entry.3.gz
 archive_write_format.3.gz
 archive_write_free.3.gz
 archive_write_header.3.gz
 archive_write_new.3.gz
 archive_write_open.3.gz
 archive_write_set_options.3.gz
 archive_write_set_passphrase.3.gz
 libarchive.3.gz
 libarchive_changes.3.gz
 libarchive_internals.3.gz
share/man/man5/
 cpio.5.gz
 libarchive-formats.5.gz
 mtree.5.gz
 tar.5.gz


[FILE:1208:manifests/plist.single.static]
bin/
 bsdcat
 bsdcpio
 bsdtar
include/
 archive.h
 archive_entry.h
lib/libarchive.a
lib/pkgconfig/libarchive.pc
share/man/man1/
 bsdcat.1.gz
 bsdcpio.1.gz
 bsdtar.1.gz
share/man/man3/
 archive_entry.3.gz
 archive_entry_acl.3.gz
 archive_entry_linkify.3.gz
 archive_entry_misc.3.gz
 archive_entry_paths.3.gz
 archive_entry_perms.3.gz
 archive_entry_stat.3.gz
 archive_entry_time.3.gz
 archive_read.3.gz
 archive_read_add_passphrase.3.gz
 archive_read_data.3.gz
 archive_read_disk.3.gz
 archive_read_extract.3.gz
 archive_read_filter.3.gz
 archive_read_format.3.gz
 archive_read_free.3.gz
 archive_read_header.3.gz
 archive_read_new.3.gz
 archive_read_open.3.gz
 archive_read_set_options.3.gz
 archive_util.3.gz
 archive_write.3.gz
 archive_write_blocksize.3.gz
 archive_write_data.3.gz
 archive_write_disk.3.gz
 archive_write_filter.3.gz
 archive_write_finish_entry.3.gz
 archive_write_format.3.gz
 archive_write_free.3.gz
 archive_write_header.3.gz
 archive_write_new.3.gz
 archive_write_open.3.gz
 archive_write_set_options.3.gz
 archive_write_set_passphrase.3.gz
 libarchive.3.gz
 libarchive_changes.3.gz
 libarchive_internals.3.gz
share/man/man5/
 cpio.5.gz
 libarchive-formats.5.gz
 mtree.5.gz
 tar.5.gz


[FILE:485:patches/patch-libarchive_archive__write__add__filter__zstd.c]
--- libarchive/archive_write_add_filter_zstd.c.orig	2019-06-12 21:05:16 UTC
+++ libarchive/archive_write_add_filter_zstd.c
@@ -96,7 +96,7 @@ archive_write_add_filter_zstd(struct arc
 	f->free = &archive_compressor_zstd_free;
 	f->code = ARCHIVE_FILTER_ZSTD;
 	f->name = "zstd";
-	data->compression_level = 3; /* Default level used by the zstd CLI */
+	data->compression_level = 7;
 #if HAVE_ZSTD_H && HAVE_LIBZSTD
 	data->cstream = ZSTD_createCStream();
 	if (data->cstream == NULL) {


[FILE:530:patches/patch-libarchive_test_test__write__filter__zstd.c]
We changed the default from level 3 to level 7, so reverse the assert
accordingly.

--- libarchive/test/test_write_filter_zstd.c.orig	2019-06-12 21:05:16 UTC
+++ libarchive/test/test_write_filter_zstd.c
@@ -142,7 +142,7 @@ DEFINE_TEST(test_write_filter_zstd)
 
 	failure("compression-level=6 wrote %d bytes, default wrote %d bytes",
 	    (int)used2, (int)used1);
-	assert(used2 < used1);
+	assert(used2 > used1);
 
 	assert((a = archive_read_new()) != NULL);
 	assertEqualIntA(a, ARCHIVE_OK, archive_read_support_format_all(a));


[FILE:346:patches/patch-test__utils_test__main.c]
--- test_utils/test_main.c.orig	2019-06-12 21:05:16 UTC
+++ test_utils/test_main.c
@@ -3499,9 +3499,9 @@ static int
 test_run(int i, const char *tmpdir)
 {
 #ifdef PATH_MAX
-	char workdir[PATH_MAX];
+	char workdir[PATH_MAX+1];
 #else
-	char workdir[1024];
+	char workdir[1024+1];
 #endif
 	char logfilename[64];
 	int failures_before = failures;

