# Buildsheet autogenerated by ravenadm tool -- Do not edit.

NAMEBASE=		sndio
VERSION=		1.5.0
KEYWORDS=		audio
VARIANTS=		standard
SDESC[standard]=	Small audio and MIDI framework from OpenBSD
HOMEPAGE=		http://www.sndio.org/
CONTACT=		nobody

DOWNLOAD_GROUPS=	main
SITES[main]=		http://www.sndio.org/
DISTFILE[1]=		sndio-1.5.0.tar.gz:main
DF_INDEX=		1
SPKGS[standard]=	single

OPTIONS_AVAILABLE=	none
OPTIONS_STANDARD=	none

BROKEN[linux]=		Requires ALSA headers and libraries first

USERS=			_sndio
GROUPS=			_sndio
USERGROUP_SPKG=		single

LICENSE=		ISCL:single
LICENSE_FILE=		ISCL:{{WRKDIR}}/ISC_LICENSE
LICENSE_AWK=		ISCL:"^\#ifndef"
LICENSE_SOURCE=		ISCL:{{WRKSRC}}/libsndio/sndio.h
LICENSE_SCHEME=		solo

FPC_EQUIVALENT=		audio/sndio

MUST_CONFIGURE=		yes
CONFIGURE_ARGS=		--prefix={{PREFIX}}
			--mandir={{MANPREFIX}}/man

SINGLE_JOB=		yes

RC_SUBR=		sndiod:single

post-patch:
	# Make sure sndiod can be started inside jails as root
	${REINPLACE_CMD} 's|err(1, "setpriority")|warn("setpriority")|' \
		${WRKSRC}/sndiod/sndiod.c

post-patch-dragonfly:
	${REINPLACE_CMD} -e 's@\(FreeBSD\))@\1|DragonFly)@g' \
		${WRKSRC}/configure

post-install:
	${STRIP_CMD} \
		${STAGEDIR}${PREFIX}/lib/libsndio.so.6.1 \
		${STAGEDIR}${PREFIX}/bin/sndiod \
		${STAGEDIR}${PREFIX}/bin/aucat \
		${STAGEDIR}${PREFIX}/bin/midicat

[FILE:449:descriptions/desc.single]
Sndio is a small audio and MIDI framework part of the OpenBSD project.

It provides an lightweight audio & MIDI server and a fully documented
user-space API to access either the server or directly the hardware in
a uniform way.  Sndio is designed to work for desktop applications,
but pays special attention to synchronization mechanisms and
reliability required by music applications.  Reliability through
simplicity are part of the project goals.


[FILE:97:distinfo]
12c70044749ad9cb7eaeb26c936816aa6b314fe4be71ef479d12272e4c5ad253       125661 sndio-1.5.0.tar.gz


[FILE:593:manifests/plist.single]
bin/
 aucat
 midicat
 sndiod
include/sndio.h
lib/
 libsndio.so
 libsndio.so.6.1
share/man/man1/
 aucat.1.gz
 midicat.1.gz
share/man/man3/
 mio_close.3.gz
 mio_eof.3.gz
 mio_nfds.3.gz
 mio_open.3.gz
 mio_pollfd.3.gz
 mio_read.3.gz
 mio_revents.3.gz
 mio_write.3.gz
 sio_close.3.gz
 sio_eof.3.gz
 sio_getcap.3.gz
 sio_getpar.3.gz
 sio_initpar.3.gz
 sio_nfds.3.gz
 sio_onmove.3.gz
 sio_onvol.3.gz
 sio_open.3.gz
 sio_pollfd.3.gz
 sio_read.3.gz
 sio_revents.3.gz
 sio_setpar.3.gz
 sio_setvol.3.gz
 sio_start.3.gz
 sio_stop.3.gz
 sio_write.3.gz
share/man/man7/sndio.7.gz
share/man/man8/sndiod.8.gz


[FILE:222:patches/patch-libsndio_Makefile.in]
--- libsndio/Makefile.in.orig	2018-01-13 12:32:33 UTC
+++ libsndio/Makefile.in
@@ -42,8 +42,8 @@ MAN7 = sndio.7
 #
 # libraries to build and install
 #
-MAJ = 7
-MIN = 0
+MAJ = 6
+MIN = 1
 SO = @so@
 SO_LINK = @so_link@
 


[FILE:465:files/sndiod.in]
#!/bin/sh
#
# $FreeBSD: head/audio/sndio/files/sndiod.in 427071 2016-11-25 01:11:41Z cpm $
#
# PROVIDE: sndiod
# REQUIRE: NETWORKING sysctl
# BEFORE:  DAEMON
# KEYWORD: shutdown

. /etc/rc.subr

name=sndiod
rcvar=sndiod_enable

load_rc_config $name

: ${sndiod_dev="rsnd/$($SYSCTL -n hw.snd.default_unit)"}
: ${sndiod_enable="NO"}
: ${sndiod_flags="-f ${sndiod_dev} -c 0:7 -j off -s default -m mon -s monitor"}

command="%%PREFIX%%/bin/sndiod"

run_rc_command "$1"

