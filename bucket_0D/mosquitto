# Buildsheet autogenerated by ravenadm tool -- Do not edit.

NAMEBASE=		mosquitto
VERSION=		2.1.2
KEYWORDS=		net
VARIANTS=		std
SDESC[std]=		Message broker implementing the MQTT protocol
HOMEPAGE=		https://mosquitto.org/
CONTACT=		nobody

DOWNLOAD_GROUPS=	main
SITES[main]=		https://mosquitto.org/files/source/
DISTFILE[1]=		mosquitto-2.1.2.tar.gz:main
DF_INDEX=		1
SPKGS[std]=		set
			primary
			tools
			cxx
			dev
			man

OPTIONS_AVAILABLE=	none
OPTIONS_STANDARD=	none

BUILD_DEPENDS=		cjson:dev:std
			libuuid:dev:std
			c-ares:dev:std
			libwebsockets:dev:std
			docbook-xsl:primary:std
			libxslt:dev:std
			libxslt:primary:std
			argon2:dev:std
BUILDRUN_DEPENDS=	cjson:primary:std
			libuuid:primary:std
			c-ares:primary:std
			libwebsockets:primary:std
			argon2:primary:std
EXRUN[cxx]=		mosquitto:primary:std
EXRUN[tools]=		mosquitto:primary:std

USERS=			nobody
USERGROUP_SPKG=		primary

USES=			cpe cmake ssl zlib sqlite readline c++:cxx
			rootca:tools

LICENSE=		CUSTOM1:tools CUSTOM2:tools
LICENSE_TERMS=		tools:{{WRKSRC}}/LICENSE.txt
LICENSE_NAME=		CUSTOM1:"Eclipse Distribution License v1.0"
			CUSTOM2:"Eclipse Public License v2.0"
LICENSE_FILE=		CUSTOM1:{{WRKSRC}}/edl-v10
			CUSTOM2:{{WRKSRC}}/epl-v20
LICENSE_SCHEME=		dual

CPE_VENDOR=		eclipse
FPC_EQUIVALENT=		net/mosquitto

SOVERSION=		2.1.2
RC_SUBR=		mosquitto:tools

CMAKE_ARGS=		-DWITH_SRV:BOOL=ON
			-DWITH_WEBSOCKETS:BOOL=ON
			-DWITH_TESTS:BOOL=OFF
			-DOPENSSL_ROOT_DIR={{OPENSSLBASE}}

post-install:
	${MV} ${STAGEDIR}${PREFIX}/etc/mosquitto/pwfile.example \
		${STAGEDIR}${PREFIX}/etc/mosquitto/pwfile.sample
	${MV} ${STAGEDIR}${PREFIX}/etc/mosquitto/pskfile.example \
		${STAGEDIR}${PREFIX}/etc/mosquitto/pskfile.sample
	${MV} ${STAGEDIR}${PREFIX}/etc/mosquitto/aclfile.example \
		${STAGEDIR}${PREFIX}/etc/mosquitto/aclfile.sample
	${MV} ${STAGEDIR}${PREFIX}/etc/mosquitto/mosquitto.conf.example \
		${STAGEDIR}${PREFIX}/etc/mosquitto/mosquitto.conf.sample
	${STRIP_CMD} ${STAGEDIR}${PREFIX}/lib/*.so
	${STRIP_CMD} ${STAGEDIR}${PREFIX}/bin/m*
	${STRIP_CMD} ${STAGEDIR}${PREFIX}/sbin/mosquitto

pre-configure:
	${REINPLACE_CMD} -e 's|%%PREFIX%%|${PREFIX}|g' ${WRKSRC}/mosquitto.conf

[FILE:681:descriptions/desc.primary]
Eclipse Mosquitto is an open source (EPL/EDL licensed) message broker that
implements the MQTT protocol versions 5.0, 3.1.1 and 3.1. Mosquitto is
lightweight and is suitable for use on all devices from low power single
board computers to full servers.

The MQTT protocol provides a lightweight method of carrying out messaging
using a publish/subscribe model. This makes it suitable for Internet of
Things messaging such as with low power sensors or mobile devices such as
phones, embedded computers or microcontrollers.

The Mosquitto project also provides a C library for implementing MQTT
clients, and the very popular mosquitto_pub and mosquitto_sub command line
MQTT clients.


[FILE:46:descriptions/desc.tools]
This package contains the Mosquitto programs.


[FILE:64:descriptions/desc.cxx]
This package contains the c++ version of the mosquitto library.


[FILE:101:distinfo]
fd905380691ac65ea5a93779e8214941829e3d6e038d5edff9eac5fd74cbed02      2882727 mosquitto-2.1.2.tar.gz


[FILE:196:manifests/plist.primary]
lib/
 libmosquitto.so.%%SOVERSION%%
 libmosquitto.so.1
 mosquitto_acl_file.so
 mosquitto_dynamic_security.so
 mosquitto_password_file.so
 mosquitto_persist_sqlite.so
 mosquitto_sparkplug_aware.so


[FILE:289:manifests/plist.tools]
@sample etc/mosquitto/aclfile.sample
@sample etc/mosquitto/mosquitto.conf.sample
@sample etc/mosquitto/pskfile.sample
@sample etc/mosquitto/pwfile.sample
bin/
 mosquitto_ctrl
 mosquitto_db_dump
 mosquitto_passwd
 mosquitto_pub
 mosquitto_rr
 mosquitto_signal
 mosquitto_sub
sbin/mosquitto


[FILE:59:manifests/plist.cxx]
lib/
 libmosquittopp.so.%%SOVERSION%%
 libmosquittopp.so.1


[FILE:875:manifests/plist.dev]
include/
 mosquitto.h
 mosquitto_broker.h
 mosquitto_plugin.h
 mosquittopp.h
 mqtt_protocol.h
include/mosquitto/
 broker.h
 broker_control.h
 broker_plugin.h
 defs.h
 libcommon.h
 libcommon_base64.h
 libcommon_cjson.h
 libcommon_file.h
 libcommon_memory.h
 libcommon_password.h
 libcommon_properties.h
 libcommon_random.h
 libcommon_string.h
 libcommon_time.h
 libcommon_topic.h
 libcommon_utf8.h
 libmosquitto.h
 libmosquitto_auth.h
 libmosquitto_callbacks.h
 libmosquitto_connect.h
 libmosquitto_create_delete.h
 libmosquitto_helpers.h
 libmosquitto_loop.h
 libmosquitto_message.h
 libmosquitto_options.h
 libmosquitto_publish.h
 libmosquitto_socks.h
 libmosquitto_subscribe.h
 libmosquitto_tls.h
 libmosquitto_unsubscribe.h
 libmosquitto_will.h
 libmosquittopp.h
 mqtt_protocol.h
lib/
 libmosquitto.so
 libmosquittopp.so
lib/pkgconfig/
 libmosquitto.pc
 libmosquittopp.pc


[FILE:316:manifests/plist.man]
share/man/man1/
 mosquitto_ctrl.1
 mosquitto_ctrl_dynsec.1
 mosquitto_ctrl_shell.1
 mosquitto_passwd.1
 mosquitto_pub.1
 mosquitto_rr.1
 mosquitto_signal.1
 mosquitto_sub.1
share/man/man3/libmosquitto.3
share/man/man5/mosquitto.conf.5
share/man/man7/
 mosquitto-tls.7
 mosquitto.7
 mqtt.7
share/man/man8/mosquitto.8


[FILE:321:patches/patch-apps_db__dump_db__dump.c]
--- apps/db_dump/db_dump.c.orig	2026-02-09 09:29:46 UTC
+++ apps/db_dump/db_dump.c
@@ -42,6 +42,10 @@ Contributors:
 #include <sys/endian.h>
 #endif
 
+#if defined(__FreeBSD__) || defined(__DragonFly__)
+#include <netinet/in.h> // for ntohl and friends
+#endif
+
 struct client_data {
 	UT_hash_handle hh_id;
 	char *id;


[FILE:406:patches/patch-apps_mosquitto__ctrl_CMakeLists.txt]
--- apps/mosquitto_ctrl/CMakeLists.txt.orig	2026-02-09 09:29:46 UTC
+++ apps/mosquitto_ctrl/CMakeLists.txt
@@ -86,7 +86,7 @@ if(WITH_TLS)
 	if(UNIX)
 		if(APPLE)
 			target_link_libraries(mosquitto_ctrl PRIVATE dl)
-		elseif(${CMAKE_SYSTEM_NAME} MATCHES "OpenBSD")
+		elseif(${CMAKE_SYSTEM_NAME} MATCHES "OpenBSD|FreeBSD|DragonFly|MidnightBSD")
 			#
 		elseif(${CMAKE_SYSTEM_NAME} MATCHES "NetBSD")
 			#


[FILE:262:patches/patch-apps_mosquitto__ctrl_ctrl__shell.c]
--- apps/mosquitto_ctrl/ctrl_shell.c.orig	2026-02-09 09:29:46 UTC
+++ apps/mosquitto_ctrl/ctrl_shell.c
@@ -34,6 +34,7 @@ Contributors:
 #ifndef WIN32
 #  include <netinet/in.h>
 #  include <unistd.h>
+#  include <netinet/in.h>
 #endif
 
 #include "ctrl_shell.h"


[FILE:304:patches/patch-apps_mosquitto__ctrl_ctrl__shell.h]
--- apps/mosquitto_ctrl/ctrl_shell.h.orig	2026-02-09 09:29:46 UTC
+++ apps/mosquitto_ctrl/ctrl_shell.h
@@ -25,6 +25,7 @@ extern "C" {
 #include <cjson/cJSON.h>
 #include <stdarg.h>
 #include <stdbool.h>
+#include <stdarg.h>    // for va_list on NetBSD
 #include <stdio.h>
 
 extern const char *ANSI_URL;


[FILE:330:patches/patch-config.h]
--- config.h.orig	2026-02-09 09:29:46 UTC
+++ config.h
@@ -6,7 +6,7 @@
 
 #ifdef __APPLE__
 #  define __DARWIN_C_SOURCE
-#elif defined(__FreeBSD__) || defined(__NetBSD__)
+#elif defined(__FreeBSD__) || defined(__NetBSD__) || defined(__DragonFly__)
 #  define HAVE_NETINET_IN_H
 #elif defined(__QNX__)
 #  define _XOPEN_SOURCE 600


[FILE:366:patches/patch-lib_socks__mosq.c]
--- lib/socks_mosq.c.orig	2026-02-09 09:29:46 UTC
+++ lib/socks_mosq.c
@@ -30,7 +30,7 @@ Contributors:
 #else
 #  include <arpa/inet.h>
 #endif
-#if defined(__FreeBSD__) || defined(__OpenBSD__) || defined(_AIX)
+#if defined(__FreeBSD__) || defined(__OpenBSD__) || defined(_AIX) || defined(__DragonFly__)
 #  include <sys/socket.h>
 #  include <netinet/in.h>
 #endif


[FILE:1031:patches/patch-mosquitto.conf]
--- mosquitto.conf.orig	2026-02-09 09:29:46 UTC
+++ mosquitto.conf
@@ -186,7 +186,7 @@
 # This should be set to /var/run/mosquitto/mosquitto.pid if mosquitto is
 # being run automatically on boot with an init script and
 # start-stop-daemon or similar.
-#pid_file
+pid_file /var/run/mosquitto.pid
 
 # Set to true to queue messages with QoS 0 when a persistent client is
 # disconnected. These messages are included in the limit imposed by
@@ -225,7 +225,7 @@
 # If run as a non-root user, this setting has no effect.
 # Note that on Windows this has no effect and so mosquitto should be started by
 # the user you wish it to run as.
-#user mosquitto
+user nobody
 
 # =================================================================
 # Listeners
@@ -439,7 +439,7 @@
 # certificate files must have ".crt" as the file ending and you must run
 # "openssl rehash <path to capath>" each time you add/remove a certificate.
 # capath is not supported for websockets.
-#cafile
+cafile %%PREFIX%%/share/certs/ca-root-nss.crt
 #capath
 
 


[FILE:445:patches/patch-src_CMakeLists.txt]
--- src/CMakeLists.txt.orig	2026-02-09 09:29:46 UTC
+++ src/CMakeLists.txt
@@ -211,7 +211,7 @@ endif()
 if(UNIX)
 	if(APPLE)
 		target_link_libraries(mosquitto PRIVATE dl m)
-	elseif (${CMAKE_SYSTEM_NAME} MATCHES "OpenBSD")
+	elseif (${CMAKE_SYSTEM_NAME} MATCHES "OpenBSD|FreeBSD|DragonFly|MidnightBSD")
 		target_link_libraries(mosquitto PRIVATE m)
 	elseif (${CMAKE_SYSTEM_NAME} MATCHES "NetBSD")
 		target_link_libraries(mosquitto PRIVATE m)


[FILE:228:patches/patch-src_proxy__v1.c]
--- src/proxy_v1.c.orig	2026-02-09 09:29:46 UTC
+++ src/proxy_v1.c
@@ -2,6 +2,7 @@
 #  include <winsock2.h>
 #  include <ws2tcpip.h>
 #else
+#  include <netinet/in.h>
 #  include <arpa/inet.h>
 #  include <netinet/in.h>
 #endif


[FILE:804:files/mosquitto.in]
#!/bin/sh

# PROVIDE: mosquitto
# REQUIRE: DAEMON
# BEFORE: LOGIN
# KEYWORD: shutdown

#
# Add the following lines to /etc/rc.conf to enable mosquitto:
#
# mosquitto_enable="YES"
# mosquitto_flags="<set as needed>"
#
# See mosquitto(8) for flags
#

. /etc/rc.subr

name=mosquitto
rcvar=mosquitto_enable

load_rc_config $name

mosquitto_enable=${mosquitto_enable:="NO"}
mosquitto_config=${mosquitto_config:="%%PREFIX%%/etc/mosquitto/mosquitto.conf"}
mosquitto_user=${mosquitto_user:="nobody"}

command=%%PREFIX%%/sbin/mosquitto
command_args="-c ${mosquitto_config} -d"
pidfile=${mosquitto_pidfile:-"/var/run/mosquitto.pid"}
required_files=${mosquitto_config}

extra_commands=reload
stop_postcmd="rm -f $pidfile"
start_precmd="install -o ${mosquitto_user} -m 644 /dev/null ${pidfile}"

run_rc_command "$1"

