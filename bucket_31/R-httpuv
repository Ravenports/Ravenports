# Buildsheet autogenerated by ravenadm tool -- Do not edit.

NAMEBASE=		R-httpuv
VERSION=		1.6.12
KEYWORDS=		cran
VARIANTS=		standard
SDESC[standard]=	HTTP and WebSocket Server Library
HOMEPAGE=		https://github.com/rstudio/httpuv
CONTACT=		CRAN_Automaton[cran@ironwolf.systems]

DOWNLOAD_GROUPS=	main
SITES[main]=		CRAN/src/contrib
			https://loki.dragonflybsd.org/cranfiles/
DISTFILE[1]=		httpuv_1.6.12.tar.gz:main
DIST_SUBDIR=		CRAN
DF_INDEX=		1
SPKGS[standard]=	single

OPTIONS_AVAILABLE=	none
OPTIONS_STANDARD=	none

BUILDRUN_DEPENDS=	R-later:single:standard
			R-promises:single:standard
			R-R6:single:standard
			R-Rcpp:single:standard

USES=			cran gmake iconv:build zlib:build bz2:build xz:build
			pcre2:build

DISTNAME=		httpuv

GENERATED=		yes

INSTALL_REQ_TOOLCHAIN=	yes

post-extract:
	${CP} ${MK_TEMPLATES}/config.guess ${WRKSRC}/src/libuv/config.guess
	${CP} ${MK_TEMPLATES}/config.sub ${WRKSRC}/src/libuv/config.sub

[FILE:492:descriptions/desc.single]
httpuv: HTTP and WebSocket Server Library

Provides low-level socket and protocol support for handling HTTP and
WebSocket requests directly from within R. It is primarily intended as a
building block for other packages, rather than making it particularly easy
to create complete web applications using httpuv alone. httpuv is built on
top of the libuv and http-parser C libraries, both of which were developed
by Joyent, Inc. (See LICENSE file for libuv and http-parser license
information.)


[FILE:104:distinfo]
b1d972b1c240702c38cb844a1040670d62876abf462256764b49c120a52f5e74      1879118 CRAN/httpuv_1.6.12.tar.gz


[FILE:730:patches/patch-src_Makevars.in]
--- src/Makevars.in.orig	2023-10-23 16:48:26 UTC
+++ src/Makevars.in
@@ -15,6 +15,9 @@ endif
 ifeq ($(UNAME), OpenBSD)
 PKG_LIBS += -lkvm
 endif
+ifeq ($(UNAME), NetBSD)
+PKG_LIBS += -lkvm
+endif
 
 PKG_CFLAGS = $(C_VISIBILITY) -DSTRICT_R_HEADERS
 PKG_CXXFLAGS = $(CXX_VISIBILITY) -DSTRICT_R_HEADERS
@@ -30,7 +33,7 @@ CONFIGURE_FLAGS="--quiet"
 
 #### Other flags ####
 # Uncomment to suppress lots of warnings on Fedora 28
-# PKG_CPPFLAGS += -Wno-deprecated-declarations -Wno-parentheses
+PKG_CPPFLAGS += -Wno-deprecated-declarations -Wno-parentheses
 # Fedora 28 defines _GLIBCXX_ASSERTIONS, so we better define it everywhere
 # to catch issues earlier.
 # jcheng 2018-06-18: Disabling _GLIBCXX_ASSERTIONS for now, as it causes


[FILE:233:patches/patch-src_libuv_configure]
--- src/libuv/configure.orig	2023-10-23 17:02:22 UTC
+++ src/libuv/configure
@@ -14850,7 +14850,7 @@ else
 fi
 
  if case $host_os in
-  *freebsd*) true ;;
+  *freebsd*|*midnight*) true ;;
   *) false ;;
 esac; then
   FREEBSD_TRUE=


[FILE:1481:patches/patch-src_unix_fs.c]
--- src/libuv/src/unix/fs.c.orig	2023-10-23 16:48:26 UTC
+++ src/libuv/src/unix/fs.c
@@ -1127,13 +1127,13 @@ static ssize_t uv__fs_sendfile(uv_fs_t*
 static ssize_t uv__fs_utime(uv_fs_t* req) {
 #if defined(__linux__)                                                         \
     || defined(_AIX71)                                                         \
-    || defined(__sun)                                                          \
     || defined(__HAIKU__)
   struct timespec ts[2];
   ts[0] = uv__fs_to_timespec(req->atime);
   ts[1] = uv__fs_to_timespec(req->mtime);
   return utimensat(AT_FDCWD, req->path, ts, 0);
 #elif defined(__APPLE__)                                                      \
+    || defined(__sun)                                                         \
     || defined(__DragonFly__)                                                 \
     || defined(__FreeBSD__)                                                   \
     || defined(__FreeBSD_kernel__)                                            \
@@ -1167,7 +1167,6 @@ static ssize_t uv__fs_utime(uv_fs_t* req
 static ssize_t uv__fs_lutime(uv_fs_t* req) {
 #if defined(__linux__)            ||                                           \
     defined(_AIX71)               ||                                           \
-    defined(__sun)                ||                                           \
     defined(__HAIKU__)
   struct timespec ts[2];
   ts[0] = uv__fs_to_timespec(req->atime);

