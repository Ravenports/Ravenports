# Buildsheet autogenerated by ravenadm tool -- Do not edit.

NAMEBASE=		libcupsfilters
VERSION=		2.1.0
KEYWORDS=		devel print
VARIANTS=		std
SDESC[std]=		Library for developing printing filters
HOMEPAGE=		https://github.com/OpenPrinting/libcupsfilters
CONTACT=		nobody

DOWNLOAD_GROUPS=	main
SITES[main]=		https://github.com/OpenPrinting/libcupsfilters/releases/download/2.1.0/
DISTFILE[1]=		libcupsfilters-2.1.0.tar.xz:main
DF_INDEX=		1
SPKGS[std]=		set
			primary
			data
			dev
			docs

OPTIONS_AVAILABLE=	none
OPTIONS_STANDARD=	none

BUILD_DEPENDS=		brotli:dev:std
			libexif:dev:std
			qpdf:dev:std
			poppler:dev:std
			poppler:cppdev:std
			lcms2:dev:std
			dbus:dev:std
			cups:dev:std
			gmp:dev:std
			ghostscript:primary:std
			fonts-dejavu:single:std
BUILDRUN_DEPENDS=	brotli:primary:std
			libexif:primary:std
			qpdf:primary:std
			poppler:primary:std
			poppler:cpp:std
			poppler:utils:std
			lcms2:primary:std
			dbus:primary:std
			cups:primary:std
			gmp:primary:std
EXRUN[dev]=		tiff:dev:std
			png:dev:std
			qpdf:dev:std
			cups:dev:std

USES=			gmake expat fontconfig zstd zlib ssl jpeg tiff png
			iconv pkgconfig libtool

LICENSE=		APACHE20:primary
LICENSE_TERMS=		primary:{{WRKSRC}}/COPYING
LICENSE_FILE=		APACHE20:{{WRKSRC}}/LICENSE
LICENSE_SCHEME=		solo

MUST_CONFIGURE=		gnu
CONFIGURE_ARGS=		--with-test-font-path="{{LOCALBASE}}/share/fonts/dejavu/DejaVuSans.ttf"
			--disable-mutool

INSTALL_TARGET=		install-strip
SOVERSION=		2.0.0

[FILE:977:descriptions/desc.primary]
This package provides the libcupsfilters library, which in its 2.x version
contains all the code of the filters of the former cups-filters package as
library functions, the so-called filter functions.

The call scheme of the filter functions is similar to the one of the CUPS
filter executables (see cupsfilters/filter.h), but generalized. In
addition, it accepts printer and job IPP attributes but not PPD files any
more. The PPD file interfacing for retro-fitting got moved to libppd.

The filter functions are principally intended to be used for the data
format conversion tasks needed in Printer Applications. They are already
in use (together with libppd and pappl-retrofit) by the CUPS-driver
retro-fitting Printer Applications from OpenPrinting.

In addition to the filter functions libcupsfilters also contains several
API functions useful for developing printer drivers/Printer Applications,
like image and raster graphics handling, make/model/device ID matching, ...


[FILE:66:descriptions/desc.data]
This package contains the data files for the cupsfilters library.


[FILE:106:distinfo]
cbe900c7783e4aab0b1681629fad7322d82d082a51e8bae7e1c741d26bdcd294      1445276 libcupsfilters-2.1.0.tar.xz


[FILE:69:manifests/plist.primary]
lib/
 libcupsfilters.so.%%SOMAJOR%%
 libcupsfilters.so.%%SOVERSION%%


[FILE:417:manifests/plist.data]
share/cups/banners/
 classified
 confidential
 form
 secret
 standard
 topsecret
 unclassified
share/cups/charsets/
share/cups/charsets/
 pdf.utf-8
 pdf.utf-8.heavy
 pdf.utf-8.simple
share/cups/data/
 classified.pdf
 confidential.pdf
 default-testpage.pdf
 default.pdf
 form_english.pdf
 form_english_in.odt
 form_russian.pdf
 form_russian_in.odt
 secret.pdf
 standard.pdf
 testprint
 topsecret.pdf
 unclassified.pdf


[FILE:214:manifests/plist.dev]
include/cupsfilters/
 bitmap.h
 catalog.h
 colord.h
 colormanager.h
 driver.h
 filter.h
 ieee1284.h
 image.h
 ipp.h
 log.h
 pdf.h
 raster.h
lib/
 libcupsfilters.a
 libcupsfilters.so
lib/pkgconfig/libcupsfilters.pc


[FILE:181:manifests/plist.docs]
share/doc/libcupsfilters/
share/doc/libcupsfilters/
 ABOUT-NLS
 AUTHORS
 CHANGES-1.x.md
 CHANGES.md
 CONTRIBUTING.md
 COPYING
 DEVELOPING.md
 INSTALL.md
 LICENSE
 NOTICE
 README.md


[FILE:294:patches/patch-cupsfilters_filter_c]
Index: cupsfilters/filter.c
--- cupsfilters/filter.c.orig	2024-10-17 20:58:08 UTC
+++ cupsfilters/filter.c
@@ -18,6 +18,7 @@
 #include <math.h>
 #include <errno.h>
 #include <signal.h>
+#include <sys/stat.h> /* S_IRUSR */
 #include <sys/wait.h>
 #include <cups/file.h>
 #include <cups/array.h>


[FILE:519:patches/patch-cupsfilters_ghostscript.c]
--- cupsfilters/ghostscript.c.orig	2024-10-17 20:58:08 UTC
+++ cupsfilters/ghostscript.c
@@ -610,7 +610,13 @@ gs_spawn (const char *filename,
     }
 
     // Execute Ghostscript command line ...
+#if defined(__DragonFly__) || defined(__FreeBSD__)
+    extern char **environ;
+    environ = envp;
+    execvp(filename, gsargv);
+#else
     execvpe(filename, gsargv, envp);
+#endif
     if (log) log(ld, CF_LOGLEVEL_ERROR,
 		 "cfFilterGhostscript: Unable to launch Ghostscript: %s: %s",
 		 filename, strerror(errno));

