# Buildsheet autogenerated by ravenadm tool -- Do not edit.

NAMEBASE=		gprbuild
VERSION=		2018
REVISION=		1
KEYWORDS=		devel ada
VARIANTS=		standard
SDESC[standard]=	Adacore multi-language software build tool
HOMEPAGE=		http://docs.adacore.com/live/wave/gprbuild/html/gprbuild_ug/gprbuild_ug.html
CONTACT=		John_Marino[draco@marino.st]

DOWNLOAD_GROUPS=	main
SITES[main]=		http://downloads.dragonlace.net/src/
DISTFILE[1]=		gprbuild-gpl-2018-20180524-src.tar.gz:main
DISTFILE[2]=		xmlada-gpl-2018-20180524-src.tar.gz:main
DF_INDEX=		1 2
SPKGS[standard]=	complete
			primary
			gprlib
			docs
			examples

OPTIONS_AVAILABLE=	none
OPTIONS_STANDARD=	none

BUILD_DEPENDS=		xmlada:primary:standard
EXRUN[gprlib]=		xmlada:primary:standard

USES=			gmake

DISTNAME=		gprbuild-gpl-2018-src

LICENSE=		GPLv3+:primary
LICENSE_TERMS=		primary:{{WRKDIR}}/TERMS
LICENSE_FILE=		GPLv3+:{{WRKSRC}}/COPYING3
LICENSE_AWK=		TERMS:"^$$"
LICENSE_SOURCE=		TERMS:{{WRKSRC}}/src/gprbuild.ads
LICENSE_SCHEME=		solo

INFO=			primary:gprbuild_ug
INFO_SUBDIR=		.

BUILD_TARGET=		all libgpr.build
MAKE_ARGS=		prefix={{STAGEDIR}}{{PREFIX}}
			ENABLE_SHARED=yes
			BUILD=production
			PROCESSORS={{MAKE_JOBS_NUMBER}}
			TARGET={{CONFIGURE_TARGET}}

INSTALL_TARGET=		install libgpr.install
INSTALL_REQ_TOOLCHAIN=	yes

post-patch:
	${SED} -i"" \
		-e "s|@LOCALBASE@|${LOCALBASE}|" \
		-e "s|@GCCX@|gcc8|" \
		${WRKSRC}/share/gprconfig/compilers.xml
	# the relocatable library fails to build, limit to static(-pic)
	${REINPLACE_CMD} \
		-e '/^LIB_INSTALLER=/ s|$$| --project-subdir=lib/gnat|' \
		${WRKSRC}/Makefile
	${RM} ${WRKSRC}/share/gprconfig/*.orig
	${REINPLACE_CMD} -e 's|"-gnatwe", ||' ${WRKSRC}/gprbuild.gpr

post-patch-dragonfly:
	# dragonfly has different install program than freebsd, linux (!)
	${REINPLACE_CMD} -e 's| -t||' ${WRKSRC}/bootstrap.sh

post-install:
	${RM} ${STAGEDIR}${PREFIX}/doinstall
	${RM} -r ${STAGEDIR}${STD_DOCDIR}/html/_sources
	${RM} -r ${STAGEDIR}${PREFIX}/lib/gnat/manifests
	${MV} ${STAGEDIR}${STD_DOCDIR}/info/gprbuild_ug.info \
		${STAGEDIR}${PREFIX}/share/info
	${RM} -r ${STAGEDIR}${STD_DOCDIR}/info
	${STRIP_CMD} ${STAGEDIR}${PREFIX}/bin/*
	${STRIP_CMD} ${STAGEDIR}${PREFIX}/libexec/gprbuild/*

do-configure:
	(cd ${WRKSRC} && ${SETENV} ${MAKE_ENV} ${MAKE_CMD} ${MAKE_ARGS} setup)

post-configure:
	# create bootstrap version of gprbuild
	${MKDIR} ${WRKDIR}/bootstrap_construction
	(cd ${WRKDIR}/bootstrap_construction && ${WRKSRC}/bootstrap.sh \
	  --with-xmlada=${WRKDIR}/xmlada-gpl-2018-src \
	  --srcdir=${WRKSRC} \
	  --prefix=${WRKDIR}/bootstrap)

[FILE:532:descriptions/desc.primary]
GPRbuild is an advanced software tool designed to help automate the
construction of multi-language systems.  It removes the complexity from
multi-language development by allowing developers to quickly and easily
compile and link software written in a combination of languages including
Ada, Assembler, C, C++, and Fortran.  Easily extendable by users to cover
new toolchains and languages it is primarily aimed at projects of all
sizes organized into subsystems and libraries and is particularly well
suited for compiled languages.


[FILE:190:descriptions/desc.gprlib]
GPRbuild is an advanced software tool designed to help automate the
construction of multi-language systems.

This package contains a standalone library to accomplish the same
functionality.


[FILE:230:distinfo]
a06b7ee6ddc00a927db9b6207a4bd44e670ff2cceb9879a5baa98f4a38f552a1      2479651 gprbuild-gpl-2018-20180524-src.tar.gz
aacef3ae91e701690f60bde9c8a4a3f47ba8ca1f8f3c0599d01bce0173be80de      1582215 xmlada-gpl-2018-20180524-src.tar.gz


[FILE:992:manifests/plist.primary]
bin/
 gprbuild
 gprclean
 gprconfig
 gprinstall
 gprls
 gprname
 gprslave
libexec/gprbuild/
 gprbind
 gprlib
share/gpr/_default.gpr
share/gprconfig/
 0_default.xml
 aarch64-vx7.xml
 arm-vx6.xml
 arm-vx7.xml
 asm.xml
 baselined.xml
 c.xml
 clean.xml
 compilers-arm-vx7.xml
 compilers-baselined.xml
 compilers-e500v2-vx6.xml
 compilers-e500v2-vx653.xml
 compilers-e500v2-vx7.xml
 compilers-ppc-vx653.xml
 compilers-ppc-vx7.xml
 compilers-ppc64-vx7.xml
 compilers-vxworks.xml
 compilers-x86-vx7.xml
 compilers-x86_64-vx7.xml
 compilers.xml
 cpp.xml
 cross.xml
 e500v2-vx6.xml
 e500v2-vx653.xml
 e500v2-vx7.xml
 env.ent
 fallback_targets.xml
 fortran.xml
 gnat.xml
 gnat_runtime.mapping
 gprconfig.xsd
 linker.xml
 nocompiler.xml
 ppc-vx6.xml
 ppc-vx653.xml
 ppc-vx7.xml
 ppc64-vx7.xml
 shortcuts.ent
 targetset.xml
 tricore-compilers.xml
 tricore-configuration.xml
 tricore-target.xml
 vx6.ent
 vx653.ent
 vx7.ent
 vxworks.ent
 vxworks.xml
 windres.xml
 x86-vx6.xml
 x86-vx7.xml
 x86_64-vx7.xml


[FILE:6383:manifests/plist.gprlib]
include/gpr/gpr.relocatable/
 gpr-ali.adb
 gpr-ali.ads
 gpr-attr-pm.adb
 gpr-attr-pm.ads
 gpr-attr.adb
 gpr-attr.ads
 gpr-com.ads
 gpr-compilation-process-waiter.adb
 gpr-compilation-process-waiter.ads
 gpr-compilation-process.adb
 gpr-compilation-process.ads
 gpr-compilation-protocol.adb
 gpr-compilation-protocol.ads
 gpr-compilation-slave.adb
 gpr-compilation-slave.ads
 gpr-compilation-sync.adb
 gpr-compilation-sync.ads
 gpr-compilation.adb
 gpr-compilation.ads
 gpr-conf.adb
 gpr-conf.ads
 gpr-cset.adb
 gpr-cset.ads
 gpr-debug.adb
 gpr-debug.ads
 gpr-dect.adb
 gpr-dect.ads
 gpr-env.adb
 gpr-env.ads
 gpr-err-scanner.adb
 gpr-err.adb
 gpr-err.ads
 gpr-erroutc.adb
 gpr-erroutc.ads
 gpr-ext.adb
 gpr-ext.ads
 gpr-knowledge.adb
 gpr-knowledge.ads
 gpr-names.adb
 gpr-names.ads
 gpr-nmsc.adb
 gpr-nmsc.ads
 gpr-opt.ads
 gpr-osint.adb
 gpr-osint.ads
 gpr-output.adb
 gpr-output.ads
 gpr-part.adb
 gpr-part.ads
 gpr-pp.adb
 gpr-pp.ads
 gpr-proc.adb
 gpr-proc.ads
 gpr-scans.adb
 gpr-scans.ads
 gpr-script.adb
 gpr-script.ads
 gpr-sdefault.ads
 gpr-sinput.adb
 gpr-sinput.ads
 gpr-snames.adb
 gpr-snames.ads
 gpr-stamps.adb
 gpr-strt.adb
 gpr-strt.ads
 gpr-tempdir.adb
 gpr-tempdir.ads
 gpr-tree.adb
 gpr-tree.ads
 gpr-util-aux.adb
 gpr-util-aux.ads
 gpr-util-knowledge.adb
 gpr-util.adb
 gpr-util.ads
 gpr-version.adb
 gpr-version.ads
 gpr.adb
 gpr.ads
 gpr_build_util.adb
 gpr_build_util.ads
 gpr_imports.c
include/gpr/gpr.static/
 gpr-ali.adb
 gpr-ali.ads
 gpr-attr-pm.adb
 gpr-attr-pm.ads
 gpr-attr.adb
 gpr-attr.ads
 gpr-com.ads
 gpr-compilation-process-waiter.adb
 gpr-compilation-process-waiter.ads
 gpr-compilation-process.adb
 gpr-compilation-process.ads
 gpr-compilation-protocol.adb
 gpr-compilation-protocol.ads
 gpr-compilation-slave.adb
 gpr-compilation-slave.ads
 gpr-compilation-sync.adb
 gpr-compilation-sync.ads
 gpr-compilation.adb
 gpr-compilation.ads
 gpr-conf.adb
 gpr-conf.ads
 gpr-cset.adb
 gpr-cset.ads
 gpr-debug.adb
 gpr-debug.ads
 gpr-dect.adb
 gpr-dect.ads
 gpr-env.adb
 gpr-env.ads
 gpr-err-scanner.adb
 gpr-err.adb
 gpr-err.ads
 gpr-erroutc.adb
 gpr-erroutc.ads
 gpr-ext.adb
 gpr-ext.ads
 gpr-knowledge.adb
 gpr-knowledge.ads
 gpr-names.adb
 gpr-names.ads
 gpr-nmsc.adb
 gpr-nmsc.ads
 gpr-opt.ads
 gpr-osint.adb
 gpr-osint.ads
 gpr-output.adb
 gpr-output.ads
 gpr-part.adb
 gpr-part.ads
 gpr-pp.adb
 gpr-pp.ads
 gpr-proc.adb
 gpr-proc.ads
 gpr-scans.adb
 gpr-scans.ads
 gpr-script.adb
 gpr-script.ads
 gpr-sdefault.ads
 gpr-sinput.adb
 gpr-sinput.ads
 gpr-snames.adb
 gpr-snames.ads
 gpr-stamps.adb
 gpr-strt.adb
 gpr-strt.ads
 gpr-tempdir.adb
 gpr-tempdir.ads
 gpr-tree.adb
 gpr-tree.ads
 gpr-util-aux.adb
 gpr-util-aux.ads
 gpr-util-knowledge.adb
 gpr-util.adb
 gpr-util.ads
 gpr-version.adb
 gpr-version.ads
 gpr.adb
 gpr.ads
 gpr_build_util.adb
 gpr_build_util.ads
 gpr_imports.c
include/gpr/gpr.static-pic/
 gpr-ali.adb
 gpr-ali.ads
 gpr-attr-pm.adb
 gpr-attr-pm.ads
 gpr-attr.adb
 gpr-attr.ads
 gpr-com.ads
 gpr-compilation-process-waiter.adb
 gpr-compilation-process-waiter.ads
 gpr-compilation-process.adb
 gpr-compilation-process.ads
 gpr-compilation-protocol.adb
 gpr-compilation-protocol.ads
 gpr-compilation-slave.adb
 gpr-compilation-slave.ads
 gpr-compilation-sync.adb
 gpr-compilation-sync.ads
 gpr-compilation.adb
 gpr-compilation.ads
 gpr-conf.adb
 gpr-conf.ads
 gpr-cset.adb
 gpr-cset.ads
 gpr-debug.adb
 gpr-debug.ads
 gpr-dect.adb
 gpr-dect.ads
 gpr-env.adb
 gpr-env.ads
 gpr-err-scanner.adb
 gpr-err.adb
 gpr-err.ads
 gpr-erroutc.adb
 gpr-erroutc.ads
 gpr-ext.adb
 gpr-ext.ads
 gpr-knowledge.adb
 gpr-knowledge.ads
 gpr-names.adb
 gpr-names.ads
 gpr-nmsc.adb
 gpr-nmsc.ads
 gpr-opt.ads
 gpr-osint.adb
 gpr-osint.ads
 gpr-output.adb
 gpr-output.ads
 gpr-part.adb
 gpr-part.ads
 gpr-pp.adb
 gpr-pp.ads
 gpr-proc.adb
 gpr-proc.ads
 gpr-scans.adb
 gpr-scans.ads
 gpr-script.adb
 gpr-script.ads
 gpr-sdefault.ads
 gpr-sinput.adb
 gpr-sinput.ads
 gpr-snames.adb
 gpr-snames.ads
 gpr-stamps.adb
 gpr-strt.adb
 gpr-strt.ads
 gpr-tempdir.adb
 gpr-tempdir.ads
 gpr-tree.adb
 gpr-tree.ads
 gpr-util-aux.adb
 gpr-util-aux.ads
 gpr-util-knowledge.adb
 gpr-util.adb
 gpr-util.ads
 gpr-version.adb
 gpr-version.ads
 gpr.adb
 gpr.ads
 gpr_build_util.adb
 gpr_build_util.ads
 gpr_imports.c
lib/libgpr.so
lib/gnat/gpr.gpr
lib/gpr/relocatable/gpr/
 gpr-ali.ali
 gpr-attr-pm.ali
 gpr-attr.ali
 gpr-com.ali
 gpr-compilation-process-waiter.ali
 gpr-compilation-process.ali
 gpr-compilation-protocol.ali
 gpr-compilation-slave.ali
 gpr-compilation-sync.ali
 gpr-compilation.ali
 gpr-conf.ali
 gpr-cset.ali
 gpr-debug.ali
 gpr-dect.ali
 gpr-env.ali
 gpr-err.ali
 gpr-erroutc.ali
 gpr-ext.ali
 gpr-knowledge.ali
 gpr-names.ali
 gpr-nmsc.ali
 gpr-opt.ali
 gpr-osint.ali
 gpr-output.ali
 gpr-part.ali
 gpr-pp.ali
 gpr-proc.ali
 gpr-scans.ali
 gpr-script.ali
 gpr-sdefault.ali
 gpr-sinput.ali
 gpr-snames.ali
 gpr-strt.ali
 gpr-tempdir.ali
 gpr-tree.ali
 gpr-util-aux.ali
 gpr-util.ali
 gpr-version.ali
 gpr.ali
 gpr_build_util.ali
 libgpr.so
lib/gpr/static-pic/gpr/
 gpr-ali.ali
 gpr-attr-pm.ali
 gpr-attr.ali
 gpr-com.ali
 gpr-compilation-process-waiter.ali
 gpr-compilation-process.ali
 gpr-compilation-protocol.ali
 gpr-compilation-slave.ali
 gpr-compilation-sync.ali
 gpr-compilation.ali
 gpr-conf.ali
 gpr-cset.ali
 gpr-debug.ali
 gpr-dect.ali
 gpr-env.ali
 gpr-err.ali
 gpr-erroutc.ali
 gpr-ext.ali
 gpr-knowledge.ali
 gpr-names.ali
 gpr-nmsc.ali
 gpr-opt.ali
 gpr-osint.ali
 gpr-output.ali
 gpr-part.ali
 gpr-pp.ali
 gpr-proc.ali
 gpr-scans.ali
 gpr-script.ali
 gpr-sdefault.ali
 gpr-sinput.ali
 gpr-snames.ali
 gpr-strt.ali
 gpr-tempdir.ali
 gpr-tree.ali
 gpr-util-aux.ali
 gpr-util.ali
 gpr-version.ali
 gpr.ali
 gpr_build_util.ali
 libgpr.a
lib/gpr/static/gpr/
 gpr-ali.ali
 gpr-attr-pm.ali
 gpr-attr.ali
 gpr-com.ali
 gpr-compilation-process-waiter.ali
 gpr-compilation-process.ali
 gpr-compilation-protocol.ali
 gpr-compilation-slave.ali
 gpr-compilation-sync.ali
 gpr-compilation.ali
 gpr-conf.ali
 gpr-cset.ali
 gpr-debug.ali
 gpr-dect.ali
 gpr-env.ali
 gpr-err.ali
 gpr-erroutc.ali
 gpr-ext.ali
 gpr-knowledge.ali
 gpr-names.ali
 gpr-nmsc.ali
 gpr-opt.ali
 gpr-osint.ali
 gpr-output.ali
 gpr-part.ali
 gpr-pp.ali
 gpr-proc.ali
 gpr-scans.ali
 gpr-script.ali
 gpr-sdefault.ali
 gpr-sinput.ali
 gpr-snames.ali
 gpr-strt.ali
 gpr-tempdir.ali
 gpr-tree.ali
 gpr-util-aux.ali
 gpr-util.ali
 gpr-version.ali
 gpr.ali
 gpr_build_util.ali
 libgpr.a


[FILE:1012:manifests/plist.docs]
share/doc/gprbuild/html/
 .buildinfo
 genindex.html
 gprbuild_ug.html
 objects.inv
 search.html
 searchindex.js
share/doc/gprbuild/html/_images/
 importing_and_project_extension_figure_1.png
 importing_and_project_extension_figure_2.png
 importing_and_project_extension_figure_3.png
 importing_and_project_extension_figure_4.png
 project-manager-figure.png
share/doc/gprbuild/html/_static/
 ajax-loader.gif
 basic.css
 comment-bright.png
 comment-close.png
 comment.png
 contents.png
 doctools.js
 down-pressed.png
 down.png
 favicon.ico
 file.png
 jquery-1.11.1.js
 jquery.js
 minus.png
 navigation.png
 plus.png
 pygments.css
 searchtools.js
 sphinxdoc.css
 underscore-1.3.1.js
 underscore.js
 up-pressed.png
 up.png
 websupport.js
share/doc/gprbuild/html/gprbuild_ug/
 building_with_gprbuild.html
 companion_tools.html
 gnat_project_manager.html
 introduction.html
share/doc/gprbuild/html/share/gnu_free_documentation_license.html
share/doc/gprbuild/pdf/gprbuild_ug.pdf
share/doc/gprbuild/txt/gprbuild_ug.txt


[FILE:2218:manifests/plist.examples]
share/examples/gprbuild/Makefile
share/examples/gprbuild/ada_cpp/
 Makefile
 animals.gpr
 except.gpr
share/examples/gprbuild/ada_cpp/src1/
 ada_main.adb
 call_cpp.adb
 call_cpp.ads
 cpp_main.cpp
 cpp_routine.cpp
 cpp_routine.h
share/examples/gprbuild/ada_cpp/src2/
 animals.adb
 animals.ads
 animals.h
 animals_c.cc
 animals_interfaces.ads
 main.adb
share/examples/gprbuild/ada_f77/
 Makefile
 ess.f
 fm.gpr
 ft.gpr
share/examples/gprbuild/ada_f77/src/
 fm-interfac.adb
 fm-interfac.ads
 fm-locks.adb
 fm-locks.ads
 fm-protected_queue.adb
 fm-protected_queue.ads
 fm-system_dependant.adb
 fm-system_dependant.ads
 fm-tuple_manager.adb
 fm-tuple_manager.ads
 fm-types.ads
 fm.adb
 fm.ads
share/examples/gprbuild/extended_projects/
 Makefile
 new_ada_main.gpr
 new_common_subsystem.gpr
share/examples/gprbuild/extended_projects/new_ada_src/ada_main.adb
share/examples/gprbuild/extended_projects/new_util_src/
 c_lib.ads
 lib2.c
share/examples/gprbuild/first_steps/
 Makefile
 ada_main.gpr
 c_main.gpr
share/examples/gprbuild/first_steps/ada_src/ada_main.adb
share/examples/gprbuild/first_steps/c_src/c_main.c
share/examples/gprbuild/first_steps/util_src/
 ada_lib.adb
 ada_lib.ads
 c_lib.ads
 lib.c
 lib.h
share/examples/gprbuild/libraries/
 Makefile
 Makefile2
 ada_main.adb
 c_main.c
 dynamic_lib.gpr
 extern_lib.gpr
 main0.gpr
 main1.gpr
 main2.gpr
 main3.gpr
 main4.gpr
 sa_lib.gpr
 static_lib.gpr
share/examples/gprbuild/libraries/lib_src/
 ada_lib.adb
 ada_lib.ads
 c_lib.ads
 lib.c
 lib.h
share/examples/gprbuild/matrix/
 Makefile
 matrix.gpr
share/examples/gprbuild/matrix/src/
 initmat.c
 main.adb
 multmat.f
share/examples/gprbuild/namings/
 Makefile
 _print2.ada
 _print3.adb
 main.adb
 my_routine.c1
 my_routine2.c1
 namings.gpr
 util-case1.ada
 util-case2.ada
 util.ads
share/examples/gprbuild/namings/src1/main.adb
share/examples/gprbuild/scenarios/
 Makefile
 general_lib.gpr
 main.gpr
share/examples/gprbuild/subsystems/
 Makefile
 ada_main.gpr
 attribute_sharing.gpr
 c_main.gpr
 common_subsystem.gpr
share/examples/gprbuild/subsystems/ada_src/ada_main.adb
share/examples/gprbuild/subsystems/c_src/c_main.c
share/examples/gprbuild/subsystems/util_src/
 ada_lib.adb
 ada_lib.ads
 c_lib.ads
 lib.c
 lib.h


[FILE:591:patches/patch-gpr_gpr.gpr]
--- gpr/gpr.gpr.orig	2018-05-25 06:23:17 UTC
+++ gpr/gpr.gpr
@@ -16,7 +16,7 @@
 --                                                                          --
 ------------------------------------------------------------------------------
 
-with "xmlada";
+with "xmlada_schema";
 
 library project GPR is
 
@@ -37,6 +37,8 @@ library project GPR is
    for Object_Dir use "libobj/" & Bld & "/" & Gnat_Lib_Type;
    for Library_Dir use "lib/" & Bld & "/" & Gnat_Lib_Type;
 
+   for Library_Options use Xmlada_schema'Library_options;
+
    --------------
    -- Compiler --
    --------------


[FILE:1202:patches/patch-share_gprconfig_compilers.xml]
--- share/gprconfig/compilers.xml.orig	2018-03-24 08:46:37 UTC
+++ share/gprconfig/compilers.xml
@@ -177,17 +177,15 @@
     </version>
     <languages>Ada</languages>
     <variable name="gcc_version">
-      <external>${PREFIX}gcc -v</external>
+      <external>ada -v</external>
       <grep regexp="^[-\w]*gcc \S+ (\S+)" group="1"></grep>
     </variable>
     <runtimes default="default,kernel,native">
-       <directory group="default" >\.\./lib/gcc(-lib)?/$TARGET/$gcc_version/adalib/</directory>
-       <directory group="default" contents="^rts-">\.\./lib/gcc(-lib)?/$TARGET/$gcc_version/ada_object_path</directory>
-       <directory group="2" >\.\./lib/gcc(-lib)?/$TARGET/$gcc_version/rts-(.*)/adalib/</directory>
-       <directory group="1" >\.\./$TARGET/lib/gnat/(.*)/adalib/</directory>
+       <directory group="default">\.\./lib/gcc/$TARGET/$gcc_version/adalib</directory>
+       <directory group="0">/raven/toolchain/@GCCX@/lib/gcc/$TARGET/$gcc_version/adalib</directory>
     </runtimes>
     <target>
-      <external>${PREFIX}gcc -dumpmachine</external>
+      <external>ada -dumpmachine</external>
       <grep regexp="[^\r\n]+"></grep>
     </target>
   </compiler_description>


[FILE:486:patches/patch-share_gprconfig_gnat.xml]
--- share/gprconfig/gnat.xml.orig	2018-03-06 13:23:50 UTC
+++ share/gprconfig/gnat.xml
@@ -60,7 +60,7 @@
    &filter_gnat;
    <config>
    package Compiler is
-      for Driver                   ("Ada") use "${PATH(ada)}${PREFIX(ada)}gcc";
+      for Driver                   ("Ada") use "${PATH(ada)}ada";
       for Language_Kind            ("Ada") use "unit_based";
       for Dependency_Kind          ("Ada") use "ALI_File";
       for Leading_Required_Switches        ("Ada") use


[FILE:2314:patches/patch-share_gprconfig_linker.xml]
--- share/gprconfig/linker.xml.orig	2018-05-24 06:18:29 UTC
+++ share/gprconfig/linker.xml
@@ -951,11 +951,14 @@
     </config>
   </configuration>
 
-  <!-- linux, freebsd, Irix, QNX -->
+  <!-- linux, bsd, Irix, QNX -->
   <configuration>
     <targets>
        <target name="^.*linux.*$" />
        <target name="^.*freebsd.*$" />
+       <target name="^.*dragonfly.*$" />
+       <target name="^.*openbsd.*$" />
+       <target name="^.*netbsd.*$" />
        <target name="^.*irix.*$" />
        <target name="^.*qnx[0-9]*$" />
     </targets>
@@ -974,7 +977,6 @@
   <!-- linux, QNX -->
   <configuration>
     <targets>
-       <target name="^.*linux.*$" />
        <target name="^.*qnx[0-9]*$" />
     </targets>
     <config>
@@ -994,7 +996,6 @@
        <compiler language="Ada" />
     </compilers>
      <targets>
-       <target name="^.*-linux.*$" />
        <target name="^.*-qnx[0-9]*"/>
      </targets>
     <config>
@@ -1061,13 +1062,37 @@
     </config>
   </configuration>
 
-  <!-- freebsd -->
+  <!-- bsd -->
   <configuration>
     <targets>
        <target name="^.*freebsd.*$" />
+       <target name="^.*dragonfly.*$" />
+       <target name="^.*openbsd.*$" />
+       <target name="^.*netbsd.*$" />
+       <target name="^.*linux.*$" />
     </targets>
     <config>
-   for Run_Path_Option  use ("-Wl,-rpath,");
+   for Run_Path_Option  use ("-Wl,-z,origin,-rpath,");
+   for Run_Path_Origin use "$$ORIGIN";
+    </config>
+  </configuration>
+  <configuration>
+    <compilers>
+       <compiler language="Ada" />
+    </compilers>
+    <targets>
+       <target name="^.*freebsd.*$" />
+       <target name="^.*dragonfly.*$" />
+       <target name="^.*openbsd.*$" />
+       <target name="^.*netbsd.*$" />
+       <target name="^.*linux.*$" />
+    </targets>
+    <config>
+   package Linker is
+      for Required_Switches use
+        Linker'Required_Switches
+        &amp; ("-Wl,-rpath,${RUNTIME_DIR(ada)}adalib");
+   end Linker;
     </config>
   </configuration>
 
@@ -1519,6 +1544,9 @@
        <target name="^.*mingw.*$" />
        <target name="^.*linux.*$" />
        <target name="^.*freebsd.*$" />
+       <target name="^.*dragonfly.*$" />
+       <target name="^.*openbsd.*$" />
+       <target name="^.*netbsd.*$" />
      </targets>
     <config>
    package Linker is


[FILE:1186:patches/patch-share_gprconfig_targetset.xml]
--- share/gprconfig/targetset.xml.orig	2018-05-24 06:18:29 UTC
+++ share/gprconfig/targetset.xml
@@ -91,9 +91,10 @@
   </targetset>
 
   <!-- x86-solaris -->
-  <targetset canonical="x86-solaris">
-    <target>x86-solaris</target>
-    <target>i.86-(pc-)?solaris.*</target>
+  <targetset canonical="x86_64-solaris">
+    <target>x86_64-solaris</target>
+    <target>x86_64-.*solaris.*</target>
+    <target>i.86-.*solaris.*</target>
   </targetset>
 
   <!-- x86-windows (mingw) -->
@@ -214,6 +215,26 @@
     <target>amd64-.*freebsd.*</target>
   </targetset>
 
+  <!-- x86_64 DragonFly -->
+  <targetset canonical="x86_64-dragonfly">
+    <target>x86_64-dragonfly</target>
+    <target>x86_64-.*dragonfly.*</target>
+  </targetset>
+
+  <!-- x86_64 NetBSD -->
+  <targetset canonical="x86_64-netbsd">
+    <target>x86_64-netbsd</target>
+    <target>x86_64-.*netbsd.*</target>
+    <target>amd64-.*netbsd.*</target>
+  </targetset>
+
+  <!-- x86_64 OpenBSD -->
+  <targetset canonical="x86_64-openbsd">
+    <target>x86_64-openbsd</target>
+    <target>x86_64-.*openbsd.*</target>
+    <target>amd64-.*openbsd.*</target>
+  </targetset>
+
 <!-- Cross Ports -->
 <!-- *********** -->
 


[FILE:452:patches/patch-src_gprbuild-link.adb]
--- src/gprbuild-link.adb.orig	2018-05-25 06:23:18 UTC
+++ src/gprbuild-link.adb
@@ -2355,8 +2355,6 @@ package body Gprbuild.Link is
          if Opt.Run_Path_Option
            and then Main_Proj.Config.Run_Path_Option /= No_Name_List
          then
-            Add_Rpath_From_Arguments (Rpaths, Arguments, Main_Proj);
-            Add_Rpath_From_Arguments (Rpaths, Other_Arguments, Main_Proj);
             Add_Run_Path_Options;
          end if;
 


[FILE:1676:patches/patch-src_gprlib.adb]
--- src/gprlib.adb.orig	2018-05-25 06:23:18 UTC
+++ src/gprlib.adb
@@ -720,9 +720,6 @@ procedure Gprlib is
 
       for Dir of Imported_Library_Directories loop
          Library_Switches_Table.Append ("-L" & Dir);
-         if Path_Option /= null then
-            Add_Rpath (Dir);
-         end if;
       end loop;
 
       for Libname of Imported_Library_Names loop
@@ -917,12 +914,6 @@ procedure Gprlib is
               Shared_Lib_Suffix.all);
       end if;
 
-      if Path_Option /= null then
-         for Path of Library_Rpath_Options_Table loop
-            Add_Rpath (Path);
-         end loop;
-      end if;
-
       if Path_Option /= null and then not Rpath.Is_Empty then
          if Separate_Run_Path_Options then
             for J in 1 .. Rpath.Last_Index loop
@@ -1468,9 +1459,7 @@ procedure Gprlib is
                if Is_Regular_File (Object_Path) then
                   Object_Files.Append (Object_Path);
                else
-                  Fail_Program
-                    (null,
-                     "unknown object file """ & Object_Path & """");
+                  Put_Line ("WARNING: unknown object '" & Object_Path & "'");
                end if;
             end;
          end loop;
@@ -2002,10 +1991,10 @@ procedure Gprlib is
 
                      Libgnat :=
                        new String'
-                         ("-lgnat-" & Line (6 .. Last));
+                         ("-lgnat-" & Line (6));
                      Libgnarl :=
                        new String'
-                         ("-lgnarl-" & Line (6 .. Last));
+                         ("-lgnarl-" & Line (6));
                   end if;
 
                else


[FILE:38:files/special.mk]
PREPEND_PATH=	${WRKDIR}/bootstrap/bin

