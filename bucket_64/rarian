# Buildsheet autogenerated by ravenadm tool -- Do not edit.

NAMEBASE=		rarian
VERSION=		0.8.5
KEYWORDS=		textproc
VARIANTS=		standard
SDESC[standard]=	Documentation metadata library
HOMEPAGE=		https://rarian.freedesktop.org/
CONTACT=		nobody

DOWNLOAD_GROUPS=	main
SITES[main]=		https://gitlab.freedesktop.org/rarian/rarian/-/releases/0.8.5/downloads/assets/
DISTFILE[1]=		rarian-0.8.5.tar.bz2:main
DF_INDEX=		1
SPKGS[standard]=	complete
			primary
			dev
			tools

OPTIONS_AVAILABLE=	none
OPTIONS_STANDARD=	none

BUILD_DEPENDS=		tinyxml:dev:standard
BUILDRUN_DEPENDS=	tinyxml:primary:standard
			bash:primary:standard
			docbook-xsl:primary:standard
			docbook-xml:single:standard
RUN_DEPENDS=		getopt:single:standard

USES=			gmake libtool python c++:primary pkgconfig
GNOME_COMPONENTS=	libxslt

MUST_CONFIGURE=		gnu
CONFIGURE_ARGS=		--with-convert-dir={{LOCALBASE}}/share/omf
			--localstatedir=/var

INSTALL_TARGET=		install-strip
PLIST_SUB=		PREFIX={{PREFIX}}

post-patch:
	${REINPLACE_CMD} -e 's|/lib/rarian|/db/rarian|' \
		${WRKSRC}/util/Makefile.in
	${REINPLACE_CMD} -e 's|@localstatedir@/lib/rarian|@localstatedir@/db/rarian|g ; \
		s|getopt|${LOCALBASE}/bin/getopt|' \
		${WRKSRC}/util/rarian-sk-config.in \
		${WRKSRC}/util/rarian-sk-extract.in \
		${WRKSRC}/util/rarian-sk-rebuild.in \
		${WRKSRC}/util/rarian-sk-update.in
	${REINPLACE_CMD} -e 's|/usr/local|${LOCALBASE}|' \
		${WRKSRC}/librarian/rarian-main.c \
		${WRKSRC}/librarian/rarian-man.c \
		${WRKSRC}/librarian/rarian-info.c

post-install:
	${RM} -r ${STAGEDIR}${PREFIX}/share/help

[FILE:67:descriptions/desc.primary]
This package contains the Rarian library used by the Rarian tools.


[FILE:522:descriptions/desc.tools]
Rarian is designed to be a replacement for scrollkeeper.  It is
currently undergoing heavy development.  As of writing, rarian can be
installed in place of scrollkeeper and everything will work okay.

Rarian manages documentation metadata (as specified by the Open Source
Metadata Framework (OMF) and provides a simple API to allow help browsers
to find, sort, and search the document catalog.  It will also be able to
communicate with catalog servers on the Net to search for documents which
are not on the local system.


[FILE:99:distinfo]
8ead8a0e70cbf080176effa6f288de55747f649c9bae9809aa967a81c7e987ed       408968 rarian-0.8.5.tar.bz2


[FILE:41:manifests/plist.primary]
lib/
 librarian.so.0
 librarian.so.0.0.0


[FILE:146:manifests/plist.dev]
include/rarian/
 rarian-info.h
 rarian-main.h
 rarian-man.h
 rarian-reg-utils.h
 rarian.h
lib/
 librarian.a
 librarian.so
lib/pkgconfig/rarian.pc


[FILE:868:manifests/plist.tools]
bin/
 rarian-example
 rarian-sk-config
 rarian-sk-extract
 rarian-sk-gen-uuid
 rarian-sk-get-cl
 rarian-sk-get-content-list
 rarian-sk-get-extended-content-list
 rarian-sk-get-scripts
 rarian-sk-install
 rarian-sk-migrate
 rarian-sk-preinstall
 rarian-sk-rebuild
 rarian-sk-update
 scrollkeeper-config
 scrollkeeper-extract
 scrollkeeper-gen-seriesid
 scrollkeeper-get-cl
 scrollkeeper-get-content-list
 scrollkeeper-get-extended-content-list
 scrollkeeper-get-index-from-docpath
 scrollkeeper-get-toc-from-docpath
 scrollkeeper-get-toc-from-id
 scrollkeeper-install
 scrollkeeper-preinstall
 scrollkeeper-rebuilddb
 scrollkeeper-uninstall
 scrollkeeper-update
share/librarian/rarian-sk-cl.xml
share/librarian/Templates/C/scrollkeeper_cl.xml
share/librarian/manual/
 help-spec-0.2.xml
 index.xhtml
 rar-lib.xhtml
 rar-mdf.xhtml
 rar-skcompat.xhtml
@dir /var/db/rarian


[FILE:327:patches/patch-librarian_rarian-main.c]
--- librarian/rarian-main.c.orig	2023-05-06 00:02:46 UTC
+++ librarian/rarian-main.c
@@ -207,7 +207,7 @@ past:
     path = getenv("XDG_DATA_DIRS");
 
     if (!path || !strcmp(path, "")) {
-        path = "/usr/local/share/:/usr/share/";
+        path = "/usr/local/share/";
     }
     scan_dirs = rrn_str_split(path, ':');
 


[FILE:284:patches/patch-util_rarian-sk-config.in]
--- util/rarian-sk-config.in.orig	2023-05-06 00:02:46 UTC
+++ util/rarian-sk-config.in
@@ -47,7 +47,7 @@ case "$1" in
 		print_help
 		;;
 	--version )
-		echo $package_version \(Rarian replacement for scrollkeeper-config\)
+		echo $package_version
 		;;
 	--prefix )
 		echo $prefix


[FILE:262:files/scripts-tools.ucl]
post-install-lua: [{
    args: ""
    code: <<EOS
prog = pkg.prefixed_path("bin/rarian-sk-update")
pkg.exec({prog})
EOS
}]
pre-deinstall-lua: [{
    args: ""
    code: <<EOS
pkg.exec({"/usr/bin/find", "/var/db/rarian", "-type", "d", "-empty", "-delete"})
EOS
}]

