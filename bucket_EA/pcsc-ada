# Buildsheet autogenerated by ravenadm tool -- Do not edit.

NAMEBASE=		pcsc-ada
VERSION=		0.7.7
KEYWORDS=		devel ada
VARIANTS=		standard
SDESC[standard]=	Ada binding to Smart card interface (PC/SC)
HOMEPAGE=		http://www.codelabs.ch/pcscada
CONTACT=		John_Marino[draco@marino.st]

DOWNLOAD_GROUPS=	main
SITES[main]=		https://www.codelabs.ch/download/
DISTFILE[1]=		libpcscada-0.7.7.tar.bz2:main
DF_INDEX=		1
SPKGS[standard]=	complete
			primary
			docs

OPTIONS_AVAILABLE=	TESTED INTF_TEST
OPTIONS_STANDARD=	TESTED INTF_TEST
OPT_ON[all]=		TESTED

BUILD_DEPENDS=		ruby-asciidoctor:single:ruby_default
BUILDRUN_DEPENDS=	pcsc-lite:primary:standard

USES=			gprbuild gmake ada:primary

DISTNAME=		libpcscada-0.7.7

LICENSE=		LGPL21+:primary
LICENSE_TERMS=		primary:{{WRKDIR}}/TERMS
LICENSE_FILE=		LGPL21+:{{WRKSRC}}/LICENSE
LICENSE_AWK=		TERMS:"<PURPOSE>"
LICENSE_SOURCE=		TERMS:{{WRKSRC}}/src/pcsc.ads
LICENSE_SCHEME=		solo

BUILD_TARGET=		build-lib build-doc
MAKE_ARGS=		NUM_CPUS={{MAKE_JOBS_NUMBER}}

INSTALL_REQ_TOOLCHAIN=	yes

[INTF_TEST].DESCRIPTION=		Run interface tests against installed smart card
[INTF_TEST].BUILD_DEPENDS_ON=		ahven:complete:standard
[INTF_TEST].BUILD_TARGET_ON=		build-itests

[TESTED].DESCRIPTION=			Run unit test suite before installation
[TESTED].BUILD_DEPENDS_ON=		ahven:complete:standard
[TESTED].BUILD_TARGET_ON=		build-utests

post-install:
	${MKDIR} ${STAGEDIR}${STD_DOCDIR}/html
	${INSTALL_DATA} ${WRKSRC}/doc/html/* ${STAGEDIR}${STD_DOCDIR}/html
	${STRIP_CMD} ${STAGEDIR}${PREFIX}/lib/libpcscada.so

[FILE:155:descriptions/desc.primary]
PCSC/Ada provides a thick Ada binding to PC/SC-middleware. The library
allows programs written in Ada to communicate with smart cards using the
SCard API.


[FILE:103:distinfo]
8a3e6fe22883b7d6b389f0e00701f853bfbee4977eeade7823e1c763dc183370        47478 libpcscada-0.7.7.tar.bz2


[FILE:521:manifests/plist.primary]
include/pcscada/
 pcsc-scard-conversion.adb
 pcsc-scard-conversion.ads
 pcsc-scard-monitor.adb
 pcsc-scard-monitor.ads
 pcsc-scard-utils.adb
 pcsc-scard-utils.ads
 pcsc-scard.adb
 pcsc-scard.ads
 pcsc-thin-ifdhandler.ads
 pcsc-thin-reader.ads
 pcsc-thin.adb
 pcsc-thin.ads
 pcsc.ads
lib/
 libpcscada.so
 libpcscada.so.0.7.7
lib/pcscada/
 pcsc-scard-conversion.ali
 pcsc-scard-monitor.ali
 pcsc-scard-utils.ali
 pcsc-scard.ali
 pcsc-thin-ifdhandler.ali
 pcsc-thin-reader.ali
 pcsc-thin.ali
 pcsc.ali
share/gpr/pcscada.gpr


[FILE:35:manifests/plist.docs]
share/doc/pcsc-ada/html/index.html


[FILE:677:patches/patch-Makefile]
--- Makefile.orig	2022-11-03 08:41:39 UTC
+++ Makefile
@@ -29,14 +29,17 @@ REV     = 7
 VERSION = $(MAJOR).$(MINOR).$(REV)
 PCSCADA = libpcscada-$(VERSION)
 
+ADALIB!= gnatls -v | grep adalib | awk '{print $$1}'
+LDFLAGS=-Wl,-rpath,${ADALIB},-L${ADALIB}
+
 # This variable explicitly exists for override by people with a
 # different directory hierarchy.
 GPRINSTALLFLAGS ?= \
-  --prefix=$(PREFIX) \
+  --prefix=$(DESTDIR)$(PREFIX) \
   --no-manifest \
-  --ali-subdir=lib/ada/adalib/pcscada \
+  --ali-subdir=lib/pcscada \
   --lib-subdir=lib \
-  --sources-subdir=share/ada/adainclude/pcscada \
+  --sources-subdir=include/pcscada \
   # EOL
 
 TARBALL = $(PCSCADA).tar.bz2

