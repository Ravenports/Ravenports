# Buildsheet autogenerated by ravenadm tool -- Do not edit.

NAMEBASE=		libconfuse
VERSION=		3.3
REVISION=		2
KEYWORDS=		devel
VARIANTS=		std
SDESC[std]=		Configuration file parser library
HOMEPAGE=		https://github.com/martinh/libconfuse
CONTACT=		nobody

DOWNLOAD_GROUPS=	main
SITES[main]=		https://github.com/martinh/libconfuse/releases/download/v3.3/
DISTFILE[1]=		confuse-3.3.tar.xz:main
DF_INDEX=		1
SPKGS[std]=		set
			primary
			dev

OPTIONS_AVAILABLE=	none
OPTIONS_STANDARD=	none

USES=			cpe iconv pkgconfig libtool mbsdfix

DISTNAME=		confuse-3.3

LICENSE=		ISCL:primary
LICENSE_FILE=		ISCL:{{WRKSRC}}/LICENSE
LICENSE_SCHEME=		solo

CPE_VENDOR=		libconfuse_project
FPC_EQUIVALENT=		devel/libconfuse

MUST_CONFIGURE=		gnu
CONFIGURE_ARGS=		--disable-nls
			--enable-shared

INSTALL_TARGET=		install-strip
SOVERSION=		2.1.0

CVE_FIXED=		CVE-2022-40320

post-install:
	${RM} -r ${STAGEDIR}${PREFIX}/share/doc/confuse

[FILE:719:descriptions/desc.primary]
libConfuse is a configuration file parser library, licensed under the terms
of the ISC, and written in C. It supports sections and (lists of) values
(strings, integers, floats, booleans or other sections), as well as some
other features (such as single/double-quoted strings, environment variable
expansion, functions and nested include statements). It makes it very easy
to add configuration file capability to a program using a simple API.

The goal of libConfuse is not to be the configuration file parser library
with a gazillion of features. Instead, it aims to be easy to use and quick
to integrate with your code. libConfuse was called libcfg before, but was
changed to not confuse with other similar libraries.


[FILE:97:distinfo]
1dd50a0320e135a55025b23fcdbb3f0a81913b6d0b0a9df8cc2fdf3b3dc67010       485140 confuse-3.3.tar.xz


[FILE:61:manifests/plist.primary]
lib/
 libconfuse.so.%%SOMAJOR%%
 libconfuse.so.%%SOVERSION%%


[FILE:80:manifests/plist.dev]
include/confuse.h
lib/
 libconfuse.a
 libconfuse.so
lib/pkgconfig/libconfuse.pc


[FILE:945:patches/patch-fix-CVE-2022-40320]
commit d73777c2c3566fb2647727bb56d9a2295b81669b
Author: Joachim Wiberg <troglobit@gmail.com>
Date:   Fri Sep 2 16:12:46 2022 +0200

    Fix #163: unterminated username used with getpwnam()
    
    Signed-off-by: Joachim Wiberg <troglobit@gmail.com>

--- src/confuse.c.orig	2020-06-21 20:53:26 UTC
+++ src/confuse.c
@@ -1863,18 +1863,20 @@ DLLIMPORT char *cfg_tilde_expand(const c
 			passwd = getpwuid(geteuid());
 			file = filename + 1;
 		} else {
-			/* ~user or ~user/path */
-			char *user;
+			char *user; /* ~user or ~user/path */
+			size_t len;
 
 			file = strchr(filename, '/');
 			if (file == 0)
 				file = filename + strlen(filename);
 
-			user = malloc(file - filename);
+			len = file - filename - 1;
+			user = malloc(len + 1);
 			if (!user)
 				return NULL;
 
-			strncpy(user, filename + 1, file - filename - 1);
+			strncpy(user, &filename[1], len);
+			user[len] = 0;
 			passwd = getpwnam(user);
 			free(user);
 		}

