# Buildsheet autogenerated by ravenadm tool -- Do not edit.

NAMEBASE=		frotz
VERSION=		2.55
KEYWORDS=		games
VARIANTS=		std
SDESC[std]=		Infocom-style interactive fiction player
HOMEPAGE=		https://gitlab.com/DavidGriffith/frotz
CONTACT=		nobody

DOWNLOAD_GROUPS=	main
SITES[main]=		https://gitlab.com/DavidGriffith/frotz/-/archive/2.55/
DISTFILE[1]=		frotz-2.55.tar.bz2:main
DF_INDEX=		1
SPKGS[std]=		set
			primary
			dumb
			man

OPTIONS_AVAILABLE=	none
OPTIONS_STANDARD=	none

BUILD_DEPENDS=		freetype:dev:std
			libao:dev:std
			libsndfile:dev:std
			libsamplerate:dev:std
			libmodplug:dev:std
			xorg-bdftopcf:primary:std
			xorg-mkfontscale:primary:std
BUILDRUN_DEPENDS=	freetype:primary:std
			libao:primary:std
			libsndfile:primary:std
			libsamplerate:primary:std
			libmodplug:primary:std

USES=			gmake ncurses pkgconfig jpeg png zlib fonts
			execinfo:build
SDL_COMPONENTS=		sdl2 mixer2
XORG_COMPONENTS=	xt x11

LICENSE=		GPLv2+:primary
LICENSE_TERMS=		primary:{{WRKDIR}}/TERMS
LICENSE_FILE=		GPLv2+:{{WRKSRC}}/COPYING
LICENSE_AWK=		TERMS:"^$$"
LICENSE_SOURCE=		TERMS:{{WRKSRC}}/src/common/main.c
LICENSE_SCHEME=		solo

FONTNAME=		zork
FPC_EQUIVALENT=		games/frotz

MAKE_ENV=		CURSES=ncurses

INSTALL_TARGET=		install-all
INSTALL_REQ_TOOLCHAIN=	yes

post-install:
	${STRIP_CMD} ${STAGEDIR}${PREFIX}/bin/*frotz

[FILE:462:descriptions/desc.primary]
An interpreter for all Infocom games. Complies with standard 1.0 of
Graham Nelson's specification. Frotz runs text adventures which come in
so-called story files: ZORK1.DAT, TRINITY.DAT, CURSES.Z5, JIGSAW.Z8,
ARTHUR.ZIP etc. It is possible to play Atari ST, Amiga or Macintosh games
on your computer once you manage to transfer the story files.  There is an
increasing number of new games available on the Internet. Check the
if-archive at http://ifarchive.org/


[FILE:136:descriptions/desc.dumb]
This package contains dfrotz, a version of frotz that runs on dumb
terminals and doesn't pull in additional packages, not even ncurses.


[FILE:97:distinfo]
235a8606aa1e654aa5a5a41b5c7b5ae1e934aab30fb2e2b18e2e35a4eafcd745       363261 frotz-2.55.tar.bz2


[FILE:132:manifests/plist.primary]
%%FONTSDIR%%/
 Zork_r400-10.pcf
 Zork_r400-11.pcf
 Zork_r400-13.pcf
 Zork_r400-16.pcf
 Zork_r400-20.pcf
bin/
 frotz
 sfrotz
 xfrotz


[FILE:11:manifests/plist.dumb]
bin/dfrotz


[FILE:55:manifests/plist.man]
share/man/man6/
 dfrotz.6
 frotz.6
 sfrotz.6
 xfrotz.6


[FILE:1843:patches/patch-Makefile]
--- Makefile.orig	2025-02-01 22:36:37 UTC
+++ Makefile
@@ -63,9 +63,7 @@ ITALIC ?= yes
 
 # Select your chosen version of curses.  Unless something old is going
 # on, ncursesw should be used because that's how UTF8 is supported.
-#CURSES ?= curses
-#CURSES ?= ncurses
-CURSES ?= ncursesw
+CURSES ?= ncurses
 
 # This Makefile uses the pkgconf utility to get information on
 # installed libraries.  If your system is missing that utility and
@@ -211,47 +209,11 @@ CURSES_CFLAGS += -D_DEFAULT_SOURCE
 endif
 endif
 
-
-#############################
-# OS-specific configurations.
-# NetBSD
-ifeq ($(UNAME_S),NetBSD)
-NETBSD = yes
-CFLAGS += -D_NETBSD_SOURCE -I/usr/pkg/include
-LDFLAGS += -Wl,-R/usr/pkg/lib -L/usr/pkg/lib
-SDL_LDFLAGS += -lexecinfo
-ifeq ($(CURSES), ncursesw)
-CURSES_CFLAGS += -I/usr/pkg/include/ncursesw
-else
-CURSES_CFLAGS += -I/usr/pkg/include/ncurses
-endif
-endif
-
-# FreeBSD
-ifeq ($(UNAME_S),FreeBSD)
-FREEBSD = yes
-CFLAGS += -I/usr/local/include -D__BSD_VISIBLE=1
-LDFLAGS += -L/usr/local/lib
-SDL_LDFLAGS += -lexecinfo
-endif
-
-# OpenBSD
-ifeq ($(UNAME_S),OpenBSD)
-OPENBSD = yes
-NO_EXECINFO_H = yes
-NO_UCONTEXT_H = yes
-NO_IMMINTRIN_H = yes
-CFLAGS += -I/usr/local/include
-LDFLAGS += -L/usr/local/lib
-SDL_CFLAGS += -DSDL_DISABLE_IMMINTRIN_H
-SDL_LDFLAGS += -lexecinfo
-endif
-
 # Linux
 ifeq ($(UNAME_S),Linux)
 LINUX = yes
 CFLAGS += -D_POSIX_C_SOURCE=200809L
-NPROCS = $(shell grep -c ^processor /proc/cpuinfo)
+SDL_LDFLAGS += -ldl
 endif
 
 # macOS
@@ -374,7 +336,7 @@ SDL_DIR = $(SRCDIR)/sdl
 SDL_LIB = $(SDL_DIR)/frotz_sdl.a
 SDL_PKGS = libpng libjpeg sdl2 freetype2 zlib
 SDL_SOUND_PKGS = SDL2_mixer
-SDL_LDFLAGS += -lm
+SDL_LDFLAGS += -lm -lexecinfo_pic
 
 SUBDIRS = $(COMMON_DIR) $(CURSES_DIR) $(X11_DIR) $(SDL_DIR) $(DUMB_DIR) $(BLORB_DIR) $(DOS_DIR) $(FONTS_DIR)
 SUB_CLEAN = $(SUBDIRS:%=%-clean)


[FILE:635:patches/patch-fonts_Makefile]
--- fonts/Makefile.orig	2025-02-01 22:36:37 UTC
+++ fonts/Makefile
@@ -4,7 +4,7 @@ ZFONTSBDF = Zork_r400-10.bdf Zork_r400-1
 ZFONTSPCF = $(ZFONTSBDF:.bdf=.pcf)
 
 FONTDIR = $(DESTDIR)$(PREFIX)/share/fonts
-X11_FONTDIR = $(FONTDIR)/X11
+X11_FONTDIR = $(FONTDIR)
 X11_ZORK_FONTDIR = $(X11_FONTDIR)/zork
 
 MKFONTDIR ?= $(shell which mkfontdir)
@@ -20,8 +20,6 @@ install_pcf:	pcf
 	@echo "Installing X11 fonts to $(X11_ZORK_FONTDIR)"
 	mkdir -p $(X11_ZORK_FONTDIR)
 	install -m 644 -t $(X11_ZORK_FONTDIR) $(ZFONTSPCF)
-	$(MKFONTDIR) $(X11_ZORK_FONTDIR)
-	$(XSET) +fp $(X11_ZORK_FONTDIR)
 
 uninstall_pcf:
 	rm -f $(X11_ZORK_FONTDIR)/*pcf

