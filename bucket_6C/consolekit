# Buildsheet autogenerated by ravenadm tool -- Do not edit.

NAMEBASE=		consolekit
VERSION=		1.2.6
REVISION=		3
KEYWORDS=		sysutils
VARIANTS=		standard
SDESC[standard]=	Framework for defining and tracking users
HOMEPAGE=		https://github.com/ConsoleKit2/ConsoleKit2
CONTACT=		Michael_Reim[kraileth@elderlinux.org]

DOWNLOAD_GROUPS=	main
SITES[main]=		GITHUB/arrowd:ConsoleKit2:3ead222
DISTFILE[1]=		generated:main
DF_INDEX=		1
SPKGS[standard]=	complete
			primary
			dev
			man
			nls

OPTIONS_AVAILABLE=	X11
OPTIONS_STANDARD=	X11
OPT_ON[all]=		X11

BUILD_DEPENDS=		dbus:dev:standard
			libdrm:dev:standard
			libtool:single:standard
			openpam:dev:standard
			polkit:dev:standard
BUILDRUN_DEPENDS=	dbus:primary:standard
			libdrm:primary:standard
			openpam:primary:standard
			polkit:primary:standard

USES=			autoreconf gmake libtool pkgconfig zlib
GNOME_COMPONENTS=	glib libxslt introspection

LICENSE=		GPLv2+:primary
LICENSE_TERMS=		primary:{{WRKDIR}}/TERMS
LICENSE_FILE=		GPLv2+:{{WRKSRC}}/COPYING
LICENSE_AWK=		TERMS:"^$$"
LICENSE_SOURCE=		TERMS:{{WRKSRC}}/src/ck-session.h
LICENSE_SCHEME=		solo

FPC_EQUIVALENT=		sysutils/consolekit2

MUST_CONFIGURE=		gnu
CONFIGURE_ARGS=		--with-pid-file=/var/run/consolekit.pid
			--enable-pam-module
			--with-pam-module-dir={{PREFIX}}/lib
			--localstatedir=/var
			--enable-polkit
			--enable-introspection
			--enable-libdrm
			--disable-udev-acl
			--disable-libcgmanager
			--disable-libevdev
			--without-systemdsystemunitdir

INSTALL_TARGET=		install-strip
INSTALL_REQ_TOOLCHAIN=	yes
PLIST_SUB=		X11_SCRIPTS={{X11_SCRIPTS:U"@comment "}}

VAR_OPSYS[freebsd]=	MAKEFILE_LINE=X11_SCRIPTS=
VAR_OPSYS[sunos]=	CPPFLAGS=-DO_CLOEXEC=0
			LDFLAGS=-lintl
VAR_OPSYS[dragonfly]=	MAKEFILE_LINE=X11_SCRIPTS=
VAR_OPSYS[midnightbsd]=	MAKEFILE_LINE=X11_SCRIPTS=

[X11].CONFIGURE_WITH_BOTH=		x
[X11].XORG_COMPONENTS_ON=		x11

post-install:
.for script in hibernate hybridsleep restart stop suspend
	(cd ${STAGEDIR}${PREFIX}/lib/ConsoleKit/scripts && \
		${MV} ck-system-${script} ck-system-${script}.sample)
.endfor
	# created by script file instead
	${RM} -r ${STAGEDIR}/var/log

pre-configure:
	${REINPLACE_CMD} -e "s|http://www.oasis-open.org/docbook/xml/|file://${LOCALBASE}/share/xml/docbook/|" \
		${WRKSRC}/doc/libconsolekit/libconsolekit-docs.xml

[FILE:438:descriptions/desc.primary]
ConsoleKit is a framework for defining and tracking users, login sessions, 
and seats. It allows multiple users to be logged in at the same time and 
share hardware for their graphical session. ConsoleKit will keep track of 
those resources and whichever session is active will have use of the 
hardware at that time.

ConsoleKit2 is a fork of the ConsoleKit since that is no longer maintained 
(freedesktop chose to use logind instead).


[FILE:112:distinfo]
82e33069d903157b693f372d0f773c2345ecceccafa72131846cf15f42d4a401       260393 arrowd-ConsoleKit2-3ead222.tar.gz


[FILE:1424:manifests/plist.primary]
@sample lib/ConsoleKit/scripts/ck-system-hibernate.sample
@sample lib/ConsoleKit/scripts/ck-system-hybridsleep.sample
@sample lib/ConsoleKit/scripts/ck-system-restart.sample
@sample lib/ConsoleKit/scripts/ck-system-stop.sample
@sample lib/ConsoleKit/scripts/ck-system-suspend.sample
%%X11-ON%%@(,,4755) libexec/ck-get-x11-display-device
%%X11-ON%%libexec/ck-get-x11-server-pid
%%X11_SCRIPTS%%lib/ConsoleKit/scripts/
 ck-get-x11-display-device
 ck-get-x11-server-pid
bin/
 ck-history
 ck-launch-session
 ck-list-sessions
etc/ConsoleKit/seats.d/00-primary.seat
etc/X11/xinit/xinitrc.d/90-consolekit
etc/dbus-1/system.d/ConsoleKit.conf
etc/logrotate.d/consolekit
lib/
 libck-connector.so.0
 libck-connector.so.0.0.0
 libconsolekit.so.1
 libconsolekit.so.1.0.0
 pam_ck_connector.so
lib/girepository-1.0/libconsolekit-1.0.typelib
libexec/
 ck-collect-session-info
 ck-remove-directory
sbin/
 ck-log-system-restart
 ck-log-system-start
 ck-log-system-stop
 console-kit-daemon
share/dbus-1/interfaces/
 org.freedesktop.ConsoleKit.Manager.xml
 org.freedesktop.ConsoleKit.Seat.xml
 org.freedesktop.ConsoleKit.Session.xml
share/dbus-1/system-services/org.freedesktop.ConsoleKit.service
share/gir-1.0/libconsolekit-1.0.gir
share/polkit-1/actions/org.freedesktop.consolekit.policy
@dir /var/run/ConsoleKit
@dir etc/ConsoleKit/run-seat.d
@dir etc/ConsoleKit/run-session.d
@dir lib/ConsoleKit/run-seat.d
@dir lib/ConsoleKit/run-session.d


[FILE:189:manifests/plist.dev]
include/ConsoleKit/
 libconsolekit.h
 sd-login.h
include/ConsoleKit/ck-connector/ck-connector.h
lib/
 libck-connector.so
 libconsolekit.so
lib/pkgconfig/
 ck-connector.pc
 libconsolekit.pc


[FILE:143:manifests/plist.man]
share/man/man1/
 ck-history.1.gz
 ck-launch-session.1.gz
 ck-list-sessions.1.gz
 console-kit-daemon.1m.gz
share/man/man8/pam_ck_connector.8.gz


[FILE:219:manifests/plist.nls]
share/locale/bg/LC_MESSAGES/ConsoleKit2.mo
share/locale/es/LC_MESSAGES/ConsoleKit2.mo
share/locale/es_419/LC_MESSAGES/ConsoleKit2.mo
share/locale/fr/LC_MESSAGES/ConsoleKit2.mo
share/locale/ru/LC_MESSAGES/ConsoleKit2.mo


[FILE:423:patches/patch-configure.ac]
--- configure.ac.orig	2023-08-11 16:26:44 UTC
+++ configure.ac
@@ -201,7 +201,7 @@ case "$host" in
                 KVM_LIBS="-lkvm"
         fi
         ;;
-        *-*-freebsd* | *-*-kfreebsd*-gnu )
+        *-*-freebsd* | *-*-midnight* )
         CK_BACKEND="freebsd"
         AC_CHECK_LIB(kvm, kvm_openfiles, have_kvm=yes,
                 AC_MSG_ERROR([Unable to find libkvm which is needed on FreeBSD/DragonflyBSD]))


[FILE:191:patches/patch-doc_Makefile.am]
--- doc/Makefile.am.orig	2023-08-11 16:26:44 UTC
+++ doc/Makefile.am
@@ -1,4 +1,4 @@
-SUBDIRS = dbus libconsolekit
+SUBDIRS = dbus
 
 manpagedir = $(mandir)/man1
 manpage_DATA =            \


[FILE:863:patches/patch-hibernate]
From 961c1de02ebcdc7279f2a8d95d87598189978bdf Mon Sep 17 00:00:00 2001
From: Gleb Popov <6yearold@gmail.com>
Date: Tue, 4 Jul 2023 09:49:18 +0300
Subject: [PATCH] Allow calls to CanSuspendThenHibernate

---
 data/ConsoleKit.conf | 3 +++
 1 file changed, 3 insertions(+)

--- data/ConsoleKit.conf.orig	2023-08-11 16:26:44 UTC
+++ data/ConsoleKit.conf
@@ -56,6 +56,9 @@
            send_member="CanSuspend"/>
     <allow send_destination="org.freedesktop.ConsoleKit"
            send_interface="org.freedesktop.ConsoleKit.Manager"
+           send_member="CanSuspendThenHibernate"/>
+    <allow send_destination="org.freedesktop.ConsoleKit"
+           send_interface="org.freedesktop.ConsoleKit.Manager"
            send_member="Hibernate"/>
     <allow send_destination="org.freedesktop.ConsoleKit"
            send_interface="org.freedesktop.ConsoleKit.Manager"


[FILE:233:patches/patch-libconsolekit_sd-compat.c]
--- libconsolekit/sd-compat.c.orig	2023-08-11 16:26:44 UTC
+++ libconsolekit/sd-compat.c
@@ -38,6 +38,7 @@
 #include <sys/event.h>
 #endif
 
+#include <stdint.h>
 #include <glib.h>
 #include <glib-object.h>
 #include <glib/gstdio.h>


[FILE:182:patches/patch-libconsolekit_sd-login.h]
--- libconsolekit/sd-login.h.orig	2023-08-11 16:26:44 UTC
+++ libconsolekit/sd-login.h
@@ -1,5 +1,6 @@
 #pragma once
 
+#include <stdint.h>
 #include <sys/types.h>
 
 typedef struct


[FILE:245:patches/patch-tools_Makefile.am]
--- tools/Makefile.am.orig	2023-08-11 16:26:44 UTC
+++ tools/Makefile.am
@@ -14,6 +14,10 @@ if CK_COMPILE_FREEBSD
 SUBDIRS += freebsd
 endif
 
+if CK_COMPILE_DRAGONFLY
+SUBDIRS += freebsd
+endif
+
 if CK_COMPILE_NETBSD
 SUBDIRS += netbsd
 endif


[FILE:283:files/scripts-primary.ucl]
post-install: [{
    args: ""
    code: <<EOS
/bin/mkdir -p /var/log/ConsoleKit
/usr/bin/touch /var/log/ConsoleKit/history 
EOS
}]
pre-deinstall: [{
    args: ""
    code: <<EOS
/bin/rm -f /var/log/ConsoleKit/history
/usr/bin/find "/var/log/ConsoleKit" -type d -empty -delete
EOS
}]

