# Buildsheet autogenerated by ravenadm tool -- Do not edit.

NAMEBASE=		unrar
VERSION=		7.1.2
KEYWORDS=		archivers
VARIANTS=		std
SDESC[std]=		RAR uncompression program and library
HOMEPAGE=		https://www.rarlab.com/
CONTACT=		nobody

DOWNLOAD_GROUPS=	main
SITES[main]=		https://www.rarlab.com/rar/
DISTFILE[1]=		unrarsrc-7.1.2.tar.gz:main
DF_INDEX=		1
SPKGS[std]=		set
			primary
			dev

OPTIONS_AVAILABLE=	none
OPTIONS_STANDARD=	none

USES=			cpe ssl:openssl30 c++:primary

DISTNAME=		unrar

LICENSE=		CUSTOM1:primary
LICENSE_NAME=		CUSTOM1:"unRAR License"
LICENSE_FILE=		CUSTOM1:{{WRKSRC}}/license.txt
LICENSE_SCHEME=		solo

CPE_VENDOR=		rarlab

BUILD_TARGET=		unrar lib
MAKEFILE=		makefile

CPPFLAGS=		-I{{OPENSSLINC}}
			-DOPENSSL_AES
LDFLAGS=		-L{{OPENSSLLIB}}
			-lcrypto

do-install:
	@${MKDIR} ${STAGEDIR}${PREFIX}/include/unrar
	${INSTALL_PROGRAM} ${WRKSRC}/unrar ${STAGEDIR}${PREFIX}/bin/
	${INSTALL_DATA} ${WRKSRC}/libunrar.a ${STAGEDIR}${PREFIX}/lib/
	${INSTALL_LIB} ${WRKSRC}/libunrar.so ${STAGEDIR}${PREFIX}/lib/libunrar.so.5
	${LN} -s libunrar.so.5 ${STAGEDIR}${PREFIX}/lib/libunrar.so
	${INSTALL_DATA} ${WRKSRC}/dll.hpp ${STAGEDIR}${PREFIX}/include/unrar/dll.hpp

[FILE:428:descriptions/desc.primary]
The unRAR utility is a freeware program, distributed with source code and
developed for extracting, testing and viewing the contents of archives
created with the RAR archiver, version 1.50 and above.

The UnRAR library and utility are a minor part of the RAR archiver and
contain the RAR uncompression algorithm. UnRAR requires a very small
amount of memory to operate. It can be used by other programs to extract
RAR archives.


[FILE:100:distinfo]
143dcacb3a9d9ca0af695adecabe1350b0a3e93d927a065ef8f7cc605ab2d322       264081 unrarsrc-7.1.2.tar.gz


[FILE:28:manifests/plist.primary]
bin/unrar
lib/libunrar.so.5


[FILE:52:manifests/plist.dev]
include/unrar/dll.hpp
lib/
 libunrar.a
 libunrar.so


[FILE:1699:patches/patch-makefile]
--- makefile.orig	2024-08-19 08:26:32 UTC
+++ makefile
@@ -5,14 +5,14 @@
 # 2024.08.19: -march=native isn't recognized on some platforms such as RISCV64.
 # Thus we removed it. Clang ARM users can add -march=armv8-a+crypto to enable
 # ARM NEON crypto.
-CXX=c++
-CXXFLAGS=-O2 -std=c++11 -Wno-logical-op-parentheses -Wno-switch -Wno-dangling-else
-LIBFLAGS=-fPIC
-DEFINES=-D_FILE_OFFSET_BITS=64 -D_LARGEFILE_SOURCE -DRAR_SMP
-STRIP=strip
-AR=ar
-LDFLAGS=-pthread
-DESTDIR=/usr
+CXX?=		c++
+CXXFLAGS?=	-O2 -std=c++11 -Wno-logical-op-parentheses -Wno-switch -Wno-dangling-else
+LIBFLAGS=	-fPIC
+DEFINES=	-D_FILE_OFFSET_BITS=64 -D_LARGEFILE_SOURCE -DRAR_SMP
+STRIP?=	strip
+AR?=		ar
+LDFLAGS+=	-pthread
+DESTDIR?=	/usr
 
 ##########################
 
@@ -30,9 +30,16 @@ OBJECTS=rar.o strlist.o strfn.o pathfn.o
 	rijndael.o getbits.o sha1.o sha256.o blake2s.o hash.o extinfo.o extract.o volume.o \
 	list.o find.o unpack.o headers.o threadpool.o rs16.o cmddata.o ui.o largepage.o
 
+.SUFFIXES:	.so
+
+SOBJECTS=	${OBJECTS:.o=.so} ${LIB_OBJ:.o=.so}
+
 .cpp.o:
 	$(COMPILE) -D$(WHAT) -c $<
 
+.cpp.so:
+	$(COMPILE) -DRARDLL -fPIC -o ${.TARGET} -c ${.IMPSRC}
+
 all:	unrar
 
 install:	install-unrar
@@ -58,12 +65,10 @@ sfx:	$(OBJECTS)
 	$(LINK) -o default.sfx $(LDFLAGS) $(OBJECTS)
 	$(STRIP) default.sfx
 
-lib:	WHAT=RARDLL
-lib:	CXXFLAGS+=$(LIBFLAGS)
-lib:	$(OBJECTS) $(LIB_OBJ)
+lib:	$(SOBJECTS)
 	@rm -f libunrar.*
-	$(LINK) -shared -o libunrar.so $(LDFLAGS) $(OBJECTS) $(LIB_OBJ)
-	$(AR) rcs libunrar.a $(OBJECTS) $(LIB_OBJ)
+	$(LINK) -shared -o libunrar.so $(LDFLAGS) -Wl,-soname,libunrar.so.5 $(SOBJECTS)
+	$(AR) rcs libunrar.a $(SOBJECTS)
 
 install-unrar:
 			install -D unrar $(DESTDIR)/bin/unrar


[FILE:206:patches/patch-os.hpp]
--- os.hpp.orig	2024-12-04 10:00:42 UTC
+++ os.hpp
@@ -170,6 +170,10 @@
 #endif
 #endif
 
+#ifdef OPENSSL_AES
+#include <openssl/evp.h>
+#endif // OPENSSL_AES
+
 #ifdef  S_IFLNK
 #define SAVE_LINKS
 #endif

