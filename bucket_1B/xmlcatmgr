# Buildsheet autogenerated by ravenadm tool -- Do not edit.

NAMEBASE=		xmlcatmgr
VERSION=		2.2
REVISION=		5
KEYWORDS=		textproc
VARIANTS=		std
SDESC[std]=		SGML and XML catalog manager
HOMEPAGE=		https://xmlcatmgr.sourceforge.net/
CONTACT=		nobody

DOWNLOAD_GROUPS=	main
SITES[main]=		SF/xmlcatmgr/xmlcatmgr/2.2
DISTFILE[1]=		xmlcatmgr-2.2.tar.gz:main
DF_INDEX=		1
SPKGS[std]=		set
			primary
			man

OPTIONS_AVAILABLE=	none
OPTIONS_STANDARD=	none

LICENSE=		BSD3CLAUSE:primary
LICENSE_FILE=		BSD3CLAUSE:{{WRKSRC}}/COPYING
LICENSE_SCHEME=		solo

FPC_EQUIVALENT=		textproc/xmlcatmgr

MUST_CONFIGURE=		gnu
CONFIGURE_ARGS=		--disable-docs
			DEFAULT_CATALOG_SGML={{PREFIX}}/share/sgml/catalog.ports
			DEFAULT_CATALOG_XML={{PREFIX}}/share/xml/catalog.ports

SUB_FILES=		scripts-primary.ucl
			messages-primary.ucl
			refresh_xmlcatmgr_catalogs
SUB_LIST=		CATALOG_MASTER_SGML={{PREFIX}}/share/sgml/catalog
			CATALOG_MASTER_XML={{PREFIX}}/share/xml/catalog
			CATALOG_PORTS_SGML={{PREFIX}}/share/sgml/catalog.ports
			CATALOG_PORTS_XML={{PREFIX}}/share/xml/catalog.ports
			XMLCATMGR={{PREFIX}}/bin/xmlcatmgr

post-install:
	${INSTALL_SCRIPT} ${WRKDIR}/refresh_xmlcatmgr_catalogs \
		${STAGEDIR}${PREFIX}/bin/

[FILE:578:descriptions/desc.primary]
XML Catalog Manager (xmlcatmgr in its short form) is a small utility
used to manipulate SGML and XML catalogs.  It is extremely small and
lightweight, specially designed to be run from packaging systems.
Basically, it allows adding and removing entries from catalogs in a
completely automated way.

A catalog is a lookup mechanism used to translate entities into other
different entities.  They can, for example, map public identifiers to
local files or URIs.  This allows you to tell the parser where to look
for entities without having to modify the original document source.


[FILE:99:distinfo]
ea1142b6aef40fbd624fc3e2130cf10cf081b5fa88e5229c92b8f515779d6fdc        97265 xmlcatmgr-2.2.tar.gz


[FILE:44:manifests/plist.primary]
bin/
 refresh_xmlcatmgr_catalogs
 xmlcatmgr


[FILE:27:manifests/plist.man]
share/man/man1/xmlcatmgr.1


[FILE:689:files/messages-primary.ucl.in]
primary: {
  type: "install"
  message: <<EOM
The following catalogs are installed:

 1) %%PREFIX%%/share/sgml/catalog

   The top level catalog for SGML stuff.  It is not changed
   by any packages other than xmlcatmgr.

 2) %%PREFIX%%/share/sgml/catalog.ports

   This catalog is for handling SGML stuff installed under
   %%PREFIX%%/share/sgml.  It may be altered by other packages.

 3) %%PREFIX%%/share/xml/catalog

   The top level catalog for XML stuff.  It is not changed
   by any packages other than xmlcatmgr.

 4) %%PREFIX%%/share/xml/catalog.ports

   This catalog is for handling XML stuff installed under
   %%PREFIX%%/share/xml.  It may be altered by other packages.
EOM
}


[FILE:1414:files/refresh_xmlcatmgr_catalogs.in]
#!/bin/sh

PATH=/bin:/usr/bin:%%LOCALBASE%%/bin

export PATH
XMLCATMGR=%%XMLCATMGR%%
CATALOG_MASTER_SGML=%%CATALOG_MASTER_SGML%%
CATALOG_MASTER_XML=%%CATALOG_MASTER_XML%%
CATALOG_PORTS_SGML=%%CATALOG_PORTS_SGML%%
CATALOG_PORTS_XML=%%CATALOG_PORTS_XML%%

echo "xmlcatmgr: deleting existing catalogs"
${XMLCATMGR} -sc ${CATALOG_MASTER_SGML} remove CATALOG catalog.ports
${XMLCATMGR} -c ${CATALOG_MASTER_XML} remove nextCatalog ${CATALOG_PORTS_XML}

rm -f ${CATALOG_MASTER_SGML}
rm -f ${CATALOG_PORTS_SGML}
rm -f ${CATALOG_MASTER_XML}
rm -f ${CATALOG_PORTS_XML}


echo "xmlcatmgr: Creating ${CATALOG_MASTER_SGML}"
${XMLCATMGR} -sc ${CATALOG_MASTER_SGML} create
echo "xmlcatmgr: Creating ${CATALOG_PORTS_SGML}"
${XMLCATMGR} -sc ${CATALOG_PORTS_SGML} create
echo "xmlcatmgr: Creating ${CATALOG_MASTER_XML}"
${XMLCATMGR} -c ${CATALOG_MASTER_XML} create
echo "xmlcatmgr: Creating ${CATALOG_PORTS_XML}"
${XMLCATMGR} -c ${CATALOG_PORTS_XML} create

if ! ${XMLCATMGR} -sc ${CATALOG_MASTER_SGML} lookup catalog.ports > /dev/null 2>&1; then
	echo "xmlcatmgr: Registering CATALOG catalog.ports (SGML)"
	${XMLCATMGR} -sc ${CATALOG_MASTER_SGML} add CATALOG catalog.ports
fi

if ! ${XMLCATMGR} -c ${CATALOG_MASTER_XML} lookup ${CATALOG_PORTS_XML} > /dev/null 2>&1 ; then
	echo "xmlcatmgr: Registering nextCatalog catalog.ports (XML)"
	${XMLCATMGR} -c ${CATALOG_MASTER_XML} add nextCatalog ${CATALOG_PORTS_XML}
fi

echo "complete"


[FILE:3378:files/scripts-primary.ucl.in]
post-install: [{
     args: ""
     code: <<EOS
PATH=/bin:/usr/bin:%%LOCALBASE%%/bin

export PATH
XMLCATMGR="%%XMLCATMGR%%"
CATALOG_MASTER_SGML="%%CATALOG_MASTER_SGML%%"
CATALOG_MASTER_XML="%%CATALOG_MASTER_XML%%"
CATALOG_PORTS_SGML="%%CATALOG_PORTS_SGML%%"
CATALOG_PORTS_XML="%%CATALOG_PORTS_XML%%"

SGML_DIR=$(dirname "${CATALOG_MASTER_SGML}")
XML_DIR=$(dirname "${CATALOG_MASTER_XML}")

if [ ! -d "${SGML_DIR}" ]; then
   echo " + Creating ${SGML_DIR} directory"
   mkdir -p "${SGML_DIR}"
fi

if [ ! -r ${CATALOG_MASTER_SGML} ]; then
	echo " + Creating ${CATALOG_MASTER_SGML}"
	${XMLCATMGR} -sc "${CATALOG_MASTER_SGML}" create
fi

if ! ${XMLCATMGR} -sc ${CATALOG_MASTER_SGML} lookup catalog.ports > /dev/null 2>&1; then
	echo " + Registering CATALOG catalog.ports (SGML)"
	${XMLCATMGR} -sc "${CATALOG_MASTER_SGML}" add CATALOG catalog.ports
fi

if [ ! -r ${CATALOG_PORTS_SGML} ]; then
	echo " + Creating ${CATALOG_PORTS_SGML}"
	${XMLCATMGR} -sc "${CATALOG_PORTS_SGML}" create
fi

if [ ! -d "${XML_DIR}" ]; then
   echo " + Creating ${XML_DIR} directory"
   mkdir -p "${XML_DIR}"
fi

if [ ! -r ${CATALOG_MASTER_XML} ]; then
	echo " + Creating ${CATALOG_MASTER_XML}"
	${XMLCATMGR} -c "${CATALOG_MASTER_XML}" create
fi

if ! ${XMLCATMGR} -c ${CATALOG_MASTER_XML} lookup ${CATALOG_PORTS_XML} > /dev/null 2>&1 ; then
	echo " + Registering nextCatalog catalog.ports (XML)"
	${XMLCATMGR} -c "${CATALOG_MASTER_XML}" add nextCatalog "${CATALOG_PORTS_XML}"
fi

if [ ! -r ${CATALOG_PORTS_XML} ]; then
	echo " + Creating ${CATALOG_PORTS_XML}"
	${XMLCATMGR} -c "${CATALOG_PORTS_XML}" create
fi
EOS
}]
pre-deinstall-lua: [{
     args: ""
     code: <<EOS
function dirname(str)
	strx = str:match("(.*".. "/" ..")")
	return strx:sub(1, #strx - 1)
end

XMLCATMGR = "%%XMLCATMGR%%"
CATALOG_MASTER_SGML = "%%CATALOG_MASTER_SGML%%"
CATALOG_MASTER_XML = "%%CATALOG_MASTER_XML%%"
CATALOG_PORTS_SGML = "%%CATALOG_PORTS_SGML%%"
CATALOG_PORTS_XML = "%%CATALOG_PORTS_XML%%"

T = "/tmp/catalog." .. math.random (100000, 999999)

------------
--  SGML  --
------------

pkg.exec({XMLCATMGR, "-sc", CATALOG_MASTER_SGML, "remove", "CATALOG", "catalog.ports"})
pkg.exec({XMLCATMGR, "-sc", T, "create"})

if pkg.filecmp(CATALOG_MASTER_SGML, T) == 0 then
   pkg.print_msg(" + Removing " .. CATALOG_MASTER_SGML .. ".  (empty)")
   os.remove(CATALOG_MASTER_SGML)
end

if pkg.filecmp(CATALOG_PORTS_SGML, T) == 0 then
   pkg.print_msg(" + Removing " .. CATALOG_PORTS_SGML .. ".  (empty)")
   os.remove(CATALOG_PORTS_SGML)
end
os.remove(T)

sgml_dir = dirname (CATALOG_MASTER_SGML)
local sres = pkg.readdir(sgml_dir)
if #sres == 0 then
        pkg.print_msg(" + Removing " .. sgml_dir .. " directory")
	os.remove(sgml_dir)
end


-----------
--  XML  --
-----------

pkg.exec({XMLCATMGR, "-c", CATALOG_MASTER_XML, "remove", "nextCatalog", CATALOG_PORTS_XML})
pkg.exec({XMLCATMGR, "-c", T, "create"})

if pkg.filecmp(CATALOG_MASTER_XML, T) == 0 then
   pkg.print_msg(" + Removing " .. CATALOG_MASTER_XML .. ".  (empty)")
   os.remove(CATALOG_MASTER_XML)
end

if pkg.filecmp(CATALOG_PORTS_XML, T) == 0 then
   pkg.print_msg(" + Removing " .. CATALOG_PORTS_XML .. ".  (empty)")
   os.remove(CATALOG_PORTS_XML)
end
os.remove(T)

xml_dir = dirname (CATALOG_MASTER_XML)
local xres = pkg.readdir(xml_dir)
if #xres == 0 then
        pkg.print_msg(" + Removing " .. xml_dir .. " directory")
	os.remove(xml_dir)
end

EOS
}]

