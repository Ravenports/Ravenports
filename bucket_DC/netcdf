# Buildsheet autogenerated by ravenadm tool -- Do not edit.

NAMEBASE=		netcdf
VERSION=		4.9.3
REVISION=		1
KEYWORDS=		science
VARIANTS=		std
SDESC[std]=		Network Common Data Form
HOMEPAGE=		https://www.unidata.ucar.edu/software/netcdf/
CONTACT=		nobody

DOWNLOAD_GROUPS=	main
SITES[main]=		GITHUB/Unidata:netcdf-c:v4.9.3
DISTFILE[1]=		generated:main
DF_INDEX=		1
SPKGS[std]=		set
			primary
			dev
			tools
			man

OPTIONS_AVAILABLE=	none
OPTIONS_STANDARD=	none

BUILD_DEPENDS=		hdf5:dev:std
			hdf5:cxx:std
			hdf5:fort:std
			hdf5:tools:std
			curl:dev:std
			libzip:dev:std
BUILDRUN_DEPENDS=	hdf5:primary:std
			curl:primary:std
			libzip:primary:std
EXRUN[tools]=		primary

USES=			cmake zstd zlib bz2
GNOME_COMPONENTS=	libxml2

LICENSE=		BSD3CLAUSE:primary
LICENSE_FILE=		BSD3CLAUSE:{{WRKSRC}}/COPYRIGHT
LICENSE_SCHEME=		solo

FPC_EQUIVALENT=		science/netcdf

SOVERSION=		22.1.0

CMAKE_ARGS=		-DNETCDF_ENABLE_EXAMPLES:BOOL=OFF

pre-configure-netbsd:
	# disable mremap
	${REINPLACE_CMD} -e '/HAVE_MREMAP/d' ${WRKSRC}/CMakeLists.txt

post-install:
	${STRIP_CMD} ${STAGEDIR}${PREFIX}/bin/nc[cdg]*
	${STRIP_CMD} ${STAGEDIR}${PREFIX}/lib/libnetcdf.so

[FILE:442:descriptions/desc.primary]
NetCDF (Network Common Data Form) is a set of software libraries and
machine-independent data formats that support the creation, access,
and sharing of array-oriented scientific data. It is also a community
standard for sharing scientific data. The Unidata Program Center
supports and maintains netCDF programming interfaces for C, C++, Java,
and Fortran. Programming interfaces are also available for Python, IDL,
MATLAB, R, Ruby, and Perl.


[FILE:36:descriptions/desc.tools]
This package contains netcdf tools.


[FILE:108:distinfo]
990f46d49525d6ab5dc4249f8684c6deeaf54de6fec63a187e9fb382cc0ffdff     25619216 Unidata-netcdf-c-4.9.3.tar.gz


[FILE:42:manifests/plist.primary]
lib/
 libnetcdf.settings
 libnetcdf.so.22


[FILE:311:manifests/plist.dev]
include/
 netcdf.h
 netcdf_aux.h
 netcdf_dispatch.h
 netcdf_filter.h
 netcdf_filter_build.h
 netcdf_json.h
 netcdf_mem.h
 netcdf_meta.h
 netcdf_proplist.h
lib/libnetcdf.so
lib/cmake/netCDF/
 netCDFConfig.cmake
 netCDFConfigVersion.cmake
 netCDFTargets-release.cmake
 netCDFTargets.cmake
lib/pkgconfig/netcdf.pc


[FILE:47:manifests/plist.tools]
bin/
 nc-config
 nccopy
 ncdump
 ncgen
 ncgen3


[FILE:79:manifests/plist.man]
share/man/man1/
 nccopy.1
 ncdump.1
 ncgen.1
 ncgen3.1
share/man/man3/netcdf.3


[FILE:513:patches/patch-libhdf5_H5FDhttp.c]
--- libhdf5/H5FDhttp.c.orig	2025-02-07 21:40:00 UTC
+++ libhdf5/H5FDhttp.c
@@ -49,14 +49,6 @@
 Define a simple #ifdef test for the version of H5FD_class_t we are using 
 */
 
-#if H5_VERS_MAJOR == 1
-#if H5_VERS_MINOR < 10
-#define H5FDCLASS1 1
-#endif
-#else
-#error "Cannot determine version of H5FD_class_t"
-#endif
-
 #ifdef H5_HAVE_WIN32_API
 /* The following two defines must be before any windows headers are included */
 #define WIN32_LEAN_AND_MEAN    /* Exclude rarely-used stuff from Windows headers */


[FILE:354:patches/patch-libhdf5_H5FDhttp.h]
Support HDF5 version 2.0+

--- libhdf5/H5FDhttp.h.orig	2025-02-07 21:40:00 UTC
+++ libhdf5/H5FDhttp.h
@@ -31,7 +31,7 @@
 
 #if H5_VERSION_GE(1,13,2)
 #define H5_VFD_HTTP     ((H5FD_class_value_t)(514))
-#define H5FD_HTTP	(H5FDperform_init(H5FD_http_init))
+#define H5FD_HTTP	(H5OPEN H5FD_http_init())
 #else
 #define H5FD_HTTP	(H5FD_http_init())
 #endif


[FILE:448:patches/patch-nczarr__test_ncdumpchunks.c]
--- nczarr_test/ncdumpchunks.c.orig	2025-02-07 21:40:00 UTC
+++ nczarr_test/ncdumpchunks.c
@@ -412,7 +412,7 @@ dump(Format* format)
 #ifdef H5
 	case NC_FORMATX_NC_HDF5: {
 	    for(i=0;i<format->rank;i++) hoffset[i] = (hsize_t)offset[i];
-	    if(H5Dread_chunk(datasetid, dxpl_id, hoffset, &filter_mask, chunkdata) < 0)
+	    if(H5Dread_chunk1(datasetid, dxpl_id, hoffset, &filter_mask, chunkdata) < 0)
 	        holechunk = 1;
 	} break;
 #endif

