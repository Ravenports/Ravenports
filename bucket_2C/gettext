# Buildsheet autogenerated by ravenadm tool -- Do not edit.

NAMEBASE=		gettext
VERSION=		0.22.5
KEYWORDS=		devel
VARIANTS=		std
SDESC[std]=		GNU internationalization and localization system
HOMEPAGE=		http://www.gnu.org/software/gettext/
CONTACT=		nobody

DOWNLOAD_GROUPS=	main
SITES[main]=		GNU/gettext
DISTFILE[1]=		gettext-0.22.5.tar.xz:main
DF_INDEX=		1
SPKGS[std]=		set
			primary
			asprintf
			tools
			bldtools
			dev
			solinks
			nls
			man
			docs
			info

OPTIONS_AVAILABLE=	none
OPTIONS_STANDARD=	none

EXRUN[tools]=		primary
EXRUN[bldtools]=	primary

USES=			charsetfix cpe libtool iconv:build c++:asprintf

LICENSE=		GPLv3+:primary LGPL21+:primary
LICENSE_TERMS=		primary:{{WRKDIR}}/TERMS
LICENSE_FILE=		GPLv3+:{{WRKSRC}}/COPYING
			LGPL21+:{{WRKSRC}}/gettext-runtime/intl/COPYING.LIB
LICENSE_SCHEME=		multi

INFO=			info:autosprintf
			info:gettext
CPE_PRODUCT=		gettext
CPE_VENDOR=		gnu
FPC_EQUIVALENT=		devel/gettext
INFO_SUBDIR=		.

MUST_CONFIGURE=		gnu
CONFIGURE_ARGS=		--disable-csharp
			--disable-java
			--disable-openmp
			--with-included-glib
			--with-included-libcroco
			--with-included-libunistring
			--with-included-libxml
			--with-xz
			--without-emacs
			--without-git
CONFIGURE_ENV=		ac_cv_lib_rt_sched_yield=no

INSTALL_TARGET=		install-strip
INSTALL_REQ_TOOLCHAIN=	yes
SOVERSION=		0.22.5
PLIST_SUB=		VERSION=0.22
			PO_SOVERSION=0.5.10
			PO_SOMAJOR=0
			LIBINTL=8.4.0
			GTS_SOMAJOR=0
			GTS_SOVERSION=0.2.1
			EXTERNAL={{EXTERNAL}}

TEST_TARGET=		check

post-install:
	${MV} ${STAGEDIR}${PREFIX}/share/gettext-0.22.5 \
		${STAGEDIR}${PREFIX}/share/gettext/0.22
.if "${.MAKE.OS.NAME}" == "Linux"
	${STRIP_CMD} ${STAGEDIR}${PREFIX}/lib/preloadable_libintl.so
.else
	${STRIP_CMD} ${STAGEDIR}${PREFIX}/lib/libintl.${LIBEXT}
.endif
	${RM} ${STAGEDIR}${PREFIX}/share/info/libtextstyle.info

pre-configure:
	# Do not install csharp and java documentation.
	${REINPLACE_CMD} -E '/^SUBDIRS =/s/(intl-csharp|intl-java)//g' \
		${WRKSRC}/gettext-runtime/Makefile.in
	# Do not install html copies of manpages.
	${REINPLACE_CMD} \
		-e '/^all-local:/s/html-local//' \
		-e '/^install-data-local:/s/install-html//' \
		-e '/^installdirs-local:/s/installdirs-html//' \
		${WRKSRC}/gettext-runtime/libasprintf/Makefile.in \
		${WRKSRC}/gettext-runtime/man/Makefile.in
	# use libiconv_pic.a instead of libiconv.so
	${REINPLACE_CMD} -e "s|names_next_round='iconv '|names_next_round='iconv_pic '|" \
		${WRKSRC}/gettext-tools/configure \
		${WRKSRC}/gettext-runtime/configure \
		${WRKSRC}/gettext-runtime/intl/configure \
		${WRKSRC}/libtextstyle/configure

post-extract:
	${AWK} '/HAVE_CONFIG_H/ {exit}; {print}' \
		${WRKSRC}/gettext-runtime/src/gettext.c > ${WRKDIR}/TERMS
	${AWK} '/HAVE_CONFIG_H/ {exit}; {print}' \
		${WRKSRC}/gettext-runtime/intl/textdomain.c >> ${WRKDIR}/TERMS

[FILE:148:descriptions/desc.primary]
GNU gettext is a framework of libraries and tools for internationalisation
and localisation of software.

This package contains the shared library.


[FILE:194:descriptions/desc.asprintf]
GNU gettext is a framework of libraries and tools for internationalisation
and localisation of software.

This package contains the asprintf library which has a runtime dependency
on libstdc++.


[FILE:159:descriptions/desc.tools]
GNU gettext is a framework of libraries and tools for internationalisation
and localisation of software.

This package contains gettext command line programs.


[FILE:163:descriptions/desc.bldtools]
GNU gettext is a framework of libraries and tools for internationalisation
and localisation of software.

This package contains development and translation tools.


[FILE:230:descriptions/desc.solinks]
GNU gettext is a framework of libraries and tools for internationalisation
and localisation of software.

This package contains symbolic links to the shared libraries, and are
used when needing to link to the shared intl library.


[FILE:100:distinfo]
fe10c37353213d78a5b83d48af231e005c4da84db5ce88037d88355938259640     10270724 gettext-0.22.5.tar.xz


[FILE:134:manifests/plist.primary]
%%EXTERNAL%%lib/
 libintl.so.%%LIBINTL%%
 libintl.so.8
%%EXTERNAL%%share/locale/locale.alias
%%ONLY-LINUX%%lib/preloadable_libintl.so


[FILE:45:manifests/plist.asprintf]
lib/
 libasprintf.so.0
 libasprintf.so.0.0.0


[FILE:46:manifests/plist.tools]
bin/
 envsubst
 gettext
 gettext.sh
 ngettext


[FILE:1262:manifests/plist.bldtools]
bin/
 autopoint
 gettextize
 msgattrib
 msgcat
 msgcmp
 msgcomm
 msgconv
 msgen
 msgexec
 msgfilter
 msgfmt
 msggrep
 msginit
 msgmerge
 msgunfmt
 msguniq
 recode-sr-latin
 xgettext
lib/
 libgettextlib-%%SOVERSION%%.so
 libgettextpo.so.%%PO_SOMAJOR%%
 libgettextpo.so.%%PO_SOVERSION%%
 libgettextsrc-%%SOVERSION%%.so
 libtextstyle.so.%%GTS_SOMAJOR%%
 libtextstyle.so.%%GTS_SOVERSION%%
lib/gettext/
 cldr-plurals
 hostname
 project-id
 urlget
 user-email
share/gettext/
 ABOUT-NLS
 archive.dir.tar.xz
 config.rpath
 gettext.h
 javaversion.class
 msgunfmt.tcl
share/gettext/%%VERSION%%/its/
 glade.loc
 glade1.its
 glade2.its
 gsettings.its
 gsettings.loc
 gtkbuilder.its
 metainfo.its
 metainfo.loc
share/gettext/po/
 Makefile.in.in
 Makevars.template
 Rules-quot
 boldquot.sed
 en@boldquot.header
 en@quot.header
 insert-header.sin
 quot.sed
 remove-potcdate.sin
share/gettext/projects/
 index
 team-address
share/gettext/projects/GNOME/
 team-address
 teams.html
 teams.url
 trigger
share/gettext/projects/KDE/
 team-address
 teams.html
 teams.url
 trigger
share/gettext/projects/TP/
 team-address
 teams.html
 teams.url
 trigger
share/gettext/styles/
 po-default.css
 po-emacs-x.css
 po-emacs-xterm.css
 po-emacs-xterm16.css
 po-emacs-xterm256.css
 po-vim.css


[FILE:419:manifests/plist.dev]
%%EXTERNAL%%include/libintl.h
%%EXTERNAL%%lib/
 libintl.a
 libintl_pic.a
include/
 autosprintf.h
 gettext-po.h
 textstyle.h
include/textstyle/
 stdbool.h
 version.h
 woe32dll.h
lib/
 libasprintf.a
 libgettextlib.a
 libgettextpo.a
 libgettextsrc.a
 libtextstyle.a
share/aclocal/
 build-to-host.m4
 gettext.m4
 host-cpu-c-abi.m4
 iconv.m4
 intlmacosx.m4
 lib-ld.m4
 lib-link.m4
 lib-prefix.m4
 nls.m4
 po.m4
 progtest.m4


[FILE:118:manifests/plist.solinks]
%%EXTERNAL%%lib/libintl.so
lib/
 libasprintf.so
 libgettextlib.so
 libgettextpo.so
 libgettextsrc.so
 libtextstyle.so


[FILE:2831:manifests/plist.nls]
share/locale/ast/LC_MESSAGES/gettext-runtime.mo
share/locale/be/LC_MESSAGES/
 gettext-runtime.mo
 gettext-tools.mo
share/locale/bg/LC_MESSAGES/
 gettext-runtime.mo
 gettext-tools.mo
share/locale/ca/LC_MESSAGES/
 gettext-runtime.mo
 gettext-tools.mo
share/locale/cs/LC_MESSAGES/
 gettext-runtime.mo
 gettext-tools.mo
share/locale/da/LC_MESSAGES/
 gettext-runtime.mo
 gettext-tools.mo
share/locale/de/LC_MESSAGES/
 gettext-runtime.mo
 gettext-tools.mo
share/locale/el/LC_MESSAGES/
 gettext-runtime.mo
 gettext-tools.mo
share/locale/en@boldquot/LC_MESSAGES/
 gettext-runtime.mo
 gettext-tools.mo
share/locale/en@quot/LC_MESSAGES/
 gettext-runtime.mo
 gettext-tools.mo
share/locale/eo/LC_MESSAGES/gettext-runtime.mo
share/locale/es/LC_MESSAGES/
 gettext-runtime.mo
 gettext-tools.mo
share/locale/et/LC_MESSAGES/
 gettext-runtime.mo
 gettext-tools.mo
share/locale/eu/LC_MESSAGES/gettext-tools.mo
share/locale/fi/LC_MESSAGES/
 gettext-runtime.mo
 gettext-tools.mo
share/locale/fr/LC_MESSAGES/
 gettext-runtime.mo
 gettext-tools.mo
share/locale/ga/LC_MESSAGES/gettext-runtime.mo
share/locale/gl/LC_MESSAGES/
 gettext-runtime.mo
 gettext-tools.mo
share/locale/hr/LC_MESSAGES/
 gettext-runtime.mo
 gettext-tools.mo
share/locale/hu/LC_MESSAGES/gettext-runtime.mo
share/locale/id/LC_MESSAGES/
 gettext-runtime.mo
 gettext-tools.mo
share/locale/it/LC_MESSAGES/
 gettext-runtime.mo
 gettext-tools.mo
share/locale/ja/LC_MESSAGES/
 gettext-runtime.mo
 gettext-tools.mo
share/locale/ka/LC_MESSAGES/
 gettext-runtime.mo
 gettext-tools.mo
share/locale/ko/LC_MESSAGES/
 gettext-runtime.mo
 gettext-tools.mo
share/locale/nb/LC_MESSAGES/
 gettext-runtime.mo
 gettext-tools.mo
share/locale/nl/LC_MESSAGES/
 gettext-runtime.mo
 gettext-tools.mo
share/locale/nn/LC_MESSAGES/
 gettext-runtime.mo
 gettext-tools.mo
share/locale/pa/LC_MESSAGES/gettext-tools.mo
share/locale/pl/LC_MESSAGES/
 gettext-runtime.mo
 gettext-tools.mo
share/locale/pt/LC_MESSAGES/
 gettext-runtime.mo
 gettext-tools.mo
share/locale/pt_BR/LC_MESSAGES/
 gettext-runtime.mo
 gettext-tools.mo
share/locale/ro/LC_MESSAGES/
 gettext-runtime.mo
 gettext-tools.mo
share/locale/ru/LC_MESSAGES/
 gettext-runtime.mo
 gettext-tools.mo
share/locale/sk/LC_MESSAGES/
 gettext-runtime.mo
 gettext-tools.mo
share/locale/sl/LC_MESSAGES/
 gettext-runtime.mo
 gettext-tools.mo
share/locale/sr/LC_MESSAGES/
 gettext-runtime.mo
 gettext-tools.mo
share/locale/sv/LC_MESSAGES/
 gettext-runtime.mo
 gettext-tools.mo
share/locale/tr/LC_MESSAGES/
 gettext-runtime.mo
 gettext-tools.mo
share/locale/uk/LC_MESSAGES/
 gettext-runtime.mo
 gettext-tools.mo
share/locale/vi/LC_MESSAGES/
 gettext-runtime.mo
 gettext-tools.mo
share/locale/zh_CN/LC_MESSAGES/
 gettext-runtime.mo
 gettext-tools.mo
share/locale/zh_HK/LC_MESSAGES/gettext-runtime.mo
share/locale/zh_TW/LC_MESSAGES/
 gettext-runtime.mo
 gettext-tools.mo


[FILE:504:manifests/plist.man]
share/man/man1/
 autopoint.1.gz
 envsubst.1.gz
 gettext.1.gz
 gettextize.1.gz
 msgattrib.1.gz
 msgcat.1.gz
 msgcmp.1.gz
 msgcomm.1.gz
 msgconv.1.gz
 msgen.1.gz
 msgexec.1.gz
 msgfilter.1.gz
 msgfmt.1.gz
 msggrep.1.gz
 msginit.1.gz
 msgmerge.1.gz
 msgunfmt.1.gz
 msguniq.1.gz
 ngettext.1.gz
 recode-sr-latin.1.gz
 xgettext.1.gz
share/man/man3/
 bind_textdomain_codeset.3.gz
 bindtextdomain.3.gz
 dcgettext.3.gz
 dcngettext.3.gz
 dgettext.3.gz
 dngettext.3.gz
 gettext.3.gz
 ngettext.3.gz
 textdomain.3.gz


[FILE:1133:patches/patch-gettext-runtime_configure]
--- gettext-runtime/configure.orig	2024-02-21 16:36:00 UTC
+++ gettext-runtime/configure
@@ -23313,7 +23313,7 @@ extern
 "C"
 #endif
 const char *_nl_expand_alias (const char *);
-#define __GNU_GETTEXT_SYMBOL_EXPRESSION (_nl_msg_cat_cntr + *_nl_expand_alias (""))
+#define __GNU_GETTEXT_SYMBOL_EXPRESSION (_nl_msg_cat_cntr)
 #else
 #define __GNU_GETTEXT_SYMBOL_EXPRESSION 0
 #endif
@@ -23358,7 +23358,7 @@ extern
 "C"
 #endif
 const char *_nl_expand_alias (const char *);
-#define __GNU_GETTEXT_SYMBOL_EXPRESSION (_nl_msg_cat_cntr + *_nl_expand_alias (""))
+#define __GNU_GETTEXT_SYMBOL_EXPRESSION (_nl_msg_cat_cntr)
 #else
 #define __GNU_GETTEXT_SYMBOL_EXPRESSION 0
 #endif
@@ -29426,7 +29426,7 @@ then :
              # On Solaris 10 or newer, this test is no longer needed, because
              # libc contains the fully functional pthread functions.
              case "$host_os" in
-               solaris | solaris2.[1-9] | solaris2.[1-9].* | hpux*)
+               solaris | solaris2.[1-9] | solaris2.[1-9].* | hpux* | freebsd* | midnight* | dragon*)
 
 printf "%s\n" "#define PTHREAD_IN_USE_DETECTION_HARD 1" >>confdefs.h
 


[FILE:1015:patches/patch-gettext-runtime_intl_gnulib-lib_glthread_threadlib.c]
--- gettext-runtime/intl/gnulib-lib/glthread/threadlib.c.orig	2024-02-21 10:43:51 UTC
+++ gettext-runtime/intl/gnulib-lib/glthread/threadlib.c
@@ -62,11 +62,10 @@ glthread_in_use (void)
 
 /* Test using pthread_create.  */
 
-/* The function to be executed by a dummy thread.  */
-static void *
-dummy_thread_func (void *arg)
+static pthread_once_t dummy_once_control = PTHREAD_ONCE_INIT;
+static void
+dummy_once_func (void)
 {
-  return arg;
 }
 
 int
@@ -77,19 +76,10 @@ glthread_in_use (void)
 
   if (!tested)
     {
-      pthread_t thread;
-
-      if (pthread_create (&thread, NULL, dummy_thread_func, NULL) != 0)
-        /* Thread creation failed.  */
+      if (pthread_once (&dummy_once_control, dummy_once_func) != 0)
         result = 0;
       else
-        {
-          /* Thread creation works.  */
-          void *retval;
-          if (pthread_join (thread, &retval) != 0)
-            abort ();
-          result = 1;
-        }
+        result = 1;
       tested = 1;
     }
   return result;


[FILE:543:patches/patch-gettext-tools_configure]
--- gettext-tools/configure.orig	2024-02-21 16:36:27 UTC
+++ gettext-tools/configure
@@ -37515,7 +37515,7 @@ then :
              # On Solaris 10 or newer, this test is no longer needed, because
              # libc contains the fully functional pthread functions.
              case "$host_os" in
-               solaris | solaris2.[1-9] | solaris2.[1-9].* | hpux*)
+               solaris | solaris2.[1-9] | solaris2.[1-9].* | hpux* | freebsd* | midnight* | dragon*)
 
 printf "%s\n" "#define PTHREAD_IN_USE_DETECTION_HARD 1" >>confdefs.h
 


[FILE:1001:patches/patch-gettext-tools_gnulib-lib_glthread_threadlib.c]
--- gettext-tools/gnulib-lib/glthread/threadlib.c.orig	2024-02-21 10:44:24 UTC
+++ gettext-tools/gnulib-lib/glthread/threadlib.c
@@ -62,11 +62,10 @@ glthread_in_use (void)
 
 /* Test using pthread_create.  */
 
-/* The function to be executed by a dummy thread.  */
-static void *
-dummy_thread_func (void *arg)
+static pthread_once_t dummy_once_control = PTHREAD_ONCE_INIT;
+static void
+dummy_once_func (void)
 {
-  return arg;
 }
 
 int
@@ -77,19 +76,10 @@ glthread_in_use (void)
 
   if (!tested)
     {
-      pthread_t thread;
-
-      if (pthread_create (&thread, NULL, dummy_thread_func, NULL) != 0)
-        /* Thread creation failed.  */
+      if (pthread_once (&dummy_once_control, dummy_once_func) != 0)
         result = 0;
       else
-        {
-          /* Thread creation works.  */
-          void *retval;
-          if (pthread_join (thread, &retval) != 0)
-            abort ();
-          result = 1;
-        }
+        result = 1;
       tested = 1;
     }
   return result;


[FILE:1005:patches/patch-gettext-tools_libgettextpo_glthread_threadlib.c]
--- gettext-tools/libgettextpo/glthread/threadlib.c.orig	2024-02-21 10:45:00 UTC
+++ gettext-tools/libgettextpo/glthread/threadlib.c
@@ -62,11 +62,10 @@ glthread_in_use (void)
 
 /* Test using pthread_create.  */
 
-/* The function to be executed by a dummy thread.  */
-static void *
-dummy_thread_func (void *arg)
+static pthread_once_t dummy_once_control = PTHREAD_ONCE_INIT;
+static void
+dummy_once_func (void)
 {
-  return arg;
 }
 
 int
@@ -77,19 +76,10 @@ glthread_in_use (void)
 
   if (!tested)
     {
-      pthread_t thread;
-
-      if (pthread_create (&thread, NULL, dummy_thread_func, NULL) != 0)
-        /* Thread creation failed.  */
+      if (pthread_once (&dummy_once_control, dummy_once_func) != 0)
         result = 0;
       else
-        {
-          /* Thread creation works.  */
-          void *retval;
-          if (pthread_join (thread, &retval) != 0)
-            abort ();
-          result = 1;
-        }
+        result = 1;
       tested = 1;
     }
   return result;


[FILE:433:files/special.mk]
# On linux, libintl is part of glibc so libintl.so doesn't get installed
.if ${OPSYS} == Linux
EXTERNAL="@comment "
.else
EXTERNAL=""
_USES_build+= 555:assemble_pic
_USES_stage+= 555:install_pic
.endif

assemble_pic:
	(cd ${WRKSRC}/gettext-runtime/intl/.libs &&\
	 ${AR} -cq libintl_pic.a *.o &&\
	 ranlib libintl_pic.a)

install_pic:
	${INSTALL_DATA} ${WRKSRC}/gettext-runtime/intl/.libs/libintl_pic.a \
		${STAGEDIR}${PREFIX}/lib/

