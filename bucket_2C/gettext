# Buildsheet autogenerated by ravenadm tool -- Do not edit.

NAMEBASE=		gettext
VERSION=		0.25
KEYWORDS=		devel
VARIANTS=		std
SDESC[std]=		GNU internationalization and localization system
HOMEPAGE=		http://www.gnu.org/software/gettext/
CONTACT=		nobody

DOWNLOAD_GROUPS=	main
SITES[main]=		GNU/gettext
DISTFILE[1]=		gettext-0.25.tar.xz:main
DF_INDEX=		1
SPKGS[std]=		set
			primary
			asprintf
			tools
			bldtools
			dev
			solinks
			nls
			man
			docs
			info
			asprintfdev
			aclocal

OPTIONS_AVAILABLE=	none
OPTIONS_STANDARD=	none

EXRUN[tools]=		primary
EXRUN[bldtools]=	primary
EXRUN[dev]=		aclocal

USES=			charsetfix cpe libtool iconv:build c++:asprintf

LICENSE=		GPLv3+:primary LGPL21+:primary
LICENSE_TERMS=		primary:{{WRKDIR}}/TERMS
LICENSE_FILE=		GPLv3+:{{WRKSRC}}/COPYING
			LGPL21+:{{WRKSRC}}/gettext-runtime/intl/COPYING.LIB
LICENSE_SCHEME=		multi

INFO=			info:autosprintf
			info:gettext
CPE_PRODUCT=		gettext
CPE_VENDOR=		gnu
FPC_EQUIVALENT=		devel/gettext
INFO_SUBDIR=		.

MUST_CONFIGURE=		gnu
CONFIGURE_ARGS=		--disable-csharp
			--disable-java
			--disable-openmp
			--with-included-glib
			--with-included-libcroco
			--with-included-libunistring
			--with-included-libxml
			--with-xz
			--without-emacs
			--without-git
CONFIGURE_ENV=		ac_cv_lib_rt_sched_yield=no

INSTALL_TARGET=		install-strip
INSTALL_REQ_TOOLCHAIN=	yes
SOVERSION=		0.25
PLIST_SUB=		VERSION=0
			PO_SOVERSION=0.5.14
			PO_SOMAJOR=0
			LIBINTL=8.4.4
			GTS_SOMAJOR=0
			GTS_SOVERSION=0.2.5
			EXTERNAL={{EXTERNAL}}

TEST_TARGET=		check
VAR_OPSYS[netbsd]=	CONFIGURE_ENV=ac_cv_func_utimens=no
			CONFIGURE_ENV=ac_cv_func_lutimens=no

post-install:
	${MV} ${STAGEDIR}${PREFIX}/share/gettext-0.25 \
		${STAGEDIR}${PREFIX}/share/gettext/0
.if "${.MAKE.OS.NAME}" == "Linux"
	${STRIP_CMD} ${STAGEDIR}${PREFIX}/lib/preloadable_libintl.so
.else
	${STRIP_CMD} ${STAGEDIR}${PREFIX}/lib/libintl.${LIBEXT}
.endif
	${RM} ${STAGEDIR}${PREFIX}/share/info/libtextstyle.info
	${RMDIR} ${STAGEDIR}${PREFIX}/lib/gettext
	# v0.24.1 broke a couple of autoreconf ports (wavpack, libmtp) with
	# relocation of m4 files, so add symlinks
	${MKDIR} ${STAGEDIR}${PREFIX}/share/aclocal
.for m4 in gettext iconv nls po lib-ld lib-link lib-prefix
	${LN} -s ../gettext/m4/${m4}.m4 ${STAGEDIR}${PREFIX}/share/aclocal/${m4}.m4
.endfor

pre-configure:
	# Do not install csharp and java documentation.
	${REINPLACE_CMD} -E '/^SUBDIRS =/s/(intl-csharp|intl-java)//g' \
		${WRKSRC}/gettext-runtime/Makefile.in
	# Do not install html copies of manpages.
	${REINPLACE_CMD} \
		-e '/^all-local:/s/html-local//' \
		-e '/^install-data-local:/s/install-html//' \
		-e '/^installdirs-local:/s/installdirs-html//' \
		${WRKSRC}/gettext-runtime/libasprintf/Makefile.in \
		${WRKSRC}/gettext-runtime/man/Makefile.in
	# use libiconv_pic.a instead of libiconv.so
	${REINPLACE_CMD} -e "s|names_next_round='iconv '|names_next_round='iconv_pic '|" \
		${WRKSRC}/gettext-tools/configure \
		${WRKSRC}/gettext-runtime/configure \
		${WRKSRC}/gettext-runtime/intl/configure \
		${WRKSRC}/libtextstyle/configure

post-extract:
	${AWK} '/HAVE_CONFIG_H/ {exit}; {print}' \
		${WRKSRC}/gettext-runtime/src/gettext.c > ${WRKDIR}/TERMS
	${AWK} '/HAVE_CONFIG_H/ {exit}; {print}' \
		${WRKSRC}/gettext-runtime/intl/textdomain.c >> ${WRKDIR}/TERMS

[FILE:148:descriptions/desc.primary]
GNU gettext is a framework of libraries and tools for internationalisation
and localisation of software.

This package contains the shared library.


[FILE:194:descriptions/desc.asprintf]
GNU gettext is a framework of libraries and tools for internationalisation
and localisation of software.

This package contains the asprintf library which has a runtime dependency
on libstdc++.


[FILE:159:descriptions/desc.tools]
GNU gettext is a framework of libraries and tools for internationalisation
and localisation of software.

This package contains gettext command line programs.


[FILE:163:descriptions/desc.bldtools]
GNU gettext is a framework of libraries and tools for internationalisation
and localisation of software.

This package contains development and translation tools.


[FILE:230:descriptions/desc.solinks]
GNU gettext is a framework of libraries and tools for internationalisation
and localisation of software.

This package contains symbolic links to the shared libraries, and are
used when needing to link to the shared intl library.


[FILE:66:descriptions/desc.asprintfdev]
This package contains the development files for asprintf library.


[FILE:164:descriptions/desc.aclocal]
This package contains the autoconf m4 files for gettext.
They are typically part of the dev package, but they have been separated
to better support glibc systems.



[FILE:98:distinfo]
05240b29f5b0f422e5a4ef8e9b5f76d8fa059cc057693d2723cdb76f36a88ab0      9932992 gettext-0.25.tar.xz


[FILE:96:manifests/plist.primary]
%%EXTERNAL%%lib/
 libintl.so.%%LIBINTL%%
 libintl.so.8
%%ONLY-LINUX%%lib/preloadable_libintl.so


[FILE:45:manifests/plist.asprintf]
lib/
 libasprintf.so.0
 libasprintf.so.0.0.0


[FILE:46:manifests/plist.tools]
bin/
 envsubst
 gettext
 gettext.sh
 ngettext


[FILE:1442:manifests/plist.bldtools]
bin/
 autopoint
 gettextize
 msgattrib
 msgcat
 msgcmp
 msgcomm
 msgconv
 msgen
 msgexec
 msgfilter
 msgfmt
 msggrep
 msginit
 msgmerge
 msgunfmt
 msguniq
 recode-sr-latin
 xgettext
lib/
 libgettextlib-%%SOVERSION%%.so
 libgettextpo.so.%%PO_SOMAJOR%%
 libgettextpo.so.%%PO_SOVERSION%%
 libgettextsrc-%%SOVERSION%%.so
 libtextstyle.so.%%GTS_SOMAJOR%%
 libtextstyle.so.%%GTS_SOVERSION%%
libexec/gettext/
 cldr-plurals
 hostname
 project-id
 urlget
 user-email
share/gettext/
 ABOUT-NLS
 archive.dir.tar.xz
 config.rpath
 disclaim-translations.txt
 gettext.h
 javaversion.class
 msgunfmt.tcl
share/gettext/%%VERSION%%/its/
 docbook.loc
 docbook4.its
 docbook5.its
 glade.loc
 glade1.its
 glade2.its
 gsettings.its
 gsettings.loc
 gtkbuilder.its
 metainfo.its
 metainfo.loc
share/gettext/po/
 Makefile.in.in
 Makevars.template
 Rules-quot
 boldquot.sed
 en@boldquot.header
 en@quot.header
 insert-header.sed
 quot.sed
 remove-potcdate.sed
share/gettext/projects/
 index
 team-address
share/gettext/projects/GNOME/
 team-address
 teams.html
 teams.url
 trigger
share/gettext/projects/KDE/
 team-address
 teams.html
 teams.url
 trigger
share/gettext/projects/TP/
 team-address
 teams.html
 teams.url
 trigger
share/gettext/schema/
 its-extensions.xsd
 its.xsd10
 its.xsd11
 locating-rules.xsd10
 locating-rules.xsd11
share/gettext/styles/
 po-default.css
 po-emacs-x.css
 po-emacs-xterm.css
 po-emacs-xterm16.css
 po-emacs-xterm256.css
 po-vim.css


[FILE:233:manifests/plist.dev]
%%EXTERNAL%%include/libintl.h
%%EXTERNAL%%lib/
 libintl.a
 libintl_pic.a
include/
 gettext-po.h
 textstyle.h
include/textstyle/
 stdbool.h
 version.h
 woe32dll.h
lib/
 libgettextlib.a
 libgettextpo.a
 libgettextsrc.a
 libtextstyle.a


[FILE:102:manifests/plist.solinks]
%%EXTERNAL%%lib/libintl.so
lib/
 libgettextlib.so
 libgettextpo.so
 libgettextsrc.so
 libtextstyle.so


[FILE:2831:manifests/plist.nls]
share/locale/ast/LC_MESSAGES/gettext-runtime.mo
share/locale/be/LC_MESSAGES/
 gettext-runtime.mo
 gettext-tools.mo
share/locale/bg/LC_MESSAGES/
 gettext-runtime.mo
 gettext-tools.mo
share/locale/ca/LC_MESSAGES/
 gettext-runtime.mo
 gettext-tools.mo
share/locale/cs/LC_MESSAGES/
 gettext-runtime.mo
 gettext-tools.mo
share/locale/da/LC_MESSAGES/
 gettext-runtime.mo
 gettext-tools.mo
share/locale/de/LC_MESSAGES/
 gettext-runtime.mo
 gettext-tools.mo
share/locale/el/LC_MESSAGES/
 gettext-runtime.mo
 gettext-tools.mo
share/locale/en@boldquot/LC_MESSAGES/
 gettext-runtime.mo
 gettext-tools.mo
share/locale/en@quot/LC_MESSAGES/
 gettext-runtime.mo
 gettext-tools.mo
share/locale/eo/LC_MESSAGES/gettext-runtime.mo
share/locale/es/LC_MESSAGES/
 gettext-runtime.mo
 gettext-tools.mo
share/locale/et/LC_MESSAGES/
 gettext-runtime.mo
 gettext-tools.mo
share/locale/eu/LC_MESSAGES/gettext-tools.mo
share/locale/fi/LC_MESSAGES/
 gettext-runtime.mo
 gettext-tools.mo
share/locale/fr/LC_MESSAGES/
 gettext-runtime.mo
 gettext-tools.mo
share/locale/ga/LC_MESSAGES/gettext-runtime.mo
share/locale/gl/LC_MESSAGES/
 gettext-runtime.mo
 gettext-tools.mo
share/locale/hr/LC_MESSAGES/
 gettext-runtime.mo
 gettext-tools.mo
share/locale/hu/LC_MESSAGES/gettext-runtime.mo
share/locale/id/LC_MESSAGES/
 gettext-runtime.mo
 gettext-tools.mo
share/locale/it/LC_MESSAGES/
 gettext-runtime.mo
 gettext-tools.mo
share/locale/ja/LC_MESSAGES/
 gettext-runtime.mo
 gettext-tools.mo
share/locale/ka/LC_MESSAGES/
 gettext-runtime.mo
 gettext-tools.mo
share/locale/ko/LC_MESSAGES/
 gettext-runtime.mo
 gettext-tools.mo
share/locale/nb/LC_MESSAGES/
 gettext-runtime.mo
 gettext-tools.mo
share/locale/nl/LC_MESSAGES/
 gettext-runtime.mo
 gettext-tools.mo
share/locale/nn/LC_MESSAGES/
 gettext-runtime.mo
 gettext-tools.mo
share/locale/pa/LC_MESSAGES/gettext-tools.mo
share/locale/pl/LC_MESSAGES/
 gettext-runtime.mo
 gettext-tools.mo
share/locale/pt/LC_MESSAGES/
 gettext-runtime.mo
 gettext-tools.mo
share/locale/pt_BR/LC_MESSAGES/
 gettext-runtime.mo
 gettext-tools.mo
share/locale/ro/LC_MESSAGES/
 gettext-runtime.mo
 gettext-tools.mo
share/locale/ru/LC_MESSAGES/
 gettext-runtime.mo
 gettext-tools.mo
share/locale/sk/LC_MESSAGES/
 gettext-runtime.mo
 gettext-tools.mo
share/locale/sl/LC_MESSAGES/
 gettext-runtime.mo
 gettext-tools.mo
share/locale/sr/LC_MESSAGES/
 gettext-runtime.mo
 gettext-tools.mo
share/locale/sv/LC_MESSAGES/
 gettext-runtime.mo
 gettext-tools.mo
share/locale/tr/LC_MESSAGES/
 gettext-runtime.mo
 gettext-tools.mo
share/locale/uk/LC_MESSAGES/
 gettext-runtime.mo
 gettext-tools.mo
share/locale/vi/LC_MESSAGES/
 gettext-runtime.mo
 gettext-tools.mo
share/locale/zh_CN/LC_MESSAGES/
 gettext-runtime.mo
 gettext-tools.mo
share/locale/zh_HK/LC_MESSAGES/gettext-runtime.mo
share/locale/zh_TW/LC_MESSAGES/
 gettext-runtime.mo
 gettext-tools.mo


[FILE:414:manifests/plist.man]
share/man/man1/
 autopoint.1
 envsubst.1
 gettext.1
 gettextize.1
 msgattrib.1
 msgcat.1
 msgcmp.1
 msgcomm.1
 msgconv.1
 msgen.1
 msgexec.1
 msgfilter.1
 msgfmt.1
 msggrep.1
 msginit.1
 msgmerge.1
 msgunfmt.1
 msguniq.1
 ngettext.1
 recode-sr-latin.1
 xgettext.1
share/man/man3/
 bind_textdomain_codeset.3
 bindtextdomain.3
 dcgettext.3
 dcngettext.3
 dgettext.3
 dngettext.3
 gettext.3
 ngettext.3
 textdomain.3


[FILE:58:manifests/plist.asprintfdev]
include/autosprintf.h
lib/
 libasprintf.a
 libasprintf.so


[FILE:250:manifests/plist.aclocal]
share/aclocal/
 gettext.m4
 iconv.m4
 lib-ld.m4
 lib-link.m4
 lib-prefix.m4
 nls.m4
 po.m4
share/gettext/m4/
 build-to-host.m4
 gettext.m4
 host-cpu-c-abi.m4
 iconv.m4
 intlmacosx.m4
 lib-ld.m4
 lib-link.m4
 lib-prefix.m4
 nls.m4
 po.m4
 progtest.m4


[FILE:1123:patches/patch-gettext-runtime_configure]
--- gettext-runtime/configure.orig	2025-05-02 15:34:04 UTC
+++ gettext-runtime/configure
@@ -25415,7 +25415,7 @@ extern
 "C"
 #endif
 const char *_nl_expand_alias (const char *);
-#define __GNU_GETTEXT_SYMBOL_EXPRESSION (_nl_msg_cat_cntr + *_nl_expand_alias (""))
+#define __GNU_GETTEXT_SYMBOL_EXPRESSION (_nl_msg_cat_cntr)
 #else
 #define __GNU_GETTEXT_SYMBOL_EXPRESSION 0
 #endif
@@ -25460,7 +25460,7 @@ extern
 "C"
 #endif
 const char *_nl_expand_alias (const char *);
-#define __GNU_GETTEXT_SYMBOL_EXPRESSION (_nl_msg_cat_cntr + *_nl_expand_alias (""))
+#define __GNU_GETTEXT_SYMBOL_EXPRESSION (_nl_msg_cat_cntr)
 #else
 #define __GNU_GETTEXT_SYMBOL_EXPRESSION 0
 #endif
@@ -32103,7 +32103,7 @@ else case e in #(
              # On Solaris 10 or newer, this test is no longer needed, because
              # libc contains the fully functional pthread functions.
              case $host_os in #(
-  solaris | solaris2.[1-9] | solaris2.[1-9].* | hpux*) :
+  solaris | solaris2.[1-9] | solaris2.[1-9].* | hpux* | freebsd* | midnight* | dragon*) :
 
 
 printf "%s\n" "#define PTHREAD_IN_USE_DETECTION_HARD 1" >>confdefs.h


[FILE:1015:patches/patch-gettext-runtime_intl_gnulib-lib_glthread_threadlib.c]
--- gettext-runtime/intl/gnulib-lib/glthread/threadlib.c.orig	2025-04-01 15:16:53 UTC
+++ gettext-runtime/intl/gnulib-lib/glthread/threadlib.c
@@ -62,11 +62,10 @@ glthread_in_use (void)
 
 /* Test using pthread_create.  */
 
-/* The function to be executed by a dummy thread.  */
-static void *
-dummy_thread_func (void *arg)
+static pthread_once_t dummy_once_control = PTHREAD_ONCE_INIT;
+static void
+dummy_once_func (void)
 {
-  return arg;
 }
 
 int
@@ -77,19 +76,10 @@ glthread_in_use (void)
 
   if (!tested)
     {
-      pthread_t thread;
-
-      if (pthread_create (&thread, NULL, dummy_thread_func, NULL) != 0)
-        /* Thread creation failed.  */
+      if (pthread_once (&dummy_once_control, dummy_once_func) != 0)
         result = 0;
       else
-        {
-          /* Thread creation works.  */
-          void *retval;
-          if (pthread_join (thread, &retval) != 0)
-            abort ();
-          result = 1;
-        }
+        result = 1;
       tested = 1;
     }
   return result;


[FILE:533:patches/patch-gettext-tools_configure]
--- gettext-tools/configure.orig	2025-05-02 15:34:19 UTC
+++ gettext-tools/configure
@@ -40732,7 +40732,7 @@ else case e in #(
              # On Solaris 10 or newer, this test is no longer needed, because
              # libc contains the fully functional pthread functions.
              case $host_os in #(
-  solaris | solaris2.[1-9] | solaris2.[1-9].* | hpux*) :
+  solaris | solaris2.[1-9] | solaris2.[1-9].* | hpux* | freebsd* | midnight* | dragon*) :
 
 
 printf "%s\n" "#define PTHREAD_IN_USE_DETECTION_HARD 1" >>confdefs.h


[FILE:1001:patches/patch-gettext-tools_gnulib-lib_glthread_threadlib.c]
--- gettext-tools/gnulib-lib/glthread/threadlib.c.orig	2025-04-01 15:16:54 UTC
+++ gettext-tools/gnulib-lib/glthread/threadlib.c
@@ -62,11 +62,10 @@ glthread_in_use (void)
 
 /* Test using pthread_create.  */
 
-/* The function to be executed by a dummy thread.  */
-static void *
-dummy_thread_func (void *arg)
+static pthread_once_t dummy_once_control = PTHREAD_ONCE_INIT;
+static void
+dummy_once_func (void)
 {
-  return arg;
 }
 
 int
@@ -77,19 +76,10 @@ glthread_in_use (void)
 
   if (!tested)
     {
-      pthread_t thread;
-
-      if (pthread_create (&thread, NULL, dummy_thread_func, NULL) != 0)
-        /* Thread creation failed.  */
+      if (pthread_once (&dummy_once_control, dummy_once_func) != 0)
         result = 0;
       else
-        {
-          /* Thread creation works.  */
-          void *retval;
-          if (pthread_join (thread, &retval) != 0)
-            abort ();
-          result = 1;
-        }
+        result = 1;
       tested = 1;
     }
   return result;


[FILE:1005:patches/patch-gettext-tools_libgettextpo_glthread_threadlib.c]
--- gettext-tools/libgettextpo/glthread/threadlib.c.orig	2025-04-01 15:16:58 UTC
+++ gettext-tools/libgettextpo/glthread/threadlib.c
@@ -62,11 +62,10 @@ glthread_in_use (void)
 
 /* Test using pthread_create.  */
 
-/* The function to be executed by a dummy thread.  */
-static void *
-dummy_thread_func (void *arg)
+static pthread_once_t dummy_once_control = PTHREAD_ONCE_INIT;
+static void
+dummy_once_func (void)
 {
-  return arg;
 }
 
 int
@@ -77,19 +76,10 @@ glthread_in_use (void)
 
   if (!tested)
     {
-      pthread_t thread;
-
-      if (pthread_create (&thread, NULL, dummy_thread_func, NULL) != 0)
-        /* Thread creation failed.  */
+      if (pthread_once (&dummy_once_control, dummy_once_func) != 0)
         result = 0;
       else
-        {
-          /* Thread creation works.  */
-          void *retval;
-          if (pthread_join (thread, &retval) != 0)
-            abort ();
-          result = 1;
-        }
+        result = 1;
       tested = 1;
     }
   return result;


[FILE:433:files/special.mk]
# On linux, libintl is part of glibc so libintl.so doesn't get installed
.if ${OPSYS} == Linux
EXTERNAL="@comment "
.else
EXTERNAL=""
_USES_build+= 555:assemble_pic
_USES_stage+= 555:install_pic
.endif

assemble_pic:
	(cd ${WRKSRC}/gettext-runtime/intl/.libs &&\
	 ${AR} -cq libintl_pic.a *.o &&\
	 ranlib libintl_pic.a)

install_pic:
	${INSTALL_DATA} ${WRKSRC}/gettext-runtime/intl/.libs/libintl_pic.a \
		${STAGEDIR}${PREFIX}/lib/

