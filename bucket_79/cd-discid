# Buildsheet autogenerated by ravenadm tool -- Do not edit.

NAMEBASE=		cd-discid
VERSION=		1.4
REVISION=		2
KEYWORDS=		audio
VARIANTS=		std
SDESC[std]=		Backend utility to retrieve CDDB discid info
HOMEPAGE=		https://github.com/taem/cd-discid
CONTACT=		Michael_Reim[kraileth@elderlinux.org]

DOWNLOAD_GROUPS=	main
SITES[main]=		GITHUB/taem:cd-discid:1.4
DISTFILE[1]=		generated:main
DF_INDEX=		1
SPKGS[std]=		set
			primary
			man

OPTIONS_AVAILABLE=	none
OPTIONS_STANDARD=	none

LICENSE=		GPLv2+:primary ART10:primary
LICENSE_TERMS=		primary:{{WRKDIR}}/TERMS
LICENSE_FILE=		GPLv2+:{{WRKSRC}}/COPYING
			ART10:stock
LICENSE_AWK=		TERMS:"^$$"
LICENSE_SOURCE=		TERMS:{{WRKSRC}}/cd-discid.c
LICENSE_SCHEME=		dual

FPC_EQUIVALENT=		audio/cd-discid

do-install:
	${INSTALL_PROGRAM} ${WRKSRC}/cd-discid ${STAGEDIR}${PREFIX}/bin/
	${INSTALL_MAN} ${WRKSRC}/cd-discid.1 ${STAGEDIR}${MANPREFIX}/man/man1/

[FILE:188:descriptions/desc.primary]
Cd-discid is a backend utility to get CDDB discid information from a 
CD-ROM disc. It was originally designed for abcde (AKA cdgrab), but can be 
used for any purpose requiring CDDB data.


[FILE:104:distinfo]
6f07df25ebf17b8336c17a50092ed288cc5a6b86f85705db7e1aa35ba26683cf        12481 taem-cd-discid-1.4.tar.gz


[FILE:14:manifests/plist.primary]
bin/cd-discid


[FILE:27:manifests/plist.man]
share/man/man1/cd-discid.1


[FILE:1345:patches/patch-cd-discid.c]
--- cd-discid.c.orig	2013-05-14 09:02:00 UTC
+++ cd-discid.c
@@ -23,6 +23,10 @@
 #include <fcntl.h>
 #include <sys/ioctl.h>
 
+#if defined(__DragonFly__) || defined(__FreeBSD__)
+#include <arpa/inet.h>
+#endif
+
 #if defined(linux)
 #include <linux/cdrom.h>
 #define cdte_track_address      cdte_addr.lba
@@ -46,7 +50,7 @@
 
 /* __FreeBSD_kernel__ is needed for properly compiling on Debian GNU/kFreeBSD
    Look at http://glibc-bsd.alioth.debian.org/porting/PORTING for more info */
-#elif defined(__FreeBSD__) || defined(__FreeBSD_kernel__)
+#elif defined(__FreeBSD__) || defined(__FreeBSD_kernel__) || defined(__DragonFly__)
 #include <sys/cdio.h>
 #define CDROM_LBA               CD_LBA_FORMAT    /* first frame is 0 */
 #define CD_MSF_OFFSET           150              /* MSF offset of first frame */
@@ -260,12 +264,12 @@ int main(int argc, char *argv[])
 	/* release file handle */
 	close(drive);
 
-#if defined(__FreeBSD__)
+#if defined(__FreeBSD__) || defined(__DragonFly__)
 	TocEntry[i].cdte_track_address = ntohl(TocEntry[i].cdte_track_address);
 #endif
 
 	for (i = 0; i < last; i++) {
-#if defined(__FreeBSD__)
+#if defined(__FreeBSD__) || defined(__DragonFly__)
 		TocEntry[i].cdte_track_address = ntohl(TocEntry[i].cdte_track_address);
 #endif
 		cksum += cddb_sum((TocEntry[i].cdte_track_address + CD_MSF_OFFSET) / CD_FRAMES);

