# Buildsheet autogenerated by ravenadm tool -- Do not edit.

NAMEBASE=		fuse3
VERSION=		3.16.2
KEYWORDS=		sysutils
VARIANTS=		standard
SDESC[standard]=	File System in Userspace (FUSE) utilities
HOMEPAGE=		https://github.com/libfuse/libfuse
CONTACT=		nobody

DOWNLOAD_GROUPS=	main
SITES[main]=		GITHUB/libfuse:libfuse:fuse-3.16.2
DISTFILE[1]=		generated:main
DF_INDEX=		1
SPKGS[standard]=	complete
			primary
			dev
			man

OPTIONS_AVAILABLE=	none
OPTIONS_STANDARD=	none

NOT_FOR_OPSYS=		dragonfly sunos

USES=			cpe meson pkgconfig

LICENSE=		LGPL21:primary GPLv2:primary
LICENSE_TERMS=		primary:{{WRKSRC}}/LICENSE
LICENSE_FILE=		LGPL21:{{WRKSRC}}/LGPL2.txt
			GPLv2:{{WRKSRC}}/GPL2.txt
LICENSE_SCHEME=		multi

CPE_PRODUCT=		fuse
CPE_VENDOR=		fuse_project
MESON_ARGS=		-Dtests=false
			-Dexamples=false

SOVERSION=		3.16.2

VAR_OPSYS[netbsd]=	CFLAGS=-D__off64_t=off_t

post-install-linux:
	${RM} -r ${STAGEDIR}/dev
	${MV} ${STAGEDIR}${PREFIX}/etc/fuse.conf ${STAGEDIR}${PREFIX}/etc/fuse.conf.sample

[FILE:1114:descriptions/desc.primary]
FUSE (Filesystem in Userspace) is an interface for userspace programs to 
export a filesystem to the kernel. The FUSE project consists of two
components: the fuse kernel module (maintained by supported operating
system) and the libfuse userspace library (the contents of this package).
libfuse provides the reference implementation for communicating with the
FUSE kernel module.

A FUSE file system is typically implemented as a standalone application 
that links with libfuse. libfuse provides functions to mount the file 
system, unmount it, read requests from the kernel, and send responses 
back. libfuse offers two APIs: a "high-level", synchronous API, and a 
"low-level" asynchronous API. In both cases, incoming requests from the 
kernel are passed to the main program using callbacks. When using the 
high-level API, the callbacks may work with file names and paths instead 
of inodes, and processing of a request finishes when the callback function 
returns. When using the low-level API, the callbacks must work with inodes 
and responses must be sent explicitly using a separate set of API 
functions.


[FILE:113:distinfo]
1bc306be1a1f4f6c8965fbdd79c9ccca021fdc4b277d501483a711cbd7dbcd6c       817044 libfuse-libfuse-fuse-3.16.2.tar.gz


[FILE:299:manifests/plist.primary]
%%ONLY-LINUX%%/etc/init.d/fuse3
%%ONLY-LINUX%%@postunexec rm -f /dev/fuse
%%ONLY-LINUX%%@preexec mknod -m 0666 /dev/fuse c 10 229 || true
%%ONLY-LINUX%%@sample etc/fuse.conf.sample
%%ONLY-LINUX%%bin/fusermount3
%%ONLY-LINUX%%sbin/mount.fuse3
lib/
 libfuse3.so.%%SOMAJOR%%
 libfuse3.so.%%SOVERSION%%


[FILE:153:manifests/plist.dev]
include/fuse3/
 cuse_lowlevel.h
 fuse.h
 fuse_common.h
 fuse_log.h
 fuse_lowlevel.h
 fuse_opt.h
 libfuse_config.h
lib/libfuse3.so
lib/pkgconfig/fuse3.pc


[FILE:92:manifests/plist.man]
%%ONLY-LINUX%%share/man/man1/fusermount3.1.gz
%%ONLY-LINUX%%share/man/man8/mount.fuse3.8.gz


[FILE:865:patches/patch-lib_mount__bsd.c]
--- lib/mount_bsd.c.orig	2023-10-10 07:38:49 UTC
+++ lib/mount_bsd.c
@@ -8,7 +8,7 @@
   See the file COPYING.LIB.
 */
 
-#include "config.h"
+#include "fuse_config.h"
 #include "fuse_i.h"
 #include "fuse_misc.h"
 #include "fuse_opt.h"
@@ -19,7 +19,9 @@
 #include <sys/stat.h>
 #include <sys/wait.h>
 #include <sys/sysctl.h>
+#if !defined(__NetBSD__)
 #include <sys/user.h>
+#endif
 #include <stdio.h>
 #include <stdlib.h>
 #include <unistd.h>
@@ -86,7 +88,7 @@ static const struct fuse_opt fuse_mount_
 	FUSE_DUAL_OPT_KEY("neglect_shares",	KEY_KERN),
 	FUSE_DUAL_OPT_KEY("push_symlinks_in",	KEY_KERN),
 	FUSE_OPT_KEY("nosync_unmount",		KEY_KERN),
-#if __FreeBSD_version >= 1200519
+#if (__FreeBSD_version >= 1200519) || defined(__MidnightBSD__)
 	FUSE_DUAL_OPT_KEY("intr",		KEY_KERN),
 #endif
 	/* stock FBSD mountopt parsing routine lets anything be negated... */


[FILE:453:patches/patch-meson.build]
--- meson.build.orig	2023-10-10 07:38:49 UTC
+++ meson.build
@@ -59,7 +59,7 @@ endforeach
 private_cfg.set('HAVE_SETXATTR', 
         cc.has_function('setxattr', prefix: '#include <sys/xattr.h>'))
 private_cfg.set('HAVE_ICONV', 
-        cc.has_function('iconv', prefix: '#include <iconv.h>'))
+        cc.has_function('dontuseiconv', prefix: '#include <iconv.h>'))
 
 # Test if structs have specific member
 private_cfg.set('HAVE_STRUCT_STAT_ST_ATIM',


[FILE:361:patches/patch-util_meson.build]
--- util/meson.build.orig	2023-10-10 07:38:49 UTC
+++ util/meson.build
@@ -18,7 +18,7 @@ udevrulesdir = get_option('udevrulesdir'
 if udevrulesdir == ''
   udev = dependency('udev', required: false)
   if udev.found()
-     udevrulesdir = join_paths(udev.get_variable(pkgconfig: 'udevdir'), 'rules.d')
+     udevrulesdir = '/etc/udev/rules.d'
   endif
 endif
 


[FILE:202:files/messages-single-freebsd.ucl]
freebsd: {
  type: "install"
  message: <<EOM
================ FreeBSD Message ================ 
Install the fuse kernel module to use this port.
=================================================
EOM
}

