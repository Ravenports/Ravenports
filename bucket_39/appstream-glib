# Buildsheet autogenerated by ravenadm tool -- Do not edit.

NAMEBASE=		appstream-glib
VERSION=		0.7.6
KEYWORDS=		devel
VARIANTS=		standard
SDESC[standard]=	Library for reading and writing AppStream metadata
HOMEPAGE=		https://people.freedesktop.org/~hughsient/appstream-glib/
CONTACT=		nobody

DOWNLOAD_GROUPS=	main
SITES[main]=		https://people.freedesktop.org/~hughsient/appstream-glib/releases/
DISTFILE[1]=		appstream-glib-0.7.6.tar.xz:main
DIST_SUBDIR=		gnome3
DF_INDEX=		1
SPKGS[standard]=	complete
			primary
			docs

OPTIONS_AVAILABLE=	none
OPTIONS_STANDARD=	none

BUILD_DEPENDS=		gtk-doc:single:standard
			gperf:single:standard
BUILDRUN_DEPENDS=	libsoup:primary:standard
			libyaml:single:standard
			ossp-uuid:single:standard
			fontconfig:primary:standard
			freetype:primary:standard
			libarchive:single:standard
			json-glib:single:standard
			gcab:primary:standard

USES=			gettext-tools gmake libtool pkgconfig sqlite meson
GNOME_COMPONENTS=	gtk3 introspection gdkpixbuf intltool pango

LICENSE=		LGPL21+:primary
LICENSE_SCHEME=		solo
LICENSE_FILE=		LGPL21+:{{WRKSRC}}/COPYING

FPC_EQUIVALENT=		devel/appstream-glib
MESON_ARGS=		-Drpm=false
			-Dstemmer=false
			-Dgtk-doc=true
MESON_INSERT_RPATH=	client/meson.build
			libappstream-glib/meson.build
			libappstream-builder/meson.build
			libappstream-builder/plugins/meson.build

INSTALL_TARGET=		install-strip
SOVERSION=		8.0.10

post-patch:
	${REINPLACE_CMD} -e "s/'uuid'/'ossp-uuid'/" ${WRKSRC}/meson.build
	${REINPLACE_CMD} -e "s|http://docbook.sourceforge.net|http://cdn.docbook.org|" \
		${WRKSRC}/data/meson.build

post-install:
	${MKDIR} ${STAGEDIR}${STD_DOCDIR:H}
	${MV} ${STAGEDIR}${PREFIX}/share/gtk-doc/html/appstream-glib \
		${STAGEDIR}${STD_DOCDIR:H}
	${RM} -r ${STAGEDIR}${PREFIX}/share/gtk-doc

[FILE:97:descriptions/desc.primary]
This library provides objects and helper methods to help reading and
writing AppStream metadata.


[FILE:113:distinfo]
b216583a8b9c47f6db52031fbbdfd9005a274c6a0a97c8db8c1d80c890b7d545      2233548 gnome3/appstream-glib-0.7.6.tar.xz


[FILE:2705:manifests/plist.primary]
bin/
 appstream-builder
 appstream-compose
 appstream-util
include/libappstream-builder/
 appstream-builder.h
 asb-app.h
include/libappstream-glib/
 appstream-glib.h
 as-app-builder.h
 as-app.h
 as-bundle.h
 as-checksum.h
 as-content-rating.h
 as-enums.h
 as-format.h
 as-icon.h
 as-image.h
 as-inf.h
 as-launchable.h
 as-markup.h
 as-monitor.h
 as-node.h
 as-problem.h
 as-profile.h
 as-provide.h
 as-release.h
 as-require.h
 as-review.h
 as-screenshot.h
 as-store.h
 as-suggest.h
 as-tag.h
 as-translation.h
 as-utils.h
 as-version.h
lib/asb-plugins-5/
 libasb_plugin_appdata.so
 libasb_plugin_desktop.so
 libasb_plugin_font.so
 libasb_plugin_gettext.so
 libasb_plugin_hardcoded.so
 libasb_plugin_shell_extension.so
lib/girepository-1.0/
 AppStreamBuilder-1.0.typelib
 AppStreamGlib-1.0.typelib
lib/
 libappstream-builder.so
 libappstream-builder.so.%%SOMAJOR%%
 libappstream-builder.so.%%SOVERSION%%
 libappstream-glib.so
 libappstream-glib.so.%%SOMAJOR%%
 libappstream-glib.so.%%SOVERSION%%
lib/pkgconfig/
 appstream-builder.pc
 appstream-glib.pc
share/aclocal/
 appdata-xml.m4
 appstream-xml.m4
share/bash-completion/completions/
 appstream-builder
 appstream-util
share/gettext/its/
 appdata.its
 appdata.loc
share/gir-1.0/
 AppStreamBuilder-1.0.gir
 AppStreamGlib-1.0.gir
share/installed-tests/appstream-glib/
 appdata-validate.test
 destdir-check.test
share/locale/ca/LC_MESSAGES/appstream-glib.mo
share/locale/cs/LC_MESSAGES/appstream-glib.mo
share/locale/da/LC_MESSAGES/appstream-glib.mo
share/locale/de/LC_MESSAGES/appstream-glib.mo
share/locale/en_GB/LC_MESSAGES/appstream-glib.mo
share/locale/es/LC_MESSAGES/appstream-glib.mo
share/locale/fi/LC_MESSAGES/appstream-glib.mo
share/locale/fr/LC_MESSAGES/appstream-glib.mo
share/locale/gl/LC_MESSAGES/appstream-glib.mo
share/locale/hu/LC_MESSAGES/appstream-glib.mo
share/locale/id/LC_MESSAGES/appstream-glib.mo
share/locale/it/LC_MESSAGES/appstream-glib.mo
share/locale/ko/LC_MESSAGES/appstream-glib.mo
share/locale/oc/LC_MESSAGES/appstream-glib.mo
share/locale/pl/LC_MESSAGES/appstream-glib.mo
share/locale/pt/LC_MESSAGES/appstream-glib.mo
share/locale/pt_BR/LC_MESSAGES/appstream-glib.mo
share/locale/ru/LC_MESSAGES/appstream-glib.mo
share/locale/sk/LC_MESSAGES/appstream-glib.mo
share/locale/sl/LC_MESSAGES/appstream-glib.mo
share/locale/sr/LC_MESSAGES/appstream-glib.mo
share/locale/sr@latin/LC_MESSAGES/appstream-glib.mo
share/locale/sv/LC_MESSAGES/appstream-glib.mo
share/locale/tr/LC_MESSAGES/appstream-glib.mo
share/locale/uk/LC_MESSAGES/appstream-glib.mo
share/locale/zh_CN/LC_MESSAGES/appstream-glib.mo
share/locale/zh_TW/LC_MESSAGES/appstream-glib.mo
share/man/man1/
 appstream-builder.1.gz
 appstream-compose.1.gz
 appstream-util.1.gz


[FILE:794:manifests/plist.docs]
share/doc/appstream-glib/
 appstream-glib-AsApp.html
 appstream-glib-AsBundle.html
 appstream-glib-AsChecksum.html
 appstream-glib-AsContentRating.html
 appstream-glib-AsFormat.html
 appstream-glib-AsIcon.html
 appstream-glib-AsImage.html
 appstream-glib-AsLaunchable.html
 appstream-glib-AsProblem.html
 appstream-glib-AsProvide.html
 appstream-glib-AsRelease.html
 appstream-glib-AsRequire.html
 appstream-glib-AsScreenshot.html
 appstream-glib-AsStore.html
 appstream-glib-AsTranslation.html
 appstream-glib-as-enums.html
 appstream-glib-as-markup.html
 appstream-glib-as-node.html
 appstream-glib-as-tag.html
 appstream-glib-as-utils.html
 home.png
 index.html
 left-insensitive.png
 left.png
 libappstream-glib.html
 right-insensitive.png
 right.png
 style.css
 up-insensitive.png
 up.png


[FILE:3064:patches/patch-libappstream-glib_as-utils.c]
--- libappstream-glib/as-utils.c.orig	2018-02-09 11:34:12 UTC
+++ libappstream-glib/as-utils.c
@@ -1470,18 +1470,21 @@ as_utils_guid_from_data (const gchar *na
 	gchar guid_new[37]; /* 36 plus NUL */
 	gsize digestlen = 20;
 	guint8 hash[20];
-	gint rc;
-	uuid_t uu_namespace;
-	uuid_t uu_new;
+	uuid_rc_t rc;
+	uuid_t *namespace_uuid;
+	uuid_t *new_uuid;
 	g_autoptr(GChecksum) csum = NULL;
+	guchar ns_binary[UUID_LEN_BIN] = { 0 };
+	size_t ns_binlen = UUID_LEN_BIN;
 
 	g_return_val_if_fail (namespace_id != NULL, FALSE);
 	g_return_val_if_fail (data != NULL, FALSE);
 	g_return_val_if_fail (data_len != 0, FALSE);
 
-	/* convert the namespace to binary */
-	rc = uuid_parse (namespace_id, uu_namespace);
-	if (rc != 0) {
+	/* convert the namespace to abstract uuid type */
+	uuid_create (&namespace_uuid);
+	rc = uuid_import (namespace_uuid, UUID_FMT_STR, namespace_id, UUID_LEN_STR);
+	if (rc != UUID_RC_OK) {
 		g_set_error (error,
 			     AS_UTILS_ERROR,
 			     AS_UTILS_ERROR_FAILED,
@@ -1489,22 +1492,45 @@ as_utils_guid_from_data (const gchar *na
 			     namespace_id);
 		return FALSE;
 	}
+	/* convert imported uuid to binary */
+	rc = uuid_export(namespace_uuid, UUID_FMT_BIN, &ns_binary, &ns_binlen);
+	if (rc != UUID_RC_OK) {
+		g_set_error (error,
+			     AS_UTILS_ERROR,
+			     AS_UTILS_ERROR_FAILED,
+			     "namespace '%s' binary conversion failed",
+			     namespace_id);
+		return FALSE;
+	}
+	
 
 	/* hash the namespace and then the string */
 	csum = g_checksum_new (G_CHECKSUM_SHA1);
-	g_checksum_update (csum, (guchar *) uu_namespace, 16);
+	g_checksum_update (csum, ns_binary, UUID_LEN_BIN);
 	g_checksum_update (csum, (guchar *) data, (gssize) data_len);
 	g_checksum_get_digest (csum, hash, &digestlen);
 
-	/* copy most parts of the hash 1:1 */
-	memcpy (uu_new, hash, 16);
+	/* namespace_uuid no longer needed */
+	uuid_destroy(namespace_uuid);
 
 	/* set specific bits according to Section 4.1.3 */
-	uu_new[6] = (guint8) ((uu_new[6] & 0x0f) | (5 << 4));
-	uu_new[8] = (guint8) ((uu_new[8] & 0x3f) | 0x80);
+	hash[6] = (guint8) ((hash[6] & 0x0f) | (5 << 4));
+	hash[8] = (guint8) ((hash[8] & 0x3f) | 0x80);
+
+	/* create a new from first 16 bytes of hash */
+	uuid_create (&new_uuid);
+	rc = uuid_import (new_uuid, UUID_FMT_BIN, hash, UUID_LEN_BIN);
+	if (rc != UUID_RC_OK) {
+		g_set_error (error,
+			     AS_UTILS_ERROR,
+			     AS_UTILS_ERROR_FAILED,
+			     "imported arranged hash failed");
+		return FALSE;
+	}
 
 	/* return as a string */
-	uuid_unparse (uu_new, guid_new);
+	uuid_export(new_uuid, UUID_FMT_STR, &guid_new, NULL);
+	uuid_destroy(new_uuid);
 	return g_strdup (guid_new);
 }
 
@@ -1521,12 +1547,14 @@ as_utils_guid_from_data (const gchar *na
 gboolean
 as_utils_guid_is_valid (const gchar *guid)
 {
-	gint rc;
-	uuid_t uu;
+	uuid_rc_t rc;
+	uuid_t *tmp_uuid;
 	if (guid == NULL)
 		return FALSE;
-	rc = uuid_parse (guid, uu);
-	return rc == 0;
+	uuid_create(&tmp_uuid);
+	rc = uuid_import (tmp_uuid, UUID_FMT_STR, guid, UUID_LEN_STR);
+	uuid_destroy(tmp_uuid);
+	return (rc == UUID_RC_OK);
 }
 
 /**

