# Buildsheet autogenerated by ravenadm tool -- Do not edit.

NAMEBASE=		desktop-file-utils
VERSION=		0.27
REVISION=		1
KEYWORDS=		sysutils
VARIANTS=		std
SDESC[std]=		Utilities for manipulating .desktop files
HOMEPAGE=		https://www.freedesktop.org/wiki/Software/desktop-file-utils/
CONTACT=		nobody

DOWNLOAD_GROUPS=	main
SITES[main]=		http://freedesktop.org/software/desktop-file-utils/releases/
DISTFILE[1]=		desktop-file-utils-0.27.tar.xz:main
DF_INDEX=		1
SPKGS[std]=		set
			primary
			man

OPTIONS_AVAILABLE=	none
OPTIONS_STANDARD=	none

USES=			gmake pkgconfig meson
GNOME_COMPONENTS=	glib

FPC_EQUIVALENT=		devel/desktop-file-utils

CONFIGURE_ENV=		EMACS="no"

SUB_FILES=		triggers-primary.ucl
			scripts-primary.ucl
SUB_LIST=		MIMEDIRS="share/applications"
			MDPARENT="share"

VAR_OPSYS[sunos]=	LDFLAGS=-lintl

post-install:
	${MKDIR} ${STAGEDIR}${PREFIX}/share/emacs/site-lisp \
		${STAGEDIR}${PREFIX}/share/applications
	${INSTALL_DATA} ${WRKSRC}/misc/desktop-entry-mode.el \
		${STAGEDIR}${PREFIX}/share/emacs/site-lisp/desktop-entry-mode.el

[FILE:719:descriptions/desc.primary]
desktop-file-utils contains a few command line utilities for working with 
desktop entries:

desktop-file-validate   : validates a desktop file and prints
                          warnings/errors about desktop entry
                          specification violations.
desktop-file-install    : installs a desktop file to the applications
                          directory, optionally munging it a bit in
                          transit.
update-desktop-database : updates the database containing a cache of MIME
                          types handled by desktop files. It requires GLib
                          to compile, because the implementation requires
                          Unicode utilities and such.


[FILE:109:distinfo]
a0817df39ce385b6621880407c56f1f298168c040c2032cedf88d5b76affe836        80808 desktop-file-utils-0.27.tar.xz


[FILE:162:manifests/plist.primary]
bin/
 desktop-file-edit
 desktop-file-install
 desktop-file-validate
 update-desktop-database
share/emacs/site-lisp/desktop-entry-mode.el
@dir share/applications


[FILE:125:manifests/plist.man]
share/man/man1/
 desktop-file-edit.1.gz
 desktop-file-install.1.gz
 desktop-file-validate.1.gz
 update-desktop-database.1.gz


[FILE:171:files/scripts-primary.ucl.in]
post-install-lua: [{
    args: ""
    code: <<EOS
pkg.print_msg("Building cache database of MIME types")
pkg.exec({"%%PREFIX%%/bin/update-desktop-database", "-q"})
EOS
}]


[FILE:659:files/triggers-primary.ucl.in]
mimeinfo-cache: {
    dir_path: ["%%PREFIX%%/%%MIMEDIRS%%"]

    cleanup: <<EOS
local mimedir = "%%PREFIX%%/%%MIMEDIRS%%/"
local mdparent = "%%PREFIX%%/%%MDPARENT%%"
local cache = mimedir .. "mimeinfo.cache"
local st = pkg.stat(cache)
if st then
	os.remove(cache)
end
local res = pkg.readdir(mimedir)
if #res == 0 then
	os.remove(mimedir)
	res = pkg.readdir(mdparent)
	if #res == 0 then
		os.remove(mdparent)
		res = pkg.readdir("%%PREFIX%%")
		if #res == 0 then
			os.remove("%%PREFIX%%")
		end
	end
end
EOS

    trigger: <<EOS
pkg.print_msg("Triggered: Building cache database of MIME types")
pkg.exec({"%%PREFIX%%/bin/update-desktop-database","-q"})
EOS
}

