# Buildsheet autogenerated by ravenadm tool -- Do not edit.

NAMEBASE=		tar
VERSION=		1.30
KEYWORDS=		archivers
VARIANTS=		standard nls noprefix
SDESC[nls]=		GNU tape archiver with native language support
SDESC[noprefix]=	GNU tape archiver without 'g' prefix
SDESC[standard]=	GNU version of the traditional tape archiver
HOMEPAGE=		https://www.gnu.org/software/tar/
CONTACT=		nobody

DOWNLOAD_GROUPS=	main
SITES[main]=		GNU/tar
DISTFILE[1]=		tar-1.30.tar.xz:main
DF_INDEX=		1
SPKGS[nls]=		single
SPKGS[noprefix]=	single
SPKGS[standard]=	single

OPTIONS_AVAILABLE=	NLS NOPREFIX
OPTIONS_STANDARD=	none
VOPTS[nls]=		NLS=ON NOPREFIX=OFF
VOPTS[noprefix]=	NLS=ON NOPREFIX=ON

USES=			cpe makeinfo iconv:build charsetfix

LICENSE=		GPLv3+:single
LICENSE_TERMS=		single:{{WRKDIR}}/TERMS
LICENSE_FILE=		GPLv3+:{{WRKSRC}}/COPYING
LICENSE_AWK=		TERMS:"tar Header Block"
LICENSE_SOURCE=		TERMS:{{WRKSRC}}/src/tar.h
LICENSE_SCHEME=		solo

INFO=			single:tar
CPE_VENDOR=		gnu
FPC_EQUIVALENT=		archivers/gtar
INFO_SUBDIR=		.

MUST_CONFIGURE=		gnu
CONFIGURE_ENV=		DEFAULT_ARCHIVE=/dev/sa0
			DEFAULT_RMT_COMMAND=/etc/rmt
			gl_cv_func_mknod_works=yes

[NLS].CONFIGURE_ENABLE_BOTH=		nls
[NLS].USES_ON=				gettext-runtime

[NOPREFIX].DESCRIPTION=			Build without prefixing all programs with "g"
[NOPREFIX].CONFIGURE_ARGS_OFF=		--program-prefix=g

[FILE:620:descriptions/desc.single.standard]
This is the Free Software Foundation's "tar" tape archiver.

GNU tar saves many files together into a single tape or disk archive,
and can restore individual files from the archive.  It includes
multivolume support, the ability to archive sparse files, automatic
archive compression/decompression, remote archives and special
features that allow tar to be used for incremental and full backups.
This distribution also includes rmt, the remote tape server.

Note that this port will install these utilities with a 'g' prefix,
e.g. gtar, but the man pages and info documentation will refer to
them without the 'g' prefix.


[FILE:697:descriptions/desc.single.nls]
This is the Free Software Foundation's "tar" tape archiver.

GNU tar saves many files together into a single tape or disk archive,
and can restore individual files from the archive.  It includes
multivolume support, the ability to archive sparse files, automatic
archive compression/decompression, remote archives and special
features that allow tar to be used for incremental and full backups.
This distribution also includes rmt, the remote tape server.

Note that this port will install these utilities with a 'g' prefix,
e.g. gtar, but the man pages and info documentation will refer to
them without the 'g' prefix.  Also, this version has native language
support unlike the standard variant.


[FILE:499:descriptions/desc.single.noprefix]
This is the Free Software Foundation's "tar" tape archiver.

GNU tar saves many files together into a single tape or disk archive,
and can restore individual files from the archive.  It includes
multivolume support, the ability to archive sparse files, automatic
archive compression/decompression, remote archives and special
features that allow tar to be used for incremental and full backups.
This distribution also includes rmt, the remote tape server.

This variant has native language support.


[FILE:94:distinfo]
f1bf92dbb1e1ab27911a861ea8dde8208ee774866c46c0bb6ead41f4d1f4d2d3      2108028 tar-1.30.tar.xz


[FILE:72:manifests/plist.single.standard]
bin/gtar
libexec/grmt
share/man/man1/gtar.1.gz
share/man/man8/grmt.8.gz


[FILE:1411:manifests/plist.single.nls]
bin/gtar
libexec/grmt
share/man/man1/gtar.1.gz
share/man/man8/grmt.8.gz
share/locale/bg/LC_MESSAGES/tar.mo
share/locale/ca/LC_MESSAGES/tar.mo
share/locale/cs/LC_MESSAGES/tar.mo
share/locale/da/LC_MESSAGES/tar.mo
share/locale/de/LC_MESSAGES/tar.mo
share/locale/el/LC_MESSAGES/tar.mo
share/locale/eo/LC_MESSAGES/tar.mo
share/locale/es/LC_MESSAGES/tar.mo
share/locale/et/LC_MESSAGES/tar.mo
share/locale/eu/LC_MESSAGES/tar.mo
share/locale/fi/LC_MESSAGES/tar.mo
share/locale/fr/LC_MESSAGES/tar.mo
share/locale/ga/LC_MESSAGES/tar.mo
share/locale/gl/LC_MESSAGES/tar.mo
share/locale/hr/LC_MESSAGES/tar.mo
share/locale/hu/LC_MESSAGES/tar.mo
share/locale/id/LC_MESSAGES/tar.mo
share/locale/it/LC_MESSAGES/tar.mo
share/locale/ja/LC_MESSAGES/tar.mo
share/locale/ko/LC_MESSAGES/tar.mo
share/locale/ky/LC_MESSAGES/tar.mo
share/locale/ms/LC_MESSAGES/tar.mo
share/locale/nb/LC_MESSAGES/tar.mo
share/locale/nl/LC_MESSAGES/tar.mo
share/locale/pl/LC_MESSAGES/tar.mo
share/locale/pt/LC_MESSAGES/tar.mo
share/locale/pt_BR/LC_MESSAGES/tar.mo
share/locale/ro/LC_MESSAGES/tar.mo
share/locale/ru/LC_MESSAGES/tar.mo
share/locale/sk/LC_MESSAGES/tar.mo
share/locale/sl/LC_MESSAGES/tar.mo
share/locale/sr/LC_MESSAGES/tar.mo
share/locale/sv/LC_MESSAGES/tar.mo
share/locale/tr/LC_MESSAGES/tar.mo
share/locale/uk/LC_MESSAGES/tar.mo
share/locale/vi/LC_MESSAGES/tar.mo
share/locale/zh_CN/LC_MESSAGES/tar.mo
share/locale/zh_TW/LC_MESSAGES/tar.mo


[FILE:1407:manifests/plist.single.noprefix]
bin/tar
libexec/rmt
share/man/man1/tar.1.gz
share/man/man8/rmt.8.gz
share/locale/bg/LC_MESSAGES/tar.mo
share/locale/ca/LC_MESSAGES/tar.mo
share/locale/cs/LC_MESSAGES/tar.mo
share/locale/da/LC_MESSAGES/tar.mo
share/locale/de/LC_MESSAGES/tar.mo
share/locale/el/LC_MESSAGES/tar.mo
share/locale/eo/LC_MESSAGES/tar.mo
share/locale/es/LC_MESSAGES/tar.mo
share/locale/et/LC_MESSAGES/tar.mo
share/locale/eu/LC_MESSAGES/tar.mo
share/locale/fi/LC_MESSAGES/tar.mo
share/locale/fr/LC_MESSAGES/tar.mo
share/locale/ga/LC_MESSAGES/tar.mo
share/locale/gl/LC_MESSAGES/tar.mo
share/locale/hr/LC_MESSAGES/tar.mo
share/locale/hu/LC_MESSAGES/tar.mo
share/locale/id/LC_MESSAGES/tar.mo
share/locale/it/LC_MESSAGES/tar.mo
share/locale/ja/LC_MESSAGES/tar.mo
share/locale/ko/LC_MESSAGES/tar.mo
share/locale/ky/LC_MESSAGES/tar.mo
share/locale/ms/LC_MESSAGES/tar.mo
share/locale/nb/LC_MESSAGES/tar.mo
share/locale/nl/LC_MESSAGES/tar.mo
share/locale/pl/LC_MESSAGES/tar.mo
share/locale/pt/LC_MESSAGES/tar.mo
share/locale/pt_BR/LC_MESSAGES/tar.mo
share/locale/ro/LC_MESSAGES/tar.mo
share/locale/ru/LC_MESSAGES/tar.mo
share/locale/sk/LC_MESSAGES/tar.mo
share/locale/sl/LC_MESSAGES/tar.mo
share/locale/sr/LC_MESSAGES/tar.mo
share/locale/sv/LC_MESSAGES/tar.mo
share/locale/tr/LC_MESSAGES/tar.mo
share/locale/uk/LC_MESSAGES/tar.mo
share/locale/vi/LC_MESSAGES/tar.mo
share/locale/zh_CN/LC_MESSAGES/tar.mo
share/locale/zh_TW/LC_MESSAGES/tar.mo


[FILE:533:patches/patch-configure]
Hack to disable shared library detection, so configure won't try
to link with "/usr/local/lib/libiconv.so -static".

--- configure.orig	2017-12-17 11:25:08 UTC
+++ configure
@@ -37451,7 +37451,7 @@ fi
 $as_echo "$acl_cv_rpath" >&6; }
   wl="$acl_cv_wl"
   acl_libext="$acl_cv_libext"
-  acl_shlibext="$acl_cv_shlibext"
+  acl_shlibext="${SHLIBEXT-$acl_cv_shlibext}"
   acl_libname_spec="$acl_cv_libname_spec"
   acl_library_names_spec="$acl_cv_library_names_spec"
   acl_hardcode_libdir_flag_spec="$acl_cv_hardcode_libdir_flag_spec"


[FILE:597:patches/patch-gnu_error.c]
Fix remfiles01.at and remfiles02.at: error() needs to fetch the
name set by set_program_name().

--- gnu/error.c.orig	2017-12-16 21:23:33 UTC
+++ gnu/error.c
@@ -42,8 +42,6 @@
 # define USE_UNLOCKED_IO 0
 # define _GL_ATTRIBUTE_FORMAT_PRINTF(a, b)
 # define _GL_ARG_NONNULL(a)
-#else
-# include "getprogname.h"
 #endif
 
 #if USE_UNLOCKED_IO
@@ -119,7 +117,7 @@ int strerror_r (int errnum, char *buf, s
 #  endif
 # endif
 
-#define program_name getprogname ()
+extern char *program_name;
 
 # if GNULIB_STRERROR_R_POSIX || HAVE_STRERROR_R || defined strerror_r
 #  define __strerror_r strerror_r


[FILE:394:patches/patch-src_utf8.c]
Work around an iconv(3) portability issue that trips up sparse07.at.
https://lists.gnu.org/archive/html/bug-tar/2018-04/threads.html

--- src/utf8.c.orig	2018-04-30 17:25:34 UTC
+++ src/utf8.c
@@ -85,7 +85,7 @@ utf8_convert (bool to_utf, char const *i
   ib = (char ICONV_CONST *) input;
   rc = iconv (cd, &ib, &inlen, &ob, &outlen);
   *ob = 0;
-  return rc != -1;
+  return rc == 0;
 }
 
 


[FILE:409:patches/patch-tests_difflink.at]
https://git.savannah.gnu.org/cgit/tar.git/commit/?id=847a36f064efed676ae007b1def3c0db364cdddb

https://lists.gnu.org/archive/html/bug-tar/2018-04/msg00012.html

--- tests/difflink.at.orig	2017-11-10 03:55:18 UTC
+++ tests/difflink.at
@@ -20,8 +20,8 @@ AT_TAR_CHECK([
 mkdir a
 genfile -f a/x
 ln -s x a/y
-ln a/y a/z
-tar cf a.tar a
+ln -P a/y a/z
+tar cf a.tar a/x a/y a/z
 rm a/z
 ln -s x a/z
 tar df a.tar


[FILE:548:patches/patch-tests_numeric.at]
https://lists.gnu.org/archive/html/bug-tar/2016-06/txt9bP0DVvYnu.txt

--- tests/numeric.at.orig	2016-03-18 17:23:55 UTC
+++ tests/numeric.at
@@ -27,14 +27,16 @@ tar $1 -vvf a dir |dnl
 ])
 
 AT_TAR_CHECK([
-mkdir dir
-genfile --file dir/file
-
 MYUID=$(id -u) || AT_SKIP_TEST
 MYGID=$(id -g) || AT_SKIP_TEST
 MYUSR=$(id -un) || AT_SKIP_TEST
 MYGRP=$(id -gn) || AT_SKIP_TEST
 
+mkdir dir
+# Ensure correct group id on BSDs.
+chown :$MYGID dir >/dev/null 2>/dev/null
+genfile --file dir/file
+
 TESTOP([--create])
 TESTOP([--list])
 TESTOP([--diff])

