# Buildsheet autogenerated by ravenadm tool -- Do not edit.

NAMEBASE=		telepathy-logger
VERSION=		0.8.2
KEYWORDS=		net_im
VARIANTS=		std
SDESC[std]=		Telepathy framework logging daemon
HOMEPAGE=		https://telepathy.freedesktop.org/components/telepathy-logger/
CONTACT=		nobody

DOWNLOAD_GROUPS=	main
SITES[main]=		https://telepathy.freedesktop.org/releases/telepathy-logger/
DISTFILE[1]=		telepathy-logger-0.8.2.tar.bz2:main
DF_INDEX=		1
SPKGS[std]=		set
			primary
			dev
			docs

OPTIONS_AVAILABLE=	none
OPTIONS_STANDARD=	none

BUILD_DEPENDS=		libxslt:dev:std
			telepathy-glib:dev:std
BUILDRUN_DEPENDS=	telepathy-glib:primary:std

USES=			gmake pkgconfig sqlite libtool schemas:primary
			gtk-doc gettext:tools python:build
GNOME_COMPONENTS=	glib intltool libxml2 introspection

LICENSE=		LGPL21+:primary
LICENSE_TERMS=		primary:{{WRKDIR}}/TERMS
LICENSE_FILE=		LGPL21+:{{WRKSRC}}/COPYING
LICENSE_AWK=		TERMS:"^$$"
LICENSE_SOURCE=		TERMS:{{WRKSRC}}/src/telepathy-logger.c
LICENSE_SCHEME=		solo

FPC_EQUIVALENT=		net-im/telepathy-logger
GLIB_SCHEMAS=		org.freedesktop.Telepathy.Logger.gschema.xml

MUST_CONFIGURE=		gnu

MAKE_ENV=		PYTHONDONTWRITEBYTECODE=1

INSTALL_TARGET=		install-strip
SOVERSION=		3.3.0

CFLAGS=			-Wno-cast-function-type

post-patch:
	${REINPLACE_CMD} -e 's|/usr/bin/python|/usr/bin/env python|g' \
		${WRKSRC}/tools/*.py

[FILE:511:descriptions/desc.primary]
Telepathy is a flexible, modular communications framework for desktop and
mobile devices that enables real-time communication via pluggable protocol
backends. Telepathy is a communications service that can be accessed by
many applications (???clients???) simultaneously. This allows any
application to access presence information, request a communication channel
(potentially handled by another client), or provide collaboration features
contact-to-contact.

This package contains telepathy's logging facility.


[FILE:109:distinfo]
8fcad534d653b1b365132c5b158adae947810ffbae9843f72dd1797966415dae       562670 telepathy-logger-0.8.2.tar.bz2


[FILE:343:manifests/plist.primary]
lib/
 libtelepathy-logger.so.%%SOMAJOR%%
 libtelepathy-logger.so.%%SOVERSION%%
lib/girepository-1.0/TelepathyLogger-0.2.typelib
libexec/telepathy-logger
share/dbus-1/services/
 org.freedesktop.Telepathy.Client.Logger.service
 org.freedesktop.Telepathy.Logger.service
share/gir-1.0/TelepathyLogger-0.2.gir
share/telepathy/clients/Logger.client


[FILE:233:manifests/plist.dev]
include/telepathy-logger-0.2/telepathy-logger/
 call-event.h
 entity.h
 event.h
 log-manager.h
 log-walker.h
 telepathy-logger.h
 text-event.h
lib/
 libtelepathy-logger.a
 libtelepathy-logger.so
lib/pkgconfig/telepathy-logger-0.2.pc


[FILE:318:manifests/plist.docs]
share/doc/telepathy-logger/
 TplCallEvent.html
 TplEntity.html
 TplEvent.html
 TplLogManager.html
 TplLogWalker.html
 TplTextEvent.html
 ch-public.html
 home.png
 index.html
 index.sgml
 left-insensitive.png
 left.png
 right-insensitive.png
 right.png
 style.css
 telepathy-logger.devhelp2
 up-insensitive.png
 up.png


[FILE:966:patches/patch-configure]
--- configure.orig	2015-04-30 11:32:10 UTC
+++ configure
@@ -14348,8 +14348,8 @@ install-data-am: install-gsettings-schem
 .SECONDARY: $(gsettings_SCHEMAS)
 
 gsettings__base_list = \
-  sed "$$!N;$$!N;$$!N;$$!N;$$!N;$$!N;$$!N;s/\n/ /g" | \
-  sed "$$!N;$$!N;$$!N;$$!N;s/\n/ /g"
+  sed '\''$$!N;$$!N;$$!N;$$!N;$$!N;$$!N;$$!N;s/\n/ /g'\'' | \
+  sed '\''$$!N;$$!N;$$!N;$$!N;s/\n/ /g'\''
 
 install-gsettings-schemas: $(gsettings_SCHEMAS:.xml=.valid) $(gsettings__enum_file)
 	@$(NORMAL_INSTALL)
@@ -15420,8 +15420,6 @@ $as_echo_n "checking to see if compiler
 
   save_CFLAGS="$CFLAGS"
   save_CXXFLAGS="$CXXFLAGS"
-  CFLAGS="$CFLAGS -D_POSIX_SOURCE"
-  CXXFLAGS="$CXXFLAGS -D_POSIX_SOURCE"
 
   cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
@@ -15444,7 +15442,6 @@ rm -f core conftest.err conftest.$ac_obj
   CXXFLAGS="$save_CXXFLAGS"
 
   if test "X$flag_ok" = Xyes ; then
-    ERROR_CFLAGS="$ERROR_CFLAGS -D_POSIX_SOURCE"
     true
   else
 


[FILE:1684:patches/patch-gcc14-imcompat-pointers]
From 2e50d1855b3395b622c768094ff2b617a0208724 Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?Ball=C3=B3=20Gy=C3=B6rgy?= <ballogyor@gmail.com>
Date: Thu, 1 Aug 2024 19:26:43 +0200
Subject: [PATCH] Fix incompatible pointer types

gcc14 defaults to -Werror=incompatible-pointer-types .
Fix build error with this option.
---
 telepathy-logger/conf.c         | 2 +-
 telepathy-logger/dbus-service.c | 2 +-
 telepathy-logger/log-manager.c  | 2 +-
 3 files changed, 3 insertions(+), 3 deletions(-)

--- telepathy-logger/conf.c.orig
+++ telepathy-logger/conf.c
@@ -132,7 +132,7 @@ tpl_conf_constructor (GType type,
 
   if (conf_singleton != NULL)
     {
-      retval = g_object_ref (conf_singleton);
+      retval = g_object_ref (G_OBJECT (conf_singleton));
     }
   else
     {
--- telepathy-logger/dbus-service.c.orig
+++ telepathy-logger/dbus-service.c
@@ -97,7 +97,7 @@ favourite_contact_closure_new (TplDBusService *self,
   FavouriteContactClosure *closure;
 
   closure = g_slice_new0 (FavouriteContactClosure);
-  closure->service = g_object_ref (G_OBJECT (self));
+  closure->service = TPL_DBUS_SERVICE (g_object_ref (G_OBJECT (self)));
   closure->account = g_strdup (account);
   closure->contact_id = g_strdup (contact_id);
   /* XXX: ideally we'd up the ref count or duplicate this */
--- telepathy-logger/log-manager.c.orig
+++ telepathy-logger/log-manager.c
@@ -160,7 +160,7 @@ log_manager_constructor (GType type,
   GObject *retval = NULL;
 
   if (G_LIKELY (manager_singleton))
-    retval = g_object_ref (manager_singleton);
+    retval = g_object_ref (G_OBJECT (manager_singleton));
   else
     {
       retval = G_OBJECT_CLASS (tpl_log_manager_parent_class)->constructor (


[FILE:1334:patches/patch-tools_c-constants-gen.py]
--- tools/c-constants-gen.py.orig	2015-04-28 16:48:03 UTC
+++ tools/c-constants-gen.py
@@ -3,7 +3,7 @@
 from sys import argv, stdout, stderr
 import xml.dom.minidom
 
-from libtpcodegen import file_set_contents
+from libtpcodegen import file_set_contents, u
 from libglibcodegen import NS_TP, get_docstring, \
         get_descendant_text, get_by_path
 
@@ -12,7 +12,7 @@ class Generator(object):
         self.prefix = prefix + '_'
         self.spec = get_by_path(dom, "spec")[0]
 
-	self.output_base = output_base
+        self.output_base = output_base
         self.__header = []
         self.__docs = []
 
@@ -21,14 +21,14 @@ class Generator(object):
         self.do_body()
         self.do_footer()
 
-        file_set_contents(self.output_base + '.h', ''.join(self.__header))
-        file_set_contents(self.output_base + '-gtk-doc.h', ''.join(self.__docs))
+        file_set_contents(self.output_base + '.h', u('').join(self.__header).encode('utf-8'))
+        file_set_contents(self.output_base + '-gtk-doc.h', u('').join(self.__docs).encode('utf-8'))
 
     def write(self, code):
-        self.__header.append(code.encode('utf-8'))
+        self.__header.append(code)
 
     def d(self, code):
-        self.__docs.append(code.encode('utf-8'))
+        self.__docs.append(code)
 
     # Header
     def do_header(self):


[FILE:1966:patches/patch-tools_glib-client-gen.py]
--- tools/glib-client-gen.py.orig	2015-04-28 16:46:29 UTC
+++ tools/glib-client-gen.py
@@ -27,8 +27,8 @@ import os.path
 import xml.dom.minidom
 from getopt import gnu_getopt
 
-from libtpcodegen import file_set_contents
-from libglibcodegen import Signature, type_to_gtype, cmp_by_name, \
+from libtpcodegen import file_set_contents, key_by_name, u
+from libglibcodegen import Signature, type_to_gtype, \
         get_docstring, xml_escape, get_deprecated
 
 
@@ -74,18 +74,12 @@ class Generator(object):
         self.guard = opts.get('--guard', None)
 
     def h(self, s):
-        if isinstance(s, unicode):
-            s = s.encode('utf-8')
         self.__header.append(s)
 
     def b(self, s):
-        if isinstance(s, unicode):
-            s = s.encode('utf-8')
         self.__body.append(s)
 
     def d(self, s):
-        if isinstance(s, unicode):
-            s = s.encode('utf-8')
         self.__docs.append(s)
 
     def get_iface_quark(self):
@@ -1187,7 +1181,7 @@ class Generator(object):
         self.b('')
 
         nodes = self.dom.getElementsByTagName('node')
-        nodes.sort(cmp_by_name)
+        nodes.sort(key=key_by_name)
 
         for node in nodes:
             self.do_interface(node)
@@ -1240,9 +1234,9 @@ class Generator(object):
             self.h('#endif /* defined (%s) */' % self.guard)
             self.h('')
 
-        file_set_contents(self.basename + '.h', '\n'.join(self.__header))
-        file_set_contents(self.basename + '-body.h', '\n'.join(self.__body))
-        file_set_contents(self.basename + '-gtk-doc.h', '\n'.join(self.__docs))
+        file_set_contents(self.basename + '.h', u('\n').join(self.__header).encode('utf-8'))
+        file_set_contents(self.basename + '-body.h', u('\n').join(self.__body).encode('utf-8'))
+        file_set_contents(self.basename + '-gtk-doc.h', u('\n').join(self.__docs).encode('utf-8'))
 
 def types_to_gtypes(types):
     return [type_to_gtype(t)[1] for t in types]


[FILE:1330:patches/patch-tools_glib-client-marshaller-gen.py]
--- tools/glib-client-marshaller-gen.py.orig	2015-04-28 16:48:03 UTC
+++ tools/glib-client-marshaller-gen.py
@@ -31,23 +31,23 @@ class Generator(object):
         for signal in signals:
             self.do_signal(signal)
 
-        print 'void'
-        print '%s_register_dbus_glib_marshallers (void)' % self.prefix
-        print '{'
+        print('void')
+        print('%s_register_dbus_glib_marshallers (void)' % self.prefix)
+        print('{')
 
-        all = self.marshallers.keys()
+        all = list(self.marshallers.keys())
         all.sort()
         for marshaller in all:
             rhs = self.marshallers[marshaller]
 
-            print '  dbus_g_object_register_marshaller ('
-            print '      g_cclosure_marshal_generic,'
-            print '      G_TYPE_NONE,       /* return */'
+            print('  dbus_g_object_register_marshaller (')
+            print('      g_cclosure_marshal_generic,')
+            print('      G_TYPE_NONE,       /* return */')
             for type in rhs:
-                print '      G_TYPE_%s,' % type.replace('VOID', 'NONE')
-            print '      G_TYPE_INVALID);'
+                print('      G_TYPE_%s,' % type.replace('VOID', 'NONE'))
+            print('      G_TYPE_INVALID);')
 
-        print '}'
+        print('}')
 
 
 def types_to_gtypes(types):


[FILE:2188:patches/patch-tools_glib-ginterface-gen.py]
--- tools/glib-ginterface-gen.py.orig	2015-04-28 16:48:03 UTC
+++ tools/glib-ginterface-gen.py
@@ -26,8 +26,8 @@ import sys
 import os.path
 import xml.dom.minidom
 
-from libtpcodegen import file_set_contents
-from libglibcodegen import Signature, type_to_gtype, cmp_by_name, \
+from libtpcodegen import file_set_contents, key_by_name, u
+from libglibcodegen import Signature, type_to_gtype, \
         NS_TP, dbus_gutils_wincaps_to_uscore
 
 
@@ -85,18 +85,12 @@ class Generator(object):
         self.allow_havoc = allow_havoc
 
     def h(self, s):
-        if isinstance(s, unicode):
-            s = s.encode('utf-8')
         self.__header.append(s)
 
     def b(self, s):
-        if isinstance(s, unicode):
-            s = s.encode('utf-8')
         self.__body.append(s)
 
     def d(self, s):
-        if isinstance(s, unicode):
-            s = s.encode('utf-8')
         self.__docs.append(s)
 
     def do_node(self, node):
@@ -733,7 +727,7 @@ class Generator(object):
 
     def __call__(self):
         nodes = self.dom.getElementsByTagName('node')
-        nodes.sort(cmp_by_name)
+        nodes.sort(key=key_by_name)
 
         self.h('#include <glib-object.h>')
         self.h('#include <dbus/dbus-glib.h>')
@@ -763,12 +757,12 @@ class Generator(object):
 
         self.h('')
         self.b('')
-        file_set_contents(self.basename + '.h', '\n'.join(self.__header))
-        file_set_contents(self.basename + '.c', '\n'.join(self.__body))
-        file_set_contents(self.basename + '-gtk-doc.h', '\n'.join(self.__docs))
+        file_set_contents(self.basename + '.h', u('\n').join(self.__header).encode('utf-8'))
+        file_set_contents(self.basename + '.c', u('\n').join(self.__body).encode('utf-8'))
+        file_set_contents(self.basename + '-gtk-doc.h', u('\n').join(self.__docs).encode('utf-8'))
 
 def cmdline_error():
-    print """\
+    print("""\
 usage:
     gen-ginterface [OPTIONS] xmlfile Prefix_
 options:
@@ -788,7 +782,7 @@ options:
             void symbol (DBusGMethodInvocation *context)
         and return some sort of "not implemented" error via
             dbus_g_method_return_error (context, ...)
-"""
+""")
     sys.exit(1)
 
 


[FILE:1565:patches/patch-tools_glib-gtypes-generator.py]
--- tools/glib-gtypes-generator.py.orig	2015-04-28 16:48:03 UTC
+++ tools/glib-gtypes-generator.py
@@ -23,7 +23,7 @@
 import sys
 import xml.dom.minidom
 
-from libtpcodegen import file_set_contents
+from libtpcodegen import file_set_contents, u
 from libglibcodegen import escape_as_identifier, \
                            get_docstring, \
                            NS_TP, \
@@ -68,13 +68,13 @@ class GTypesGenerator(object):
         self.need_other_arrays = {}
 
     def h(self, code):
-        self.header.append(code.encode("utf-8"))
+        self.header.append(code)
 
     def c(self, code):
-        self.body.append(code.encode("utf-8"))
+        self.body.append(code)
 
     def d(self, code):
-        self.docs.append(code.encode('utf-8'))
+        self.docs.append(code)
 
     def do_mapping_header(self, mapping):
         members = mapping.getElementsByTagNameNS(NS_TP, 'member')
@@ -292,9 +292,9 @@ class GTypesGenerator(object):
             self.c('  return t;\n')
             self.c('}\n\n')
 
-        file_set_contents(self.output + '.h', ''.join(self.header))
-        file_set_contents(self.output + '-body.h', ''.join(self.body))
-        file_set_contents(self.output + '-gtk-doc.h', ''.join(self.docs))
+        file_set_contents(self.output + '.h', u('').join(self.header).encode('utf-8'))
+        file_set_contents(self.output + '-body.h', u('').join(self.body).encode('utf-8'))
+        file_set_contents(self.output + '-gtk-doc.h', u('').join(self.docs).encode('utf-8'))
 
 if __name__ == '__main__':
     argv = sys.argv[1:]


[FILE:1372:patches/patch-tools_glib-interfaces-gen.py]
--- tools/glib-interfaces-gen.py.orig	2015-04-28 16:48:03 UTC
+++ tools/glib-interfaces-gen.py
@@ -3,7 +3,7 @@
 from sys import argv, stdout, stderr
 import xml.dom.minidom
 
-from libtpcodegen import file_set_contents
+from libtpcodegen import file_set_contents, u
 from libglibcodegen import NS_TP, get_docstring, \
         get_descendant_text, get_by_path
 
@@ -24,22 +24,22 @@ class Generator(object):
         self.spec = get_by_path(dom, "spec")[0]
 
     def h(self, code):
-        self.decls.append(code.encode('utf-8'))
+        self.decls.append(code)
 
     def c(self, code):
-        self.impls.append(code.encode('utf-8'))
+        self.impls.append(code)
 
     def d(self, code):
-        self.docs.append(code.encode('utf-8'))
+        self.docs.append(code)
 
     def __call__(self):
         for f in self.h, self.c:
             self.do_header(f)
         self.do_body()
 
-        file_set_contents(self.implfile, ''.join(self.impls))
-        file_set_contents(self.declfile, ''.join(self.decls))
-        file_set_contents(self.docfile, ''.join(self.docs))
+        file_set_contents(self.implfile, u('').join(self.impls).encode('utf-8'))
+        file_set_contents(self.declfile, u('').join(self.decls).encode('utf-8'))
+        file_set_contents(self.docfile, u('').join(self.docs).encode('utf-8'))
 
     # Header
     def do_header(self, f):


[FILE:943:patches/patch-tools_libglibcodegen.py]
--- tools/libglibcodegen.py.orig	2015-04-28 16:46:29 UTC
+++ tools/libglibcodegen.py
@@ -154,7 +154,7 @@ def type_to_gtype(s):
         return ("GHashTable *", "DBUS_TYPE_G_STRING_STRING_HASHTABLE", "BOXED", False)
     elif s[:2] == 'a{':  #some arbitrary hash tables
         if s[2] not in ('y', 'b', 'n', 'q', 'i', 'u', 's', 'o', 'g'):
-            raise Exception, "can't index a hashtable off non-basic type " + s
+            raise Exception("can't index a hashtable off non-basic type " + s)
         first = type_to_gtype(s[2])
         second = type_to_gtype(s[3:-1])
         return ("GHashTable *", "(dbus_g_type_get_map (\"GHashTable\", " + first[1] + ", " + second[1] + "))", "BOXED", False)
@@ -169,4 +169,4 @@ def type_to_gtype(s):
         return ("GValueArray *", gtype, "BOXED", True)
 
     # we just don't know ..
-    raise Exception, "don't know the GType for " + s
+    raise Exception("don't know the GType for " + s)


[FILE:1811:patches/patch-tools_libtpcodegen.py]
--- tools/libtpcodegen.py.orig	2015-04-28 16:46:29 UTC
+++ tools/libtpcodegen.py
@@ -21,6 +21,7 @@ please make any changes there.
 # Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA  02110-1301  USA
 
 import os
+import sys
 from string import ascii_letters, digits
 
 
@@ -28,6 +29,20 @@ NS_TP = "http://telepathy.freedesktop.or
 
 _ASCII_ALNUM = ascii_letters + digits
 
+if sys.version_info[0] >= 3:
+    def u(s):
+        """Return s, which must be a str literal with no non-ASCII characters.
+        This is like a more restricted form of the Python 2 u'' syntax.
+        """
+        return s.encode('ascii').decode('ascii')
+else:
+    def u(s):
+        """Return a Unicode version of s, which must be a str literal
+        (a bytestring) in which each byte is an ASCII character.
+        This is like a more restricted form of the u'' syntax.
+        """
+        return s.decode('ascii')
+
 def file_set_contents(filename, contents):
     try:
         os.remove(filename)
@@ -38,13 +53,15 @@ def file_set_contents(filename, contents
     except OSError:
         pass
 
-    open(filename + '.tmp', 'w').write(contents)
+    open(filename + '.tmp', 'wb').write(contents)
     os.rename(filename + '.tmp', filename)
 
 def cmp_by_name(node1, node2):
     return cmp(node1.getAttributeNode("name").nodeValue,
                node2.getAttributeNode("name").nodeValue)
 
+def key_by_name(node):
+    return node.getAttributeNode("name").nodeValue
 
 def escape_as_identifier(identifier):
     """Escape the given string to be a valid D-Bus object path or service
@@ -168,6 +185,9 @@ class _SignatureIter:
         self.remaining = string
 
     def next(self):
+        return self.__next__()
+
+    def __next__(self):
         if self.remaining == '':
             raise StopIteration
 


[FILE:1039:patches/patch-tools_xincludator.py]
--- tools/xincludator.py.orig	2015-04-28 16:46:29 UTC
+++ tools/xincludator.py
@@ -1,17 +1,19 @@
 #!/usr/bin/python
 
+import sys
 from sys import argv, stdout, stderr
 import codecs, locale
 import os
 import xml.dom.minidom
 
-stdout = codecs.getwriter('utf-8')(stdout)
+if sys.version_info[0] < 3:
+    stdout = codecs.getwriter('utf-8')(stdout)
 
 NS_XI = 'http://www.w3.org/2001/XInclude'
 
 def xincludate(dom, base, dropns = []):
     remove_attrs = []
-    for i in xrange(dom.documentElement.attributes.length):
+    for i in range(dom.documentElement.attributes.length):
         attr = dom.documentElement.attributes.item(i)
         if attr.prefix == 'xmlns':
             if attr.localName in dropns:
@@ -34,6 +36,11 @@ if __name__ == '__main__':
     argv = argv[1:]
     dom = xml.dom.minidom.parse(argv[0])
     xincludate(dom, argv[0])
-    xml = dom.toxml()
+
+    if sys.version_info[0] >= 3:
+        xml = dom.toxml(encoding=None)
+    else:
+        xml = dom.toxml()
+
     stdout.write(xml)
     stdout.write('\n')

