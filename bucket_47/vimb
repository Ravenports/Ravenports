# Buildsheet autogenerated by ravenadm tool -- Do not edit.

NAMEBASE=		vimb
VERSION=		3.3.0
KEYWORDS=		www
VARIANTS=		standard
SDESC[standard]=	Vim-like browser
HOMEPAGE=		https://fanglingsu.github.io/vimb/
CONTACT=		Leonid_Bobrov[mazocomp@disroot.org]

DOWNLOAD_GROUPS=	main
SITES[main]=		GITHUB/fanglingsu:vimb:3.3.0
DISTFILE[1]=		generated:main
DF_INDEX=		1
SPKGS[standard]=	single

OPTIONS_AVAILABLE=	none
OPTIONS_STANDARD=	none

BUILDRUN_DEPENDS=	webkit2:single:gtk3

USES=			desktop-utils:single gmake pkgconfig

LICENSE=		GPLv3+:single
LICENSE_TERMS=		single:{{WRKDIR}}/TERMS
LICENSE_FILE=		GPLv3+:{{WRKSRC}}/LICENSE
LICENSE_AWK=		TERMS:"^\#include"
LICENSE_SOURCE=		TERMS:{{WRKSRC}}/src/main.c
LICENSE_SCHEME=		solo

FPC_EQUIVALENT=		www/vimb-gtk3

MAKE_ENV=		V=1

CFLAGS=			-D_BSD_SOURCE

post-install:
	${STRIP_CMD} ${STAGEDIR}${PREFIX}/bin/vimb
	${STRIP_CMD} ${STAGEDIR}${PREFIX}/lib/vimb/webext_main.so

[FILE:411:descriptions/desc.single]
Vimb is a fast and lightweight vim like web browser based on the webkit
web browser engine and the GTK toolkit. Vimb is modal like the great vim
editor and also easily configurable during runtime. Vimb is mostly
keyboard driven and does not detract you from your daily work.

If your are familiar with vim or have some experience with pentadactyl the
use of vimb would be a breeze, if not we missed our target.


[FILE:107:distinfo]
5c6fe39b1b2ca18a342bb6683f7fd5b139ead53903f57dd9eecd5a1074576d6c       136151 fanglingsu-vimb-3.3.0.tar.gz


[FILE:90:manifests/plist.single]
bin/vimb
lib/vimb/webext_main.so
share/applications/vimb.desktop
share/man/man1/vimb.1.gz


[FILE:1324:patches/patch-config.mk]
--- config.mk.orig	2018-11-06 22:27:25 UTC
+++ config.mk
@@ -12,6 +12,7 @@ DOTDESKTOPPREFIX := $(DESTDIR)$(PREFIX)/
 LIBDIR           := $(DESTDIR)$(PREFIX)/lib/vimb
 RUNPREFIX        := $(PREFIX)
 EXTENSIONDIR     := $(RUNPREFIX)/lib/vimb
+OS               := $(shell uname -s)
 
 # define some directories
 SRCDIR  = src
@@ -26,17 +27,20 @@ COMMIT := $(shell git describe --tags --
 CFLAGS   += -std=c99 -pipe -Wall -fPIC
 CPPFLAGS += -DVERSION=\"${VERSION}\" -DEXTENSIONDIR=\"${EXTENSIONDIR}\" -DCOMMIT=\"$(COMMIT)\"
 CPPFLAGS += -DPROJECT=\"vimb\" -DPROJECT_UCFIRST=\"Vimb\"
-CPPFLAGS += -D_XOPEN_SOURCE=500
-CPPFLAGS += -D__BSD_VISIBLE
 CPPFLAGS += -DGSEAL_ENABLE
 CPPFLAGS += -DGTK_DISABLE_SINGLE_INCLUDES
 CPPFLAGS += -DGDK_DISABLE_DEPRECATED
 
+ifeq "$(findstring $(OS),FreeBSD DragonFly)" ""
+CPPFLAGS += -D_XOPEN_SOURCE=500
+CPPFLAGS += -D__BSD_VISIBLE
+endif
+
 # flags used to build webextension
 EXTTARGET   = webext_main.so
 EXTCFLAGS   = ${CFLAGS} $(shell pkg-config --cflags webkit2gtk-web-extension-4.0)
 EXTCPPFLAGS = $(CPPFLAGS)
-EXTLDFLAGS  = $(shell pkg-config --libs webkit2gtk-web-extension-4.0) -shared
+EXTLDFLAGS  = -Wl,-rpath,$(PREFIX)/lib $(shell pkg-config --libs webkit2gtk-web-extension-4.0) -shared
 
 # flags used for the main application
 CFLAGS     += $(shell pkg-config --cflags $(LIBS))

