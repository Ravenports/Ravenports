# Buildsheet autogenerated by ravenadm tool -- Do not edit.

NAMEBASE=		lua-socket
VERSION=		3.1.0
KEYWORDS=		net
VARIANTS=		lua52 lua53 lua54
SDESC[lua52]=		Comprehensive networking module for Lua 5.2
SDESC[lua53]=		Comprehensive networking module for Lua 5.3
SDESC[lua54]=		Comprehensive networking module for Lua 5.4
HOMEPAGE=		https://github.com/diegonehab/luasocket
CONTACT=		Michael_Reim[kraileth@elderlinux.org]

DOWNLOAD_GROUPS=	main
SITES[main]=		GITHUB/diegonehab:luasocket:v3.1.0
DISTFILE[1]=		generated:main
DF_INDEX=		1
SPKGS[lua52]=		single
SPKGS[lua53]=		single
SPKGS[lua54]=		single

OPTIONS_AVAILABLE=	LUA52 LUA53 LUA54
OPTIONS_STANDARD=	none
VOPTS[lua52]=		LUA52=ON LUA53=OFF LUA54=OFF
VOPTS[lua53]=		LUA52=OFF LUA53=ON LUA54=OFF
VOPTS[lua54]=		LUA52=OFF LUA53=OFF LUA54=ON

USES=			gmake pkgconfig

LICENSE=		MIT:single
LICENSE_FILE=		MIT:{{WRKSRC}}/LICENSE
LICENSE_SCHEME=		solo

FPC_EQUIVALENT=		net/luasocket

MAKE_ARGS=		LUAV={{LUA_VER}}

INSTALL_REQ_TOOLCHAIN=	yes

[LUA52].DESCRIPTION=			Build with Lua 5.2
[LUA52].USES_ON=			lua:5.2

[LUA53].DESCRIPTION=			Build with Lua 5.3
[LUA53].USES_ON=			lua:5.3

[LUA54].DESCRIPTION=			Build with Lua 5.4
[LUA54].USES_ON=			lua:5.4

post-patch:
	${CP} ${FILESDIR}/Makefile ${WRKSRC}
	${MV} ${WRKSRC}/src/makefile ${WRKSRC}/src/Makefile
	${REINPLACE_CMD} -e 's!__PREFIX__!${PREFIX}!g' \
		-e 's!__LUA_VER_STR__!${LUA_VER_STR}!g' \
		${WRKSRC}/src/Makefile

post-install:
	${STRIP_CMD} ${STAGEDIR}${LUA_MODLIBDIR}/mime/core.so \
		${STAGEDIR}${LUA_MODLIBDIR}/socket/core.so

[FILE:635:descriptions/desc.single]
LuaSocket is a Lua extension library that is composed of two parts: a C 
core that provides support for the TCP and UDP transport layers, and a set 
of Lua modules that add support for functionality commonly needed by 
applications that deal with the Internet.

The core support has been implemented so that it is both efficient and 
simple to use. Among the support modules, the most commonly used implement 
the SMTP, HTTP and FTP client protocols. These provide a very natural and 
generic interface to the functionality defined by each protocol. In 
addition, you will find that the MIME, URL and LTN12 modules can be very 
handy.


[FILE:112:distinfo]
bf033aeb9e62bcaa8d007df68c119c966418e8c9ef7e4f2d7e96bddeca9cca6e       336542 diegonehab-luasocket-3.1.0.tar.gz


[FILE:205:manifests/plist.single]
%%LUA_MODLIBDIR%%/mime/core.so
%%LUA_MODLIBDIR%%/socket/core.so
%%LUA_MODSHAREDIR%%/
 ltn12.lua
 mime.lua
 socket.lua
%%LUA_MODSHAREDIR%%/socket/
 ftp.lua
 headers.lua
 http.lua
 smtp.lua
 tp.lua
 url.lua


[FILE:542:patches/patch-src_makefile]
--- src/makefile.orig	2022-03-25 08:05:48 UTC
+++ src/makefile
@@ -48,9 +48,9 @@ LDIR_macosx?=share/lua/$(LUAV)
 # /usr/local/include
 # /usr/local/include/lua$(LUAV)
 # where lua headers are found for linux builds
-LUAINC_linux_base?=/usr/include
-LUAINC_linux?=$(LUAINC_linux_base)/lua/$(LUAV) $(LUAINC_linux_base)/lua$(LUAV)
-LUAPREFIX_linux?=/usr/local
+LUAINC_linux_base?=__PREFIX__/include
+LUAINC_linux?=$(LUAINC_linux_base)/lua__LUA_VER_STR__
+LUAPREFIX_linux?=__PREFIX__
 CDIR_linux?=lib/lua/$(LUAV)
 LDIR_linux?=share/lua/$(LUAV)
 


[FILE:293:files/Makefile]
PLAT?= linux
PLATS= macosx linux win32 mingw

all: $(PLAT)

$(PLATS) none install install-unix local clean:
	$(MAKE) -C src $@

install:
	$(MAKE) clean 
	@cd src; $(MAKE) $(PLAT)
	@cd src; $(MAKE) install

install-unix:
	$(MAKE) clean 
	@cd src; $(MAKE) $(PLAT)
	@cd src; $(MAKE) install-unix

