# Buildsheet autogenerated by ravenadm tool -- Do not edit.

NAMEBASE=		mupdf
VERSION=		1.17.0
KEYWORDS=		graphics
VARIANTS=		standard
SDESC[standard]=	Lightweight PDF and XPS viewer
HOMEPAGE=		https://mupdf.com/
CONTACT=		nobody

DOWNLOAD_GROUPS=	main
SITES[main]=		https://mupdf.com/downloads/archive/
			https://mupdf.com/downloads/
DISTFILE[1]=		mupdf-1.17.0-source.tar.gz:main
DF_INDEX=		1
SPKGS[standard]=	complete
			primary
			docs
			examples

OPTIONS_AVAILABLE=	none
OPTIONS_STANDARD=	none

BUILDRUN_DEPENDS=	curl:primary:standard
			freetype:primary:standard
			harfbuzz:primary:standard
			openjpeg:single:standard
			jbig2dec:single:standard
			freeglut:primary:standard

USES=			cpe gmake pkgconfig
XORG_COMPONENTS=	x11 xcursor xext xinerama xrandr

DISTNAME=		mupdf-1.17.0-source

LICENSE=		AGPLv3+:primary
LICENSE_TERMS=		primary:{{WRKDIR}}/TERMS
LICENSE_FILE=		AGPLv3+:{{WRKSRC}}/COPYING
LICENSE_SCHEME=		solo

CPE_VENDOR=		artifex
FPC_EQUIVALENT=		graphics/mupdf

MAKE_ARGS=		build=release
			prefix={{PREFIX}}
			mandir={{MANPREFIX}}/man
			verbose=yes
			SOVERSION=1.17.0

SOVERSION=		1.17.0

CFLAGS=			`pkg-config
			--cflags
			libopenjp2`
			-I{{WRKSRC}}/include/mupdf
			-I{{LOCALBASE}}/include/freetype2
			-I{{LOCALBASE}}/include/harfbuzz
VAR_ARCH[x86_64]=	CFLAGS=-fPIC

post-patch:
	${REINPLACE_CMD} -e "s|%%OPSYS%%|${OPSYS}|; s/-pipe -O2 //" \
		${WRKSRC}/Makerules

post-install:
	${MV} ${STAGEDIR}${PREFIX}/bin/mupdf-x11 ${STAGEDIR}${PREFIX}/bin/mupdf
	${INSTALL_PROGRAM} ${WRKSRC}/build/release/muraster \
		${STAGEDIR}${PREFIX}/bin
	${LN} -s libmupdf.so.1.17.0 \
		${STAGEDIR}${PREFIX}/lib/libmupdf.so
	${LN} -s libmupdfthird.so.1.17.0 \
		${STAGEDIR}${PREFIX}/lib/libmupdfthird.so
	${MKDIR ${STAGEDIR}${PREFIX}/share/examples
	${MV} ${STAGEDIR}${PREFIX}/share/doc/mupdf/examples \
		${STAGEDIR}${STD_EXAMPLESDIR}
	${RM} ${STAGEDIR}${STD_DOCDIR}/COPYING

post-extract:
	${RM} -r ${WRKSRC}/thirdparty/curl \
		${WRKSRC}/thirdparty/freetype \
		${WRKSRC}/thirdparty/freeglut \
		${WRKSRC}/thirdparty/harfbuzz \
		${WRKSRC}/thirdparty/jbig2dec \
		${WRKSRC}/thirdparty/openjpeg \
		${WRKSRC}/thirdparty/zlib
	${AWK} '/^LICENSE/,/^REPORTING/' ${WRKSRC}/README > ${WRKDIR}/TERMS

post-patch-sunos:
	${REINPLACE_CMD} -e '/define _XOPEN_SOURCE/d' \
		${WRKSRC}/platform/x11/x11_image.c

[FILE:828:descriptions/desc.primary]
MuPDF is a lightweight PDF viewer and toolkit written in portable C.

The renderer in MuPDF is tailored for high quality anti-aliased graphics.
It renders text with metrics and spacing accurate to within fractions of a
pixel for the highest fidelity in reproducing the look of a printed page on
screen.

MuPDF has a small footprint. A binary that includes the standard Roman
fonts is only one megabyte. A build with full CJK support (including an
Asian font) is approximately five megabytes.

MuPDF has support for all non-interactive PDF 1.7 features, and the toolkit
provides a simple API for accessing the internal structures of the PDF
document. Example code for navigating interactive links and bookmarks,
encrypting PDF files, extracting fonts, images, and searchable text, and
rendering pages to image files is provided.


[FILE:105:distinfo]
00e33fa89cb42f1ef9e3bb73671b1cb6d210f5159bd68168fa5c89ceb24dd48e     65510829 mupdf-1.17.0-source.tar.gz


[FILE:958:manifests/plist.primary]
bin/
 mupdf
 mupdf-gl
 mupdf-x11-curl
 muraster
 mutool
include/mupdf/
 fitz.h
 memento.h
 pdf.h
 ucdn.h
include/mupdf/fitz/
 archive.h
 band-writer.h
 bidi.h
 bitmap.h
 buffer.h
 color.h
 compress.h
 compressed-buffer.h
 config.h
 context.h
 crypt.h
 device.h
 display-list.h
 document.h
 filter.h
 font.h
 geometry.h
 getopt.h
 glyph-cache.h
 glyph.h
 hash.h
 image.h
 link.h
 log.h
 outline.h
 output-svg.h
 output.h
 path.h
 pixmap.h
 pool.h
 separation.h
 shade.h
 store.h
 stream.h
 string-util.h
 structured-text.h
 system.h
 text.h
 track-usage.h
 transition.h
 tree.h
 util.h
 version.h
 write-pixmap.h
 writer.h
 xml.h
include/mupdf/pdf/
 annot.h
 clean.h
 cmap.h
 crypt.h
 document.h
 event.h
 font.h
 form.h
 interpret.h
 javascript.h
 name-table.h
 object.h
 output-pdf.h
 page.h
 parse.h
 resource.h
 xref.h
lib/
 libmupdf.so
 libmupdf.so.%%SOVERSION%%
 libmupdfthird.so
 libmupdfthird.so.%%SOVERSION%%
share/man/man1/
 mupdf.1.gz
 mutool.1.gz


[FILE:463:manifests/plist.docs]
share/doc/mupdf/
 CHANGES
 README
 android-sdk.html
 artifex-logo.png
 building.html
 coding-overview.html
 coding-progressive.html
 coding-style.html
 index.html
 manual-mupdf-gl.html
 manual-mutool-clean.html
 manual-mutool-convert.html
 manual-mutool-create.html
 manual-mutool-draw.html
 manual-mutool-extract.html
 manual-mutool-merge.html
 manual-mutool-run.html
 manual-mutool-show.html
 manual-mutool-trace.html
 style.css
 template.html
 thirdparty.html


[FILE:254:manifests/plist.examples]
share/examples/mupdf/
 bbox-device.js
 create-thumbnail.js
 draw-device.js
 draw-document.js
 example.c
 fix-s22pdf.js
 jpx-to-pdf.js
 multi-threaded.c
 pdf-create-lowlevel.js
 pdf-create.js
 pdf-dejpx.js
 pdf-merge.js
 pdf-portfolio.js
 trace-device.js


[FILE:616:patches/patch-Makefile]
--- Makefile.orig	2020-05-05 11:29:09 UTC
+++ Makefile
@@ -189,13 +189,17 @@ generate: source/pdf/js/util.js.h
 
 # --- Library ---
 
-MUPDF_LIB = $(OUT)/libmupdf.a
-THIRD_LIB = $(OUT)/libmupdf-third.a
+MUPDF_LIB = libmupdf.so.$(SOVERSION)
+THIRD_LIB = libmupdfthird.so.$(SOVERSION)
 THREAD_LIB = $(OUT)/libmupdf-threads.a
 PKCS7_LIB = $(OUT)/libmupdf-pkcs7.a
 
 $(MUPDF_LIB) : $(MUPDF_OBJ)
+	$(CC) $(LDFLAGS) -fPIC -shared -Wl,-soname=$@ -o $@ $^ $(LIBS)
+
 $(THIRD_LIB) : $(THIRD_OBJ)
+	$(CC) $(LDFLAGS) -fPIC -shared -Wl,-soname=$@ -o $@ $^ $(LIBS)
+
 $(THREAD_LIB) : $(THREAD_OBJ)
 $(PKCS7_LIB) : $(PKCS7_OBJ)
 


[FILE:666:patches/patch-Makerules]
--- Makerules.orig	2020-05-05 11:29:09 UTC
+++ Makerules
@@ -91,7 +91,7 @@ else ifeq ($(OS),MACOS)
   LD = xcrun ld
   RANLIB = xcrun ranlib
 
-else ifeq ($(OS),Linux)
+else ifeq ($(OS),%%OPSYS%%)
   HAVE_OBJCOPY := yes
 
   ifeq ($(shell pkg-config --exists freetype2 && echo yes),yes)
@@ -137,7 +137,7 @@ else ifeq ($(OS),Linux)
 	X11_LIBS := $(shell pkg-config --libs x11 xext)
   endif
 
-  HAVE_LIBCRYPTO := $(shell pkg-config --exists 'libcrypto >= 1.1.0' && echo yes)
+  HAVE_LIBCRYPTO := no
   ifeq ($(HAVE_LIBCRYPTO),yes)
 	LIBCRYPTO_CFLAGS := $(shell pkg-config --cflags libcrypto) -DHAVE_LIBCRYPTO
 	LIBCRYPTO_LIBS := $(shell pkg-config --libs libcrypto)


[FILE:505:patches/patch-Makethird]
--- Makethird.orig	2020-05-05 11:29:09 UTC
+++ Makethird
@@ -1,12 +1,12 @@
 # GNU Makefile for third party libraries used by MuPDF
 
+USE_SYSTEM_LIBS := yes
 ifeq ($(USE_SYSTEM_LIBS),yes)
   USE_SYSTEM_FREETYPE := yes
   USE_SYSTEM_HARFBUZZ := yes
   USE_SYSTEM_JBIG2DEC := yes
   USE_SYSTEM_JPEGXR := no # not available
   USE_SYSTEM_LCMS2 := no # lcms2mt is strongly preferred
-  USE_SYSTEM_LIBJPEG := yes
   USE_SYSTEM_MUJS := no # not available
   USE_SYSTEM_OPENJPEG := yes
   USE_SYSTEM_ZLIB := yes

