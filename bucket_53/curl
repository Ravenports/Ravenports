# Buildsheet autogenerated by ravenadm tool -- Do not edit.

NAMEBASE=		curl
VERSION=		7.55.0
KEYWORDS=		ftp net www
VARIANTS=		standard
SDESC[standard]=	Tool and library for transferring data with URLs
HOMEPAGE=		https://curl.haxx.se/
CONTACT=		nobody

DOWNLOAD_GROUPS=	main
SITES[main]=		http://curl.haxx.se/download/
DISTFILE[1]=		curl-7.55.0.tar.xz:main
DF_INDEX=		1
SPKGS[standard]=	complete
			primary
			examples
			docs

OPTIONS_AVAILABLE=	IDN LDAP LDAPS SSH2
OPTIONS_STANDARD=	IDN LDAP LDAPS SSH2

BUILDRUN_DEPENDS=	libnghttp2:single:standard
RUN_DEPENDS=		nss:caroot:standard

USES=			cpe gmake libtool perl:build pkgconfig shebangfix ssl

LICENSE=		MIT:primary
LICENSE_SCHEME=		solo
LICENSE_FILE=		MIT:{{WRKSRC}}/COPYING

CPE_VENDOR=		haxx
FPC_EQUIVALENT=		ftp/curl
SHEBANG_FILES=		*/*.pl

MUST_CONFIGURE=		gnu
CONFIGURE_ARGS=		--disable-werror
			--enable-imap
			--enable-pop3
			--enable-rtsp
			--enable-smtp
			--with-zsh-functions-dir={{LOCALBASE}}/share/zsh/site-functions
			--without-axtls
			--with-ca-bundle={{LOCALBASE}}/share/certs/ca-root-nss.crt
			--enable-cookies
			--with-nghttp2
			--with-ipv6
			--with-ssl={{OPENSSLBASE}}
			--enable-pthreads
			--enable-threaded-resolver
CONFIGURE_ENV=		LOCALBASE={{LOCALBASE}}
			ac_cv_func_SSLv2_client_method=no

CPPFLAGS=		-I{{OPENSSLINC}}
LDFLAGS=		-L{{OPENSSLLIB}}
TEST_TARGET=		test

[SSH2].DESCRIPTION=			SCP/SFTP support via libssh2

post-patch:
	@${REINPLACE_CMD} -e '/^SUBDIRS = / s|$$| docs scripts|; /^DIST_SUBDIRS = / s| docs scripts||; /cd docs &&/d' ${WRKSRC}/Makefile.in
	@${REINPLACE_CMD} -e 's|\(flags_dbg_off=\)".*"|\1""|; s|\(flags_opt_off=\)".*"|\1""|' ${WRKSRC}/configure
	@${REINPLACE_CMD} -e 's|include <gssapi.h>|include <gssapi/gssapi.h>|' ${WRKSRC}/lib/curl_gssapi.h ${WRKSRC}/lib/urldata.h

post-install:
	${MKDIR} ${STAGEDIR}${STD_DOCDIR}/libcurl \
		${STAGEDIR}${STD_EXAMPLESDIR}
	${STRIP_CMD} ${STAGEDIR}${PREFIX}/lib/libcurl.so
	(cd ${WRKSRC}/docs/ && \
		${INSTALL_DATA} BUGS CODE_OF_CONDUCT.md CODE_STYLE.md CONTRIBUTE.md FAQ FEATURES HISTORY.md HTTP-COOKIES.md HTTP2.md INTERNALS.md KNOWN_BUGS LICENSE-MIXING.md MAIL-ETIQUETTE MANUAL RELEASE-PROCEDURE RESOURCES ROADMAP.md SECURITY.md SSL-PROBLEMS.md SSLCERTS.md TheArtOfHttpScripting VERSIONS ${STAGEDIR}${STD_DOCDIR}/)
	(cd ${WRKSRC}/docs/libcurl/ && ${INSTALL_DATA} \
		ABI *.html *.m4 ${STAGEDIR}${STD_DOCDIR}/libcurl/)
	(cd ${WRKSRC}/docs/examples/ && ${INSTALL_DATA} \
		README Makefile.example makefile* *.c *.cpp \
		${STAGEDIR}${STD_EXAMPLESDIR}/)

[FILE:779:descriptions/desc.primary]
Command line tool and library for transferring data with URLs.

curl is used in command lines or scripts to transfer data. It is also
used in cars, television sets, routers, printers, audio equipment, mobile
phones, tablets, settop boxes, media players and is the internet transfer
backbone for thousands of software applications affecting billions of
humans daily.

Protocols:
DICT, FILE, FTP, FTPS, Gopher, HTTP, HTTPS, IMAP, IMAPS, LDAP, LDAPS, POP3,
POP3S, RTMP, RTSP, SCP, SFTP, SMB, SMTP, SMTPS, Telnet and TFTP.

curl supports SSL certificates, HTTP POST, HTTP PUT, FTP uploading, HTTP
form based upload, proxies, HTTP/2, cookies, user+password authentication
(Basic, Plain, Digest, CRAM-MD5, NTLM, Negotiate and Kerberos),
file transfer resume, proxy tunneling and more.


[FILE:97:distinfo]
cdd58522f8607fd4e871df79d73acb3155075e2134641e5adab12a0962df059d      2228476 curl-7.55.0.tar.xz


[FILE:288:manifests/plist.primary]
bin/
 curl
 curl-config
include/curl/
 curl.h
 curlver.h
 easy.h
 mprintf.h
 multi.h
 stdcheaders.h
 system.h
 typecheck-gcc.h
lib/
 libcurl.a
 libcurl.so
 libcurl.so.4
 libcurl.so.4.4.0
lib/pkgconfig/libcurl.pc
share/man/man1/
 curl-config.1.gz
 curl.1.gz
share/zsh/site-functions/_curl


[FILE:4114:patches/patch-configure]
Description: Tweak the build for a FreeBSD environment.
 Respect user-supplied CFLAGS
 Use the FreeBSD location of pkg-config's library directory.
 Check for librtmp in sensible locations in all cases.
Forwarded: not-needed
Author: Peter Pentchev <roam@FreeBSD.org>
Last-Update: 2010-12-19

--- configure.orig	2017-06-14 06:10:57 UTC
+++ configure
@@ -4149,9 +4149,10 @@ $as_echo "$as_me: LIBS note: LIBS should
       -I*)
         xc_bad_var_ldflags=yes
         ;;
-      -l* | --library=*)
-        xc_bad_var_ldflags=yes
-        ;;
+# Temporarily disable -l* flag check for SSP support (Mk/bsd.ssp.mk)
+#      -l* | --library=*)
+#        xc_bad_var_ldflags=yes
+#        ;;
     esac
   done
   if test $xc_bad_var_ldflags = yes; then
@@ -4221,9 +4222,10 @@ $as_echo "$as_me: $xc_bad_var_msg librar
   xc_bad_var_cflags=no
   for xc_word in $CFLAGS; do
     case "$xc_word" in
-      -D*)
-        xc_bad_var_cflags=yes
-        ;;
+# Temporarily disable -D* flag check (PR/177401, PR/180944)
+#      -D*)
+#        xc_bad_var_cflags=yes
+#        ;;
       -U*)
         xc_bad_var_cflags=yes
         ;;
@@ -17982,6 +17984,8 @@ $as_echo "$as_me: WARNING: compiler opti
     tmp_CFLAGS="$CFLAGS"
     tmp_CPPFLAGS="$CPPFLAGS"
 
+# Do not remove the user-supplied debug flags in CFLAGS (PR/150854)
+if false; then
     ac_var_stripped=""
   for word1 in $tmp_CFLAGS; do
     ac_var_strip_word="no"
@@ -18012,6 +18016,7 @@ $as_echo "$as_me: WARNING: compiler opti
   done
     tmp_CPPFLAGS="$ac_var_stripped"
   squeeze tmp_CPPFLAGS
+fi
 
     #
     if test "$want_debug" = "yes"; then
@@ -18229,6 +18234,8 @@ $as_echo "$honor_optimize_option" >&6; }
     #
     if test "$honor_optimize_option" = "yes"; then
 
+# Do not remove the user-supplied optimization flags in CFLAGS (PR/150854)
+if false; then
     ac_var_stripped=""
   for word1 in $tmp_CFLAGS; do
     ac_var_strip_word="no"
@@ -18259,6 +18266,7 @@ $as_echo "$honor_optimize_option" >&6; }
   done
     tmp_CPPFLAGS="$ac_var_stripped"
   squeeze tmp_CPPFLAGS
+fi
 
       if test "$want_optimize" = "yes"; then
         { $as_echo "$as_me:${as_lineno-$LINENO}: checking if compiler accepts optimizer enabling options" >&5
@@ -26661,30 +26669,30 @@ $as_echo "found" >&6; }
     ;;
   off)
         LIB_RTMP="-lrtmp"
+        LD_RTMP=""
+        CPP_RTMP=""
+        DIR_RTMP=""
     ;;
   *)
         LIB_RTMP="-lrtmp"
+        LD_RTMP="-L${PREFIX_RTMP}/lib$libsuff"
+        CPP_RTMP="-I${PREFIX_RTMP}/include"
+        DIR_RTMP="${PREFIX_RTMP}/lib$libsuff"
     PREFIX_RTMP=$OPT_LIBRTMP
     ;;
   esac
 
-    if test -n "$PREFIX_RTMP"; then
-    LD_RTMP=-L${PREFIX_RTMP}/lib$libsuff
-    CPP_RTMP=-I${PREFIX_RTMP}/include
-    DIR_RTMP=${PREFIX_RTMP}/lib$libsuff
-  fi
-
   LDFLAGS="$LDFLAGS $LD_RTMP"
   CPPFLAGS="$CPPFLAGS $CPP_RTMP"
   LIBS="$LIB_RTMP $LIBS"
 
-  { $as_echo "$as_me:${as_lineno-$LINENO}: checking for RTMP_Init in -lrtmp" >&5
-$as_echo_n "checking for RTMP_Init in -lrtmp... " >&6; }
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking for RTMP_Init in $LIB_RTMP" >&5
+$as_echo_n "checking for RTMP_Init in $LIB_RTMP... " >&6; }
 if ${ac_cv_lib_rtmp_RTMP_Init+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   ac_check_lib_save_LIBS=$LIBS
-LIBS="-lrtmp  $LIBS"
+LIBS="$LIBS"
 cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
@@ -41279,9 +41287,10 @@ $as_echo "$as_me: LIBS note: LIBS should
       -I*)
         xc_bad_var_ldflags=yes
         ;;
-      -l* | --library=*)
-        xc_bad_var_ldflags=yes
-        ;;
+# Temporarily disable -l* flag check for SSP support (Mk/bsd.ssp.mk)
+#      -l* | --library=*)
+#        xc_bad_var_ldflags=yes
+#        ;;
     esac
   done
   if test $xc_bad_var_ldflags = yes; then
@@ -41351,9 +41360,10 @@ $as_echo "$as_me: $xc_bad_var_msg librar
   xc_bad_var_cflags=no
   for xc_word in $CFLAGS; do
     case "$xc_word" in
-      -D*)
-        xc_bad_var_cflags=yes
-        ;;
+# Temporarily disable -D* flag check (PR/177401, PR/180944)
+#      -D*)
+#        xc_bad_var_cflags=yes
+#        ;;
       -U*)
         xc_bad_var_cflags=yes
         ;;


[FILE:277:patches/patch-lib-hostcheck.h]
--- lib/hostcheck.h.orig	2013-09-08 22:11:15 UTC
+++ lib/hostcheck.h
@@ -23,6 +23,7 @@
  ***************************************************************************/
 
 #include <curl/curl.h>
+#include <netinet/in.h>
 
 #define CURL_HOST_NOMATCH 0
 #define CURL_HOST_MATCH   1


[FILE:643:patches/patch-lib-url.c]
Description: Different handling of signals and threads.
Forwarded: not-needed
Author: Peter Pentchev <roam@FreeBSD.org>
Last-Update: 2010-12-18

--- lib/url.c.orig	2017-04-18 06:36:20 UTC
+++ lib/url.c
@@ -671,6 +671,9 @@ CURLcode Curl_open(struct Curl_easy **cu
     data->state.current_speed = -1; /* init to negative == impossible */
     data->set.fnmatch = ZERO_NULL;
     data->set.maxconnects = DEFAULT_CONNCACHE_SIZE; /* for easy handles */
+#if defined(__FreeBSD_version)
+    data->set.no_signal = TRUE; /* different handling of signals and threads */
+#endif /* __FreeBSD_version */
 
     Curl_http2_init_state(&data->state);
   }


[FILE:2250:patches/patch-src-tool_operate.c]
--- src/tool_operate.c.orig	2017-06-09 09:57:41 UTC
+++ src/tool_operate.c
@@ -654,20 +654,7 @@ static CURLcode operate_do(struct Global
             DEBUGASSERT(!outs.filename);
           }
 
-          if(config->resume_from_current) {
-            /* We're told to continue from where we are now. Get the size
-               of the file as it is now and open it for append instead */
-            struct_stat fileinfo;
-            /* VMS -- Danger, the filesize is only valid for stream files */
-            if(0 == stat(outfile, &fileinfo))
-              /* set offset to current file size: */
-              config->resume_from = fileinfo.st_size;
-            else
-              /* let offset be 0 */
-              config->resume_from = 0;
-          }
-
-          if(config->resume_from) {
+          if(config->resume_from || config->resume_from_current) {
 #ifdef __VMS
             /* open file for output, forcing VMS output format into stream
                mode which is needed for stat() call above to always work. */
@@ -675,7 +662,8 @@ static CURLcode operate_do(struct Global
                                "ctx=stm", "rfm=stmlf", "rat=cr", "mrs=0");
 #else
             /* open file for output: */
-            FILE *file = fopen(outfile, config->resume_from?"ab":"wb");
+            /* (always open for appending, it has no effect on new files) */
+            FILE *file = fopen(outfile, "ab");
 #endif
             if(!file) {
               helpf(global->errors, "Can't open '%s'!\n", outfile);
@@ -684,6 +672,19 @@ static CURLcode operate_do(struct Global
             }
             outs.fopened = TRUE;
             outs.stream = file;
+
+            if(config->resume_from_current) {
+              /* We're told to continue from where we are now. Get the size
+                 of the file as it is now */
+              struct_stat fileinfo;
+              if(0 == fstat(fileno(outs.stream), &fileinfo))
+                /* set offset to current file size: */
+                config->resume_from = fileinfo.st_size;
+              else
+                /* let offset be 0 */
+                config->resume_from = 0;
+            }
+
             outs.init = config->resume_from;
           }
           else {

