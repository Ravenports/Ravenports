# Buildsheet autogenerated by ravenadm tool -- Do not edit.

NAMEBASE=		libvpx
VERSION=		1.14.1
KEYWORDS=		multimedia
VARIANTS=		standard
SDESC[standard]=	VP8 Video Codec SDK
HOMEPAGE=		https://chromium.googlesource.com/webm/libvpx
CONTACT=		nobody

DOWNLOAD_GROUPS=	main
SITES[main]=		GITHUB/webmproject:libvpx:v1.14.1
DISTFILE[1]=		generated:main
DF_INDEX=		1
SPKGS[standard]=	complete
			primary
			dev

OPTIONS_AVAILABLE=	none
OPTIONS_STANDARD=	none

BUILD_DEPENDS=		yasm:primary:standard

USES=			cpe gmake perl:build shebangfix c++:primary

LICENSE=		BSD3CLAUSE:primary
LICENSE_FILE=		BSD3CLAUSE:{{WRKSRC}}/LICENSE
LICENSE_SCHEME=		solo

CPE_PRODUCT=		libvpx
CPE_VENDOR=		webmproject
FPC_EQUIVALENT=		multimedia/libvpx
SHEBANG_FILES=		build/make/ads2gas.pl

MUST_CONFIGURE=		yes
CONFIGURE_ARGS=		--prefix={{PREFIX}}
			--disable-install-docs
			--disable-install-srcs
			--enable-pic
			--enable-vp8
			--enable-vp9
			--enable-multi-res-encoding
			--enable-postproc
			--enable-vp9-postproc
			--enable-vp9-temporal-denoising
			--enable-runtime-cpu-detect
			--enable-shared
			--size-limit=16384x16384

BUILD_TARGET=		#empty
MAKE_ARGS=		verbose=yes

SOVERSION=		9.0.1
PLIST_SUB=		SOMAJORMIN=9.0

VAR_ARCH[aarch64]=	CONFIGURE_ARGS=--target=arm64-linux-gcc
VAR_ARCH[x86_64]=	CONFIGURE_ARGS=--target=x86_64-linux-gcc
VAR_ARCH[i386]=		CONFIGURE_ARGS=--target=x86-linux-gcc

post-patch:
	${REINPLACE_CMD} 's|\(link_with_cc\)=gcc|\1=$${CC}|' \
		${WRKSRC}/build/make/configure.sh

post-install:
	${STRIP_CMD} ${STAGEDIR}${PREFIX}/bin/vpx*
	${STRIP_CMD} ${STAGEDIR}${PREFIX}/lib/libvpx.so.*.*.*

post-patch-sunos:
	${REINPLACE_CMD} -e 's/-Wl,--no-undefined//' \
		${WRKSRC}/build/make/Makefile

[FILE:53:descriptions/desc.primary]
This package contains libvpx, the VP8/VP9 Codec SDK.


[FILE:111:distinfo]
901747254d80a7937c933d03bd7c5d41e8e6c883e0665fadcb172542167c7977      5614104 webmproject-libvpx-1.14.1.tar.gz


[FILE:100:manifests/plist.primary]
bin/
 vpxdec
 vpxenc
lib/
 libvpx.so.%%SOMAJOR%%
 libvpx.so.%%SOMAJORMIN%%
 libvpx.so.%%SOVERSION%%


[FILE:207:manifests/plist.dev]
include/vpx/
 vp8.h
 vp8cx.h
 vp8dx.h
 vpx_codec.h
 vpx_decoder.h
 vpx_encoder.h
 vpx_ext_ratectrl.h
 vpx_frame_buffer.h
 vpx_image.h
 vpx_integer.h
 vpx_tpl.h
lib/
 libvpx.a
 libvpx.so
lib/pkgconfig/vpx.pc


[FILE:358:patches/patch-build_make_Makefile]
--- build/make/Makefile.orig	2024-01-09 21:12:22 UTC
+++ build/make/Makefile
@@ -299,8 +299,8 @@ endef
 define install_map_template
 $(DIST_DIR)/$(1): $(2)
 	$(if $(quiet),@echo "    [INSTALL] $$@")
-	$(qexec)mkdir -p $$(dir $$@)
-	$(qexec)cp -p $$< $$@
+	$(qexec)install -d $$(dir $$@)
+	$(qexec)install -p $$< $$(dir $$@)
 endef
 
 define archive_template

