# Buildsheet autogenerated by ravenadm tool -- Do not edit.

NAMEBASE=		upower
VERSION=		1.90.4
REVISION=		1
KEYWORDS=		sysutils
VARIANTS=		standard
SDESC[standard]=	D-Bus daemon for power management tasks
HOMEPAGE=		https://upower.freedesktop.org
CONTACT=		Michael_Reim[kraileth@elderlinux.org]

DOWNLOAD_GROUPS=	main
SITES[main]=		https://gitlab.freedesktop.org/upower/upower/-/archive/v1.90.4/
DISTFILE[1]=		upower-v1.90.4.tar.gz:main
DF_INDEX=		1
SPKGS[standard]=	complete
			primary
			nls

OPTIONS_AVAILABLE=	none
OPTIONS_STANDARD=	none

BUILD_DEPENDS=		automake:single:standard
			autoconf:single:standard
			docbook-xsl:primary:standard
			libtool:single:standard
BUILDRUN_DEPENDS=	dbus-glib:primary:standard
			polkit:primary:standard
B_DEPS[linux]=		libgudev:dev:standard libusb:dev:standard
BR_DEPS[linux]=		libgudev:primary:standard libusb:primary:standard

USES=			meson pkgconfig shebangfix
GNOME_COMPONENTS=	glib intltool introspection

DISTNAME=		upower-v1.90.4

LICENSE=		GPLv2+:primary
LICENSE_TERMS=		primary:{{WRKDIR}}/TERMS
LICENSE_FILE=		GPLv2+:{{WRKSRC}}/COPYING
LICENSE_AWK=		TERMS:"^$$"
LICENSE_SOURCE=		TERMS:{{WRKSRC}}/src/up-native.h
LICENSE_SCHEME=		solo

FPC_EQUIVALENT=		sysutils/upower
GTKDOC_OUTPUT_BASEDIR=	UPower
MESON_ARGS=		-Dman=true
			-Dgtk-doc=false
			-Dintrospection=enabled
			-Dsystemdsystemunitdir=no
			-Didevice=disabled
SHEBANG_FILES=		src/linux/integration-test.py

INSTALL_REQ_TOOLCHAIN=	yes
SOVERSION=		3.1.0

CFLAGS=			-Wno-deprecated-declarations
VAR_OPSYS[freebsd]=	CONFIGURE_ARGS=-Dos_backend=freebsd
			CONFIGURE_ARGS=-Dudevrulesdir=no
			CONFIGURE_ARGS=-Dudevhwdbdir=no
			LDFLAGS=-lkvm
VAR_OPSYS[sunos]=	CONFIGURE_ARGS=-Dos_backend=dummy
VAR_OPSYS[linux]=	CONFIGURE_ARGS=-Dos_backend=linux
			CONFIGURE_ARGS=-Dudevrulesdir=/etc/udev/rules.d
			CONFIGURE_ARGS=-Dudevhwdbdir=/etc/udev/hwdb.d
VAR_OPSYS[netbsd]=	CONFIGURE_ARGS=-Dos_backend=dummy
			CONFIGURE_ARGS=-Dudevrulesdir=no
			CONFIGURE_ARGS=-Dudevhwdbdir=no
VAR_OPSYS[dragonfly]=	CONFIGURE_ARGS=-Dos_backend=freebsd
			CONFIGURE_ARGS=-Dudevrulesdir=no
			CONFIGURE_ARGS=-Dudevhwdbdir=no
			CFLAGS=-D__WANT_NO_INLINED___ERROR
VAR_OPSYS[midnightbsd]=	CONFIGURE_ARGS=-Dos_backend=freebsd
			CONFIGURE_ARGS=-Dudevrulesdir=no
			CONFIGURE_ARGS=-Dudevhwdbdir=no
			LDFLAGS=-lkvm

post-stage:
	${RM} -r ${STAGEDIR}/var

pre-configure:
	${REINPLACE_CMD} -e "s|http://docbook.sourceforge.net/release/xsl/current/|file://${LOCALBASE}/share/xsl/docbook/|" \
		${WRKSRC}/doc/man/meson.build

[FILE:863:descriptions/desc.primary]
UPower is an abstraction for enumerating power devices, listening to 
device events and querying history and statistics. Any application or 
service on the system can access the org.freedesktop.UPower service via 
the system message bus. Some operations (such as suspending the system) 
are restricted using PolicyKit.

UPower was once called DeviceKit-power. UPower aims to make a large chunk 
of HAL redundant, as HAL is officially deprecated.

UPower is also useful to control the latency of different operations on 
your computer, which enables you to save significant amounts of power. 
Nothing much uses this interface yet, but this is a classic chicken and 
egg scenario, and I think it's important to encourage the egg to lay a 
chicken. Please report any problems to the Freedesktop bugzilla or send a 
mail to the DeviceKit mailing list for discussion.


[FILE:100:distinfo]
cd194dd278bd8d058b4728efd1d0a91cdf017378f025b558beb6f60a86af4781       181952 upower-v1.90.4.tar.gz


[FILE:1210:manifests/plist.primary]
%%ONLY-LINUX%%/etc/udev/hwdb.d/95-upower-hid.hwdb
%%ONLY-LINUX%%/etc/udev/rules.d/
 95-upower-hid.rules
 95-upower-wup.rules
%%ONLY-LINUX%%libexec/upower/
 integration-test.py
 output_checker.py
%%ONLY-LINUX%%libexec/upower/tests/
 logitech-g903.device
 steelseries-headset.device
 usb-headset.device
 wacom-bluetooth-active.device
 wacom-dongle-active.device
 wacom-dongle-waiting.device
 wacom-pen-digitiser.device
%%ONLY-LINUX%%share/installed-tests/upower/upower-integration.test
bin/upower
etc/UPower/UPower.conf
include/libupower-glib/
 up-autocleanups.h
 up-client.h
 up-device.h
 up-history-item.h
 up-stats-item.h
 up-types.h
 up-version.h
 upower.h
lib/
 libupower-glib.so
 libupower-glib.so.%%SOMAJOR%%
 libupower-glib.so.%%SOVERSION%%
lib/girepository-1.0/UPowerGlib-1.0.typelib
lib/pkgconfig/upower-glib.pc
libexec/upowerd
share/dbus-1/interfaces/
 org.freedesktop.UPower.Device.xml
 org.freedesktop.UPower.KbdBacklight.xml
 org.freedesktop.UPower.xml
share/dbus-1/system-services/org.freedesktop.UPower.service
share/dbus-1/system.d/org.freedesktop.UPower.conf
share/gir-1.0/UPowerGlib-1.0.gir
share/man/man1/upower.1.gz
share/man/man7/UPower.7.gz
share/man/man8/upowerd.8.gz
@dir var/lib/upower


[FILE:152:manifests/plist.nls]
share/locale/fr/LC_MESSAGES/upower.mo
share/locale/it/LC_MESSAGES/upower.mo
share/locale/pl/LC_MESSAGES/upower.mo
share/locale/sv/LC_MESSAGES/upower.mo


[FILE:300:patches/patch-meson.build]
--- meson.build.orig	2023-07-06 08:52:27 UTC
+++ meson.build
@@ -111,7 +111,9 @@ endif
 config_h = configure_file(output: 'config.h', configuration: cdata)
 
 subdir('etc')
-subdir('rules')
+if os_backend == 'linux'
+    subdir('rules')
+endif
 subdir('po')
 subdir('dbus')
 subdir('libupower-glib')


[FILE:555:freebsd/patch-src_freebsd_meson.build]
--- src/freebsd/meson.build.orig	2023-07-06 08:52:27 UTC
+++ src/freebsd/meson.build
@@ -1,3 +1,4 @@
+kvm_dep = cc.find_library('kvm')
 upshared += { 'freebsd': static_library('upshared',
     sources: [
         'up-acpi-native.c',
@@ -13,6 +14,6 @@ upshared += { 'freebsd': static_library(
         'up-util.h',
     ],
     c_args: [ '-DG_LOG_DOMAIN="UPower-Freebsd"' ],
-    dependencies: [ gudev_dep, upowerd_deps, upshared_common_dep ],
+    dependencies: [ gudev_dep, upowerd_deps, upshared_common_dep, kvm_dep ],
     build_by_default: false,
 )}


[FILE:363:freebsd/patch-src_freebsd_up-devd.c]
--- src/freebsd/up-devd.c.orig	2023-07-06 08:52:27 UTC
+++ src/freebsd/up-devd.c
@@ -195,7 +195,7 @@ up_devd_event_cb (GIOChannel *source, GI
 		event[terminator] = 0;
 		up_devd_process_event(event, user_data);
 		g_free(event);
-	} else if (status == G_IO_STATUS_AGAIN) {
+	} else {
 		up_devd_init (UP_BACKEND(user_data));
 		if (up_devd_inited) {
 			int fd;


[FILE:464:freebsd/patch-src_freebsd_up-device-supply.c]
--- src/freebsd/up-device-supply.c.orig	2023-07-06 08:52:27 UTC
+++ src/freebsd/up-device-supply.c
@@ -250,7 +250,7 @@ up_device_supply_battery_set_properties
 		      "energy", cap,
 		      "energy-full", lastfull,
 		      "energy-full-design", dcap,
-		      "energy-rate", rate,
+		      "energy-rate", (battinfo.battinfo.state & ACPI_BATT_STAT_CHARGING) ? -rate : rate,
 		      "energy-empty", lcap,
 		      "voltage", volt,
 		      "capacity", capacity,

