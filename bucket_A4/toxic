# Buildsheet autogenerated by ravenadm tool -- Do not edit.

NAMEBASE=		toxic
VERSION=		0.8.2
KEYWORDS=		net net_im net_p2p
VARIANTS=		standard
SDESC[standard]=	Ncurses-based Tox client
HOMEPAGE=		https://github.com/Jfreegman/toxic
CONTACT=		Leonid_Bobrov[mazocomp@disroot.org]

DOWNLOAD_GROUPS=	main
SITES[main]=		GITHUB/JFreegman:toxic:v0.8.2
DISTFILE[1]=		generated:main
DF_INDEX=		1
SPKGS[standard]=	single

OPTIONS_AVAILABLE=	none
OPTIONS_STANDARD=	none

BUILD_DEPENDS=		video4linux:headers:standard
BUILDRUN_DEPENDS=	curl:primary:standard
			freealut:single:standard
			libnotify:primary:standard
			qrencode:single:standard
			toxcore:single:standard

USES=			desktop-utils:single gmake ncurses pkgconfig python
			shebangfix
XORG_COMPONENTS=	x11

LICENSE=		GPLv3+:single
LICENSE_TERMS=		single:{{WRKDIR}}/TERMS
LICENSE_FILE=		GPLv3+:{{WRKSRC}}/LICENSE
LICENSE_AWK=		TERMS:"^\#include"
LICENSE_SOURCE=		TERMS:{{WRKSRC}}/src/toxic.c
LICENSE_SCHEME=		solo

FPC_EQUIVALENT=		net-im/toxic
SHEBANG_FILES=		apidoc/python/source/conf.py

MAKE_ARGS=		ENABLE_PYTHON=1
			MANDIR="{{MANPREFIX}}/man"
			PREFIX="{{PREFIX}}"
			USER_CFLAGS="{{CFLAGS}}"
			USER_LDFLAGS="{{LDFLAGS}}"

CFLAGS=			-I{{NCURSESINC}}

post-patch:
	${REINPLACE_CMD} -e 's|LIBS = python3|LIBS = python-${PYTHON_VER}|' \
	${WRKSRC}/cfg/checks/python.mk
	${REINPLACE_CMD} -e 's|python3|python${PYTHON_VER}|g' \
	${WRKSRC}/cfg/checks/python.mk

[FILE:63:descriptions/desc.single]
Toxic is a Tox-based instant messenging and video chat client.


[FILE:107:distinfo]
53bdbed3d72d000f9e43b8823523c589540b811bc237ed6f3b4ddf0fe6f9a6b7      1146526 JFreegman-toxic-0.8.2.tar.gz


[FILE:350:manifests/plist.single]
bin/toxic
share/applications/toxic.desktop
share/man/man1/toxic.1.gz
share/man/man5/toxic.conf.5.gz
share/toxic/
 nameservers
 toxic.conf.example
share/toxic/sounds/
 ToxicContactOffline.wav
 ToxicContactOnline.wav
 ToxicError.wav
 ToxicIncomingCall.wav
 ToxicOutgoingCall.wav
 ToxicRecvMessage.wav
 ToxicTransferComplete.wav
 ToxicTransferStart.wav


[FILE:449:patches/patch-cfg_targets_install.mk]
--- cfg/targets/install.mk.orig	2018-02-27 23:46:56 UTC
+++ cfg/targets/install.mk
@@ -27,7 +27,7 @@ install: $(BUILD_DIR)/toxic
 		if [ ! -e "$(DOC_DIR)/$$f" ]; then \
 			continue ;\
 		fi ;\
-		section=$(abspath $(DESTDIR)/$(MANDIR))/man`echo $$f | rev | cut -d "." -f 1` ;\
+		section=$(abspath $(DESTDIR)/$(MANDIR))/man`echo $$f | sed "s/.*\.//"` ;\
 		file=$$section/$$f ;\
 		mkdir -p $$section ;\
 		install -m 0644 $(DOC_DIR)/$$f $$file ;\


[FILE:2261:patches/patch-src_video__device.c]
--- src/video_device.c.orig	2018-02-27 23:46:56 UTC
+++ src/video_device.c
@@ -37,7 +37,7 @@
 #include <sys/stat.h>
 #include <sys/mman.h>
 #include <fcntl.h>
-#if defined(__linux__)
+#if defined(__linux__) || defined(__FreeBSD__) || defined(__DragonFly__)
 #include <linux/videodev2.h>
 #else
 #include <sys/videoio.h>
@@ -69,7 +69,7 @@ typedef struct VideoDevice {
     void *cb_data;                          /* Data to be passed to callback */
     int32_t friend_number;                  /* ToxAV friend number */
 
-#if defined(__linux__) || defined(__FreeBSD__) || defined(__NetBSD__) || defined(__OpenBSD__)
+#if defined(__linux__) || defined(__FreeBSD__) || defined(__NetBSD__) || defined(__OpenBSD__) || defined(__DragonFly__)
     int fd;                                 /* File descriptor of video device selected/opened */
     struct v4l2_format fmt;
     struct VideoBuffer *buffers;
@@ -136,7 +136,7 @@ static void yuv420tobgr(uint16_t width,
     }
 }
 
-#if defined(__linux__) || defined(__FreeBSD__) || defined(__NetBSD__) || defined(__OpenBSD__)
+#if defined(__linux__) || defined(__FreeBSD__) || defined(__NetBSD__) || defined(__OpenBSD__) || defined(__DragonFly__)
 static void yuv422to420(uint8_t *plane_y, uint8_t *plane_u, uint8_t *plane_v,
                         uint8_t *input, uint16_t width, uint16_t height)
 {
@@ -724,7 +724,7 @@ void *video_thread_poll (void *arg) // T
                     XFlush(device->x_display);
                     free(img_data);
 
-#if defined(__linux__) || defined(__FreeBSD__) || defined(__NetBSD__) || defined(__OpenBSD__)
+#if defined(__linux__) || defined(__FreeBSD__) || defined(__NetBSD__) || defined(__OpenBSD__) || defined(__DragonFly__)
 
                     if ( -1 == xioctl(device->fd, VIDIOC_QBUF, &buf) ) {
                         unlock;
@@ -787,7 +787,7 @@ VideoDeviceError close_video_device(Vide
             XCloseDisplay(device->x_display);
             pthread_mutex_destroy(device->mutex);
 
-#if defined(__linux__) || defined(__FreeBSD__) || defined(__NetBSD__) || defined(__OpenBSD__)
+#if defined(__linux__) || defined(__FreeBSD__) || defined(__NetBSD__) || defined(__OpenBSD__) || defined(__DragonFly__)
             free(device->buffers);
 #endif /* __linux__ / BSD */
 

