# Buildsheet autogenerated by ravenadm tool -- Do not edit.

NAMEBASE=		toxic
VERSION=		0.16.1
KEYWORDS=		net net_im net_p2p
VARIANTS=		std
SDESC[std]=		Ncurses-based Tox client
HOMEPAGE=		https://github.com/Jfreegman/toxic
CONTACT=		nobody

DOWNLOAD_GROUPS=	main
SITES[main]=		GITHUB/JFreegman:toxic:v0.16.1
DISTFILE[1]=		generated:main
DIST_SUBDIR=		tox
DF_INDEX=		1
SPKGS[std]=		set
			primary
			man

OPTIONS_AVAILABLE=	none
OPTIONS_STANDARD=	none

BUILD_DEPENDS=		evdev-proto:single:std
			libnotify:dev:std
			toxcore:dev:std
			openal:dev:std
			libconfig:dev:std
			qrencode:dev:std
BUILDRUN_DEPENDS=	freealut:single:std
			libnotify:primary:std
			qrencode:primary:std
			toxcore:primary:std
			openal:primary:std
			libconfig:primary:std

USES=			desktop-utils:primary gmake ncurses pkgconfig curl
			png zlib:build gettext shebangfix ssl:build
GNOME_COMPONENTS=	glib
XORG_COMPONENTS=	x11

LICENSE=		GPLv3+:primary
LICENSE_TERMS=		primary:{{WRKDIR}}/TERMS
LICENSE_FILE=		GPLv3+:{{WRKSRC}}/LICENSE
LICENSE_AWK=		TERMS:"^\#include"
LICENSE_SOURCE=		TERMS:{{WRKSRC}}/src/toxic.c
LICENSE_SCHEME=		solo

FPC_EQUIVALENT=		net-im/toxic
SHEBANG_FILES=		apidoc/python/source/conf.py

MAKE_ARGS=		ENABLE_PYTHON=0
			MANDIR="{{MANPREFIX}}/man"
			PREFIX="{{PREFIX}}"
			USER_CFLAGS="{{CFLAGS}}"
			USER_LDFLAGS="{{LDFLAGS}}"
SINGLE_JOB=		yes

CFLAGS=			-I{{NCURSESINC}}

post-install:
	${STRIP_CMD} ${STAGEDIR}${PREFIX}/bin/toxic

pre-configure:
	${REINPLACE_CMD} \
		-e 's|LIBS = python3|LIBS = python-${PYTHON_VER}|' \
		${WRKSRC}/cfg/checks/python.mk
	# log the build
	${REINPLACE_CMD} -e '/@.[(]CC[)]/ s|@||' ${WRKSRC}/Makefile

[FILE:63:descriptions/desc.primary]
Toxic is a Tox-based instant messenging and video chat client.


[FILE:112:distinfo]
4969f0a72e40e0ed296cfff5a5bcd58b999ace52759327c29f23866c96d64f00      1249306 tox/JFreegman-toxic-0.16.1.tar.gz


[FILE:293:manifests/plist.primary]
bin/toxic
share/applications/toxic.desktop
share/toxic/
 nameservers
 toxic.conf.example
share/toxic/sounds/
 ToxicContactOffline.wav
 ToxicContactOnline.wav
 ToxicError.wav
 ToxicIncomingCall.wav
 ToxicOutgoingCall.wav
 ToxicRecvMessage.wav
 ToxicTransferComplete.wav
 ToxicTransferStart.wav


[FILE:51:manifests/plist.man]
share/man/man1/toxic.1
share/man/man5/toxic.conf.5


[FILE:855:patches/patch-Makefile]
--- Makefile.orig	2025-01-09 14:41:43 UTC
+++ Makefile
@@ -3,7 +3,7 @@ CFG_DIR = $(BASE_DIR)/cfg
 
 -include $(CFG_DIR)/global_vars.mk
 
-LIBS = toxcore ncursesw libconfig libcurl
+LIBS = toxcore ncurses libconfig libcurl
 
 CFLAGS ?= -std=c11 -pthread -Wall -Wpedantic -Wunused -fstack-protector-all -Wvla -Wno-missing-braces -Wmissing-prototypes -Wcast-align -Wcast-qual -Wmissing-declarations -Wshadow -Wunused-macros -Wformat-nonliteral -Wno-unknown-pragmas
 CFLAGS += '-DTOXICVER="$(VERSION)"' -DHAVE_WIDECHAR -D_XOPEN_SOURCE_EXTENDED -D_FILE_OFFSET_BITS=64
@@ -42,10 +42,6 @@ ifeq ($(UNAME_S), OpenBSD)
 LIBS := $(filter-out ncursesw, $(LIBS))
 LDFLAGS += -lncursesw
 endif
-ifeq ($(UNAME_S), NetBSD)
-LIBS := $(filter-out ncursesw, $(LIBS))
-LDFLAGS += -lncursesw
-endif
 ifeq ($(UNAME_S), Darwin)
     -include $(CFG_DIR)/systems/Darwin.mk
 endif


[FILE:863:patches/patch-src_main.c]
The dns function is not implemented anywhere.

--- src/main.c.orig	2025-01-09 14:41:43 UTC
+++ src/main.c
@@ -477,7 +477,6 @@ static void init_tox_options(const Run_O
     tox_options_set_tcp_port(tox_opts, run_opts->tcp_port);
     tox_options_set_local_discovery_enabled(tox_opts, !run_opts->disable_local_discovery);
     tox_options_set_experimental_groups_persistence(tox_opts, true);
-    tox_options_set_experimental_disable_dns(tox_opts, false);
 
     if (run_opts->logging) {
         tox_options_set_log_callback(tox_opts, cb_toxcore_logger);
@@ -508,9 +507,6 @@ static void init_tox_options(const Run_O
     }
 
     if (!tox_options_get_udp_enabled(tox_opts)) {
-        if (proxy_set) {
-            tox_options_set_experimental_disable_dns(tox_opts, true);
-        }
 
         init_queue_add(init_q, "UDP disabled");
     } else if (proxy_set) {

