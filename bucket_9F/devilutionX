# Buildsheet autogenerated by ravenadm tool -- Do not edit.

NAMEBASE=		devilutionX
VERSION=		0.5.0
KEYWORDS=		games
VARIANTS=		standard
SDESC[standard]=	Reverse-engineered Diablo 1 engine made portable
HOMEPAGE=		https://github.com/diasurgical/devilutionX
CONTACT=		Michael_Reim[kraileth@elderlinux.org]

DOWNLOAD_GROUPS=	main
SITES[main]=		GITHUB/diasurgical:devilutionX:0.5.0
DISTFILE[1]=		generated:main
DF_INDEX=		1
SPKGS[standard]=	single

OPTIONS_AVAILABLE=	none
OPTIONS_STANDARD=	none

BUILDRUN_DEPENDS=	libsodium:single:standard

USES=			cmake pkgconfig dos2unix
SDL_COMPONENTS=		mixer2 ttf2

LICENSE=		PUBDOM:single
LICENSE_FILE=		PUBDOM:{{WRKSRC}}/LICENSE
LICENSE_SCHEME=		solo

DOS2UNIX_FILES=		CMakeLists.txt
FPC_EQUIVALENT=		games/devilutionX

INVALID_RPATH=		yes

SUB_FILES=		pkg-message-single

CMAKE_ARGS=		-DBINARY_RELEASE:BOOL=ON

do-install:
	${INSTALL_PROGRAM} ${WRKDIR}/.build/devilutionx \
		${STAGEDIR}${PREFIX}/bin

[FILE:529:descriptions/desc.single]
Devilution is a project to re-create and document the source code for the 
game Diablo 1 as closely to the original as possible. It was 
reverse-engineered and cleaned up (believed to be legal under the Digital 
Millennium Copyright Act's documentation and interoperability exceptions).

DevilutionX is a portable version of the engine that uses SDL to run 
across modern operating systems. This package contains just the engine, no 
game data is provided. You will need the original resource container 
("diabdat.mpq") to play.


[FILE:115:distinfo]
45f779084aa7459880e5eab1bf3d63dcd223d937485a840dc055e7d1e8eace5c      1767600 diasurgical-devilutionX-0.5.0.tar.gz


[FILE:16:manifests/plist.single]
bin/devilutionx


[FILE:417:patches/patch-3rdParty_StormLib_src_StormPort.h]
$NetBSD: patch-3rdParty_StormLib_src_StormPort.h,v 1.1 2019/10/16 12:00:51 nia Exp $

strings.h for strncasecmp.

--- 3rdParty/StormLib/src/StormPort.h.orig	2019-10-09 22:34:02.000000000 +0000
+++ 3rdParty/StormLib/src/StormPort.h
@@ -162,6 +162,7 @@
   #include <stdio.h>
   #include <stdarg.h>
   #include <string.h>
+  #include <strings.h>
   #include <ctype.h>
   #include <assert.h>
   #include <errno.h>


[FILE:630:patches/patch-3rdParty_asio_include_asio_detail_config.hpp]
--- 3rdParty/asio/include/asio/detail/config.hpp.orig	2019-10-09 22:34:02 UTC
+++ 3rdParty/asio/include/asio/detail/config.hpp
@@ -1002,6 +1002,7 @@
    || (defined(__MACH__) && defined(__APPLE__)) \
    || defined(__FreeBSD__) \
    || defined(__NetBSD__) \
+   || defined(__DragonFly__) \
    || defined(__OpenBSD__) \
    || defined(__linux__) \
    || defined(__HAIKU__)
@@ -1043,6 +1044,7 @@
 #if (defined(__MACH__) && defined(__APPLE__)) \
   || defined(__FreeBSD__) \
   || defined(__NetBSD__) \
+  || defined(__DragonFly__) \
   || defined(__OpenBSD__)
 # if !defined(ASIO_HAS_KQUEUE)
 #  if !defined(ASIO_DISABLE_KQUEUE)


[FILE:944:patches/patch-CMakeLists.txt]
--- CMakeLists.txt.orig	2019-10-24 15:02:06 UTC
+++ CMakeLists.txt
@@ -65,7 +65,7 @@ project(DevilutionX
 
 list(APPEND CMAKE_MODULE_PATH "${DevilutionX_SOURCE_DIR}/CMake")
 
-if(${CMAKE_SYSTEM_NAME} STREQUAL FreeBSD)
+if(${CMAKE_SYSTEM_NAME} MATCHES "FreeBSD|DragonFly")
   set(ASAN OFF)
   set(CMAKE_CXX_FLAGS "${CMAKE_CXX_FLAGS} -DO_LARGEFILE=0 -Dstat64=stat -Dlstat64=lstat -Dlseek64=lseek -Doff64_t=off_t -Dfstat64=fstat -Dftruncate64=ftruncate")
 endif()
@@ -83,7 +83,6 @@ if(DIST)
   set(sodium_USE_STATIC_LIBS ON)
 endif()
 
-set(CMAKE_CXX_STANDARD 11)
 set(CMAKE_CXX_EXTENSIONS OFF)
 set(CMAKE_CXX_STANDARD_REQUIRED ON)
 set(CMAKE_THREAD_PREFER_PTHREAD ON)
@@ -326,11 +325,6 @@ if(WIN32)
   endif()
 endif()
 
-if(NOT WIN32 AND NOT APPLE)
-  # Enable POSIX extensions such as `readlink` and `ftruncate`.
-  add_definitions(-D_POSIX_C_SOURCE=200809L)
-endif()
-
 if(HAIKU)
   target_link_libraries(devilutionx PRIVATE network)
 endif()


[FILE:558:files/pkg-message-single.in]
To play the game you need the resource container file DIABDAT.MPQ. Copy
it off your Diablo CD or extract it (using e.g. innoextract) from the
GOG version (see https://www.gog.com/game/diablo). Then put it into the
directory ~/.local/share/diasurgical/devilution and make sure it is
spelled all lower-case!

NOTE: 64-bit builds of devilutionX are considered experimental right now.
The game is playable but there are major flaws such as morphing potions,
missing features like character deletion, etc. These issues are known
and are being addressed upstream.

