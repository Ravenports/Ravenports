# Buildsheet autogenerated by ravenadm tool -- Do not edit.

NAMEBASE=		devilutionX
VERSION=		1.4.1
REVISION=		2
KEYWORDS=		games
VARIANTS=		standard
SDESC[standard]=	Reverse-engineered Diablo 1 engine made portable
HOMEPAGE=		https://github.com/diasurgical/devilutionX
CONTACT=		Michael_Reim[kraileth@elderlinux.org]

DOWNLOAD_GROUPS=	main audiolib libmpq simpleini smack
SITES[main]=		GITHUB/diasurgical:devilutionX:1.4.1
SITES[audiolib]=	GITHUB/realnc:SDL_audiolib:1a69135313c79817b38a3a99826d4ac28d627fdf
SITES[libmpq]=		GITHUB/diasurgical:libmpq:0f10bd1600f406b13932bf5351ba713361262184
SITES[simpleini]=	GITHUB/brofield:simpleini:9b3ed7ec815997bc8c5b9edf140d6bde653e1458
SITES[smack]=		GITHUB/diasurgical:libsmackerdec:2997ee0e41e91bb723003bc09234be553b190e38
DISTFILE[1]=		generated:main
DISTFILE[2]=		generated:smack
DISTFILE[3]=		generated:audiolib
DISTFILE[4]=		generated:simpleini
DISTFILE[5]=		generated:libmpq
DIST_SUBDIR=		devilutionX
DF_INDEX=		1 2 3 4 5
SPKGS[standard]=	single

OPTIONS_AVAILABLE=	none
OPTIONS_STANDARD=	none

BUILD_DEPENDS=		asio:single:standard
			gtest:single:standard
			fmt:dev:standard
			libsodium:dev:standard
BUILDRUN_DEPENDS=	libsodium:primary:standard
			fmt:primary:standard

USES=			cmake pkgconfig gettext:build png dos2unix zlib
			bz2:build
C_USES[linux]=		iconv
SDL_COMPONENTS=		mixer2 ttf2 sdl2 image2

LICENSE=		PUBDOM:single
LICENSE_FILE=		PUBDOM:{{WRKSRC}}/LICENSE
LICENSE_SCHEME=		solo

DOS2UNIX_GLOB=		*.cpp
			*.h
			*.cmake
			CMakeLists.txt
FPC_EQUIVALENT=		games/devilutionX

SUB_FILES=		pkg-message-single

CMAKE_ARGS=		-DBINARY_RELEASE:BOOL=ON
			-DVERSION_NUM="1.4.1"
			-DDISABLE_ZERO_TIER:BOOL=ON
			-DFETCHCONTENT_FULLY_DISCONNECTED:BOOL=ON
			-Wno-dev
VAR_OPSYS[linux]=	LDFLAGS=-liconv

post-extract:
	${MKDIR} ${BUILD_WRKSRC}/_deps
	(cd ${BUILD_WRKSRC}/_deps \
	&& ${MV} ${WRKDIR}/libsmackerdec-2997ee0e41e91bb723003bc09234be553b190e38 libsmackerdec-src \
	&& ${MV} ${WRKDIR}/libmpq-0f10bd1600f406b13932bf5351ba713361262184 libmpq-src \
	&& ${MV} ${WRKDIR}/simpleini-9b3ed7ec815997bc8c5b9edf140d6bde653e1458 simpleini-src \
	&& ${MV} ${WRKDIR}/SDL_audiolib-1a69135313c79817b38a3a99826d4ac28d627fdf sdl_audiolib-src)

do-install:
	${INSTALL_PROGRAM} ${WRKDIR}/.build/devilutionx \
		${STAGEDIR}${PREFIX}/bin

[FILE:592:descriptions/desc.single]
Devilution is a project to re-create and document the source code for the 
game Diablo 1 as closely to the original as possible. It was 
reverse-engineered and cleaned up (believed to be legal under the Digital 
Millennium Copyright Act's documentation and interoperability exceptions).

DevilutionX is a portable version of the engine that uses SDL to run 
across modern operating systems. This package contains just the engine, no 
game data is provided. You will need the original resource container 
("diabdat.mpq") to play.

The Hellfire expansion is also supported since version 1.2.0.


[FILE:763:distinfo]
54b9fd496eba5b82d7e64891ab4de808f539c60b3b94bfa49639e0d9580fb7b8      7578111 devilutionX/diasurgical-devilutionX-1.4.1.tar.gz
40c0dc21943de22e153d56a7992c621a42a0c56c7cd833f8b84f90e48da753ea        18556 devilutionX/diasurgical-libsmackerdec-2997ee0e41e91bb723003bc09234be553b190e38.tar.gz
8e013245bf8e676d4e2c61661d7cee6cb9de74f97a475c9e6b35a25d5e7a7715       304183 devilutionX/realnc-SDL_audiolib-1a69135313c79817b38a3a99826d4ac28d627fdf.tar.gz
f7792eca9f3f7b0ee8916ffa4e124cb4b319b11d5849e15c5eef58eb910b0451        62870 devilutionX/brofield-simpleini-9b3ed7ec815997bc8c5b9edf140d6bde653e1458.tar.gz
ee173f5edb20f162482658cbc9d4bb84b640f651041d686c0ad7b2af12baf2a1        69570 devilutionX/diasurgical-libmpq-0f10bd1600f406b13932bf5351ba713361262184.tar.gz


[FILE:16:manifests/plist.single]
bin/devilutionx


[FILE:453:patches/patch-3rdParty_libfmt_CMakeLists.txt]
--- 3rdParty/libfmt/CMakeLists.txt.orig	2023-04-05 20:06:24 UTC
+++ 3rdParty/libfmt/CMakeLists.txt
@@ -1,6 +1,6 @@
 include(functions/FetchContent_MakeAvailableExcludeFromAll)
 
-if(NOT WIN32 AND NOT APPLE AND NOT ${CMAKE_SYSTEM_NAME} STREQUAL FreeBSD)
+if(NOT WIN32 AND NOT APPLE AND NOT ${CMAKE_SYSTEM_NAME} MATCH "BSD|DragonFly")
   # Enable POSIX extensions such as `readlink` and `ftruncate`.
   add_definitions(-D_POSIX_C_SOURCE=200809L)
 endif()


[FILE:277:patches/patch-CMakeLists.txt]
--- CMakeLists.txt.orig	2023-01-04 23:06:45 UTC
+++ CMakeLists.txt
@@ -156,7 +156,6 @@ if(NONET)
   set(PACKET_ENCRYPTION OFF)
 endif()
 
-find_program(CCACHE_PROGRAM ccache)
 if(CCACHE_PROGRAM)
   set_property(GLOBAL PROPERTY RULE_LAUNCH_COMPILE "${CCACHE_PROGRAM}")
 endif()


[FILE:381:patches/patch-CMake_Platforms.cmake]
--- CMake/Platforms.cmake.orig	2023-04-05 20:01:40 UTC
+++ CMake/Platforms.cmake
@@ -6,7 +6,7 @@ if(HAIKU)
   include(platforms/haiku)
 endif()
 
-if(CMAKE_SYSTEM_NAME MATCHES "FreeBSD|OpenBSD|DragonFly|NetBSD")
+if(CMAKE_SYSTEM_NAME MATCHES "FreeBSD|OpenBSD|DragonFly|NetBSD|MidnightBSD")
   if(CMAKE_SYSTEM_NAME MATCHES "NetBSD")
     add_definitions(-D_NETBSD_SOURCE)
   else()


[FILE:536:patches/patch-CMake_functions_devilutionx__library.cmake]
--- CMake/functions/devilutionx_library.cmake.orig	2023-04-05 20:06:24 UTC
+++ CMake/functions/devilutionx_library.cmake
@@ -48,7 +48,7 @@ function(add_devilutionx_library NAME)
     target_compile_options(${NAME} PUBLIC -fsigned-char)
   endif()
 
-  if(NOT WIN32 AND NOT APPLE AND NOT ${CMAKE_SYSTEM_NAME} STREQUAL FreeBSD)
+  if(NOT WIN32 AND NOT APPLE AND NOT ${CMAKE_SYSTEM_NAME} MATCHES "BSD|DragonFly")
     # Enable POSIX extensions such as `readlink` and `ftruncate`.
     add_definitions(-D_POSIX_C_SOURCE=200809L)
   endif()


[FILE:397:files/pkg-message-single.in]
To play the game you need the resource container file DIABDAT.MPQ. Copy
it off your Diablo CD or extract it (using e.g. innoextract) from the
GOG version (see https://www.gog.com/game/diablo). Then put it into the
directory ~/.local/share/diasurgical/devilution and make sure it is
spelled all lower-case!

This version matches Diablo 1.9 but also includes some additional fixes
and new features.

