# Buildsheet autogenerated by ravenadm tool -- Do not edit.

NAMEBASE=		sbcl
VERSION=		2.5.4
KEYWORDS=		lang
VARIANTS=		std
SDESC[std]=		Steel Bank Common Lisp
HOMEPAGE=		http://www.sbcl.org/
CONTACT=		nobody

DOWNLOAD_GROUPS=	main boot ravdist
SITES[main]=		SF/sbcl/sbcl/2.5.4
SITES[ravdist]=		https://leaf.dragonflybsd.org/~marino/raven-distfiles/sbcl/
DISTFILE[1]=		sbcl-2.5.4-source.tar.bz2:main
DISTFILE[2]=		bootstrap-sbcl-2.4.4-dragonfly-x86_64.tzst:ravdist
DISTFILE[3]=		bootstrap-sbcl-2.4.4-Linux-amd64.tzst:ravdist
DISTFILE[4]=		bootstrap-sbcl-2.4.4-MidnightBSD-amd64.tzst:ravdist
DISTFILE[5]=		bootstrap-sbcl-2.4.4-NetBSD-amd64.tzst:ravdist
DISTFILE[6]=		bootstrap-sbcl-2.4.4-FreeBSD-amd64.tzst:ravdist
DF_INDEX=		1
SPKGS[std]=		set
			primary
			man

OPTIONS_AVAILABLE=	DRAGONFLY FREEBSD LINUX SUNOS NETBSD MIDNIGHT MACOS
			CONCURRENCY SIMD CLISP
OPTIONS_STANDARD=	DRAGONFLY FREEBSD LINUX SUNOS NETBSD MIDNIGHT MACOS
			CONCURRENCY SIMD CLISP
OPTGROUP_RADIO=		SYSTEM
OPTDESCR[SYSTEM]=	Operating System
OPTGROUP[SYSTEM]=	DRAGONFLY FREEBSD LINUX SUNOS MACOS NETBSD MIDNIGHT
OPT_ON[freebsd]=	FREEBSD CONCURRENCY
OPT_ON[sunos]=		SUNOS CLISP
OPT_ON[linux]=		LINUX CONCURRENCY
OPT_ON[darwin]=		MACOS CLISP
OPT_ON[netbsd]=		NETBSD
OPT_ON[dragonfly]=	DRAGONFLY
OPT_ON[midnightbsd]=	MIDNIGHT CONCURRENCY

NOT_FOR_OPSYS=		darwin

BUILD_DEPENDS=		gmp:dev:std
			mpfr:dev:std
BUILDRUN_DEPENDS=	gmp:primary:std
			mpfr:primary:std
RUN_DEPENDS=		asdf:primary:std

USES=			gmake makeinfo zlib zstd

LICENSE=		PUBDOM:primary BSD3CLAUSE:primary MIT:primary
LICENSE_TERMS=		primary:{{WRKDIR}}/TERMS
LICENSE_FILE=		PUBDOM:{{WRKDIR}}/LICENSE_PUBDOM
			BSD3CLAUSE:{{WRKDIR}}/LICENSE_BSD
			MIT:{{FILESDIR}}/city.cc.license
LICENSE_AWK=		TERMS:"^===="
LICENSE_SOURCE=		TERMS:{{WRKSRC}}/COPYING
LICENSE_SCHEME=		multi

FPC_EQUIVALENT=		lang/sbcl

SUB_FILES=		sbclrc

CMAKE_ARGS=		--prefix="{{PREFIX}}"
			--without-sb-thread
			--with-sb-unicode
			--with-sb-core-compression
			--without-sb-xref-for-internals
			--without-sb-safepoint
VAR_OPSYS[netbsd]=	MAKE_ENV=SBCL_PAXCTL="{{PAXCTL}} +m"

[NETBSD].DESCRIPTION=			Build for NetBSD
[NETBSD].DF_INDEX_ON=			5

[MIDNIGHT].DESCRIPTION=			Build for MidnightBSD
[MIDNIGHT].DF_INDEX_ON=			4

[SIMD].DESCRIPTION=			Enable SB-SIMD (requires AVX2 CPU)
[SIMD].CMAKE_ARGS_OFF=			--without-sb-simd
[SIMD].CMAKE_ARGS_ON=			--with-sb-simd

[MACOS].DESCRIPTION=			Build for MacOS

[DRAGONFLY].DESCRIPTION=		Build for DragonFly BSD
[DRAGONFLY].DF_INDEX_ON=		2

[FREEBSD].DESCRIPTION=			Build for FreeBSD
[FREEBSD].DF_INDEX_ON=			6

[SUNOS].DESCRIPTION=			Build for Solaris

[CONCURRENCY].DESCRIPTION=		Enable thread support
[CONCURRENCY].CMAKE_ARGS_OFF=		--without-sb-thread
[CONCURRENCY].CMAKE_ARGS_ON=		--with-sb-thread

[CLISP].DESCRIPTION=			Bootstrap SBCL with Clisp
[CLISP].BUILD_DEPENDS_ON=		clisp:primary:std
[CLISP].CMAKE_ARGS_OFF=			--xc-host={{WRKDIR}}/bootstrap/bin/sbcl
[CLISP].CMAKE_ARGS_ON=			--xc-host=clisp

[LINUX].DESCRIPTION=			Build for Linux
[LINUX].DF_INDEX_ON=			3

post-patch:
	# Rename installed file sbcl.core as sbcl_core
	${GREP} -Frl 'sbcl.core' ${WRKSRC} | ${XARGS} ${REINPLACE_CMD} -e 's|sbcl\.core|sbcl_core|g'
	# fix paths
	${REINPLACE_CMD} -e 's|/etc|${PREFIX}/etc|' \
		${WRKSRC}/src/code/toplevel.lisp \
		${WRKSRC}/doc/sbcl.1 \
		${WRKSRC}/doc/manual/start-stop.texinfo

do-build:
	(cd ${WRKSRC} && ${SETENV} ${MAKE_ENV} ${SH} make.sh ${CMAKE_ARGS} || ${TRUE})

post-install:
	${STRIP_CMD} ${STAGEDIR}${PREFIX}/bin/sbcl
	${RM} ${STAGEDIR}${PREFIX}/${INFO_PATH}/dir
	${RM} -rf ${STAGEDIR}${STD_DOCDIR}

pre-build-netbsd:
	# increase datasize limits on NetBSD
	ulimit -d 2097152 && ulimit -a

post-install-SIMD-ON:
	${MKDIR} ${STAGEDIR}${PREFIX}/lib/sbcl/sb-simd
	${INSTALL_DATA} ${WRKSRC}/contrib/sb-simd/code/*.[la]* \
		${STAGEDIR}${PREFIX}/lib/sbcl/sb-simd/

pre-build-midnightbsd:
	# MidnightBSD 3.0 code originates from FreeBSD before the addition of ASLR
	${REINPLACE_CMD} '/PAXCTL/d' ${WRKSRC}/src/runtime/Config.x86-64-freebsd

post-extract:
	# Extract licenses into separate files
	${AWK} '/^;;;; Portions of LOOP/,/;;;; specification/' \
		${WRKSRC}/COPYING > ${WRKDIR}/LICENSE_PUBDOM
	${AWK} '/gerd\.moellmann/,/;;; DAMAGE/' \
		${WRKSRC}/COPYING > ${WRKDIR}/LICENSE_BSD

do-install:
	(cd ${WRKSRC} && ${SETENV} \
	INSTALL_ROOT="${STAGEDIR}${PREFIX}" \
	MAN_DIR="${STAGEDIR}${MANPREFIX}/man" \
	INFO_DIR="${STAGEDIR}${PREFIX}/${INFO_PATH}" \
	DOC_DIR="${STAGEDIR}${STD_DOCDIR}" \
	${SH} install.sh)
.for M in asdf sb-aclrepl sb-bsd-sockets sb-cltl2 sb-concurrency sb-cover \
	sb-executable sb-gmp sb-grovel sb-introspect sb-md5 sb-mpfr sb-posix \
	sb-queue sb-rotate-byte sb-rt sb-simple-streams sb-sprof
	${MKDIR} ${STAGEDIR}${PREFIX}/lib/sbcl/${M}
	${INSTALL_DATA} ${WRKSRC}/contrib/${M}/*.[la]* \
		${STAGEDIR}${PREFIX}/lib/sbcl/${M}/
.endfor
	${INSTALL_DATA} ${WRKDIR}/sbclrc \
		${STAGEDIR}${PREFIX}/etc/sbclrc.sample
	# build documentation
	${DO_MAKE_BUILD} -C ${WRKSRC}/doc/manual info html

[FILE:343:descriptions/desc.primary]
Steel Bank Common Lisp (SBCL) is a high performance Common Lisp compiler. 
It is open source / free software, with a permissive license. In addition 
to the compiler and runtime system for ANSI Common Lisp, it provides an 
interactive environment including a debugger, a statistical profiler, a 
code coverage tool, and many other extensions.


[FILE:698:distinfo]
5f14b4ed92942a9e387594fac000b96db7467e9ce5613067ffc0923df3ec2072      8252514 sbcl-2.5.4-source.tar.bz2
2078b590523a39aa6162ce9d28e2aa641de91176a42d34a804f9b1d48841435d      9889963 bootstrap-sbcl-2.4.4-dragonfly-x86_64.tzst
1292fc0a8ac79b4debae4443878758a46c1a0c2f6bc7fda54c389ca0ecd28489      9920439 bootstrap-sbcl-2.4.4-Linux-amd64.tzst
23539b78dcfcf0448cb724abaadf368f89cd8c48c1aec13597f1dde8441f9b11      9904011 bootstrap-sbcl-2.4.4-MidnightBSD-amd64.tzst
6ceaa51752eeebc1f3f9545bdf738c0681ea00aaead30284e2bf6b9a20afdeee      9893648 bootstrap-sbcl-2.4.4-NetBSD-amd64.tzst
e665941f63f70600b78161bf95537870836677c1d178560798f03b3c3d7e4b09      9912823 bootstrap-sbcl-2.4.4-FreeBSD-amd64.tzst


[FILE:3727:manifests/plist.primary]
@sample etc/sbclrc.sample
%%ONLY-LINUX%%lib/sbcl/contrib/
 sb-perf.asd
 sb-perf.fasl
%%SIMD-ON%%lib/sbcl/contrib/
 sb-simd.asd
 sb-simd.fasl
%%SIMD-ON%%lib/sbcl/sb-simd/
 constants.lisp
 cpu-identification.lisp
 define-arefs.lisp
 define-associatives.lisp
 define-comparisons.lisp
 define-custom-vops.lisp
 define-fake-vops.lisp
 define-ifs.lisp
 define-instruction-vops.lisp
 define-instructions.lisp
 define-modify-macros.lisp
 define-reducers.lisp
 define-reffers.lisp
 define-rounders.lisp
 define-scalar-casts.lisp
 define-simd-casts.lisp
 define-types.lisp
 define-unequals.lisp
 define-vop-functions.lisp
 define-vref-vops.lisp
 define-vrefs.lisp
 instruction-set-case.lisp
 instruction-set.lisp
 missing-instruction.lisp
 packages.lisp
 printable.lisp
 record.lisp
 sb-simd.asd
 utilities.lisp
bin/sbcl
lib/sbcl/
 sbcl.mk
 sbcl_core
lib/sbcl/asdf/
 asdf.lisp
 uiop.lisp
lib/sbcl/contrib/
 asdf.fasl
 sb-aclrepl.asd
 sb-aclrepl.fasl
 sb-bsd-sockets.asd
 sb-bsd-sockets.fasl
 sb-capstone.asd
 sb-capstone.fasl
 sb-cltl2.asd
 sb-cltl2.fasl
 sb-concurrency.asd
 sb-concurrency.fasl
 sb-cover.asd
 sb-cover.fasl
 sb-executable.asd
 sb-executable.fasl
 sb-gmp.asd
 sb-gmp.fasl
 sb-grovel.asd
 sb-grovel.fasl
 sb-introspect.asd
 sb-introspect.fasl
 sb-md5.asd
 sb-md5.fasl
 sb-mpfr.asd
 sb-mpfr.fasl
 sb-posix.asd
 sb-posix.fasl
 sb-queue.asd
 sb-queue.fasl
 sb-rotate-byte.asd
 sb-rotate-byte.fasl
 sb-rt.asd
 sb-rt.fasl
 sb-simple-streams.asd
 sb-simple-streams.fasl
 sb-sprof.asd
 sb-sprof.fasl
 uiop.fasl
lib/sbcl/sb-aclrepl/
 debug.lisp
 inspect.lisp
 repl.lisp
 sb-aclrepl.asd
 tests.lisp
 toplevel.lisp
lib/sbcl/sb-bsd-sockets/
 constants-addrinfo.lisp
 constants-gethostbyname.lisp
 constants-unix.lisp
 constants-win32.lisp
 constants.lisp
 defpackage.lisp
 inet.lisp
 inet4.lisp
 inet6.lisp
 local.lisp
 misc.lisp
 name-service.lisp
 protocol.lisp
 sb-bsd-sockets.asd
 sockets.lisp
 sockopt.lisp
 tests.lisp
 util.lisp
 win32-lib.lisp
 win32-sockets.lisp
lib/sbcl/sb-cltl2/
 compiler-let.lisp
 defpackage.lisp
 env.lisp
 sb-cltl2.asd
 tests.lisp
lib/sbcl/sb-concurrency/
 frlock.lisp
 gate.lisp
 mailbox.lisp
 package.lisp
 queue.lisp
 sb-concurrency.asd
lib/sbcl/sb-cover/
 cover.lisp
 sb-cover.asd
 test-data-1.lisp
 test-data-2.lisp
 test-data-3.lisp
 test-data-4.lisp
 test-data-5.lisp
 test-data-6.lisp
 test-data-branching-forms.lisp
 tests.lisp
lib/sbcl/sb-executable/
 sb-executable.asd
 sb-executable.lisp
lib/sbcl/sb-gmp/
 bench.lisp
 gmp.lisp
 sb-gmp.asd
 tests-stress.lisp
 tests.lisp
lib/sbcl/sb-grovel/
 def-to-lisp.lisp
 defpackage.lisp
 example-constants.lisp
 foreign-glue.lisp
 sb-grovel.asd
lib/sbcl/sb-introspect/
 introspect.lisp
 load-test.lisp
 sb-introspect.asd
 test-driver.lisp
 test.lisp
 xref-test-data.lisp
 xref-test.lisp
lib/sbcl/sb-md5/
 md5-tests.lisp
 md5.lisp
 sb-md5.asd
lib/sbcl/sb-mpfr/
 mpfr.lisp
 sb-mpfr.asd
 tests.lisp
lib/sbcl/sb-posix/
 constants.lisp
 defpackage.lisp
 designator.lisp
 interface.lisp
 libc-tests.lisp
 macros.lisp
 posix-tests.lisp
 sb-posix.asd
 strtod.lisp
lib/sbcl/sb-queue/
 package.lisp
 sb-queue.asd
lib/sbcl/sb-rotate-byte/
 arm-vm.lisp
 arm64-vm.lisp
 compiler.lisp
 package.lisp
 ppc-vm.lisp
 ppc64-vm.lisp
 riscv-vm.lisp
 rotate-byte-tests.lisp
 rotate-byte.lisp
 sb-rotate-byte.asd
 x86-64-vm.lisp
 x86-vm.lisp
lib/sbcl/sb-rt/
 rt.lisp
 sb-rt.asd
lib/sbcl/sb-simple-streams/
 classes.lisp
 direct.lisp
 file.lisp
 fndb.lisp
 impl.lisp
 internal.lisp
 iodefs.lisp
 null.lisp
 package.lisp
 sb-simple-streams.asd
 simple-stream-tests.lisp
 socket.lisp
 strategy.lisp
 string.lisp
 terminal.lisp
lib/sbcl/sb-sprof/
 call-counting.lisp
 disassemble.lisp
 graph.lisp
 interface.lisp
 package.lisp
 record.lisp
 report.lisp
 sb-sprof.asd
 test.lisp


[FILE:22:manifests/plist.man]
share/man/man1/sbcl.1


[FILE:557:patches/patch-make-config.sh]
Linux LARGEFILE option does not seem to build.

--- make-config.sh.orig	2025-04-28 07:35:17 UTC
+++ make-config.sh
@@ -301,7 +301,7 @@ case `uname` in
         ;;
     *BSD)
         case `uname` in
-            FreeBSD)
+            FreeBSD|MidnightBSD)
                 sbcl_os="freebsd"
                 ;;
             GNU/kFreeBSD)
@@ -577,7 +577,6 @@ case "$sbcl_os" in
         # src/runtime/Config.foo-linux too.
         case "$sbcl_arch" in
 	    mips | arm | x86 | x86-64)
-		printf ' :largefile' >> $ltf
 		;;
         esac
         if $android


[FILE:1222:files/city.cc.license]
// Copyright (c) 2011 Google, Inc.
//
// Permission is hereby granted, free of charge, to any person obtaining a copy
// of this software and associated documentation files (the "Software"), to deal
// in the Software without restriction, including without limitation the rights
// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
// copies of the Software, and to permit persons to whom the Software is
// furnished to do so, subject to the following conditions:
//
// The above copyright notice and this permission notice shall be included in
// all copies or substantial portions of the Software.
//
// THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
// THE SOFTWARE.
//
// CityHash, by Geoff Pike and Jyrki Alakuijala
//
// This file provides CityHash64() and related functions.


[FILE:39:files/sbclrc.in]
(load "%%PREFIX%%/etc/asdf-init.lisp")

