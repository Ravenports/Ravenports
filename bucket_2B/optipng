# Buildsheet autogenerated by ravenadm tool -- Do not edit.

NAMEBASE=		optipng
VERSION=		0.7.7
KEYWORDS=		graphics
VARIANTS=		standard
SDESC[standard]=	Advanced PNG optimizer
HOMEPAGE=		none
CONTACT=		nobody

DOWNLOAD_GROUPS=	main
SITES[main]=		SF/optipng/OptiPNG/optipng-0.7.7
DISTFILE[1]=		optipng-0.7.7.tar.gz:main
DF_INDEX=		1
SPKGS[standard]=	complete
			primary
			docs

OPTIONS_AVAILABLE=	none
OPTIONS_STANDARD=	none

USES=			gmake zlib png

LICENSE=		CUSTOM1:primary
LICENSE_NAME=		CUSTOM1:"ZLIB License"
LICENSE_FILE=		CUSTOM1:{{WRKSRC}}/LICENSE.txt
LICENSE_SCHEME=		solo

FPC_EQUIVALENT=		graphics/optipng

MUST_CONFIGURE=		yes
CONFIGURE_ARGS=		--with-system-zlib
			--with-system-libpng

do-install:
	${INSTALL_PROGRAM} ${WRKSRC}/src/optipng/optipng \
		${STAGEDIR}${PREFIX}/bin/
	${INSTALL_MAN} ${WRKSRC}/src/optipng/man/optipng.1 \
		${STAGEDIR}${MAN1PREFIX}/man/man1/
	${MKDIR} ${STAGEDIR}${STD_DOCDIR}
.for D in history.txt optipng.man.* png_optimization.html
	${INSTALL_DATA} ${WRKSRC}/doc/${D} ${STAGEDIR}${STD_DOCDIR}/
.endfor

[FILE:508:descriptions/desc.primary]
OptiPNG is a PNG optimizer that recompresses image files to a smaller size,
without losing any information. This program also converts external formats
(BMP, GIF, PNM; TIFF support is coming up) to optimized PNG, and performs
PNG integrity checks and corrections.

The idea has been inspired from pngcrush, and is explained in detail in the
PNG-Tech article "A guide to PNG optimization". The implementation is
carried forward in OptiPNG, which offers a faster execution per trial, and
a wider search space.


[FILE:99:distinfo]
4f32f233cef870b3f95d3ad6428bfe4224ef34908f1b42b0badf858216654452      2329555 optipng-0.7.7.tar.gz


[FILE:40:manifests/plist.primary]
bin/optipng
share/man/man1/optipng.1.gz


[FILE:107:manifests/plist.docs]
share/doc/optipng/
 history.txt
 optipng.man.html
 optipng.man.pdf
 optipng.man.txt
 png_optimization.html


[FILE:601:patches/patch-src_pngxtern_pngxmem.c]
--- src/pngxtern/pngxmem.c.orig	2018-01-06 23:22:33 UTC
+++ src/pngxtern/pngxmem.c
@@ -35,7 +35,7 @@ pngx_malloc_rows_extended(png_structp pn
    row_size = png_get_rowbytes(png_ptr, info_ptr);
    /* libpng sets row_size to 0 when the width is too large to process. */
    if (row_size == 0 ||
-       (pngx_alloc_size_t)height > (pngx_alloc_size_t)(-1) / sizeof(png_bytep))
+       (pngx_alloc_size_t)height > (pngx_alloc_size_t)(-1U) / sizeof(png_bytep))
       png_error(png_ptr, "Can't handle exceedingly large image dimensions");
    if (row_size < min_row_size)
       row_size = min_row_size;

