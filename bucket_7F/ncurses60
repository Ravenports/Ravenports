# Buildsheet autogenerated by ravenadm tool -- Do not edit.

NAMEBASE=		ncurses60
VERSION=		6.0
REVISION=		1
KEYWORDS=		devel
VARIANTS=		standard
SDESC[standard]=	Minimal static-only version of ncurses v6.0
HOMEPAGE=		http://invisible-island.net/ncurses/ncurses.html
CONTACT=		nobody

DOWNLOAD_GROUPS=	main
SITES[main]=		http://invisible-mirror.net/archives/ncurses/
			ftp://invisible-island.net/ncurses/
DISTFILE[1]=		ncurses-6.0.tar.gz:main
DF_INDEX=		1
SPKGS[standard]=	single

OPTIONS_AVAILABLE=	none
OPTIONS_STANDARD=	none

USES=			bdb:static pkgconfig terminfo:single shebangfix

DISTNAME=		ncurses-6.0

LICENSE=		MIT:single
LICENSE_FILE=		MIT:{{WRKSRC}}/COPYING
LICENSE_SCHEME=		solo

PREFIX=			{{LOCALBASE}}/ncurses60
SHEBANG_FILES=		test/tracemunch

MUST_CONFIGURE=		gnu
CONFIGURE_WRKSRC=	{{WRKSRC}}/build.nowidec
CONFIGURE_SCRIPT=	../configure
CONFIGURE_ARGS=		--datadir={{PREFIX}}/share/misc
			--disable-overwrite
			--disable-termcap
			--enable-bsdpad
			--enable-getcap
			--enable-colorfgbg
			--enable-shared=no
			--disable-home-terminfo
			--with-pkg-config=yes
			--enable-pc-files
			--includedir={{PREFIX}}/include/ncurses
			--with-termlib
			--program-prefix=
			--enable-rpath
			--disable-root-environ
			--with-manpage-format=gzip
			--srcdir=../
			--without-debug
			--without-manpage-renames
			--without-ada
			--mandir={{MANPREFIX}}/man
			--with-hashed-db=db5
			--with-shlib-version=rel
			--with-pc-suffix=60
			--datadir={{PREFIX}}/share/misc
			--with-default-terminfo-dir={{PREFIX}}/share/misc/terminfo
			--with-terminfo-dirs={{PREFIX}}/share/misc/terminfo:/usr/share/terminfo
CONFIGURE_ENV=		gnat_exists="no"

BUILD_WRKSRC=		{{WRKSRC}}/build.nowidec
SINGLE_JOB=		yes

INSTALL_WRKSRC=		{{WRKSRC}}/build.nowidec
INSTALL_REQ_TOOLCHAIN=	yes
PLIST_SUB=		ABI_VER=6
			REL_VER=6.0
			PREFIX={{LOCALBASE}}

CPPFLAGS=		-P
VAR_OPSYS[sunos]=	CONFIGURE_ENV=LIBS="-lrt -lresolv -lsocket"

post-patch:
	${REINPLACE_CMD} -e 's,$$(INSTALL_PROG) ncurses-config,@INSTALL_SCRIPT@ ncurses-config,' ${WRKSRC}/misc/Makefile.in
	${REINPLACE_CMD} -e 's,/usr/include,${PREFIX}/include,g' ${WRKSRC}/misc/ncurses-config.in

post-stage:
	${SED} -i'' -e 's|-ldb-5||' -e 's|-Wl,.*/db5||' \
		${STAGEDIR}${LOCALBASE}/lib/pkgconfig/*.pc \
		${STAGEDIR}${PREFIX}/bin/ncurse*-config

post-install:
	${MV} ${STAGEDIR}${PREFIX}/share/misc/terminfo.db \
		${STAGEDIR}${PREFIX}/share/misc/terminfo.db.default
	${RM} -r ${STAGEDIR}${MANPREFIX}/man

post-build:
	(cd ${.CURDIR} && ${MAKE} ${.MAKEFLAGS} \
		BUILD_WRKSRC=${WRKSRC}/build.widec do-build)
	# Shift post-install to post-build.   The installation uses the
	# compiler even there.
	(cd ${.CURDIR} && ${MAKE} ${.MAKEFLAGS} \
		INSTALL_WRKSRC=${WRKSRC}/build.widec do-install)
	# Remove -ldb-5 from pc files.  It's been statically linked in

post-configure:
	cd ${.CURDIR} && \
	    ${SET_LATE_CONFIGURE_ARGS} \
	    ${MAKE} ${.MAKEFLAGS} CONFIGURE_WRKSRC=${WRKSRC}/build.widec \
	    CONFIGURE_ARGS="${CONFIGURE_ARGS} --enable-widec" \
	    do-configure
.for d in test c++
	${CP} -R ${WRKSRC}/${d}/* ${WRKSRC}/build.widec/${d}/
	${CP} -R ${WRKSRC}/${d}/* ${WRKSRC}/build.nowidec/${d}/
.endfor

post-extract:
	@${MKDIR} ${WRKSRC}/build.widec
	@${MKDIR} ${WRKSRC}/build.nowidec

post-patch-freebsd:
	# static libdb requires post-linking with pthread library
	${REINPLACE_CMD} -e 's|(LIBS_TIC)|(LIBS_TIC) -lpthread|' \
		-e 's|(LIBS_TINFO)|(LIBS_TINFO) -lpthread|' \
		${WRKSRC}/progs/Makefile.in
	${REINPLACE_CMD} -e 's|(MATH_LIB)|(MATH_LIB) -lpthread|' \
		${WRKSRC}/test/Makefile.in
	${REINPLACE_CMD} -e 's|(TEST_LDFLAGS)|(TEST_LDFLAGS) -lpthread|' \
		${WRKSRC}/c++/Makefile.in

[FILE:512:descriptions/desc.single]
The ncurses software includes a SVr4 and XSI-Curses compatible
curses library as well as terminfo tools including "tic", "infocmp",
and "captoinfo".  The library is used by other programs for text-mode
support of color, multiple highlights, forms-drawing characters,
automatic recognition of keypad and function-key sequences, and
more.

This package was statically built against its own static libraries,
and the version is intentionally fixed to 6.0.  It is meant to be
used exclusively as a build dependency.


[FILE:97:distinfo]
f551c24b30ce8bfb6e96d9f59b42fbea30fa3a6123384172f9e7284bcf647260      3131891 ncurses-6.0.tar.gz


[FILE:780:manifests/plist.single]
%%PREFIX%%/lib/pkgconfig/
 form60.pc
 formw60.pc
 menu60.pc
 menuw60.pc
 ncurses++60.pc
 ncurses++w60.pc
 ncurses60.pc
 ncursesw60.pc
 panel60.pc
 panelw60.pc
 tinfo60.pc
 tinfow60.pc
bin/
 captoinfo
 clear
 infocmp
 infotocap
 ncurses%%ABI_VER%%-config
 ncursesw%%ABI_VER%%-config
 reset
 tabs
 tic
 toe
 tput
 tset
include/ncurses/
 curses.h
 cursesapp.h
 cursesf.h
 cursesm.h
 cursesp.h
 cursesw.h
 cursslk.h
 eti.h
 etip.h
 form.h
 menu.h
 nc_tparm.h
 ncurses.h
 ncurses_dll.h
 panel.h
 term.h
 term_entry.h
 termcap.h
 tic.h
 unctrl.h
lib/
 libform.a
 libformw.a
 libmenu.a
 libmenuw.a
 libncurses++.a
 libncurses++w.a
 libncurses.a
 libncursesw.a
 libpanel.a
 libpanelw.a
 libtinfo.a
 libtinfow.a
share/misc/terminfo.db.default
share/misc/tabset/
 std
 stdcrt
 vt100
 vt300


[FILE:970:patches/patch-configure]
--- configure.orig	2015-08-05 09:20:32 UTC
+++ configure
@@ -5863,7 +5863,7 @@ case $cf_cv_system_name in
 	LD_RPATH_OPT="-Wl,-rpath,"
 	;;
 (dragonfly*|freebsd*)
-	LD_RPATH_OPT="-rpath "
+	LD_RPATH_OPT="-Wl,-rpath,"
 	;;
 (netbsd*)
 	LD_RPATH_OPT="-Wl,-rpath,"
@@ -5872,7 +5872,7 @@ case $cf_cv_system_name in
 	LD_RPATH_OPT="-rpath "
 	;;
 (solaris2*)
-	LD_RPATH_OPT="-R"
+	LD_RPATH_OPT="-Wl,-R"
 	;;
 (*)
 	;;
@@ -6343,11 +6343,11 @@ CF_EOF
 		# tested with SunOS 5.5.1 (solaris 2.5.1) and gcc 2.7.2
 		# tested with SunOS 5.10 (solaris 10) and gcc 3.4.3
 		if test "$DFT_LWR_MODEL" = "shared" ; then
-			LOCAL_LDFLAGS="-R \$(LOCAL_LIBDIR):\${libdir}"
+			LOCAL_LDFLAGS="-Wl,-R\$(LOCAL_LIBDIR):\${libdir}"
 			LOCAL_LDFLAGS2="$LOCAL_LDFLAGS"
 		fi
 		if test "$cf_cv_enable_rpath" = yes ; then
-			EXTRA_LDFLAGS="-R \${libdir} $EXTRA_LDFLAGS"
+			EXTRA_LDFLAGS="-Wl,-R\${libdir} $EXTRA_LDFLAGS"
 		fi
 
 	test "$cf_cv_shlib_version" = auto && cf_cv_shlib_version=rel


[FILE:1041:patches/patch-misc_terminfo.src]
--- misc/terminfo.src.orig	2015-07-25 19:27:20 UTC
+++ misc/terminfo.src
@@ -4143,7 +4143,7 @@ xterm-basic|modern xterm terminal emulat
 	il=\E[%p1%dL, il1=\E[L, ind=^J, invis=\E[8m,
 	is2=\E[!p\E[?3;4l\E[4l\E>, kmous=\E[M, meml=\El,
 	memu=\Em, op=\E[39;49m, rc=\E8, rev=\E[7m, ri=\EM,
-	ritm=\E[23m, rmacs=\E(B, rmam=\E[?7l, rmcup=\E[?1049l,
+	ritm=\E[23m, rmacs=\E(B, rmam=\E[?7l,
 	rmir=\E[4l, rmkx=\E[?1l\E>, rmm=\E[?1034l, rmso=\E[27m,
 	rmul=\E[24m, rs1=\Ec, rs2=\E[!p\E[?3;4l\E[4l\E>, sc=\E7,
 	setab=\E[4%p1%dm, setaf=\E[3%p1%dm,
@@ -4151,7 +4151,7 @@ xterm-basic|modern xterm terminal emulat
 	setf=\E[3%?%p1%{1}%=%t4%e%p1%{3}%=%t6%e%p1%{4}%=%t1%e%p1%{6}%=%t3%e%p1%d%;m,
 	sgr=%?%p9%t\E(0%e\E(B%;\E[0%?%p6%t;1%;%?%p5%t;2%;%?%p2%t;4%;%?%p1%p3%|%t;7%;%?%p4%t;5%;%?%p7%t;8%;m,
 	sgr0=\E(B\E[m, sitm=\E[3m, smacs=\E(0, smam=\E[?7h,
-	smcup=\E[?1049h, smir=\E[4h, smkx=\E[?1h\E=,
+	smir=\E[4h, smkx=\E[?1h\E=,
 	smm=\E[?1034h, smso=\E[7m, smul=\E[4m, tbc=\E[3g,
 	vpa=\E[%i%p1%dd, E3=\E[3J, use=ansi+pp, use=xterm+kbs,
 	use=vt100+enq,


[FILE:359:patches/patch-ncurses_Makefile.in]
--- ncurses/Makefile.in.orig	2018-01-15 19:28:45 UTC
+++ ncurses/Makefile.in
@@ -130,7 +130,7 @@ LDFLAGS		= @LDFLAGS@ @LD_MODEL@ @LIBS@
 
 SHLIB_DIRS	= -L../lib
 SHLIB_LIST	= $(SHLIB_DIRS) @SHLIB_LIST@
-TINFO_LIST	= $(SHLIB_DIRS) @TINFO_LIST@
+TINFO_LIST	= $(SHLIB_DIRS) @TINFO_LIST@ -ldb-5
 TICS_LIST	= $(SHLIB_DIRS) @TICS_LIST@
 
 RPATH_LIST	= @RPATH_LIST@

