# Buildsheet autogenerated by ravenadm tool -- Do not edit.

NAMEBASE=		rspamd
VERSION=		3.10.0
KEYWORDS=		mail
VARIANTS=		std
SDESC[std]=		Fast, free and open-source spam filtering system
HOMEPAGE=		https://rspamd.com/
CONTACT=		nobody

DOWNLOAD_GROUPS=	main
SITES[main]=		GITHUB/vstakhov:rspamd:3.10.0
DISTFILE[1]=		generated:main
DF_INDEX=		1
SPKGS[std]=		set
			primary
			man

OPTIONS_AVAILABLE=	none
OPTIONS_STANDARD=	none

BUILD_DEPENDS=		libsodium:dev:std
			ragel:primary:std
			icu:dev:std
			libarchive:dev:std
			luajit:dev:std
BUILDRUN_DEPENDS=	icu:primary:std
			libsodium:primary:std
			luajit:primary:std
			libarchive:primary:std
RUN_DEPENDS=		nss:caroot:std

USERS=			rspamd
GROUPS=			rspamd
USERGROUP_SPKG=		primary

USES=			cmake perl:build pkgconfig sqlite ssl:openssl30 zlib
			pcre2
GNOME_COMPONENTS=	glib

FPC_EQUIVALENT=		mail/rspamd

PLIST_SUB=		RSPAMDVERSION=3.10.0
			JQUERY=3.7.1
RC_SUBR=		rspamd:primary
SUB_FILES=		messages-primary.ucl
			rspamd.newsyslog.conf.sample

CMAKE_ARGS=		-DCONFDIR={{PREFIX}}/etc/rspamd
			-DLOGDIR=/var/log/rspamd
			-DDBDIR=/var/db/rspamd
			-DRUNDIR=/var/run/rspamd
			-DMANDIR={{MANPREFIX}}/man
			-DCMAKE_INSTALL_PREFIX={{PREFIX}}
			-DBUILD_PORT=yes
			-DLIBDIR={{PREFIX}}/lib/rspamd

post-install:
	${STRIP_CMD} ${STAGEDIR}${PREFIX}/bin/rspamadm
	${STRIP_CMD} ${STAGEDIR}${PREFIX}/bin/rspamc
	${STRIP_CMD} ${STAGEDIR}${PREFIX}/bin/rspamd
	${STRIP_CMD} ${STAGEDIR}${PREFIX}/lib/rspamd/*.so
	${MKDIR}\
		${STAGEDIR}/var/log/rspamd \
		${STAGEDIR}/var/db/rspamd \
		${STAGEDIR}/var/run/rspamd \
		${STAGEDIR}${PREFIX}/etc/newsyslog.conf.d
	${INSTALL_DATA} ${WRKDIR}/rspamd.newsyslog.conf.sample \
		${STAGEDIR}${PREFIX}/etc/rspamd/
	${LN} -s etc/rspamd/rspamd.newsyslog.conf \
		${STAGEDIR}${PREFIX}/etc/newsyslog.conf.d

[FILE:160:descriptions/desc.primary]
Rspamd is fast, modular and lightweight spam filter. It is designed to work
with big amount of mail and can be easily extended with own filters written
in lua.


[FILE:108:distinfo]
528d7f8e2e6263378d043a41c4b1c5dbf1b3e54f3085619f68b04e283efa4a69      6008518 vstakhov-rspamd-3.10.0.tar.gz


[FILE:6650:manifests/plist.primary]
@sample etc/rspamd/rspamd.newsyslog.conf.sample
bin/
 rspamadm
 rspamadm-%%RSPAMDVERSION%%
 rspamc
 rspamc-%%RSPAMDVERSION%%
 rspamd
 rspamd-%%RSPAMDVERSION%%
 rspamd_stats
etc/newsyslog.conf.d/rspamd.newsyslog.conf
etc/rspamd/
 actions.conf
 cgp.inc
 common.conf
 composites.conf
 groups.conf
 lang_detection.inc
 logging.inc
 metrics.conf
 modules.conf
 options.inc
 rspamd.conf
 settings.conf
 statistic.conf
 worker-controller.inc
 worker-fuzzy.inc
 worker-normal.inc
 worker-proxy.inc
etc/rspamd/maps.d/
 dmarc_whitelist.inc
 exe_clickbait.inc
 maillist.inc
 mid.inc
 mime_types.inc
 redirectors.inc
 spf_dkim_whitelist.inc
 surbl-whitelist.inc
etc/rspamd/modules.d/
 antivirus.conf
 arc.conf
 asn.conf
 aws_s3.conf
 bayes_expiry.conf
 bimi.conf
 chartable.conf
 clickhouse.conf
 dcc.conf
 dkim.conf
 dkim_signing.conf
 dmarc.conf
 elastic.conf
 emails.conf
 external_relay.conf
 external_services.conf
 force_actions.conf
 forged_recipients.conf
 fuzzy_check.conf
 gpt.conf
 greylist.conf
 hfilter.conf
 history_redis.conf
 http_headers.conf
 known_senders.conf
 maillist.conf
 metadata_exporter.conf
 metric_exporter.conf
 mid.conf
 milter_headers.conf
 mime_types.conf
 multimap.conf
 mx_check.conf
 neural.conf
 once_received.conf
 p0f.conf
 phishing.conf
 ratelimit.conf
 rbl.conf
 redis.conf
 regexp.conf
 replies.conf
 reputation.conf
 rspamd_update.conf
 spamassassin.conf
 spamtrap.conf
 spf.conf
 surbl.conf
 trie.conf
 url_redirector.conf
 whitelist.conf
etc/rspamd/scores.d/
 content_group.conf
 fuzzy_group.conf
 headers_group.conf
 hfilter_group.conf
 mime_types_group.conf
 mua_group.conf
 phishing_group.conf
 policies_group.conf
 rbl_group.conf
 statistics_group.conf
 subject_group.conf
 surbl_group.conf
 whitelist_group.conf
lib/rspamd/
 librspamd-actrie.so
 librspamd-ev.so
 librspamd-kann.so
 librspamd-replxx.so
 librspamd-server.so
share/rspamd/effective_tld_names.dat
share/rspamd/elastic/
 kibana.json
 rspamd_template.json
share/rspamd/languages/
 af.json
 an.json
 ar.json
 bg.json
 bn.json
 br.json
 cs.json
 cy.json
 da.json
 de.json
 en.json
 es.json
 et.json
 eu.json
 fa.json
 fi.json
 fr.json
 ga.json
 hi.json
 hr.json
 hu.json
 id.json
 is.json
 it.json
 lt.json
 lv.json
 mr.json
 ms.json
 ne.json
 nl.json
 no.json
 pa.json
 pl.json
 pt.json
 ro.json
 ru.json
 sl.json
 so.json
 sq.json
 sr.json
 stop_words
 sv.json
 sw.json
 tr.json
 uk.json
 ur.json
 vi.json
share/rspamd/lualib/
 ansicolors.lua
 argparse.lua
 fun.lua
 global_functions.lua
 lpegre.lua
 lua_auth_results.lua
 lua_aws.lua
 lua_bayes_learn.lua
 lua_bayes_redis.lua
 lua_cfg_transform.lua
 lua_cfg_utils.lua
 lua_clickhouse.lua
 lua_dkim_tools.lua
 lua_fuzzy.lua
 lua_lexer.lua
 lua_maps.lua
 lua_maps_expressions.lua
 lua_meta.lua
 lua_mime.lua
 lua_mime_types.lua
 lua_redis.lua
 lua_settings.lua
 lua_smtp.lua
 lua_stat.lua
 lua_tcp_sync.lua
 lua_urls_compose.lua
 lua_util.lua
 lua_verdict.lua
 lupa.lua
 plugins_stats.lua
 tableshape.lua
share/rspamd/lualib/lua_content/
 ical.lua
 init.lua
 pdf.lua
 vcard.lua
share/rspamd/lualib/lua_ffi/
 common.lua
 dkim.lua
 init.lua
 linalg.lua
 spf.lua
share/rspamd/lualib/lua_magic/
 heuristics.lua
 init.lua
 patterns.lua
 types.lua
share/rspamd/lualib/lua_scanners/
 avast.lua
 clamav.lua
 cloudmark.lua
 common.lua
 dcc.lua
 fprot.lua
 icap.lua
 init.lua
 kaspersky_av.lua
 kaspersky_se.lua
 oletools.lua
 p0f.lua
 pyzor.lua
 razor.lua
 savapi.lua
 sophos.lua
 spamassassin.lua
 vadesecure.lua
 virustotal.lua
share/rspamd/lualib/lua_selectors/
 common.lua
 extractors.lua
 init.lua
 maps.lua
 transforms.lua
share/rspamd/lualib/plugins/
 dmarc.lua
 neural.lua
 ratelimit.lua
 rbl.lua
share/rspamd/lualib/redis_scripts/
 bayes_cache_check.lua
 bayes_cache_learn.lua
 bayes_classify.lua
 bayes_learn.lua
 bayes_stat.lua
 neural_maybe_invalidate.lua
 neural_maybe_lock.lua
 neural_save_unlock.lua
 neural_train_size.lua
 ratelimit_check.lua
 ratelimit_cleanup_pending.lua
 ratelimit_update.lua
share/rspamd/lualib/rspamadm/
 classifier_test.lua
 clickhouse.lua
 configgraph.lua
 confighelp.lua
 configwizard.lua
 cookie.lua
 corpus_test.lua
 dkim_keygen.lua
 dmarc_report.lua
 dns_tool.lua
 fuzzy_convert.lua
 fuzzy_ping.lua
 fuzzy_stat.lua
 grep.lua
 keypair.lua
 mime.lua
 neural_test.lua
 publicsuffix.lua
 secretbox.lua
 stat_convert.lua
 statistics_dump.lua
 template.lua
 vault.lua
share/rspamd/plugins/
 antivirus.lua
 arc.lua
 asn.lua
 aws_s3.lua
 bayes_expiry.lua
 bimi.lua
 clickhouse.lua
 clustering.lua
 dcc.lua
 dkim_signing.lua
 dmarc.lua
 dynamic_conf.lua
 elastic.lua
 emails.lua
 external_relay.lua
 external_services.lua
 force_actions.lua
 forged_recipients.lua
 fuzzy_collect.lua
 gpt.lua
 greylist.lua
 hfilter.lua
 history_redis.lua
 http_headers.lua
 ip_score.lua
 known_senders.lua
 maillist.lua
 maps_stats.lua
 metadata_exporter.lua
 metric_exporter.lua
 mid.lua
 milter_headers.lua
 mime_types.lua
 multimap.lua
 mx_check.lua
 neural.lua
 once_received.lua
 p0f.lua
 phishing.lua
 ratelimit.lua
 rbl.lua
 replies.lua
 reputation.lua
 rspamd_update.lua
 settings.lua
 spamassassin.lua
 spamtrap.lua
 spf.lua
 trie.lua
 url_redirector.lua
 whitelist.lua
share/rspamd/rules/
 archives.lua
 bitcoin.lua
 bounce.lua
 content.lua
 forwarding.lua
 headers_checks.lua
 html.lua
 mid.lua
 misc.lua
 parts.lua
 rspamd.lua
 subject_checks.lua
share/rspamd/rules/controller/
 fuzzy.lua
 init.lua
 maps.lua
 neural.lua
 selectors.lua
share/rspamd/rules/regexp/
 compromised_hosts.lua
 headers.lua
 misc.lua
 upstream_spam_filters.lua
share/rspamd/www/
 README.md
 apple-touch-icon.png
 browserconfig.xml
 favicon-16x16.png
 favicon-32x32.png
 favicon.ico
 index.html
 mstile-150x150.png
 safari-pinned-tab.svg
share/rspamd/www/css/
 FooTable.Glyphicons.css
 bootstrap.min.css
 codejar-linenumbers.css
 d3evolution.css
 d3pie.css
 font-glyphicons.css
 footable.standalone.min.css
 nprogress.css
 prism.css
 rspamd.css
 svg-with-js.min.css
share/rspamd/www/fonts/
 glyphicons-halflings-regular.ttf
 glyphicons-halflings-regular.woff
 glyphicons-halflings-regular.woff2
share/rspamd/www/img/
 asc.png
 desc.png
 drop-area.svg
 rspamd_logo_navbar.png
share/rspamd/www/js/main.js
share/rspamd/www/js/app/
 common.js
 config.js
 graph.js
 history.js
 libft.js
 rspamd.js
 selectors.js
 stats.js
 symbols.js
 upload.js
share/rspamd/www/js/lib/
 bootstrap.bundle.min.js
 codejar-linenumbers.min.js
 codejar.min.js
 d3.min.js
 d3evolution.min.js
 d3pie.min.js
 fontawesome.min.js
 footable.min.js
 jquery-%%JQUERY%%.min.js
 jquery.stickytabs.min.js
 nprogress.min.js
 prism.js
 require.min.js
 solid.min.js
 visibility.min.js
@dir /var/db/rspamd
@dir /var/log/rspamd
@dir /var/run/rspamd


[FILE:62:manifests/plist.man]
share/man/man1/
 rspamadm.1
 rspamc.1
share/man/man8/rspamd.8


[FILE:377:patches/patch-contrib_backward-cpp_backward.hpp]
--- contrib/backward-cpp/backward.hpp.orig	2024-07-23 10:37:27 UTC
+++ contrib/backward-cpp/backward.hpp
@@ -415,6 +415,7 @@ extern "C" uintptr_t _Unwind_GetIPInfo(_
 #ifdef BACKWARD_ATLEAST_CXX11
 #include <unordered_map>
 #include <utility> // for std::swap
+#include <cstdint>
 namespace backward {
 namespace details {
 template <typename K, typename V> struct hashtable {


[FILE:358:files/messages-primary.ucl.in]
single: {
  type: "install"
  message: <<EOM
 - Add the following line to /etc/rc.conf to enable rspamd:

     rspamd_enable="YES"

 - A symbolic link to %%ETCDIR%%/rspamd.newsyslog.conf
   has been created in the /usr/local/etc/newsyslog.conf.d directory.
   You can edit %%ETCDIR%%/rspamd.newsyslog.conf
   to change log file rotation configuration.
EOM
}


[FILE:1259:files/rspamd.in]
#!/bin/sh

# PROVIDE: rspamd
# REQUIRE: LOGIN redis
# BEFORE:  mail
# KEYWORD: shutdown
#
# Add the following line to /etc/rc.conf to enable rspamd:
#
# rspamd_enable (bool):		Set to "NO" by default.
#				Set it to "YES" to enable rspamd.
#
# rspamd_user (str):		Default to "rspamd".
#
# rspamd_group (str):		Default to "rspamd".
#
# rspamd_flags (str):		Default to "-c %%PREFIX%%/etc/rspamd.conf".

. /etc/rc.subr

name=rspamd
rcvar=rspamd_enable

load_rc_config $name

: ${rspamd_enable:="NO"}
: ${rspamd_user="rspamd"}
: ${rspamd_group="rspamd"}
: ${rspamd_flags="-c %%PREFIX%%/etc/rspamd/rspamd.conf"}

pidfile=${rspamd_pidfile:-"/var/run/rspamd/rspamd.pid"}

command=%%PREFIX%%/bin/rspamd
command_adm=%%PREFIX%%/bin/rspamadm
restart_precmd="rspamd_checkconfig"
reload_precmd="rspamd_checkconfig"
configtest_cmd="rspamd_checkconfig"
reopenlog_cmd="reopenlog_cmd"

required_files=%%PREFIX%%/etc/rspamd/rspamd.conf
command_args="-u ${rspamd_user} -g ${rspamd_group}"
extra_commands="reload configtest reopenlog"
stop_postcmd="rm -f $pidfile"
sig_reload="HUP"

rspamd_checkconfig()
{
	echo "Performing sanity check on rspamd configuration:"
	eval ${command_adm} configtest ${rspamd_flags}
}

reopenlog_cmd()
{
	pkill -USR1 -F $pidfile
}

run_rc_command "$1"


[FILE:467:files/rspamd.newsyslog.conf.sample.in]
# newsyslog configuration file for rspamd(8)
#
# Link (or copy) rspamd.newsyslog.conf to %%PREFIX%%/etc/newsyslog.conf.d/
# to take care of log rotation.
#
# ln -s %%PREFIX%%/etc/rspamd/rspamd.newsyslog.conf %%PREFIX%%/etc/newsyslog.conf.d
#
# See newsyslog.conf(5) for details.
#
# logfilename          [owner:group]    mode count size when  flags [/pid_file] [sig_num]
/var/log/rspamd/rspamd.log	rspamd:rspamd	644   7	   *	@T00  JC    /var/run/rspamd/rspamd.pid 30

