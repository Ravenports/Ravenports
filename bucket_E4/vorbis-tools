# Buildsheet autogenerated by ravenadm tool -- Do not edit.

NAMEBASE=		vorbis-tools
VERSION=		1.4.2
REVISION=		2
KEYWORDS=		audio
VARIANTS=		std
SDESC[std]=		Play, encode, and manage Ogg Vorbis files
HOMEPAGE=		https://xiph.org/vorbis/
CONTACT=		Michael_Reim[kraileth@elderlinux.org]

DOWNLOAD_GROUPS=	main
SITES[main]=		https://ftp.osuosl.org/pub/xiph/releases/vorbis/
DISTFILE[1]=		vorbis-tools-1.4.2.tar.gz:main
DF_INDEX=		1
SPKGS[std]=		set
			primary
			nls
			man

OPTIONS_AVAILABLE=	none
OPTIONS_STANDARD=	none

BUILD_DEPENDS=		libvorbis:dev:std
			flac:dev:std
			libao:dev:std
BUILDRUN_DEPENDS=	flac:primary:std
			libao:primary:std
			libkate:primary:std
			libvorbis:primary:std
			speex:primary:std

USES=			cpe curl gettext iconv pkgconfig

LICENSE=		GPLv2:primary
LICENSE_TERMS=		primary:{{WRKDIR}}/TERMS
LICENSE_FILE=		GPLv2:{{WRKSRC}}/COPYING
LICENSE_AWK=		TERMS:"^$$"
LICENSE_SOURCE=		TERMS:{{WRKSRC}}/oggdec/oggdec.c
LICENSE_SCHEME=		solo

CPE_VENDOR=		xiph
FPC_EQUIVALENT=		audio/vorbis-tools

MUST_CONFIGURE=		gnu
CONFIGURE_ENV=		PTHREAD_LIBS="-lpthread"

VAR_OPSYS[sunos]=	LDFLAGS=-lrt
CVE_FIXED=		CVE-2023-43361

post-install:
	${MKDIR} ${STAGEDIR}${PREFIX}/share/examples/vorbis-tools
	${INSTALL_DATA} ${WRKSRC}/ogg123/ogg123rc-example \
		${STAGEDIR}${PREFIX}/share/examples/vorbis-tools/ogg123rc

[FILE:555:descriptions/desc.primary]
Vorbis is a general-purpose audio and music encoding format contemporary 
to MPEG-4's AAC and TwinVQ, the next generation beyond MPEG audio layer 3. 
 Unlike the MPEG sponsored formats and other proprietary formats such as 
RealAudio G2, the Vorbis CODEC specification belongs to the public domain. 
All the technical details are published and documented, and any software 
entity may make full use of the format without royalty or patent concerns.

This package contains utilities to encode, decode, and cut vorbis streams, 
and to add comments to them.


[FILE:104:distinfo]
db7774ec2bf2c939b139452183669be84fda5774d6400fc57fde37f77624f0b0      1389947 vorbis-tools-1.4.2.tar.gz


[FILE:96:manifests/plist.primary]
bin/
 ogg123
 oggdec
 oggenc
 ogginfo
 vcut
 vorbiscomment
share/examples/vorbis-tools/ogg123rc


[FILE:751:manifests/plist.nls]
share/locale/be/LC_MESSAGES/vorbis-tools.mo
share/locale/cs/LC_MESSAGES/vorbis-tools.mo
share/locale/da/LC_MESSAGES/vorbis-tools.mo
share/locale/en_GB/LC_MESSAGES/vorbis-tools.mo
share/locale/eo/LC_MESSAGES/vorbis-tools.mo
share/locale/es/LC_MESSAGES/vorbis-tools.mo
share/locale/fr/LC_MESSAGES/vorbis-tools.mo
share/locale/hr/LC_MESSAGES/vorbis-tools.mo
share/locale/hu/LC_MESSAGES/vorbis-tools.mo
share/locale/nl/LC_MESSAGES/vorbis-tools.mo
share/locale/pl/LC_MESSAGES/vorbis-tools.mo
share/locale/ro/LC_MESSAGES/vorbis-tools.mo
share/locale/ru/LC_MESSAGES/vorbis-tools.mo
share/locale/sk/LC_MESSAGES/vorbis-tools.mo
share/locale/sv/LC_MESSAGES/vorbis-tools.mo
share/locale/uk/LC_MESSAGES/vorbis-tools.mo
share/locale/vi/LC_MESSAGES/vorbis-tools.mo


[FILE:82:manifests/plist.man]
share/man/man1/
 ogg123.1
 oggdec.1
 oggenc.1
 ogginfo.1
 vcut.1
 vorbiscomment.1


[FILE:1941:patches/patch-fix-CVE-2023-43361]
From 69dfbe06ce02e6199444245397acf79fb6857b4c Mon Sep 17 00:00:00 2001
From: Ralph Giles <giles@thaumas.net>
Date: Sun, 17 Sep 2023 11:49:12 -0700
Subject: [PATCH] oggenc: Don't assume the output path ends in a file name.

oggenc attempts to create any specified directories in the output
file path if they don't exist. The parser was assuming there was
a final filename after the last directory separator, and so would
try to read off the end of the argument if it was a bare directory
such as `./` or `outdir/`. This adds a check to make sure the
scan isn't starting off the end of the path string.

Thanks to Frank-Z7 (Zeng Yunxiang) at Huazhong University of Science
and Technology (cse.hust.edu.cn) for the report.
---
 oggenc/platform.c | 13 +++++++++----
 1 file changed, 9 insertions(+), 4 deletions(-)

--- oggenc/platform.c.orig
+++ oggenc/platform.c
@@ -136,18 +136,23 @@ int create_directories(char *fn, int isutf8)
 {
     char *end, *start;
     struct stat statbuf;
-    char *segment = malloc(strlen(fn)+1);
+    const size_t fn_len = strlen(fn);
+    char *segment = malloc(fn_len+1);
 #ifdef _WIN32
     wchar_t seg[MAX_PATH+1];
 #endif
 
     start = fn;
 #ifdef _WIN32
-    if(strlen(fn) >= 3 && isalpha(fn[0]) && fn[1]==':')
+    // Strip drive prefix
+    if(fn_len >= 3 && isalpha(fn[0]) && fn[1]==':') {
         start = start+2;
+    }
 #endif
 
-    while((end = strpbrk(start+1, PATH_SEPS)) != NULL)
+    // Loop through path segments, creating directories if necessary
+    while((start+1 - fn < fn_len) &&
+          (end = strpbrk(start+1, PATH_SEPS)) != NULL)
     {
         int rv;
         memcpy(segment, fn, end-fn);
@@ -159,7 +164,7 @@ int create_directories(char *fn, int isutf8)
             rv = _wstat(seg,&statbuf);
         } else
 #endif
-            rv = stat(segment,&statbuf);
+        rv = stat(segment, &statbuf);
         if(rv) {
             if(errno == ENOENT) {
 #ifdef _WIN32
-- 
GitLab

[FILE:232:patches/patch-ogg123_Makefile.in]
--- ogg123/Makefile.in.orig	2021-01-21 09:14:18 UTC
+++ ogg123/Makefile.in
@@ -816,7 +816,7 @@ info: info-am
 
 info-am:
 
-install-data-am: install-docDATA install-man
+install-data-am: install-man
 
 install-dvi: install-dvi-am
 


[FILE:238:patches/patch-ogg123_status.c]
--- ogg123/status.c.orig	2021-01-02 19:54:35 UTC
+++ ogg123/status.c
@@ -26,6 +26,9 @@
 #ifdef HAVE_UNISTD_H
 #include <sys/ioctl.h>
 #include <unistd.h>
+# ifdef __sun__
+# include <sys/termios.h>
+# endif
 #endif
 
 #ifdef HAVE_FCNTL_H


[FILE:320:patches/patch-ogg123_vorbis__comments.c]
--- ogg123/vorbis_comments.c.orig	2021-01-07 23:31:25 UTC
+++ ogg123/vorbis_comments.c
@@ -74,7 +74,7 @@ char *lookup_comment_prettyprint (const
 
   /* Use default formatting */
   j = strcspn(comment, "=");
-  if (j) {
+  if (j != strlen(comment)) {
     *offset = j + 1;
     s = malloc(j + 2);
     if (s == NULL) {


[FILE:202:patches/patch-oggenc_lyrics.c]
--- oggenc/lyrics.c.orig	2020-12-18 14:49:34 UTC
+++ oggenc/lyrics.c
@@ -16,7 +16,7 @@
 #endif
 
 #include <stdio.h>
-#include <malloc.h>
+#include <stdlib.h>
 #include <string.h>
 #include <errno.h>
 


[FILE:193:patches/patch-ogginfo_codec__skeleton.c]
--- ogginfo/codec_skeleton.c.orig	2021-01-08 23:13:55 UTC
+++ ogginfo/codec_skeleton.c
@@ -24,6 +24,7 @@
 
 #include <ogg/ogg.h>
 
+#include "utf8.h"
 #include "i18n.h"
 
 #include "private.h"

