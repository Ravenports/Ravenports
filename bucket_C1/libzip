# Buildsheet autogenerated by ravenadm tool -- Do not edit.

NAMEBASE=		libzip
VERSION=		1.5.0
KEYWORDS=		archivers
VARIANTS=		standard
SDESC[standard]=	C library for manipulating ZIP archives
HOMEPAGE=		http://www.nih.at/libzip/
CONTACT=		nobody

DOWNLOAD_GROUPS=	main
SITES[main]=		http://www.nih.at/libzip/
DISTFILE[1]=		libzip-1.5.0.tar.xz:main
DF_INDEX=		1
SPKGS[standard]=	single

OPTIONS_AVAILABLE=	none
OPTIONS_STANDARD=	none

BUILD_DEPENDS=		bzip2:static:standard
BUILDRUN_DEPENDS=	bzip2:shared:standard

USES=			cpe cmake zlib ssl

LICENSE=		BSD3CLAUSE:single
LICENSE_SCHEME=		solo
LICENSE_FILE=		BSD3CLAUSE:{{WRKSRC}}/LICENSE

FPC_EQUIVALENT=		archivers/libzip

SOVERSION=		5.0

CMAKE_ARGS=		-DCMAKE_INSTALL_LIBDIR:STRING="lib"

post-patch:
	${REINPLACE_CMD} -e '/SET(CMAKE_INSTALL_RPATH /d' \
		${WRKSRC}/CMakeLists.txt

post-install:
	${STRIP_CMD} ${STAGEDIR}${PREFIX}/bin/zip*
	${STRIP_CMD} ${STAGEDIR}${PREFIX}/lib/libzip.so

[FILE:272:descriptions/desc.single]
libzip is a C library for reading, creating, and modifying zip archives.
Files can be added from data buffers, files, or compressed data copied
directly from other zip archives. Changes made without closing the archive
can be reverted. The API is documented by man pages.


[FILE:98:distinfo]
5ddb9b41d31b2f99ad4d512003c610ae2db70e222833aba6f9332d5b48a153d9       695660 libzip-1.5.0.tar.xz


[FILE:3157:manifests/plist.single]
bin/
 zipcmp
 zipmerge
 ziptool
include/
 zip.h
 zipconf.h
lib/
 libzip.so
 libzip.so.%%SOMAJOR%%
 libzip.so.%%SOVERSION%%
lib/pkgconfig/libzip.pc
share/man/man1/
 zipcmp.1.gz
 zipmerge.1.gz
 ziptool.1.gz
share/man/man3/
 ZIP_SOURCE_GET_ARGS.3.gz
 libzip.3.gz
 zip_add.3.gz
 zip_add_dir.3.gz
 zip_close.3.gz
 zip_delete.3.gz
 zip_dir_add.3.gz
 zip_discard.3.gz
 zip_error_clear.3.gz
 zip_error_code_system.3.gz
 zip_error_code_zip.3.gz
 zip_error_fini.3.gz
 zip_error_get.3.gz
 zip_error_get_sys_type.3.gz
 zip_error_init.3.gz
 zip_error_init_with_code.3.gz
 zip_error_set.3.gz
 zip_error_strerror.3.gz
 zip_error_system_type.3.gz
 zip_error_to_data.3.gz
 zip_error_to_str.3.gz
 zip_errors.3.gz
 zip_fclose.3.gz
 zip_fdopen.3.gz
 zip_file_add.3.gz
 zip_file_error_clear.3.gz
 zip_file_error_get.3.gz
 zip_file_extra_field_delete.3.gz
 zip_file_extra_field_delete_by_id.3.gz
 zip_file_extra_field_get.3.gz
 zip_file_extra_field_get_by_id.3.gz
 zip_file_extra_field_set.3.gz
 zip_file_extra_fields_count.3.gz
 zip_file_extra_fields_count_by_id.3.gz
 zip_file_get_comment.3.gz
 zip_file_get_error.3.gz
 zip_file_get_external_attributes.3.gz
 zip_file_rename.3.gz
 zip_file_replace.3.gz
 zip_file_set_comment.3.gz
 zip_file_set_encryption.3.gz
 zip_file_set_external_attributes.3.gz
 zip_file_set_mtime.3.gz
 zip_file_strerror.3.gz
 zip_fopen.3.gz
 zip_fopen_encrypted.3.gz
 zip_fopen_index.3.gz
 zip_fopen_index_encrypted.3.gz
 zip_fread.3.gz
 zip_fseek.3.gz
 zip_ftell.3.gz
 zip_get_archive_comment.3.gz
 zip_get_archive_flag.3.gz
 zip_get_error.3.gz
 zip_get_file_comment.3.gz
 zip_get_name.3.gz
 zip_get_num_entries.3.gz
 zip_get_num_files.3.gz
 zip_libzip_version.3.gz
 zip_name_locate.3.gz
 zip_open.3.gz
 zip_open_from_source.3.gz
 zip_register_progress_callback.3.gz
 zip_register_progress_callback_with_state.3.gz
 zip_rename.3.gz
 zip_replace.3.gz
 zip_set_archive_comment.3.gz
 zip_set_archive_flag.3.gz
 zip_set_default_password.3.gz
 zip_set_file_comment.3.gz
 zip_set_file_compression.3.gz
 zip_source.3.gz
 zip_source_begin_write.3.gz
 zip_source_begin_write_cloning.3.gz
 zip_source_buffer.3.gz
 zip_source_buffer_create.3.gz
 zip_source_buffer_fragment.3.gz
 zip_source_buffer_fragment_create.3.gz
 zip_source_close.3.gz
 zip_source_commit_write.3.gz
 zip_source_error.3.gz
 zip_source_file.3.gz
 zip_source_file_create.3.gz
 zip_source_filep.3.gz
 zip_source_filep_create.3.gz
 zip_source_free.3.gz
 zip_source_function.3.gz
 zip_source_function_create.3.gz
 zip_source_is_deleted.3.gz
 zip_source_keep.3.gz
 zip_source_make_command_bitmap.3.gz
 zip_source_open.3.gz
 zip_source_read.3.gz
 zip_source_rollback_write.3.gz
 zip_source_seek.3.gz
 zip_source_seek_compute_offset.3.gz
 zip_source_seek_write.3.gz
 zip_source_stat.3.gz
 zip_source_tell.3.gz
 zip_source_tell_write.3.gz
 zip_source_win32a.3.gz
 zip_source_win32a_create.3.gz
 zip_source_win32handle.3.gz
 zip_source_win32handle_create.3.gz
 zip_source_win32w.3.gz
 zip_source_win32w_create.3.gz
 zip_source_write.3.gz
 zip_source_zip.3.gz
 zip_stat.3.gz
 zip_stat_index.3.gz
 zip_stat_init.3.gz
 zip_strerror.3.gz
 zip_unchange.3.gz
 zip_unchange_all.3.gz
 zip_unchange_archive.3.gz


[FILE:1112:patches/patch-lib_zip__crypto__openssl.c]
--- lib/zip_crypto_openssl.c.orig	2018-03-11 17:00:53 UTC
+++ lib/zip_crypto_openssl.c
@@ -75,7 +75,7 @@ _zip_crypto_hmac_new(const zip_uint8_t *
         return NULL;
     }
 
-#if OPENSSL_VERSION_NUMBER < 0x1010000fL
+#if OPENSSL_VERSION_NUMBER < 0x1010000fL || defined(LIBRESSL_VERSION_NUMBER)
     if ((hmac  = (_zip_crypto_hmac_t *)malloc(sizeof(*hmac))) == NULL) {
         zip_error_set(error, ZIP_ER_MEMORY, 0);
         return NULL;
@@ -91,7 +91,7 @@ _zip_crypto_hmac_new(const zip_uint8_t *
 
     if (HMAC_Init_ex(hmac, secret, (int)secret_length, EVP_sha1(), NULL) != 1) {
         zip_error_set(error, ZIP_ER_INTERNAL, 0);
-#if OPENSSL_VERSION_NUMBER < 0x1010000fL
+#if OPENSSL_VERSION_NUMBER < 0x1010000fL || defined(LIBRESSL_VERSION_NUMBER)
         free(hmac);
 #else
         HMAC_CTX_free(hmac);
@@ -110,7 +110,7 @@ _zip_crypto_hmac_free(_zip_crypto_hmac_t
         return;
     }
 
-#if OPENSSL_VERSION_NUMBER < 0x1010000fL
+#if OPENSSL_VERSION_NUMBER < 0x1010000fL || defined(LIBRESSL_VERSION_NUMBER)
     HMAC_CTX_cleanup(hmac);
     _zip_crypto_clear(hmac, sizeof(*hmac));
     free(hmac);

