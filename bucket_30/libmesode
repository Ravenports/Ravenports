# Buildsheet autogenerated by ravenadm tool -- Do not edit.

NAMEBASE=		libmesode
VERSION=		0.10.1
KEYWORDS=		net net_im
VARIANTS=		standard
SDESC[standard]=	Lightweight XMPP library
HOMEPAGE=		https://github.com/boothj5/libmesode
CONTACT=		Leonid_Bobrov[goleo@disroot.org]

DOWNLOAD_GROUPS=	main
SITES[main]=		GITHUB/boothj5:libmesode:0.10.1
DISTFILE[1]=		generated:main
DF_INDEX=		1
SPKGS[standard]=	single

OPTIONS_AVAILABLE=	none
OPTIONS_STANDARD=	none

USES=			autoreconf libtool pkgconfig ssl expat

LICENSE=		MIT:single GPLv3+:single
LICENSE_TERMS=		single:{{WRKSRC}}/LICENSE.txt
LICENSE_FILE=		MIT:{{WRKSRC}}/MIT-LICENSE.txt
			GPLv3+:{{WRKSRC}}/GPL-LICENSE.txt
LICENSE_SCHEME=		dual

FPC_EQUIVALENT=		net-im/libmesode

MUST_CONFIGURE=		gnu

INSTALL_TARGET=		install-strip
SOVERSION=		0.0.0

[FILE:301:descriptions/desc.single]
libmesode is a fork of libstrophe for use in Profanity.

From http://strophe.im/libstrophe/:
libstrophe is a minimal XMPP library written in C. It has almost no
external dependencies, only an XML parsing library (expat or libxml
are both supported). It is designed for both POSIX and Windows
systems.


[FILE:110:distinfo]
c9dd90648e73d92b90f2b0ae41a75d8f469b116d3e6aa297c14cd57be937d99e       150629 boothj5-libmesode-0.10.1.tar.gz


[FILE:130:manifests/plist.single]
include/mesode.h
lib/
 libmesode.a
 libmesode.so
 libmesode.so.%%SOMAJOR%%
 libmesode.so.%%SOVERSION%%
lib/pkgconfig/libmesode.pc


[FILE:1675:patches/patch-src_tls_openssl.c]
diff --git src/tls_openssl.c src/tls_openssl.c
index 83e52f9..20badd7 100644
--- src/tls_openssl.c.orig	2020-09-29 15:25:04 UTC
+++ src/tls_openssl.c
@@ -64,7 +64,7 @@ static void _tls_dump_cert_info(tls_t *t
 
 void tls_initialize(void)
 {
-#if OPENSSL_VERSION_NUMBER < 0x10100000L
+#if OPENSSL_VERSION_NUMBER < 0x10100000L || defined(LIBRESSL_VERSION_NUMBER)
     SSL_library_init();
     SSL_load_error_strings();
 #else
@@ -79,14 +79,14 @@ void tls_shutdown(void)
      * openssl after libstrophe finalization. Maybe better leak some fixed
      * memory rather than cause random crashes of the main program.
      */
-#if OPENSSL_VERSION_NUMBER < 0x10100000L
+#if OPENSSL_VERSION_NUMBER < 0x10100000L || defined(LIBRESSL_VERSION_NUMBER)
     ERR_free_strings();
     EVP_cleanup();
     CRYPTO_cleanup_all_ex_data();
-#if OPENSSL_VERSION_NUMBER >= 0x10002000L
+#if OPENSSL_VERSION_NUMBER >= 0x10002000L && !defined(LIBRESSL_VERSION_NUMBER)
     SSL_COMP_free_compression_methods();
 #endif
-#if OPENSSL_VERSION_NUMBER < 0x10000000L
+#if OPENSSL_VERSION_NUMBER < 0x10000000L || defined(LIBRESSL_VERSION_NUMBER)
     ERR_remove_state(0);
 #else
     ERR_remove_thread_state(NULL);
@@ -376,7 +376,7 @@ tls_t *tls_new(xmpp_conn_t *conn)
         /* Trust server's certificate when user sets the flag explicitly. */
         mode = conn->tls_trust ? SSL_VERIFY_NONE : SSL_VERIFY_PEER;
         SSL_set_verify(tls->ssl, mode, 0);
-#if OPENSSL_VERSION_NUMBER >= 0x10002000L
+#if OPENSSL_VERSION_NUMBER >= 0x10002000L || !defined(LIBRESSL_VERSION_NUMBER)
         /* Hostname verification is supported in OpenSSL 1.0.2 and newer. */
         param = SSL_get0_param(tls->ssl);
 

