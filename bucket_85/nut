# Buildsheet autogenerated by ravenadm tool -- Do not edit.

NAMEBASE=		nut
VERSION=		2.8.4
KEYWORDS=		sysutils
VARIANTS=		std
SDESC[std]=		Network UPS Tools
HOMEPAGE=		https://networkupstools.org/
CONTACT=		nobody

DOWNLOAD_GROUPS=	main
SITES[main]=		http://www.networkupstools.org/source/2.8/
DISTFILE[1]=		nut-2.8.4.tar.gz:main
DF_INDEX=		1
SPKGS[std]=		set
			primary
			dev
			man
			docs
			examples

OPTIONS_AVAILABLE=	none
OPTIONS_STANDARD=	none

BUILD_DEPENDS=		libltdl:dev:std
			libGD:dev:std
			net-snmp:dev:std
			neon:dev:std
			freeipmi:dev:std
BUILDRUN_DEPENDS=	libltdl:primary:std
			libGD:primary:std
			net-snmp:primary:std
			neon:primary:std
			freeipmi:primary:std

USERS=			nut
GROUPS=			nut
USERGROUP_SPKG=		primary

USES=			autoreconf:build gmake libtool pkgconfig
			python:build ssl mbsdfix

FPC_EQUIVALENT=		sysutils/nut

MUST_CONFIGURE=		gnu
CONFIGURE_ARGS=		--sysconfdir={{PREFIX}}/etc/nut
			--datadir={{PREFIX}}/etc/nut
			--with-devd-dir={{PREFIX}}/etc/devd
			--with-drvpath={{PREFIX}}/libexec/nut
			--localstatedir=/var/db/nut
			--with-statepath=/var/db/nut
			--with-altpidpath=/var/db/nut
			--with-pidpath=/var/db/nut
			--with-pkgconfig-dir={{PREFIX}}/lib/pkgconfig
			--with-user=nut
			--with-group=nut
			--with-python={{PYTHON_CMD}}
			--without-python2
			--with-python3={{PYTHON_CMD}}
			--without-nut_monitor
			--without-powerman
			--without-modbus
			--without-avahi
			--with-ltdl
			--with-nut-scanner
			--with-doc=man=auto
			--with-cgi
			--with-cgipath={{PREFIX}}/www/cgi-bin/nut
			--with-htmlpath={{PREFIX}}/www/nut
			--with-gd-libs=-lgd
			--with-serial
			--with-usb=auto
			--with-snmp
			--with-neon
			--with-openssl
			--with-freeipmi
			--with-dev
			--disable-rpath

INSTALL_REQ_TOOLCHAIN=	yes
SOVERSION=		4.0.0
PLIST_SUB=		NUT_USER=nut
			NUT_GROUP=nut
			STATEDIR=/var/db/nut
			CGIDIR=www/cgi-bin/nut
			WWWDIR=www/nut
			UPS_SOVERSION=7.0.0
			UPS_SOMAJOR=7
			NUT_SOVERSION=2.0.2
			NUT_SOMAJOR=2
			STUB_SOVERSION=1.0.1
			STUB_SOMAJOR=1
RC_SUBR=		nut:primary
			nut_upsmon:primary
			nut_upslog:primary
SUB_LIST=		STATEDIR=/var/db/nut
			NUT_USER=nut
			NUT_GROUP=nut

pre-install:
	${MKDIR} ${STAGEDIR}${PREFIX}/libexec/nut
	${REINPLACE_CMD} -e 's/device-name\*/cdev/g' \
		${WRKSRC}/scripts/devd/nut-usb.conf

post-install:
	${MKDIR} ${STAGEDIR}/var/db/nut
	${MKDIR} ${STAGEDIR}${PREFIX}/etc/syslog.d
	${MKDIR} ${STAGEDIR}${PREFIX}/etc/bash_completion.d/
	${MKDIR} ${STAGEDIR}${STD_DOCDIR}/cables
	${MKDIR} ${STAGEDIR}/var/log/nut
	${MKDIR} ${STAGEDIR}${STD_EXAMPLESDIR}
	${RMDIR} ${STAGEDIR}${STD_DOCDIR}/html-man
	${INSTALL_DATA} ${WRKSRC}/scripts/misc/nut.bash_completion \
		${STAGEDIR}${PREFIX}/etc/bash_completion.d/
	${INSTALL_DATA} ${WRKSRC}/docs/cables/*.txt ${STAGEDIR}${STD_DOCDIR}/cables
	${INSTALL_DATA} ${WRKSRC}/docs/*.txt ${STAGEDIR}${STD_DOCDIR}
	${INSTALL_DATA} ${WRKSRC}/docs/FAQ.txt ${STAGEDIR}${STD_DOCDIR}
.for file in AUTHORS COPYING ChangeLog INSTALL MAINTAINERS NEWS README
	${INSTALL_DATA} ${WRKSRC}/${file} ${STAGEDIR}${STD_DOCDIR}
.endfor
	${INSTALL_DATA} ${FILESDIR}/nut.syslog \
		${STAGEDIR}${STD_EXAMPLESDIR}/syslog.sample
	${INSTALL_DATA} ${FILESDIR}/nut.newsyslog \
		${STAGEDIR}${STD_EXAMPLESDIR}/newsyslog.sample
	${INSTALL_DATA} ${FILESDIR}/nut_upslog.sample \
		${STAGEDIR}${STD_EXAMPLESDIR}/nut_upslog.sample

pre-configure:
	${FIND} ${WRKSRC} -type f | \
		${XARGS} ${REINPLACE_CMD} -i'' -e 's|/usr/bin/env python|${PYTHON_CMD}|'
	${FIND} ${WRKSRC} -type f | \
		${XARGS} ${REINPLACE_CMD} -i'' -e 's|/usr/local/ups|${PREFIX}|'

[FILE:457:descriptions/desc.primary]
The primary goal of the Network UPS Tools (NUT) project is to provide
support for Power Devices, such as Uninterruptible Power Supplies, Power
Distribution Units, Automatic Transfer Switches, Power Supply Units and
Solar Controllers. NUT provides a common protocol and set of tools to
monitor and manage such devices, and to consistently name equivalent
features and data points, across a vast range of vendor-specific protocols
and connection media types.


[FILE:95:distinfo]
0130ba82ea79f04ba4f34c5249a85943977efd984ed7df6aec1a518d5a3594f8      6522704 nut-2.8.4.tar.gz


[FILE:1854:manifests/plist.primary]
@sample etc/nut/hosts.conf.sample
@sample etc/nut/nut.conf.sample
@sample etc/nut/ups.conf.sample
@sample etc/nut/upsd.conf.sample
@sample etc/nut/upsd.users.sample
@sample etc/nut/upsmon.conf.sample
@sample etc/nut/upssched.conf.sample
@sample etc/nut/upsset.conf.sample
@sample etc/nut/upsstats-single.html.sample
@sample etc/nut/upsstats.html.sample
%%CGIDIR%%/
 upsimage.cgi
 upsset.cgi
 upsstats.cgi
%%PYTHON_SITELIBDIR%%/
 PyNUT.py
 test_nutclient.py
%%WWWDIR%%/
 bottom.html
 header.html
 index.html
 nut-banner.png
bin/
 nut-scanner
 nutconf
 upsc
 upscmd
 upslog
 upsrw
 upssched-cmd
etc/bash_completion.d/nut.bash_completion
etc/devd/nut-usb.conf
etc/nut/
 cmdvartab
 driver.list
lib/
 libnutclient.so.%%NUT_SOMAJOR%%
 libnutclient.so.%%NUT_SOVERSION%%
 libnutclientstub.so.%%STUB_SOMAJOR%%
 libnutclientstub.so.%%STUB_SOVERSION%%
 libnutscan.so.%%SOMAJOR%%
 libnutscan.so.%%SOVERSION%%
 libupsclient.so.%%UPS_SOMAJOR%%
 libupsclient.so.%%UPS_SOVERSION%%
libexec/sockdebug
libexec/nut/
 al175
 apcsmart
 apcsmart-old
 apcupsd-ups
 bcmxcp
 bcmxcp_usb
 belkin
 belkinunv
 bestfcom
 bestfortress
 bestuferrups
 bestups
 bicker_ser
 blazer_ser
 blazer_usb
 clone
 clone-outlet
 dummy-ups
 etapro
 everups
 failover
 gamatronic
 genericups
 isbmex
 ivtscd
 liebert
 liebert-esp2
 liebert-gxe
 masterguard
 metasys
 mge-shut
 mge-utalk
 microdowell
 microsol-apc
 netxml-ups
 nut-ipmipsu
 nutdrv_atcl_usb
 nutdrv_hashx
 nutdrv_qx
 nutdrv_siemens-sitop
 oneac
 optiups
 powercom
 powerpanel
 powervar_cx_ser
 powervar_cx_usb
 rhino
 richcomm_usb
 riello_ser
 riello_usb
 safenet
 skel
 sms_ser
 snmp-ups
 solis
 tripplite
 tripplite_usb
 tripplitesu
 upscode2
 usbhid-ups
 ve-direct
 victronups
sbin/
 upsd
 upsdrvctl
 upsmon
 upssched
@dir etc/syslog.d
@dir(%%NUT_USER%%,%%NUT_GROUP%%,) /var/log/nut
@dir(%%NUT_USER%%,%%NUT_GROUP%%,750) %%STATEDIR%%


[FILE:368:manifests/plist.dev]
include/
 nut-scan.h
 nutclient.h
 nutclientmem.h
 nutscan-device.h
 nutscan-init.h
 nutscan-ip.h
 nutscan-serial.h
 parseconf.h
 upsclient.h
lib/
 libnutclient.a
 libnutclient.so
 libnutclientstub.a
 libnutclientstub.so
 libnutscan.a
 libnutscan.so
 libupsclient.a
 libupsclient.so
lib/pkgconfig/
 libnutclient.pc
 libnutclientstub.pc
 libnutscan.pc
 libupsclient.pc


[FILE:3555:manifests/plist.man]
share/man/man3/
 libnutclient.3
 libnutclient_commands.3
 libnutclient_devices.3
 libnutclient_general.3
 libnutclient_misc.3
 libnutclient_tcp.3
 libnutclient_variables.3
 nutclient_authenticate.3
 nutclient_destroy.3
 nutclient_device_forced_shutdown.3
 nutclient_device_login.3
 nutclient_device_master.3
 nutclient_execute_device_command.3
 nutclient_get_device_command_description.3
 nutclient_get_device_commands.3
 nutclient_get_device_description.3
 nutclient_get_device_num_logins.3
 nutclient_get_device_rw_variables.3
 nutclient_get_device_variable_description.3
 nutclient_get_device_variable_values.3
 nutclient_get_device_variables.3
 nutclient_get_devices.3
 nutclient_has_device.3
 nutclient_has_device_command.3
 nutclient_has_device_variable.3
 nutclient_logout.3
 nutclient_set_device_variable_value.3
 nutclient_set_device_variable_values.3
 nutclient_tcp_create_client.3
 nutclient_tcp_disconnect.3
 nutclient_tcp_get_timeout.3
 nutclient_tcp_is_connected.3
 nutclient_tcp_reconnect.3
 nutclient_tcp_set_timeout.3
 nutscan.3
 nutscan_add_commented_option_to_device.3
 nutscan_add_device_to_device.3
 nutscan_add_ip_range.3
 nutscan_add_option_to_device.3
 nutscan_cidr_to_ip.3
 nutscan_display_parsable.3
 nutscan_display_sanity_check.3
 nutscan_display_sanity_check_serial.3
 nutscan_display_ups_conf.3
 nutscan_display_ups_conf_with_sanity_check.3
 nutscan_free_device.3
 nutscan_free_ip_ranges.3
 nutscan_get_serial_ports_list.3
 nutscan_init.3
 nutscan_init_ip_ranges.3
 nutscan_ip_ranges_iter_inc.3
 nutscan_ip_ranges_iter_init.3
 nutscan_new_device.3
 nutscan_scan_avahi.3
 nutscan_scan_eaton_serial.3
 nutscan_scan_ipmi.3
 nutscan_scan_nut.3
 nutscan_scan_nut_simulation.3
 nutscan_scan_snmp.3
 nutscan_scan_usb.3
 nutscan_scan_xml_http_range.3
 nutscan_stringify_ip_ranges.3
 upscli_add_host_cert.3
 upscli_cleanup.3
 upscli_connect.3
 upscli_disconnect.3
 upscli_fd.3
 upscli_get.3
 upscli_get_default_connect_timeout.3
 upscli_init.3
 upscli_init_default_connect_timeout.3
 upscli_list_next.3
 upscli_list_start.3
 upscli_readline.3
 upscli_readline_timeout.3
 upscli_sendline.3
 upscli_sendline_timeout.3
 upscli_set_default_connect_timeout.3
 upscli_splitaddr.3
 upscli_splitname.3
 upscli_ssl.3
 upscli_str_add_unique_token.3
 upscli_str_contains_token.3
 upscli_strerror.3
 upscli_tryconnect.3
 upscli_upserror.3
 upsclient.3
share/man/man5/
 hosts.conf.5
 nut.conf.5
 ups.conf.5
 upsd.conf.5
 upsd.users.5
 upsmon.conf.5
 upssched.conf.5
 upsset.conf.5
 upsstats.html.5
share/man/man7/nut.7
share/man/man8/
 al175.8
 apcsmart-old.8
 apcsmart.8
 apcupsd-ups.8
 bcmxcp.8
 bcmxcp_usb.8
 belkin.8
 belkinunv.8
 bestfcom.8
 bestfortress.8
 bestuferrups.8
 bestups.8
 bicker_ser.8
 blazer_ser.8
 blazer_usb.8
 clone-outlet.8
 clone.8
 dummy-ups.8
 etapro.8
 everups.8
 failover.8
 gamatronic.8
 genericups.8
 isbmex.8
 ivtscd.8
 liebert-esp2.8
 liebert-gxe.8
 liebert.8
 masterguard.8
 metasys.8
 mge-shut.8
 mge-utalk.8
 microdowell.8
 microsol-apc.8
 netxml-ups.8
 nut-ipmipsu.8
 nut-recorder.8
 nut-scanner.8
 nutconf.8
 nutdrv_atcl_usb.8
 nutdrv_hashx.8
 nutdrv_qx.8
 nutdrv_siemens_sitop.8
 nutupsdrv.8
 oneac.8
 optiups.8
 powercom.8
 powerpanel.8
 powervar_cx_ser.8
 powervar_cx_usb.8
 rhino.8
 richcomm_usb.8
 riello_ser.8
 riello_usb.8
 safenet.8
 sms_ser.8
 snmp-ups.8
 sockdebug.8
 solis.8
 tripplite.8
 tripplite_usb.8
 tripplitesu.8
 upsc.8
 upscmd.8
 upscode2.8
 upsd.8
 upsdrvctl.8
 upsimage.cgi.8
 upslog.8
 upsmon.8
 upsrw.8
 upssched.8
 upsset.cgi.8
 upsstats.cgi.8
 usbhid-ups.8
 ve-direct.8
 victronups.8


[FILE:846:manifests/plist.docs]
share/doc/nut/
 AUTHORS
 COPYING
 ChangeLog
 ChangeLog.txt
 FAQ.txt
 INSTALL
 MAINTAINERS
 NEWS
 README
 acknowledgements.txt
 asciidoc.txt
 cables.txt
 ci-farm-lxc-setup.txt
 config-notes.txt
 config-prereqs.txt
 configure.txt
 contact-closure.txt
 daisychain.txt
 design.txt
 developer-guide.txt
 developers.txt
 documentation.txt
 download.txt
 features.txt
 hid-subdrivers.txt
 history.txt
 macros.txt
 net-protocol.txt
 new-clients.txt
 new-drivers.txt
 nut-names.txt
 nut-qa.txt
 nutdrv_qx-subdrivers.txt
 outlets.txt
 packager-guide.txt
 release-notes.txt
 scheduling.txt
 security.txt
 sms-brazil-protocol.txt
 snmp-subdrivers.txt
 snmp.txt
 sock-protocol.txt
 solaris-usb.txt
 support.txt
 user-manual.txt
share/doc/nut/cables/
 apc-rs500-serial.txt
 apc.txt
 ge-imv-victron.txt
 imv.txt
 mgeups.txt
 powerware.txt
 repotec.txt
 sms.txt


[FILE:72:manifests/plist.examples]
share/examples/nut/
 newsyslog.sample
 nut_upslog.sample
 syslog.sample


[FILE:418:patches/patch-conf_upsmon.conf.sample.in]
--- conf/upsmon.conf.sample.in.orig	2025-08-06 13:50:58 UTC
+++ conf/upsmon.conf.sample.in
@@ -170,7 +170,7 @@ MINSUPPLIES 1
 # Or use the old DOS 8.3 file name, like this:
 # SHUTDOWNCMD "C:\\PROGRA~1\\SOMECO~1.bat -first_arg -second_arg"
 
-SHUTDOWNCMD "/sbin/shutdown -h +0"
+SHUTDOWNCMD "/sbin/poweroff"
 
 # --------------------------------------------------------------------------
 # SHUTDOWNEXIT <boolean|num>


[FILE:639:patches/patch-drivers_libusb1.c]
--- drivers/libusb1.c.orig	2025-08-06 15:00:53 UTC
+++ drivers/libusb1.c
@@ -53,7 +53,19 @@ static void nut_libusb_close(libusb_devi
  */
 void nut_usb_addvars(void)
 {
+#if defined(__DragonFly__) && __DragonFly_version < 600514
+	const struct libusb_version {
+		const uint16_t major;
+		const uint16_t minor;
+		const uint16_t micro;
+	} _v = {
+		.major = 1,
+		.minor = 0,
+		.micro = 0,
+	}, *v = &_v;
+#else
 	const struct libusb_version	*v = libusb_get_version();
+#endif
 
 	/* allow -x vendor=X, vendorid=X, product=X, productid=X, serial=X */
 	addvar(VAR_VALUE, "vendor", "Regular expression to match UPS Manufacturer string");


[FILE:229:patches/patch-drivers_main.h]
--- drivers/main.h.orig	2025-04-19 15:08:33 UTC
+++ drivers/main.h
@@ -1,6 +1,7 @@
 #ifndef NUT_MAIN_H_SEEN
 #define NUT_MAIN_H_SEEN 1
 
+#include <sys/param.h>
 #include "common.h"
 #include "upsconf.h"
 #include "upshandler.h"


[FILE:541:patches/patch-m4_nut__check__libltdl.m4]
--- m4/nut_check_libltdl.m4.orig	2025-04-19 15:08:33 UTC
+++ m4/nut_check_libltdl.m4
@@ -10,10 +10,7 @@ if test -z "${nut_have_libltdl_seen}"; t
 	dnl No NUT_CHECK_PKGCONFIG here: (lib)ltdl.pc was not seen on any OS
 
 	dnl save CFLAGS and LIBS
-	CFLAGS_ORIG="${CFLAGS}"
-	LIBS_ORIG="${LIBS}"
 	LIBS=""
-	CFLAGS=""
 	depLIBS=""
 	depCFLAGS=""
 	dnl For fallback below:
@@ -94,7 +91,5 @@ if test -z "${nut_have_libltdl_seen}"; t
 	unset depLIBS
 
 	dnl restore original CFLAGS and LIBS
-	CFLAGS="${CFLAGS_ORIG}"
-	LIBS="${LIBS_ORIG}"
 fi
 ])


[FILE:419:patches/patch-scripts_Makefile]
--- scripts/Makefile.am.orig	2025-08-06 13:50:58 UTC
+++ scripts/Makefile.am
@@ -31,7 +31,7 @@ EXTRA_DIST = \
     Windows/halt.c \
     Windows/Makefile
 
-SUBDIRS = augeas devd hotplug installer python systemd udev ufw Solaris Windows upsdrvsvcctl external_apis
+SUBDIRS = augeas devd hotplug python udev upsdrvsvcctl
 
 SPELLCHECK_SRC = README.adoc RedHat/README.adoc usb_resetter/README.adoc valgrind/README.adoc
 


[FILE:1575:files/nut.in]
#!/bin/sh

# PROVIDE: nut
# REQUIRE: NETWORKING devfs devd syslogd
# BEFORE: LOGIN
# KEYWORD: shutdown

# Define these nut_* variables in one of these files:
#       /etc/rc.conf
#       /etc/rc.conf.local
#       /etc/rc.conf.d/nut
#
# DO NOT CHANGE THESE DEFAULT VALUES HERE
#
nut_enable=${nut_enable:-"NO"}
nut_prefix=${nut_prefix:-"%%PREFIX%%"}
nut_upsshut=${nut_upsshut:-"NO"}

. /etc/rc.subr

name="nut"
rcvar=nut_enable

load_rc_config $name

required_dirs="%%STATEDIR%%"
required_files="${nut_prefix}/etc/nut/ups.conf ${nut_prefix}/etc/nut/upsd.conf ${nut_prefix}/etc/nut/upsd.users"
command="${nut_prefix}/sbin/upsd"
pidfile="%%STATEDIR%%/upsd.pid"

start_precmd="nut_prestart"
stop_postcmd="nut_poststop"

nut_file_fixup=${nut_file_fixup:-"YES"}

nut_prestart() {
	#
	# As of PR/268960 UID/GID uucp is no longer used by nut.
	# Instead UID/GID nut is used. Make sure preexisting nut files
	# and directories are owned by nut instead of uucp.
	#
	if [ "${nut_file_fixup}" == "YES" ]; then
		find ${nut_prefix}/etc/nut -user uucp -exec chown %%NUT_USER%% {} \;
		find ${nut_prefix}/etc/nut -group uucp -exec chgrp %%NUT_GROUP%% {} \;
		find %%STATEDIR%% -user uucp -exec chown %%NUT_USER%% {} \;
		find %%STATEDIR%% -group uucp -exec chgrp %%NUT_GROUP%% {} \;
	fi

	${nut_prefix}/sbin/upsdrvctl start
}

nut_poststop() {
	if ${nut_prefix}/sbin/upsdrvctl stop && checkyesno nut_upsshut; then
		if ${nut_prefix}/sbin/upsmon -K; then
			${nut_prefix}/sbin/upsdrvctl shutdown
		fi
	fi

}

extra_commands=reload
reload()
{
 kill -HUP `cat $pidfile`
}

run_rc_command "$1"


[FILE:292:files/nut.newsyslog]
# configuration file for newsyslog for nut
#
# see newsyslog.conf(5) for details
#
# logfilename          [owner:group]    mode    count   size    when    flags   [/pid_file]     	[sig_num]
/var/log/nut/upsd.log   nut:nut       644     7       100     *       J       /var/db/nut/upslog.pid



[FILE:38:files/nut.syslog]
!upsmon
*.*					/var/log/nut/upsd.log


[FILE:947:files/nut_upslog.in]
#!/bin/sh

# PROVIDE: nut_upslog
# REQUIRE: NETWORKING nut syslogd
# BEFORE: LOGIN
# KEYWORD: shutdown

# Define these nut_upslog* variables in one of these files:
#       /etc/rc.conf
#       /etc/rc.conf.local
#       /etc/rc.conf.d/nut_upslog
#
# DO NOT CHANGE THESE DEFAULT VALUES HERE
#
nut_upslog_enable=${nut_upslog_enable:-"NO"}
nut_upslog_prefix=${nut_upslog_prefix:-"%%PREFIX%%"}
nut_upslog_logfile=${nut_upslog_logfile:-"/var/log/nut/ups.log"}
nut_upslog_interval=${nut_upslog_interval:-"300"}
nut_upslog_ups=${nut_upslog_ups:-"myups@localhost"}
# nut_upslog_format

. /etc/rc.subr

name="nut_upslog"
rcvar=nut_upslog_enable

load_rc_config $name

required_dirs="%%STATEDIR%%"
command="${nut_upslog_prefix}/bin/upslog"
pidfile="%%STATEDIR%%/upslog.pid"
nut_upslog_flags=${nut_upslog_flags:-"-s ${nut_upslog_ups} -l ${nut_upslog_logfile} -i ${nut_upslog_interval} ${nut_upslog_format:+-f \"${nut_upslog_format}\"}"}

run_rc_command "$1"


[FILE:1305:files/nut_upslog.sample]
#!/bin/sh

# Authored by vvd@unislabs.com.

# PROVIDE: nut_upslog
# REQUIRE: NETWORKING nut
# BEFORE: LOGIN
# KEYWORD: shutdown

. /etc/rc.subr

case $0 in
/etc/rc*)
	# during boot (shutdown) $0 is /etc/rc (/etc/rc.shutdown),
	# so get the name of the script from $_file
	name=$_file
	;;
*)
	name=$0
	;;
esac

name=${name##*/}
rcvar=${name}_enable

load_rc_config "${name}"

# Define these nut_upslog* variables in one of these files:
#       /etc/rc.conf
#       /etc/rc.conf.local
#       /etc/rc.conf.d/nut_upslog
#
# If you want to log several different UPSes:
# ln -s nut_upslog /usr/local/etc/rc.d/NAME
# then set variables NAME_enable, NAME_ups, NAME_pidbase, NAME_logfile and etc.
#
# DO NOT CHANGE THESE DEFAULT VALUES HERE
#
eval "${rcvar}=\${${rcvar}:-'NO'}"
eval "_prefix=\${${name}_prefix:-'/usr/local'}"
eval "_logfile=\${${name}_logfile:-'/var/log/nut/ups.log'}"
eval "_interval=\${${name}_interval:-'300'}"
eval "_ups=\${${name}_ups:-'myups@localhost'}"
eval "_pidbase=\${${name}_pidbase:-'upslog'}"
eval "_format=\${${name}_format:+-f \${${name}_format}}"
eval "${name}_flags=\${${name}_flags:-'-s ${_ups} -l ${_logfile} -i ${_interval} -p ${_pidbase} ${_format}'}"

required_dirs="%%STATEDIR%%"
pidfile="%%STATEDIR%%/${_pidbase}.pid"
command="${_prefix}/bin/upslog"

run_rc_command "$1"


[FILE:828:files/nut_upsmon.in]
#!/bin/sh

# PROVIDE: nut_upsmon
# REQUIRE: NETWORKING nut syslogd
# BEFORE: LOGIN
# KEYWORD: shutdown

# Define these nut_upsmon* variables in one of these files:
#       /etc/rc.conf
#       /etc/rc.conf.local
#       /etc/rc.conf.d/nut_upsmon
#
# DO NOT CHANGE THESE DEFAULT VALUES HERE
#
nut_upsmon_enable=${nut_upsmon_enable:-"NO"}
nut_upsmon_prefix=${nut_upsmon_prefix:-"%%PREFIX%%"}

. /etc/rc.subr

name="nut_upsmon"
rcvar=nut_upsmon_enable

load_rc_config $name

required_dirs="%%STATEDIR%%"
required_files="${nut_upsmon_prefix}/etc/nut/upsmon.conf"
command="${nut_upsmon_prefix}/sbin/upsmon"
pidfile="%%STATEDIR%%/upsmon.pid"
nut_upsmon_flags=${nut_upsmon_flags:-"localhost"}

extra_commands=reload
stop_cmd="upsmon_stop"

reload()
{
	${command} -c reload
}

upsmon_stop()
{
	${command} -c stop
}

run_rc_command "$1"

