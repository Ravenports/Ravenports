# Buildsheet autogenerated by ravenadm tool -- Do not edit.

NAMEBASE=		clamav
VERSION=		1.2.0
KEYWORDS=		security
VARIANTS=		standard
SDESC[standard]=	Clam Anti-Virus Scanner
HOMEPAGE=		https://www.clamav.net/
CONTACT=		nobody

DOWNLOAD_GROUPS=	main
SITES[main]=		https://www.clamav.net/downloads/production/
DISTFILE[1]=		clamav-1.2.0.tar.gz:main
DF_INDEX=		1
SPKGS[standard]=	complete
			primary
			dev
			man
			docs

OPTIONS_AVAILABLE=	none
OPTIONS_STANDARD=	none

BUILD_DEPENDS=		json-c:dev:standard
			doxygen:single:standard
			rust:single:standard
			libmspack:dev:standard
BUILDRUN_DEPENDS=	libltdl:single:standard
			libmspack:primary:standard
RUN_DEPENDS=		arc:single:standard
			arj:single:standard
			unzoo:single:standard

USERS=			clamav
GROUPS=			clamav mail
USERGROUP_SPKG=		primary

USES=			cpe cmake ncurses pkgconfig ssl iconv zlib pcre2
			curl bz2 execinfo c++:primary
GNOME_COMPONENTS=	libxml2

LICENSE=		GPLv2:primary
LICENSE_TERMS=		primary:{{WRKDIR}}/TERMS
LICENSE_FILE=		GPLv2:{{WRKSRC}}/COPYING.txt
LICENSE_AWK=		TERMS:"HAVE_CONFIG_H"
LICENSE_SOURCE=		TERMS:{{WRKSRC}}/clamscan/clamscan.c
LICENSE_SCHEME=		solo

FPC_EQUIVALENT=		security/clamav

SOVERSION=		12.0.1
PLIST_SUB=		CLAMAVGROUP=clamav
			CLAMAVUSER=clamav
			DBDIR=/var/db/clamav
			LOGDIR=/var/log/clamav
			RUNDIR=/var/run/clamav
			FRESH_SOMAJOR=3
			FRESH_SOVERSION=3.0.1
RC_SUBR=		clamav-clamd:primary
			clamav-freshclam:primary
SUB_FILES=		pkg-deinstall-primary
SUB_LIST=		CHMOD={{CHMOD}}
			CHOWN={{CHOWN}}
			CLAMAV_CLAMD_PIDFILE=/var/run/clamav/clamd.pid
			CLAMAV_CLAMD_SOCKET=/var/run/clamav/clamd.sock
			CLAMAV_MILTER_SOCKET=/var/run/clamav/clmilter.sock
			CLAMAVGROUP=clamav
			CLAMAVUSER=clamav
			DBDIR=/var/db/clamav
			LOGDIR=/var/log/clamav
			RUNDIR=/var/run/clamav

CMAKE_ARGS=		-DCLAMAV_USER:STRING="clamav"
			-DCLAMAV_GROUP:STRING="clamav"
			-DENABLE_EXTERNAL_MSPACK:BOOL=TRUE
			-DENABLE_TESTS:BOOL=FALSE
			-DENABLE_WERROR:BOOL=FALSE
			-DENABLE_ALL_THE_WARNINGS:BOOL=FALSE
			-DENABLE_DEBUG:BOOL=FALSE
			-DENABLE_EXPERIMENTAL:BOOL=FALSE
			-DENABLE_FRESHCLAM_DNS_FIX:BOOL=TRUE
			-DENABLE_FRESHCLAM_NO_CACHE:BOOL=TRUE
			-DENABLE_MILTER:BOOL=FALSE
			-DENABLE_MAN_PAGES:BOOL=TRUE
			-DENABLE_DOXYGEN:BOOL=TRUE
			-DENABLE_EXAMPLES:BOOL=TRUE
			-DENABLE_JSON_SHARED:BOOL=FALSE
			-DENABLE_UNRAR:BOOL=TRUE
			-DENABLE_SYSTEMD:BOOL=TRUE

post-patch:
	${REINPLACE_CMD} -E -e \
		's|^\#?(Example)$$|\#\1|' -e \
		's|^\#?((Update)?LogFile) .*/([a-z]+\.log)$$|\1 /var/log/clamav/\3|' \
		-e 's|^\#?(PidFile) .*/([a-z\-]+\.pid)$$|\1 /var/run/clamav/\2|' -e \
		's|^\#?(LocalSocket) .*$$|\1 ${CLAMAV_CLAMD_SOCKET}|' -e \
		's|^\#?(User) .*$$|\1 ${CLAMAVUSER}|' -e \
		's|^\#?(AllowSupplementaryGroups).*$$|\1 yes|' -e \
		's|^\#?(ScanMail).*$$|\1 yes|' -e \
		's|^\#?(DatabaseDirectory) .*$$|\1 /var/db/clamav|' -e \
		's|^\#?(DatabaseOwner) .*$$|\1 ${CLAMAVUSER}|' -e \
		's|^\#?(FixStaleSocket).*$$|\1 yes|' -e \
		's|^\#?(NotifyClamd) .*$$|\1 ${PREFIX}/etc/clamd.conf|' -e \
		's|^\#?(MilterSocket) */tmp.*$$|\1 ${CLAMAV_MILTER_SOCKET}|' -e \
		's|^\#?(ClamdSocket).*$$|\1 unix:${CLAMAV_CLAMD_SOCKET}|' \
	${WRKSRC}/etc/clamd.conf.sample \
	${WRKSRC}/etc/freshclam.conf.sample \
	${WRKSRC}/etc/clamav-milter.conf.sample

post-install:
	${INSTALL_DATA} ${BUILD_WRKSRC}/clamav-config.h ${STAGEDIR}${PREFIX}/include
	${MKDIR} ${STAGEDIR}${STD_DOCDIR}/html \
		  ${STAGEDIR}/var/db/clamav \
		  ${STAGEDIR}/var/log/clamav \
		  ${STAGEDIR}/var/run/clamav
	cd ${STAGEDIR}${PREFIX}/bin && ${STRIP_CMD} clambc clamconf clamdscan \
		clamdtop clamscan clamsubmit freshclam sigtool ex_*
	cd ${STAGEDIR}${PREFIX} && ${STRIP_CMD} sbin/clamd lib/lib*.so

[FILE:317:descriptions/desc.primary]
This the stable version of Clam Antivirus.

Clam Antivirus is command line virus scanner written entirely in C
and its database is kept up to date. It also detects polymorphic
viruses, scans compressed files and supported by AMaViS.
Optionally you can use the clamav-milter interface to connect
clamav with sendmail.


[FILE:98:distinfo]
97a192dffe141480b56cabf1063d79a9fc55cd59203241fa41bfc7a98a548020     41360851 clamav-1.2.0.tar.gz


[FILE:666:manifests/plist.primary]
@sample etc/clamd.conf.sample
@sample etc/freshclam.conf.sample
bin/
 clamav-config
 clambc
 clamconf
 clamdscan
 clamdtop
 clamscan
 clamsubmit
 ex_basic_scandesc
 ex_file_inspection_callback
 ex_prescan_callback
 freshclam
 sigtool
lib/
 libclamav.so.%%SOMAJOR%%
 libclamav.so.%%SOVERSION%%
 libclamunrar.so.%%SOMAJOR%%
 libclamunrar.so.%%SOVERSION%%
 libclamunrar_iface.so.%%SOMAJOR%%
 libclamunrar_iface.so.%%SOVERSION%%
 libfreshclam.so.%%FRESH_SOMAJOR%%
 libfreshclam.so.%%FRESH_SOVERSION%%
sbin/clamd
@dir(%%CLAMAVUSER%%,%%CLAMAVGROUP%%,0755) %%DBDIR%%
@dir(%%CLAMAVUSER%%,%%CLAMAVGROUP%%,0755) %%LOGDIR%%
@dir(%%CLAMAVUSER%%,%%CLAMAVGROUP%%,0755) %%RUNDIR%%


[FILE:189:manifests/plist.dev]
include/
 clamav-config.h
 clamav-types.h
 clamav-version.h
 clamav.h
 libfreshclam.h
lib/
 libclamav.so
 libclamunrar.so
 libclamunrar_iface.so
 libfreshclam.so
lib/pkgconfig/libclamav.pc


[FILE:264:manifests/plist.man]
share/man/man1/
 clambc.1.gz
 clamconf.1.gz
 clamdscan.1.gz
 clamdtop.1.gz
 clamscan.1.gz
 clamsubmit.1.gz
 freshclam.1.gz
 sigtool.1.gz
share/man/man5/
 clamav-milter.conf.5.gz
 clamd.conf.5.gz
 freshclam.conf.5.gz
share/man/man8/
 clamav-milter.8.gz
 clamd.8.gz


[FILE:3111:manifests/plist.docs]
share/doc/clamav/html/
 404.html
 Introduction.html
 ace.js
 ayu-highlight.css
 book.js
 clipboard.min.js
 editor.js
 elasticlunr.min.js
 favicon.png
 highlight.css
 highlight.js
 index.html
 mark.min.js
 mode-rust.js
 print.html
 searcher.js
 searchindex.js
 searchindex.json
 theme-dawn.js
 theme-tomorrow_night.js
 tomorrow-night.css
share/doc/clamav/html/FontAwesome/css/font-awesome.css
share/doc/clamav/html/FontAwesome/fonts/
 FontAwesome.ttf
 fontawesome-webfont.eot
 fontawesome-webfont.svg
 fontawesome-webfont.ttf
 fontawesome-webfont.woff
 fontawesome-webfont.woff2
share/doc/clamav/html/appendix/
 Appendix.html
 Authenticode.html
 CvdPrivateMirror.html
 FileTypes.html
 FunctionalityLevels.html
 Terminology.html
share/doc/clamav/html/community_resources/
 CommunityResources.html
 CompileClamAV_AmazonLinux2.txt
share/doc/clamav/html/css/
 chrome.css
 general.css
 print.css
 variables.css
share/doc/clamav/html/faq/
 faq-cvd.html
 faq-eol.html
 faq-freshclam.html
 faq-ignore.html
 faq-misc.html
 faq-ml.html
 faq-pua.html
 faq-rust.html
 faq-safebrowsing.html
 faq-scan-alerts.html
 faq-troubleshoot.html
 faq-uninstall.html
 faq-upgrade.html
 faq-whichversion.html
 faq-win32.html
 faq.html
share/doc/clamav/html/fonts/
 OPEN-SANS-LICENSE.txt
 SOURCE-CODE-PRO-LICENSE.txt
 fonts.css
 open-sans-v17-all-charsets-300.woff2
 open-sans-v17-all-charsets-300italic.woff2
 open-sans-v17-all-charsets-600.woff2
 open-sans-v17-all-charsets-600italic.woff2
 open-sans-v17-all-charsets-700.woff2
 open-sans-v17-all-charsets-700italic.woff2
 open-sans-v17-all-charsets-800.woff2
 open-sans-v17-all-charsets-800italic.woff2
 open-sans-v17-all-charsets-italic.woff2
 open-sans-v17-all-charsets-regular.woff2
 source-code-pro-v11-all-charsets-500.woff2
share/doc/clamav/html/images/
 change-fork-name.png
 cisco.png
 clone-your-fork.png
 create-a-fork.png
 demon.png
 flamegraph.svg
 fork-is-behind.png
 logo.png
 new-git-workflow.png
 old-git-workflow.png
share/doc/clamav/html/manual/
 Development.html
 Installing.html
 OnAccess.html
 Signatures.html
 Usage.html
share/doc/clamav/html/manual/Development/
 Contribute.html
 build-installer-packages.html
 clamav-git-work-flow.html
 code-coverage.html
 development-builds.html
 fuzzing-sanitizers.html
 github-pr-basics.html
 libclamav.html
 performance-profiling.html
 personal-forks.html
 testing-pull-requests.html
 tips-and-tricks.html
share/doc/clamav/html/manual/Installing/
 Add-clamav-user.html
 Community-projects.html
 Docker.html
 Installing-from-source-Unix-old.html
 Installing-from-source-Unix.html
 Installing-from-source-Windows.html
 Packages.html
share/doc/clamav/html/manual/Signatures/
 AllowLists.html
 AuthenticodeRules.html
 BodySignatureFormat.html
 BytecodeSignatures.html
 ContainerMetadata.html
 DatabaseInfo.html
 DynamicConfig.html
 EncryptedArchives.html
 ExtendedSignatures.html
 FileTypeMagic.html
 HashSignatures.html
 LogicalSignatures.html
 PhishSigs.html
 SignatureNames.html
 YaraRules.html
share/doc/clamav/html/manual/Usage/
 Configuration.html
 ReportABug.html
 Scanning.html
 Services.html
 SignatureManagement.html


[FILE:328:patches/patch-CMakeLists.txt]
--- CMakeLists.txt.orig	2023-08-26 22:00:24 UTC
+++ CMakeLists.txt
@@ -59,7 +59,7 @@ set(GENERATE_WARNING "WARNING: This file
 #
 if(CMAKE_SYSTEM_NAME STREQUAL "Linux")
     set(C_LINUX 1)
-elseif(APPLE OR CMAKE_SYSTEM_NAME MATCHES "BSD")
+elseif(APPLE OR CMAKE_SYSTEM_NAME MATCHES "BSD|DragonFly")
     set(C_BSD 1)
 endif()
 


[FILE:308:patches/patch-clamdtop_CMakeLists.txt]
--- clamdtop/CMakeLists.txt.orig	2023-08-26 22:00:24 UTC
+++ clamdtop/CMakeLists.txt
@@ -34,6 +34,7 @@ target_link_libraries( clamdtop
     PRIVATE
         ClamAV::libclamav
         ClamAV::common
+	tinfo
         Curses::curses )
 if(WIN32)
     install(TARGETS clamdtop DESTINATION . COMPONENT programs)


[FILE:1152:files/clamav-clamd.in]
#!/bin/sh

# PROVIDE: clamav_clamd
# REQUIRE: LOGIN
# BEFORE: mail
# KEYWORD: shutdown

#
# Add the following lines to /etc/rc.conf to enable clamd:
#
# clamav_clamd_enable="YES"
# clamav_clamd_flags="<set as needed>"
#
# See clamd(8) for flags
#

. /etc/rc.subr

name=clamav_clamd
rcvar=clamav_clamd_enable

# read settings, set default values
load_rc_config "$name"

: ${clamav_clamd_enable:=NO}
: ${clamav_clamd_socket="%%CLAMAV_CLAMD_SOCKET%%"}
: ${clamav_clamd_pidfile="%%CLAMAV_CLAMD_PIDFILE%%"}
: ${clamav_clamd_user="%%CLAMAVUSER%%"}

command=%%PREFIX%%/sbin/clamd
required_dirs=%%DBDIR%%
required_files=%%PREFIX%%/etc/clamd.conf

start_precmd=clamav_clamd_precmd
extra_commands=reload
reload_cmd="%%PREFIX%%/bin/clamdscan --reload"

#clamav .93 won't start without a valid main.c[vl]d file
clamav_clamd_precmd()
{
	local rundir=${clamav_clamd_pidfile%/*}
	if [ ! -d $rundir ] ; then
		install -d -m 0755 -o ${clamav_clamd_user} -g ${clamav_clamd_user} $rundir
	fi
	if [ ! -f %%DBDIR%%/main.cvd -a ! -f %%DBDIR%%/main.cld ];then
		echo "Missing %%DBDIR%%/*.cvd or *.cld files.  You must run freshclam first"
		exit 1
	fi
}

run_rc_command "$1"


[FILE:980:files/clamav-freshclam.in]
#!/bin/sh

# PROVIDE: clamav_freshclam
# REQUIRE: LOGIN clamav_clamd
# BEFORE: mail
# KEYWORD: shutdown

#
# Add the following lines to /etc/rc.conf to enable the freshclam daemon:
#
# clamav_freshclam_enable="YES"
# clamav_freshclam_flags="<set as needed>"
#
# See freshclam(1) for flags
#

. /etc/rc.subr

name=clamav_freshclam
rcvar=clamav_freshclam_enable

# read settings, set default values
load_rc_config ${name}

: ${clamav_freshclam_enable:=NO}
: ${clamav_freshclam_pidfile=%%RUNDIR%%/freshclam.pid}
: ${clamav_freshclam_user=%%CLAMAVUSER%%}

command=%%PREFIX%%/bin/freshclam
pidfile=${clamav_freshclam_pidfile}
command_args="--daemon -p ${pidfile}"
required_dirs=%%DBDIR%%
required_files=%%PREFIX%%/etc/freshclam.conf

start_precmd=clamav_freshclam_precmd

clamav_freshclam_precmd()
{
	local rundir=${clamav_freshclam_pidfile%/*}
	if [ ! -d $rundir ] ; then
		install -d -m 0755 -o ${clamav_freshclam_user} -g ${clamav_freshclam_user} $rundir
	fi
}

run_rc_command "$1"


[FILE:513:files/pkg-deinstall-primary.in]
#!/bin/sh

if [ "$2" != "POST-DEINSTALL" ]; then
	exit 0
fi

CLAMAVUSER=%%CLAMAVUSER%%

echo
echo "===================================================="
echo
echo "If you want remove clamav permanently from you system"
echo "execute following commands:"
echo
echo " # rm -rf %%LOGDIR%%"
echo " # rm -rf %%RUNDIR%%"
echo " # rm -rf %%DBDIR%%"
if pw usershow "${CLAMAVUSER}" 2>/dev/null 1>&2; then
	echo " # pw userdel ${CLAMAVUSER}"
fi
echo
echo "===================================================="
echo

exit 0

