# Buildsheet autogenerated by ravenadm tool -- Do not edit.

NAMEBASE=		php72-wddx
VERSION=		7.2.8
KEYWORDS=		lang www php textproc
VARIANTS=		standard
SDESC[standard]=	PHP 7.2 extension: wddx web data exchange
HOMEPAGE=		http://php.net/
CONTACT=		nobody

DOWNLOAD_GROUPS=	main
SITES[main]=		PHP/distributions
DISTFILE[1]=		php-7.2.8.tar.xz:main
DF_INDEX=		1
SPKGS[standard]=	single

OPTIONS_AVAILABLE=	none
OPTIONS_STANDARD=	none

USES=			php:ext,72
GNOME_COMPONENTS=	libxml2
PHP_EXTENSIONS=		xml session

DISTNAME=		php-7.2.8/ext/{{PHP_MODNAME}}
EXTRACT_HEAD[1]=	{{TAR}} -xf
EXTRACT_TAIL[1]=	php-7.2.8/ext/{{PHP_MODNAME}}

FPC_EQUIVALENT=		textproc/php72-wddx

CONFIGURE_ARGS=		--enable-wddx
			--with-libxml-dir={{LOCALBASE}}

[FILE:54:descriptions/desc.single]
This package contains the wddx extension for PHP 7.2.


[FILE:95:distinfo]
53ba0708be8a7db44256e3ae9fcecc91b811e5b5119e6080c951ffe7910ffb0f     12153548 php-7.2.8.tar.xz


[FILE:697:patches/patch-config.m4]
--- config.m4.orig	2017-08-01 17:36:48 UTC
+++ config.m4
@@ -13,6 +13,9 @@ fi
 PHP_ARG_WITH(libexpat-dir, libexpat dir for WDDX,
 [  --with-libexpat-dir=DIR WDDX: libexpat dir for XMLRPC-EPI (deprecated)],no,no)
 
+PHP_ARG_WITH(libxml-dir, libxml2 install dir,
+[  --with-libxml-dir=<DIR>    WDDX: libxml2 install prefix], no, no)
+
 if test "$PHP_WDDX" != "no"; then
 
   dnl
@@ -57,4 +60,9 @@ if test "$PHP_WDDX" != "no"; then
   PHP_NEW_EXTENSION(wddx, wddx.c, $ext_shared)
   PHP_ADD_EXTENSION_DEP(wddx, libxml)
   PHP_SUBST(XMLRPC_SHARED_LIBADD)
+
+  PHP_SETUP_LIBXML(WDDX_SHARED_LIBADD, [
+  ], [
+    AC_MSG_ERROR([xml2-config not found. Please check your libxml2 installation.])
+  ])
 fi


[FILE:1119:patches/patch-wddx.c]
--- wddx.c.orig	2017-08-01 17:36:48 UTC
+++ wddx.c
@@ -22,6 +22,10 @@
 #include "config.h"
 #endif
 
+#ifdef HAVE_CONFIG_H
+# include "config.h"
+#endif
+
 #include "php.h"
 
 #if HAVE_WDDX
@@ -260,7 +264,7 @@ static void release_wddx_packet_rsrc(zen
 
 #include "ext/session/php_session.h"
 
-#if HAVE_PHP_SESSION && !defined(COMPILE_DL_SESSION)
+#if HAVE_PHP_SESSION
 /* {{{ PS_SERIALIZER_ENCODE_FUNC
  */
 PS_SERIALIZER_ENCODE_FUNC(wddx)
@@ -335,7 +339,7 @@ PHP_MINIT_FUNCTION(wddx)
 {
 	le_wddx = zend_register_list_destructors_ex(release_wddx_packet_rsrc, NULL, "wddx", module_number);
 
-#if HAVE_PHP_SESSION && !defined(COMPILE_DL_SESSION)
+#if HAVE_PHP_SESSION
 	php_session_register_serializer("wddx",
 									PS_SERIALIZER_ENCODE_NAME(wddx),
 									PS_SERIALIZER_DECODE_NAME(wddx));
@@ -350,7 +354,7 @@ PHP_MINIT_FUNCTION(wddx)
 PHP_MINFO_FUNCTION(wddx)
 {
 	php_info_print_table_start();
-#if HAVE_PHP_SESSION && !defined(COMPILE_DL_SESSION)
+#if HAVE_PHP_SESSION
 	php_info_print_table_header(2, "WDDX Support", "enabled" );
 	php_info_print_table_row(2, "WDDX Session Serializer", "enabled" );
 #else

