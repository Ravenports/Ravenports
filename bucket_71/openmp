# Buildsheet autogenerated by ravenadm tool -- Do not edit.

NAMEBASE=		openmp
VERSION=		8.0.0
KEYWORDS=		devel lang
VARIANTS=		standard
SDESC[standard]=	LLVM Open Multi-Processing Runtime Library
HOMEPAGE=		http://llvm.org/
CONTACT=		nobody

DOWNLOAD_GROUPS=	main
SITES[main]=		http://llvm.org/releases/8.0.0/
DISTFILE[1]=		openmp-8.0.0.src.tar.xz:main
DF_INDEX=		1
SPKGS[standard]=	single

OPTIONS_AVAILABLE=	none
OPTIONS_STANDARD=	none

USES=			cmake perl:build pkgconfig c++:single

DISTNAME=		openmp-8.0.0.src

LICENSE=		CUSTOM1:single
LICENSE_NAME=		CUSTOM1:"University of Illinois/NCSA Open Source License"
LICENSE_FILE=		CUSTOM1:{{WRKSRC}}/LICENSE.txt
LICENSE_SCHEME=		solo

CMAKE_BUILD_TYPE=	Release

CMAKE_ARGS=		-DCMAKE_INSTALL_RPATH:STRING="{{LOCALBASE}}/llvm/lib"

post-install:
	${STRIP_CMD} ${STAGEDIR}${PREFIX}/lib/libomp.${LIBEXT}
	${STRIP_CMD} ${STAGEDIR}${PREFIX}/lib/libomptarget.${LIBEXT}

[FILE:951:descriptions/desc.single]
The LLVM Project is a collection of modular and reusable compiler and
toolchain technologies. Despite its name, LLVM has little to do with
traditional virtual machines, though it does provide helpful libraries
that can be used to build them. The name "LLVM" itself is not an
acronym; it is the full name of the project.

The OpenMP subproject of LLVM contains the components required to build
an executable OpenMP program that are outside the compiler itself.

This package contains the code for the runtime library against which code
compiled by clang -fopenmp must be linked before it can run.  It also
contains the library that supports offload to target devices (in
"libomptarget").

Support for the parts of the OpenMP 4.0 (and later) language that are not
associated with the "target" constructs are contained in the "runtime"
directory. Support for offloading computation via the "target" directive
is in the separate "libomptarget" directory.


[FILE:102:distinfo]
f7b1705d2f16c4fc23d6531f67d2dd6fb78a077dd346b02fed64f4b8df65c9d5       934384 openmp-8.0.0.src.tar.xz


[FILE:95:manifests/plist.single]
include/
 omp-tools.h
 omp.h
 ompt.h
lib/
 libgomp.so
 libiomp5.so
 libomp.so
 libomptarget.so


[FILE:775:patches/patch-runtime_cmake_LibompHandleFlags.cmake]
--- runtime/cmake/LibompHandleFlags.cmake.orig	2018-12-10 13:45:00 UTC
+++ runtime/cmake/LibompHandleFlags.cmake
@@ -159,11 +159,11 @@ function(libomp_get_libflags libflags)
   if(${IA32})
     libomp_append(libflags_local -lirc_pic LIBOMP_HAVE_IRC_PIC_LIBRARY)
   endif()
-  IF(${CMAKE_SYSTEM_NAME} MATCHES "DragonFly")
+  IF(${CMAKE_SYSTEM_NAME} MATCHES "FreeBSD|DragonFly")
     libomp_append(libflags_local "-Wl,--no-as-needed" LIBOMP_HAVE_AS_NEEDED_FLAG)
     libomp_append(libflags_local "-lm")
     libomp_append(libflags_local "-Wl,--as-needed" LIBOMP_HAVE_AS_NEEDED_FLAG)
-  ENDIF(${CMAKE_SYSTEM_NAME} MATCHES "DragonFly")
+  ENDIF()
   IF(${CMAKE_SYSTEM_NAME} MATCHES "NetBSD")
     libomp_append(libflags_local -lm)
   ENDIF(${CMAKE_SYSTEM_NAME} MATCHES "NetBSD")


[FILE:615:patches/patch-runtime_cmake_LibompMicroTests.cmake]
--- runtime/cmake/LibompMicroTests.cmake.orig	2018-12-09 16:40:33 UTC
+++ runtime/cmake/LibompMicroTests.cmake
@@ -171,7 +171,7 @@ add_custom_command(
 add_custom_target(libomp-test-deps DEPENDS test-deps/.success)
 set(libomp_expected_library_deps)
 if(CMAKE_SYSTEM_NAME MATCHES "FreeBSD")
-  set(libomp_expected_library_deps libc.so.7 libthr.so.3)
+  set(libomp_expected_library_deps libc.so.7 libthr.so.3 libm.so.5)
   libomp_append(libomp_expected_library_deps libhwloc.so.5 LIBOMP_USE_HWLOC)
 elseif(CMAKE_SYSTEM_NAME MATCHES "NetBSD")
   set(libomp_expected_library_deps libc.so.12 libpthread.so.1 libm.so.0)


[FILE:369:patches/patch-runtime_src_kmp__runtime.cpp]
--- runtime/src/kmp_runtime.cpp.orig	2019-01-15 15:36:53 UTC
+++ runtime/src/kmp_runtime.cpp
@@ -8104,7 +8104,7 @@ __kmp_determine_reduction_method(
 
 #elif KMP_ARCH_X86 || KMP_ARCH_ARM || KMP_ARCH_AARCH || KMP_ARCH_MIPS
 
-#if KMP_OS_LINUX || KMP_OS_WINDOWS || KMP_OS_HURD
+#if KMP_OS_LINUX || KMP_OS_FREEBSD || KMP_OS_WINDOWS || KMP_OS_HURD
 
     // basic tuning
 

