# Buildsheet autogenerated by ravenadm tool -- Do not edit.

NAMEBASE=		xmlsec
VERSION=		1.3.2
KEYWORDS=		security
VARIANTS=		standard
SDESC[standard]=	XML Security Library
HOMEPAGE=		https://www.aleksey.com/xmlsec/
CONTACT=		nobody

DOWNLOAD_GROUPS=	main
SITES[main]=		https://www.aleksey.com/xmlsec/download/
DISTFILE[1]=		xmlsec1-1.3.2.tar.gz:main
DF_INDEX=		1
SPKGS[standard]=	complete
			primary
			tools
			dev
			man
			docs

OPTIONS_AVAILABLE=	none
OPTIONS_STANDARD=	none

BUILD_DEPENDS=		libgcrypt:dev:standard
			gnutls:dev:standard
			nss:dev:standard
BUILDRUN_DEPENDS=	libgcrypt:primary:standard
			libltdl:single:standard
			gnutls:primary:standard
			nss:primary:standard
EXRUN[tools]=		xmlsec:primary:standard

USES=			cpe gmake libtool pkgconfig ssl:openssl30
GNOME_COMPONENTS=	libxslt

DISTNAME=		xmlsec1-1.3.2

LICENSE=		MIT:primary
LICENSE_FILE=		MIT:{{WRKSRC}}/Copyright
LICENSE_SCHEME=		solo

CPE_VENDOR=		xmlsec_project
FPC_EQUIVALENT=		security/xmlsec1

MUST_CONFIGURE=		gnu
CONFIGURE_ARGS=		--with-openssl="{{OPENSSLBASE}}"
			--with-gcrypt="{{LOCALBASE}}"
			--with-gnutls="{{LOCALBASE}}"
			--with-nspr="{{LOCALBASE}}"
			--with-nss="{{LOCALBASE}}"
			--enable-soap
			--disable-docs-build
CONFIGURE_ENV=		NSS_CFLAGS="-I{{LOCALBASE}}/include/nss/nss"

MAKE_ARGS=		confexecdir="{{LOCALBASE}}/etc"
MAKE_ENV=		ABS_BUILDDIR="{{WRKSRC}}"
			TMPFOLDER="{{WRKDIR}}"

INSTALL_TARGET=		install-strip
INSTALL_REQ_TOOLCHAIN=	yes
SOVERSION=		1.3.2

LDFLAGS=		-L{{LOCALBASE}}/lib/nss
			-Wl,-rpath,{{LOCALBASE}}/lib/nss

pre-configure:
	${REINPLACE_CMD} \
		-e 's/mozilla-nss/nss/' \
		-e 's/mozilla-nspr/nspr/' \
		-e '/^GNUTLS_FOUND/s/no/yes/' \
		-e '/^GNUTLS_LIBS=/s,"","-L${LOCALBASE}/lib -lgnutls",' \
		${WRKSRC}/configure
	${REINPLACE_CMD} -e 's/(CP) -ru/(CP) -r/' -e 's/(CP) -u/(CP)/' \
		${WRKSRC}/docs/Makefile.am ${WRKSRC}/docs/Makefile.in \
		${WRKSRC}/docs/api/Makefile.am ${WRKSRC}/docs/api/Makefile.in \
		${WRKSRC}/man/Makefile.am ${WRKSRC}/man/Makefile.in
	# Making the xmlsec1 executable multi-threaded to let load -lnss when needed
	${REINPLACE_CMD} -e 's,^\(xmlsec1_LDADD = \)\\$$,\1 -L${LOCALBASE}/lib -lpthread\\,' \
		${WRKSRC}/apps/Makefile.in

[FILE:303:descriptions/desc.primary]
XML Security Library is the latest stable of a C library based on
LibXML2 and OpenSSL. The library was created with a goal to support
major XML security standards:
   - XML Signature
   - XML Encryption
   - Canonical XML (was included in libxml2)
   - Exclusive Canonical XML (was included in libxml2)


[FILE:706:descriptions/desc.tools]
On branch master
Your branch is ahead of 'origin/master' by 3 commits.
  (use "git push" to publish your local commits)

Changes not staged for commit:
  (use "git add <file>..." to update what will be committed)
  (use "git restore <file>..." to discard changes in working directory)
	modified:   ../distinfo
	modified:   ../manifests/plist.primary
	modified:   ../patches/patch-configure
	modified:   ../patches/patch-src_cast__helpers.h
	modified:   ../specification

Untracked files:
  (use "git add <file>..." to include in what will be committed)
	desc.tools
	../manifests/plist.dev
	../manifests/plist.man
	../manifests/plist.tools

no changes added to commit (use "git add" and/or "git commit -a")


[FILE:99:distinfo]
4003c56b3d356d21b1db7775318540fad6bfedaf5f117e8f7c010811219be3cf      2437263 xmlsec1-1.3.2.tar.gz


[FILE:337:manifests/plist.primary]
lib/
 libxmlsec1-gcrypt.so.%%SOMAJOR%%
 libxmlsec1-gcrypt.so.%%SOVERSION%%
 libxmlsec1-gnutls.so.%%SOMAJOR%%
 libxmlsec1-gnutls.so.%%SOVERSION%%
 libxmlsec1-nss.so.%%SOMAJOR%%
 libxmlsec1-nss.so.%%SOVERSION%%
 libxmlsec1-openssl.so.%%SOMAJOR%%
 libxmlsec1-openssl.so.%%SOVERSION%%
 libxmlsec1.so.%%SOMAJOR%%
 libxmlsec1.so.%%SOVERSION%%


[FILE:31:manifests/plist.tools]
bin/xmlsec1
etc/xmlsec1Conf.sh


[FILE:954:manifests/plist.dev]
bin/xmlsec1-config
include/xmlsec1/xmlsec/
 app.h
 base64.h
 bn.h
 buffer.h
 crypto.h
 dl.h
 errors.h
 exports.h
 io.h
 keyinfo.h
 keys.h
 keysdata.h
 keysmngr.h
 list.h
 membuf.h
 nodeset.h
 parser.h
 private.h
 strings.h
 templates.h
 transforms.h
 version.h
 x509.h
 xmldsig.h
 xmlenc.h
 xmlsec.h
 xmltree.h
include/xmlsec1/xmlsec/gcrypt/
 app.h
 crypto.h
 symbols.h
include/xmlsec1/xmlsec/gnutls/
 app.h
 crypto.h
 keysstore.h
 symbols.h
 x509.h
include/xmlsec1/xmlsec/nss/
 app.h
 crypto.h
 keysstore.h
 pkikeys.h
 symbols.h
 x509.h
include/xmlsec1/xmlsec/openssl/
 app.h
 crypto.h
 evp.h
 keysstore.h
 symbols.h
 x509.h
lib/
 libxmlsec1-gcrypt.a
 libxmlsec1-gcrypt.so
 libxmlsec1-gnutls.a
 libxmlsec1-gnutls.so
 libxmlsec1-nss.a
 libxmlsec1-nss.so
 libxmlsec1-openssl.a
 libxmlsec1-openssl.so
 libxmlsec1.a
 libxmlsec1.so
lib/pkgconfig/
 xmlsec1-gcrypt.pc
 xmlsec1-gnutls.pc
 xmlsec1-nss.pc
 xmlsec1-openssl.pc
 xmlsec1.pc
share/aclocal/xmlsec1.m4


[FILE:51:manifests/plist.man]
share/man/man1/
 xmlsec1-config.1.gz
 xmlsec1.1.gz


[FILE:823:patches/patch-configure]
--- configure.orig	2023-06-06 13:00:49 UTC
+++ configure
@@ -15558,7 +15558,7 @@ case $host in
     *-*-osf5*)    OPENSSL_EXTRA_LIBS=;;
     *-*-openbsd*) OPENSSL_EXTRA_LIBS=;;
     *-*-netbsd*)  OPENSSL_EXTRA_LIBS=;;
-    *-*-freebsd*|*-*-dragonfly*) OPENSSL_EXTRA_LIBS=;;
+    *-*-freebsd*|*-*-dragonfly*|*-*-midnight*) OPENSSL_EXTRA_LIBS=;;
     *-*-darwin*) OPENSSL_EXTRA_LIBS=;;
     #FIXME: check if lib "dl" is required
     *)            OPENSSL_EXTRA_LIBS=-ldl;;
@@ -15973,8 +15973,8 @@ NSS_PACKAGE=mozilla-nss
 NSPR_INCLUDE_MARKER="nspr/nspr.h"
 NSPR_LIB_MARKER="libnspr4$shrext"
 NSPR_LIBS_LIST="-lnspr4 -lplds4 -lplc4"
-NSS_INCLUDE_MARKER="nss/nss.h"
-NSS_LIB_MARKER="libnss3$shrext"
+NSS_INCLUDE_MARKER="nss/nss/nss.h"
+NSS_LIB_MARKER="nss/libnss3$shrext"
 NSS_LIBS_LIST="-lnss3 -lsmime3"
 
 XMLSEC_NO_NSS="1"


[FILE:3923:patches/patch-fix-libxml2-2.12]
https://github.com/lsh123/xmlsec/commit/ffb327376f5bb69e8dfe7f805529e45a40118c2b

From ffb327376f5bb69e8dfe7f805529e45a40118c2b Mon Sep 17 00:00:00 2001
From: lsh123 <aleksey@aleksey.com>
Date: Mon, 20 Nov 2023 11:50:43 -0500
Subject: [PATCH] Fix libxml2 v2.12.0 includes  (#729)

--- apps/crypto.c
+++ apps/crypto.c
@@ -12,6 +12,7 @@
 #endif
 
 #include <string.h>
+#include <stdlib.h>
 
 #include <xmlsec/xmlsec.h>
 #include <xmlsec/keys.h>
--- apps/xmlsec.c
+++ apps/xmlsec.c
@@ -22,6 +22,7 @@
 #include <libxml/xmlmemory.h>
 #include <libxml/parser.h>
 #include <libxml/xpath.h>
+#include <libxml/xmlsave.h>
 #include <libxml/xpathInternals.h>
 
 #ifndef XMLSEC_NO_XSLT
@@ -3030,7 +3031,7 @@ xmlSecAppInit(void) {
     /* Init libxml */
     xmlInitParser();
     LIBXML_TEST_VERSION
-    xmlTreeIndentString = "\t";
+    xmlThrDefTreeIndentString("\t");
 #ifndef XMLSEC_NO_XSLT
     xmlIndentTreeOutput = 1;
 #endif /* XMLSEC_NO_XSLT */
--- include/xmlsec/xmlsec.h
+++ include/xmlsec/xmlsec.h
@@ -12,6 +12,7 @@
 #define __XMLSEC_H__
 
 #include <libxml/tree.h>
+#include <libxml/parser.h>
 
 #include <xmlsec/version.h>
 #include <xmlsec/exports.h>
--- src/errors_helpers.h
+++ src/errors_helpers.h
@@ -136,7 +136,7 @@ extern "C" {
  */
 #define xmlSecXmlError(errorFunction, errorObject) \
     {                                                 \
-        xmlErrorPtr error = xmlGetLastError();        \
+        const xmlError * error = xmlGetLastError();        \
         int code = (error != NULL) ? error->code : 0; \
         const char* message = (error != NULL) ? error->message : NULL; \
         xmlSecError(XMLSEC_ERRORS_HERE,               \
@@ -159,7 +159,7 @@ extern "C" {
  */
 #define xmlSecXmlError2(errorFunction, errorObject, msg, param) \
     {                                                 \
-        xmlErrorPtr error = xmlGetLastError();        \
+        const xmlError * error = xmlGetLastError();        \
         int code = (error != NULL) ? error->code : 0; \
         const char* message = (error != NULL) ? error->message : NULL; \
         xmlSecError(XMLSEC_ERRORS_HERE,               \
@@ -181,7 +181,7 @@ extern "C" {
  */
 #define xmlSecXmlParserError(errorFunction, ctxt, errorObject) \
     {                                                 \
-        xmlErrorPtr error = xmlCtxtGetLastError(ctxt);\
+        const xmlError * error = xmlCtxtGetLastError(ctxt);\
         int code = (error != NULL) ? error->code : 0; \
         const char* message = (error != NULL) ? error->message : NULL; \
         xmlSecError(XMLSEC_ERRORS_HERE,               \
@@ -205,7 +205,7 @@ extern "C" {
  */
 #define xmlSecXmlParserError2(errorFunction, ctxt, errorObject, msg, param) \
     {                                                 \
-        xmlErrorPtr error = xmlCtxtGetLastError(ctxt);\
+        const xmlError * error = xmlCtxtGetLastError(ctxt);\
         int code = (error != NULL) ? error->code : 0; \
         const char* message = (error != NULL) ? error->message : NULL; \
         xmlSecError(XMLSEC_ERRORS_HERE,               \
@@ -227,7 +227,7 @@ extern "C" {
  */
 #define xmlSecXsltError(errorFunction, ctxt, errorObject) \
     {                                                 \
-        xmlErrorPtr error = xmlGetLastError();        \
+        const xmlError * error = xmlGetLastError();        \
         int code = (error != NULL) ? error->code : 0; \
         const char* message = (error != NULL) ? error->message : NULL; \
         xmlSecError(XMLSEC_ERRORS_HERE,               \
--- src/mscrypto/certkeys.c
+++ src/mscrypto/certkeys.c
@@ -18,6 +18,7 @@
 #include "globals.h"
 
 #include <string.h>
+#include <stdlib.h>
 
 #ifndef XMLSEC_NO_GOST
 #include "csp_oid.h"
--- src/mscrypto/signatures.c
+++ src/mscrypto/signatures.c
@@ -17,6 +17,7 @@
 #include "globals.h"
 
 #include <string.h>
+#include <stdlib.h>
 
 #ifndef XMLSEC_NO_GOST
 #include "csp_calg.h"



[FILE:348:patches/patch-src_cast__helpers.h]
--- src/cast_helpers.h.orig	2023-06-06 13:00:47 UTC
+++ src/cast_helpers.h
@@ -16,6 +16,7 @@
 #error "cast_helpers.h file contains private xmlsec definitions and should not be used outside xmlsec or xmlsec-$crypto libraries"
 #endif /* XMLSEC_PRIVATE */
 
+#include <stdint.h>
 #include <limits.h>
 #include <stdint.h>
 #include "errors_helpers.h"

