# Buildsheet autogenerated by ravenadm tool -- Do not edit.

NAMEBASE=		xmlsec
VERSION=		1.2.25
KEYWORDS=		security
VARIANTS=		standard
SDESC[standard]=	XML Security Library
HOMEPAGE=		https://www.aleksey.com/xmlsec/
CONTACT=		nobody

DOWNLOAD_GROUPS=	main
SITES[main]=		https://www.aleksey.com/xmlsec/download/
DISTFILE[1]=		xmlsec1-1.2.25.tar.gz:main
DF_INDEX=		1
SPKGS[standard]=	complete
			primary
			docs

OPTIONS_AVAILABLE=	none
OPTIONS_STANDARD=	none

BUILDRUN_DEPENDS=	libgcrypt:single:standard
			libgpg-error:single:standard
			libltdl:single:standard
			nspr:single:standard
			nss:primary:standard

USES=			gmake libtool pkgconfig ssl
GNOME_COMPONENTS=	libxslt

DISTNAME=		xmlsec1-1.2.25

LICENSE=		MIT:primary
LICENSE_FILE=		MIT:{{WRKSRC}}/Copyright
LICENSE_SCHEME=		solo

FPC_EQUIVALENT=		security/xmlsec1

MUST_CONFIGURE=		gnu
CONFIGURE_ARGS=		--with-openssl="{{OPENSSLBASE}}"
			--with-gcrypt="{{LOCALBASE}}"
			--with-nspr="{{LOCALBASE}}"
			--with-nss="{{LOCALBASE}}"
			--enable-soap
			--disable-docs-build

MAKE_ARGS=		confexecdir="{{LOCALBASE}}/etc"
MAKE_ENV=		ABS_BUILDDIR="{{WRKSRC}}"
			TMPFOLDER="{{WRKDIR}}"

INSTALL_TARGET=		install-strip
INSTALL_REQ_TOOLCHAIN=	yes
SOVERSION=		1.2.25

LDFLAGS=		-Wl,-rpath,{{LOCALBASE}}/lib/nss

post-patch:
	${REINPLACE_CMD} -e 's/mozilla-nss/nss/' -e 's/mozilla-nspr/nspr/' \
		${WRKSRC}/configure
	${REINPLACE_CMD} -e 's/(CP) -ru/(CP) -r/' -e 's/(CP) -u/(CP)/' \
		${WRKSRC}/docs/Makefile.am ${WRKSRC}/docs/Makefile.in \
		${WRKSRC}/docs/api/Makefile.am ${WRKSRC}/docs/api/Makefile.in \
		${WRKSRC}/man/Makefile.am ${WRKSRC}/man/Makefile.in
	# Making the xmlsec1 executable multi-threaded to let load -lnss when needed
	${REINPLACE_CMD} -e 's,^\(xmlsec1_LDADD = \)\\$$,\1 -L${LOCALBASE}/lib -lpthread\\,' \
		${WRKSRC}/apps/Makefile.in

[FILE:303:descriptions/desc.primary]
XML Security Library is the latest stable of a C library based on
LibXML2 and OpenSSL. The library was created with a goal to support
major XML security standards:
   - XML Signature
   - XML Encryption
   - Canonical XML (was included in libxml2)
   - Exclusive Canonical XML (was included in libxml2)


[FILE:100:distinfo]
967ca83edf25ccb5b48a3c4a09ad3405a63365576503bf34290a42de1b92fcd2      1839160 xmlsec1-1.2.25.tar.gz


[FILE:1252:manifests/plist.primary]
bin/
 xmlsec1
 xmlsec1-config
etc/xmlsec1Conf.sh
include/xmlsec1/xmlsec/
 app.h
 base64.h
 bn.h
 buffer.h
 crypto.h
 dl.h
 errors.h
 exports.h
include/xmlsec1/xmlsec/gcrypt/
 app.h
 crypto.h
 symbols.h
include/xmlsec1/xmlsec/
 io.h
 keyinfo.h
 keys.h
 keysdata.h
 keysmngr.h
 list.h
 membuf.h
 nodeset.h
include/xmlsec1/xmlsec/nss/
 app.h
 bignum.h
 crypto.h
 keysstore.h
 pkikeys.h
 symbols.h
 x509.h
include/xmlsec1/xmlsec/openssl/
 app.h
 bn.h
 crypto.h
 evp.h
 symbols.h
 x509.h
include/xmlsec1/xmlsec/
 parser.h
 private.h
include/xmlsec1/xmlsec/private/xslt.h
 soap.h
 strings.h
 templates.h
 transforms.h
 version.h
 x509.h
 xmldsig.h
 xmlenc.h
 xmlsec.h
 xmltree.h
lib/
 libxmlsec1-gcrypt.a
 libxmlsec1-gcrypt.so
 libxmlsec1-gcrypt.so.%%SOMAJOR%%
 libxmlsec1-gcrypt.so.%%SOVERSION%%
 libxmlsec1-nss.a
 libxmlsec1-nss.so
 libxmlsec1-nss.so.%%SOMAJOR%%
 libxmlsec1-nss.so.%%SOVERSION%%
 libxmlsec1-openssl.a
 libxmlsec1-openssl.so
 libxmlsec1-openssl.so.%%SOMAJOR%%
 libxmlsec1-openssl.so.%%SOVERSION%%
 libxmlsec1.a
 libxmlsec1.so
 libxmlsec1.so.%%SOMAJOR%%
 libxmlsec1.so.%%SOVERSION%%
lib/pkgconfig/
 xmlsec1-gcrypt.pc
 xmlsec1-nss.pc
 xmlsec1-openssl.pc
 xmlsec1.pc
share/aclocal/xmlsec1.m4
share/man/man1/
 xmlsec1-config.1.gz
 xmlsec1.1.gz


[FILE:2757:patches/patch-configure]
--- configure.orig	2017-09-12 13:21:59 UTC
+++ configure
@@ -12661,7 +12661,7 @@ CC=$lt_save_CC
 
 
 
-if test "z$RM" == "z" ; then
+if test "z$RM" = "z" ; then
     # Extract the first word of "rm", so it can be a program name with args.
 set dummy rm; ac_word=$2
 { $as_echo "$as_me:${as_lineno-$LINENO}: checking for $ac_word" >&5
@@ -13648,7 +13648,7 @@ case "${host}" in
         ;;
 esac
 
-if test "z$shrext" == "z" ; then
+if test "z$shrext" = "z" ; then
     shrext=$shrext_cmds
 fi
 
@@ -14384,6 +14384,7 @@ elif test "z$with_openssl" != "z" ; then
 	*-*-osf5*) openssl_exlibs=;;
 	*-*-openbsd*) openssl_exlibs=;;
 	*-*-netbsd*) openssl_exlibs=;;
+	*-*-freebsd*|*-*-dragonfly*) openssl_exlibs=;;
 	#FIXME: check if lib "dl" is required
 	*)          openssl_exlibs=-ldl;;
     esac
@@ -14716,7 +14717,7 @@ rm -f conftest*
 /* end confdefs.h.  */
 
     	    #include <openssl/opensslv.h>
-	    #if OPENSSL_VERSION_NUMBER >= 0x10000000L
+	    #if OPENSSL_VERSION_NUMBER >= 0x10000000L || defined(LIBRESSL_VERSION_NUMBER)
 		yes
 	    #endif
 
@@ -14749,12 +14750,12 @@ fi
 if test "z$OPENSSL_FOUND" = "zyes" ; then
     XMLSEC_NO_OPENSSL="0"
     OPENSSL_CFLAGS="$OPENSSL_CFLAGS -DXMLSEC_CRYPTO_OPENSSL=1"
-    XMLSEC_CRYPTO_LIST="$XMLSEC_CRYPTO_LIST openssl"
+    XMLSEC_CRYPTO_LIST="$XMLSEC_CRYPTO_LIST openssl"; CPPFLAGS="$CPPFLAGS $OPENSSL_CFLAGS"
 else
     XMLSEC_CRYPTO_DISABLED_LIST="$XMLSEC_CRYPTO_DISABLED_LIST openssl"
 fi
 
- if test "z$XMLSEC_NO_OPENSSL" == "z1"; then
+ if test "z$XMLSEC_NO_OPENSSL" = "z1"; then
   XMLSEC_NO_OPENSSL_TRUE=
   XMLSEC_NO_OPENSSL_FALSE='#'
 else
@@ -14776,7 +14777,7 @@ NSPR_MIN_VERSION="4.4.1"
 NSS_CFLAGS=""
 NSS_LIBS=""
 NSS_LIBS_LIST="-lnss3 -lsmime3"
-NSPR_LIBS_LIST="-lnspr4 -lplds4 -lplc4"
+NSPR_LIBS_LIST="-lnspr4 -lplds4 -lplc4 -lpthread"
 NSS_CRYPTO_LIB="$XMLSEC_PACKAGE-nss"
 NSS_FOUND="no"
 NSPR_PACKAGE=mozilla-nspr
@@ -15211,15 +15212,15 @@ $as_echo_n "checking for nss libraries >
     NSS_NSS_H=""
 
     if test "z$with_nss" != "z" ; then
-	NSS_CFLAGS="$NSS_CFLAGS -I$with_nss/include -I$with_nss/include/nss"
+	NSS_CFLAGS="$NSS_CFLAGS -I$with_nss/include/nss/nss -I$with_nss/include/nss"
 	if test "z$with_gnu_ld" = "zyes" ; then
-	    NSS_LIBS="$NSS_LIBS -Wl,-rpath-link -Wl,$with_nss/lib -L$with_nss/lib $NSS_LIBS_LIST"
+	    NSS_LIBS="$NSS_LIBS -Wl,-rpath-link -Wl,$with_nss/lib/nss -L$with_nss/lib/nss $NSS_LIBS_LIST"
         else
-	    NSS_LIBS="$NSS_LIBS -L$with_nss/lib $NSS_LIBS_LIST"
+	    NSS_LIBS="$NSS_LIBS -L$with_nss/lib/nss $NSS_LIBS_LIST"
         fi
 	NSS_INCLUDES_FOUND="yes"
 	NSS_LIBS_FOUND="yes"
-	NSS_NSS_H="$with_nss/include/nss.h"
+	NSS_NSS_H="$with_nss/include/nss/nss/nss.h"
     else
 	for dir in $ac_nss_inc_dir ; do
 	    if test -f $dir/nss/nss.h ; then

