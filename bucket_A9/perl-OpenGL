# Buildsheet autogenerated by ravenadm tool -- Do not edit.

NAMEBASE=		perl-OpenGL
VERSION=		0.7006
KEYWORDS=		perl
VARIANTS=		540 542
SDESC[540]=		Bindings to OpenGL API, GLU, GLUT/FreeGLUT (5.40)
SDESC[542]=		Bindings to OpenGL API, GLU, GLUT/FreeGLUT (5.42)
HOMEPAGE=		https://github.com/Perl-GPU/pogl
CONTACT=		Perl_Automaton[perl@ironwolf.systems]

DOWNLOAD_GROUPS=	main
SITES[main]=		CPAN/ID:E/ET/ETJ
DISTFILE[1]=		OpenGL-0.7006.tar.gz:main
DF_INDEX=		1
SPKGS[540]=		single
SPKGS[542]=		single

OPTIONS_AVAILABLE=	PERL_540 PERL_542
OPTIONS_STANDARD=	none
VOPTS[540]=		PERL_540=ON PERL_542=OFF
VOPTS[542]=		PERL_540=OFF PERL_542=ON

BUILD_DEPENDS=		freeglut:dev:std
BUILDRUN_DEPENDS=	freeglut:primary:std

XORG_COMPONENTS=	x11 xext xmu xi ice

DISTNAME=		OpenGL-0.7006

GENERATED=		yes

CONFIGURE_ARGS=		interface=FREEGLUT
			verbose

SINGLE_JOB=		yes

[PERL_540].USES_ON=			perl:540,configure

[PERL_542].USES_ON=			perl:542,configure

post-install:
	${RM} ${STAGEDIR}${SITE_ARCH}/OpenGL/GLUT.pm
	${RM} ${STAGEDIR}${SITE_ARCH}/auto/OpenGL/GLUT/GLUT.so
	${RM} ${STAGEDIR}${SITE_MAN3}/OpenGL::GLUT.3
	${RMDIR} ${STAGEDIR}${SITE_ARCH}/auto/OpenGL/GLUT

pre-configure:
	${REINPLACE_CMD} -e 's|/usr/local|${LOCALBASE}|g' ${WRKSRC}/Makefile.PL
	${REINPLACE_CMD} -e 's|LDFLAGS=|LDFLAGS=-L${LOCALBASE}/lib -Wl,-rpath,${LOCALBASE}/lib |' \
		${WRKSRC}/utils/Makefile
	${REINPLACE_CMD} -e 's|glBindBufferARB|glBindBuffer|g' \
		${WRKSRC}/lib/OpenGL/V1.xs

[FILE:57:descriptions/desc.single]
Perl bindings to the OpenGL API, GLU, and GLUT/FreeGLUT



[FILE:99:distinfo]
69a1587213b7f414e5a2a7c2899f31b91fd681c055a2cee23ac4db932d67d557       778332 OpenGL-0.7006.tar.gz


[FILE:3114:patches/patch-Makefile.PL]
Don't check current display for extensions, build all.
Similar to gentoo portage.

--- Makefile.PL.orig	2025-04-14 04:33:29 UTC
+++ Makefile.PL
@@ -181,8 +181,7 @@ WriteMakefile(
       "lib/OpenGL/Config.pm ".
       "gl_exclude.h ".
       "utils/glversion.txt ".
-      "utils/glversion$Config{exe_ext} ".
-      "utils/glversion$Config{obj_ext}"
+      ""
   },
   %$build_config,
   INC => $INCS . ' -I'.curdir(),
@@ -504,47 +503,7 @@ sub get_gldata {
     ($found->{FREEGLUT32} || $found->{FREEGLUT}) ? "GLUT_DEF=HAVE_FREEGLUT " :
     ($found->{GLUT32} || $found->{GLUT}) ? "GLUT_DEF=HAVE_GLUT " :
     '';
-  # Platform-specific makefiles for glversion
-  my $make_ver;
-  my $append = " LIB='$libs' INC='$incs' DEF='$defs'";
-  if ($IS_STRAWBERRY) {
-    $make_ver = "&strawberry.bat";
-    print "strawberry glversion: '$make_ver'\n" if $verbose>1;
-  } elsif ($IS_MINGW) {
-    $make_ver = "&mingw.bat";
-    print "mingw glversion: '$make_ver'\n" if $verbose>1;
-  } elsif ($IS_W32API) {
-    $make_ver = ";make -f Makefile.cygwin $append";
-    print "cygwin glversion: '$make_ver'\n" if $verbose>1;
-  } elsif ($^O eq 'MSWin32') {
-    $make_ver = '&nmake -f makefile.mak ' . $append;
-    print "MSWin32 glversion: '$make_ver'\n" if $verbose>1;
-  } else {
-    $make_ver = ";make -f Makefile $append";
-    print "glversion: '$make_ver'\n" if $verbose>1;
-  }
-  my $exec = 'cd utils'."$make_ver clean".$make_ver;
-  print "glversion: $exec\n" if $verbose;
-  my $stat = `$exec`;
-  die "Error building glversion.txt: $stat" if $?;
-  print "\n$stat\n\n" if $verbose;
-  unlink "utils/freeglut.dll" or die "could not remove temporary freeglut: $!" if -f "utils/freeglut.dll";
-  # Parse glversion.txt file
-  open GLDATA, $glv_file or die "get_gldata: could not open $glv_file: $!\n";
   my $gldata = {};
-  my @gldata = <GLDATA>;
-  close(GLDATA);
-  foreach my $line (@gldata) {
-    $line =~ s|[\r\n]+||;
-    my($key,$val) = split('=',$line);
-    $gldata->{$key} = $val;
-  }
-  die "get_gldata: no extensions found in $glv_file\n" if !keys %$gldata;
-  print "This looks like OpenGL Version: $gldata->{VERSION}\n";
-  if ($^O eq 'darwin') {
-    $gldata->{VERSION} = '4.1';
-    print "  for MacOS X, overriding to version $gldata->{VERSION}\n";
-  }
   # Fix GLUT flags based on results
   if ($gldata->{FREEGLUT}) {
     print 'Found FreeGLUT v'.$gldata->{FREEGLUT}."\n";
@@ -570,12 +529,10 @@ sub generate_excl {
     next if ($ext =~ m|^GL_VERSION_|);
     $no_ext->{$ext}++;
   }
+
+  my $gldata = { };
   # Create gl_exclude.h
   die "Unable to write to $exc_file\n" if !open my $excl_fh, ">", $exc_file;
-  print $excl_fh "// OpenGL Extension Exclusions - may be modified before building.\n";
-  print $excl_fh "//\n";
-  print $excl_fh "// Generated for ".$gldata->{VENDOR}.", ".$gldata->{RENDERER}."\n";
-  print $excl_fh "// OpenGL v".$gldata->{VERSION}.", using ";
   print $excl_fh 'FreeGLUT v'.$gldata->{FREEGLUT}."\n" if $gldata->{FREEGLUT};
   my $GL_VERSION = $gldata->{VERSION} =~ m|^(\d\.\d+)| ? $1 : undef;
   # Make an empty exclusion file if a Windows distribution build


[FILE:324:patches/patch-gl_util.c]
--- gl_util.c.orig	2025-04-14 04:33:29 UTC
+++ gl_util.c
@@ -759,6 +759,12 @@ int gl_component_count(GLenum format, GL
 
 /* 18 */
 #ifdef GL_EXT_cmyka
+# ifndef GL_CMYK
+#  define GL_CMYK GL_CMYK_EXT
+# endif
+# ifndef GL_CMYKA
+#  define GL_CMYKA GL_CMYKA_EXT
+# endif
 		case GL_CMYK:
 			n = 4; break;
 		case GL_CMYKA:


[FILE:75:files/special.mk]
.if ${OPSYS} == Linux
MAKE_ARGS+=	CCFLAGS="${CFLAGS} -D_GNU_SOURCE"
.endif

