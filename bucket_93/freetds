# Buildsheet autogenerated by ravenadm tool -- Do not edit.

NAMEBASE=		freetds
VERSION=		1.4.5
KEYWORDS=		databases
VARIANTS=		standard
SDESC[standard]=	Sybase/Microsoft TDS protocol library
HOMEPAGE=		https://www.freetds.org/
CONTACT=		nobody

DOWNLOAD_GROUPS=	main
SITES[main]=		http://www.freetds.org/files/stable/
DISTFILE[1]=		freetds-1.4.5.tar.bz2:main
DF_INDEX=		1
SPKGS[standard]=	complete
			primary
			tools
			dev
			man
			docs

OPTIONS_AVAILABLE=	none
OPTIONS_STANDARD=	none

BUILD_DEPENDS=		libgcrypt:dev:standard
			unixODBC:dev:standard
BUILDRUN_DEPENDS=	libgcrypt:primary:standard
			unixODBC:primary:standard
EXRUN[tools]=		freetds:primary:standard

USES=			autoreconf cpe gettext:build gmake iconv libtool
			pkgconfig readline ssl:openssl11

LICENSE=		LGPL20+:primary
LICENSE_TERMS=		primary:{{WRKDIR}}/TERMS
LICENSE_FILE=		LGPL20+:{{WRKSRC}}/COPYING_LIB.txt
LICENSE_AWK=		TERMS:"^$$"
LICENSE_SOURCE=		TERMS:{{WRKSRC}}/include/freetds/tds.h
LICENSE_SCHEME=		solo

FPC_EQUIVALENT=		databases/freetds

MUST_CONFIGURE=		gnu
CONFIGURE_ARGS=		--with-tdsver=7.4
			--sysconfdir={{PREFIX}}/etc/freetds
			--enable-sybase-compat
			--enable-msdblib
			--with-openssl={{OPENSSLBASE}}
			--with-unixodbc={{LOCALBASE}}

INSTALL_TARGET=		install-strip

LDFLAGS=		-lgcrypt
			-lpthread

post-patch:
	${FIND} ${WRKSRC} -name "Makefile.am" | ${XARGS} ${REINPLACE_CMD} -e \
		's|<malloc.h>|<stdlib.h>| ; \
		 s|/freetds.conf|/freetds.conf.sample|g ; \
		 s|/locales.conf|/locales.conf.sample|g ; \
		 s|/pool.conf|/pool.conf.sample|g ; \
		 s| common.h||g'
	${REINPLACE_CMD} -e 's|\(\$with_iodbc/include\)|\1/libiodbc|g' \
		${WRKSRC}/configure.ac

post-install:
	${INSTALL_DATA} ${WRKSRC}/interfaces \
		${STAGEDIR}${PREFIX}/etc/freetds/interfaces.sample

post-extract:
	(cd ${WRKSRC} && ${LN} -s freetds.conf freetds.conf.sample)
	(cd ${WRKSRC} && ${LN} -s locales.conf locales.conf.sample)
	(cd ${WRKSRC}/src/pool && ${LN} -s pool.conf pool.conf.sample)

[FILE:487:descriptions/desc.primary]
FreeTDS is a set of libraries for Unix and Linux that allows your
programs to natively talk to Microsoft SQL Server and Sybase databases.

Technically speaking, FreeTDS is an open source implementation of the
TDS (Tabular Data Stream) protocol used by these databases for their
own clients. It supports many different flavors of the protocol and
three APIs to access it. Additionally FreeTDS works with other software
such as Perl and PHP, providing access from those languages as well.


[FILE:37:descriptions/desc.tools]
This package contains FreeTDS tools.


[FILE:100:distinfo]
16c411772bea227b4dd99aa513ff87fc09ee23a2ff8ec7851e5b3ad73227bc2f      2394540 freetds-1.4.5.tar.bz2


[FILE:105:manifests/plist.primary]
lib/
 libct.so.4
 libct.so.4.0.0
 libsybdb.so.5
 libsybdb.so.5.1.0
 libtdsodbc.so.0
 libtdsodbc.so.0.0.0


[FILE:235:manifests/plist.tools]
@sample etc/freetds/freetds.conf.sample
@sample etc/freetds/interfaces.sample
@sample etc/freetds/locales.conf.sample
@sample etc/freetds/pool.conf.sample
bin/
 bsqldb
 bsqlodbc
 datacopy
 defncopy
 fisql
 freebcp
 osql
 tdspool
 tsql


[FILE:219:manifests/plist.dev]
include/
 bkpublic.h
 cspublic.h
 cstypes.h
 ctpublic.h
 odbcss.h
 sqldb.h
 sqlfront.h
 sybdb.h
 syberror.h
 sybfront.h
 tds_sysdep_public.h
lib/
 libct.a
 libct.so
 libsybdb.a
 libsybdb.so
 libtdsodbc.a
 libtdsodbc.so


[FILE:155:manifests/plist.man]
share/man/man1/
 bsqldb.1.gz
 bsqlodbc.1.gz
 datacopy.1.gz
 defncopy.1.gz
 fisql.1.gz
 freebcp.1.gz
 osql.1.gz
 tsql.1.gz
share/man/man5/freetds.conf.5.gz


[FILE:420:patches/patch-src_tds_sec__negotiate__openssl.h]
--- src/tds/sec_negotiate_openssl.h.orig	2023-09-12 12:07:08 UTC
+++ src/tds/sec_negotiate_openssl.h
@@ -37,6 +37,11 @@
 #error HAVE_OPENSSL not defines, this file should not be included
 #endif
 
+#if defined(LIBRESSL_VERSION_NUMBER) && LIBRESSL_VERSION_NUMBER < 0x2070000fL
+#undef OPENSSL_VERSION_NUMBER
+#define OPENSSL_VERSION_NUMBER 0x1000107fL
+#endif
+
 static inline const BIGNUM*
 rsa_get_n(const RSA *rsa)
 {


[FILE:654:patches/patch-src_tds_tls.c]
--- src/tds/tls.c.orig	2023-09-26 21:11:17 UTC
+++ src/tds/tls.c
@@ -53,6 +53,10 @@
 #include <sys/socket.h>
 #endif
 
+#if defined(__FreeBSD__) || defined(__DragonFly__)
+#include <sys/socket.h>
+#endif
+
 #include <freetds/tds.h>
 #include <freetds/utils/string.h>
 #include <freetds/tls.h>
@@ -75,6 +79,15 @@
 #define SSL_PTR ptr
 #else
 
+#ifdef LIBRESSL_VERSION_NUMBER
+#if LIBRESSL_VERSION_NUMBER < 0x2070000FL
+static pthread_mutex_t *openssllocks;
+#undef OPENSSL_VERSION_NUMBER
+#define OPENSSL_VERSION_NUMBER 0x1000107fL
+#endif
+#define TLS_ST_OK SSL_ST_OK
+#endif
+
 /* some compatibility layer */
 #if !HAVE_BIO_GET_DATA
 static inline void

