# Buildsheet autogenerated by ravenadm tool -- Do not edit.

NAMEBASE=		freetds
VERSION=		1.00.62
KEYWORDS=		databases
VARIANTS=		standard
SDESC[standard]=	Sybase/Microsoft TDS protocol library
HOMEPAGE=		http://www.freetds.org/
CONTACT=		nobody

DOWNLOAD_GROUPS=	main
SITES[main]=		ftp://ftp.freetds.org/pub/freetds/stable/
DISTFILE[1]=		freetds-1.00.62.tar.bz2:main
DF_INDEX=		1
SPKGS[standard]=	complete
			primary
			docs

OPTIONS_AVAILABLE=	none
OPTIONS_STANDARD=	none

BROKEN_SSL=		openssl-devel

BUILDRUN_DEPENDS=	libgcrypt:single:standard
			unixODBC:primary:standard

USES=			autoreconf gettext-tools gmake iconv libtool:keepla
			pkgconfig readline ssl

FPC_EQUIVALENT=		databases/freetds

MUST_CONFIGURE=		gnu
CONFIGURE_ARGS=		--with-tdsver=7.4
			--sysconfdir={{PREFIX}}/etc/freetds
			--enable-sybase-compat
			--enable-msdblib
			--with-openssl={{OPENSSLBASE}}
			--with-unixodbc={{LOCALBASE}}

INSTALL_TARGET=		install-strip

LDFLAGS=		-lgcrypt
			-lpthread

post-patch:
	@${FIND} ${WRKSRC} -name "Makefile.am" | ${XARGS} ${REINPLACE_CMD} -e \
		's|<malloc.h>|<stdlib.h>| ; \
		 s|/freetds.conf|/freetds.conf.sample|g ; \
		 s|/locales.conf|/locales.conf.sample|g ; \
		 s|/pool.conf|/pool.conf.sample|g ; \
		 s| common.h||g'
	@${REINPLACE_CMD} -e 's|\(\$with_iodbc/include\)|\1/libiodbc|g' \
		${WRKSRC}/configure.ac

post-install:
	${INSTALL_DATA} ${WRKSRC}/interfaces \
		${STAGEDIR}${PREFIX}/etc/freetds/interfaces.sample

post-extract:
	@cd ${WRKSRC} && ${LN} -s freetds.conf freetds.conf.sample
	@cd ${WRKSRC} && ${LN} -s locales.conf locales.conf.sample
	@cd ${WRKSRC}/src/pool && ${LN} -s pool.conf pool.conf.sample

[FILE:487:descriptions/desc.primary]
FreeTDS is a set of libraries for Unix and Linux that allows your
programs to natively talk to Microsoft SQL Server and Sybase databases.

Technically speaking, FreeTDS is an open source implementation of the
TDS (Tabular Data Stream) protocol used by these databases for their
own clients. It supports many different flavors of the protocol and
three APIs to access it. Additionally FreeTDS works with other software
such as Perl and PHP, providing access from those languages as well.


[FILE:102:distinfo]
3a369aa00078f87dd3765006f772bfcf813bc46462d35fe6abf38d4b9dcca181      2149063 freetds-1.00.62.tar.bz2


[FILE:757:manifests/plist.primary]
bin/
 bsqldb
 datacopy
 defncopy
 freebcp
 fisql
 osql
 tdspool
 tsql
@sample etc/freetds/freetds.conf.sample
@sample etc/freetds/interfaces.sample
@sample etc/freetds/locales.conf.sample
@sample etc/freetds/pool.conf.sample
include/
 bkpublic.h
 cspublic.h
 cstypes.h
 ctpublic.h
 odbcss.h
 sqldb.h
 sqlfront.h
 sybdb.h
 syberror.h
 sybfront.h
 tds_sysdep_public.h
lib/
 libct.a
 libct.la
 libct.so
 libct.so.4
 libct.so.4.0.0
 libsybdb.a
 libsybdb.la
 libsybdb.so
 libsybdb.so.5
 libsybdb.so.5.1.0
share/man/man1/
 bsqldb.1.gz
 bsqlodbc.1.gz
 datacopy.1.gz
 defncopy.1.gz
 fisql.1.gz
 freebcp.1.gz
 osql.1.gz
 tsql.1.gz
share/man/man5/freetds.conf.5.gz
bin/
 bsqlodbc
lib/
 libtdsodbc.so
 libtdsodbc.so.0
 libtdsodbc.so.0.0.0
 libtdsodbc.la
 libtdsodbc.a


[FILE:373:patches/patch-src_tds_sec_negotiate_openssl.h]
--- src/tds/sec_negotiate_openssl.h.orig	2017-02-15 09:00:01 UTC
+++ src/tds/sec_negotiate_openssl.h
@@ -37,6 +37,11 @@
 #error HAVE_OPENSSL not defines, this file should not be included
 #endif
 
+#ifdef LIBRESSL_VERSION_NUMBER
+#undef OPENSSL_VERSION_NUMBER
+#define OPENSSL_VERSION_NUMBER 0x1000107fL
+#endif
+
 static inline const BIGNUM*
 rsa_get_n(const RSA *rsa)
 {


[FILE:586:patches/patch-src_tds_tls.c]
--- src/tds/tls.c.orig	2017-02-15 09:00:01 UTC
+++ src/tds/tls.c
@@ -50,6 +50,10 @@
 #include <sys/socket.h>
 #endif
 
+#if defined(__FreeBSD__) || defined(__DragonFly__)
+#include <sys/socket.h>
+#endif
+
 #include <freetds/tds.h>
 #include <freetds/string.h>
 #include <freetds/tls.h>
@@ -72,6 +76,12 @@
 #define SSL_PTR ptr
 #else
 
+#ifdef LIBRESSL_VERSION_NUMBER
+static pthread_mutex_t *openssllocks;
+#undef OPENSSL_VERSION_NUMBER
+#define OPENSSL_VERSION_NUMBER 0x1000107fL
+#endif
+
 /* some compatibility layer */
 #if OPENSSL_VERSION_NUMBER < 0x1010000FL
 static inline void

