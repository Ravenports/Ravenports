# Buildsheet autogenerated by ravenadm tool -- Do not edit.

NAMEBASE=		libiconv
VERSION=		1.14
KEYWORDS=		converters devel
VARIANTS=		standard
SDESC[standard]=	Character set conversion library
HOMEPAGE=		http://www.gnu.org/software/libiconv/
CONTACT=		nobody

DOWNLOAD_GROUPS=	main patch
SITES[patch]=		http://apolloron.org/software/libiconv-1.14-ja
SITES[main]=		GNU/libiconv
DISTFILE[1]=		libiconv-1.14.tar.gz:main
DISTFILE[2]=		libiconv-1.14-ja-1.patch.gz:patch
DF_INDEX=		1
SPKGS[standard]=	complete
			static
			shared

OPTIONS_AVAILABLE=	ENCODINGS PATCHES
OPTIONS_STANDARD=	ENCODINGS PATCHES
OPT_ON[all]=		ENCODINGS

USES=			libtool

LICENSE=		GPLv3:static
LICENSE_SCHEME=		solo
LICENSE_FILE=		GPLv3:{{WRKSRC}}/COPYING

PATCHFILES_STRIP=	-p1

MUST_CONFIGURE=		gnu
CONFIGURE_ARGS=		--enable-static
			--disable-nls
			--docdir={{STD_DOCDIR}}
			am_cv_func_iconv=no

SINGLE_JOB=		yes

INSTALL_TARGET=		install-strip
INSTALL_REQ_TOOLCHAIN=	yes

CFLAGS=			-std=gnu89

[PATCHES].DESCRIPTION=			Apply patches to fix CP932, add EUCJP-MS
[PATCHES].PATCHFILES_ON=		2

[ENCODINGS].DESCRIPTION=		Include extra character sets
[ENCODINGS].CONFIGURE_ENABLE_BOTH=	extra-encodings

post-patch:
	@${REINPLACE_CMD} -e 's:ei_ksc5601:ei_euc_kr:g' ${WRKSRC}/lib/aliases.h
	@${REINPLACE_CMD} -e 's:gawk:awk:g' ${WRKSRC}/configure \
		${WRKSRC}/libcharset/configure \
		${WRKSRC}/preload/configure

post-install:
	${RM} -r ${STAGEDIR}${STD_DOCDIR}

[FILE:621:descriptions/desc.static]
This library provides an iconv() implementation, for use on systems which
don't have one, or whose implementation cannot convert from/to Unicode.

It can convert from any of these encodings to any other, through Unicode
conversion. It has also some limited support for transliteration, i.e.
when a character cannot be represented in the target character set, it can
be approximated through one or several similarly looking characters.

libiconv is for you if your application needs to support multiple character
encodings, but that support lacks from your system.

This package contains the headers and static libraries.


[FILE:213:descriptions/desc.shared]
This library provides an iconv() implementation, for use on systems which
don't have one, or whose implementation cannot convert from/to Unicode.

This package contains the iconv program and the shared libraries.


[FILE:205:distinfo]
72b24ded17d687193c3366d0ebe7cde1e6b18f0df8c55438ac95be39e8a30613      4984397 libiconv-1.14.tar.gz
1fb7afc12b1f76c86340b29df65891b82c6dc4d579167125bf9be39854aef53e          970 libiconv-1.14-ja-1.patch.gz


[FILE:220:manifests/plist.static]
include/
 iconv.h
 libcharset.h
 localcharset.h
lib/
 charset.alias
 libcharset.a
 libiconv.a
share/man/man1/iconv.1.gz
share/man/man3/
 iconv.3.gz
 iconv_open.3.gz
 iconv_open_into.3.gz
 iconv_close.3.gz
 iconvctl.3.gz


[FILE:115:manifests/plist.shared]
bin/iconv
lib/
 libcharset.so
 libcharset.so.1
 libcharset.so.1.0.0
 libiconv.so
 libiconv.so.2
 libiconv.so.2.5.1


[FILE:2344:patches/patch-include-iconv.h.in]
--- include/iconv.h.in.orig	2011-08-07 17:48:03 UTC
+++ include/iconv.h.in
@@ -21,8 +21,10 @@
 #ifndef _LIBICONV_H
 #define _LIBICONV_H
 
+#ifndef LIBICONV_PLUG
 #define _LIBICONV_VERSION 0x010E    /* version number: (major<<8) + minor */
 extern @DLL_VARIABLE@ int _libiconv_version; /* Likewise */
+#endif
 
 /* We would like to #include any system header file which could define
    iconv_t, 1. in order to eliminate the risk that the user gets compilation
@@ -94,7 +96,6 @@ extern int iconv_close (iconv_t cd);
 #endif
 
 
-#ifndef LIBICONV_PLUG
 
 /* Nonstandard extensions. */
 
@@ -127,12 +128,16 @@ typedef struct {
 /* Allocates descriptor for code conversion from encoding ‘fromcode’ to
    encoding ‘tocode’ into preallocated memory. Returns an error indicator
    (0 or -1 with errno set). */
+#ifndef LIBICONV_PLUG
 #define iconv_open_into libiconv_open_into
+#endif
 extern int iconv_open_into (const char* tocode, const char* fromcode,
                             iconv_allocation_t* resultp);
 
 /* Control of attributes. */
+#ifndef LIBICONV_PLUG
 #define iconvctl libiconvctl
+#endif
 extern int iconvctl (iconv_t cd, int request, void* argument);
 
 /* Hook performed after every successful conversion of a Unicode character. */
@@ -212,7 +217,9 @@ struct iconv_fallbacks {
 #define ICONV_SET_FALLBACKS       6  /* const struct iconv_fallbacks *argument */
 
 /* Listing of locale independent encodings. */
+#ifndef LIBICONV_PLUG
 #define iconvlist libiconvlist
+#endif
 extern void iconvlist (int (*do_one) (unsigned int namescount,
                                       const char * const * names,
                                       void* data),
@@ -224,6 +231,7 @@ extern const char * iconv_canonicalize (
 
 /* Support for relocatable packages.  */
 
+#ifndef LIBICONV_PLUG
 /* Sets the original and the current installation prefix of the package.
    Relocation simply replaces a pathname starting with the original prefix
    by the corresponding pathname with the current prefix instead.  Both
@@ -231,12 +239,12 @@ extern const char * iconv_canonicalize (
    instead of "/").  */
 extern void libiconv_set_relocation_prefix (const char *orig_prefix,
                                             const char *curr_prefix);
+#endif
 
 #ifdef __cplusplus
 }
 #endif
 
-#endif
 
 
 #endif /* _LIBICONV_H */


[FILE:1370:patches/patch-src__Makefile.in]
--- src/Makefile.in.orig	2011-06-04 19:05:58.000000000 +0200
+++ src/Makefile.in	2013-07-06 18:49:54.000000000 +0200
@@ -71,7 +71,6 @@
 # without internationalization and not linked with libintl.
 
 all : iconv_no_i18n$(EXEEXT) iconv.@OBJEXT@ $(OBJECTS_RES_@WOE32@)
-	test `ls -ld . | sed -e 's/^d\(.........\).*/\1/'` = rwxrwxrwx || chmod 777 .
 
 # This is the temporary iconv executable, without internationalization.
 iconv_no_i18n$(EXEEXT) : iconv_no_i18n.@OBJEXT@ ../lib/libiconv.la $(OBJECTS_RES_@WOE32@)
@@ -113,7 +112,7 @@
 	if [ ! -d $(DESTDIR)$(bindir) ] ; then $(mkinstalldirs) $(DESTDIR)$(bindir) ; fi
 	case "@host_os@" in \
 	  hpux*) $(CC) $(LDFLAGS) $(CFLAGS) $(iconv_LDFLAGS) iconv.@OBJEXT@ ../srclib/libicrt.a -L$(DESTDIR)$(libdir) -liconv @LIBINTL@ $(OBJECTS_RES_@WOE32@) `if test -n '$(DESTDIR)'; then echo " -Wl,+b -Wl,$(libdir)"; fi` -o iconv$(EXEEXT);; \
-	  *) $(LIBTOOL_LINK) $(CC) $(LDFLAGS) $(CFLAGS) $(iconv_LDFLAGS) iconv.@OBJEXT@ ../srclib/libicrt.a $(DESTDIR)$(libdir)/libiconv.la @LTLIBINTL@ $(OBJECTS_RES_@WOE32@) -o iconv$(EXEEXT);; \
+	  *) $(LIBTOOL_LINK) $(CC) $(LDFLAGS) $(CFLAGS) $(iconv_LDFLAGS) iconv.@OBJEXT@ ../srclib/libicrt.a ../lib/libiconv.la @LTLIBINTL@ $(OBJECTS_RES_@WOE32@) -o iconv$(EXEEXT);; \
 	esac
 	$(INSTALL_PROGRAM_ENV) $(LIBTOOL_INSTALL) $(INSTALL_PROGRAM) iconv$(EXEEXT) $(DESTDIR)$(bindir)/iconv$(EXEEXT)
 


[FILE:1329:freebsd/patch-libcharset__lib__config.charset]
--- libcharset/lib/config.charset.orig	2010-04-05 02:25:38.000000000 +0200
+++ libcharset/lib/config.charset	2011-10-23 22:05:50.000000000 +0200
@@ -348,7 +348,7 @@ case "$os" in
     #echo "sun_eu_greek ?" # what is this?
     echo "UTF-8 UTF-8"
     ;;
-  freebsd* | os2*)
+  freebsd4.[0-5]* | os2*)
     # FreeBSD 4.2 doesn't have nl_langinfo(CODESET); therefore
     # localcharset.c falls back to using the full locale name
     # from the environment variables.
@@ -385,6 +385,31 @@ case "$os" in
     echo "ja_JP.Shift_JIS SHIFT_JIS"
     echo "ko_KR.EUC EUC-KR"
     ;;
+  freebsd*)
+	echo "US-ASCII ASCII"
+	echo "ISO8859-1 ISO-8859-1"
+	echo "ISO_8859-1 ISO-8859-1"
+	echo "ISO8859-2 ISO-8859-2"
+	echo "ISO_8859-2 ISO-8859-2"
+	echo "ISO8859-4 ISO-8859-4"
+	echo "ISO_8859-4 ISO-8859-4"
+	echo "ISO8859-5 ISO-8859-5"
+	echo "ISO_8859-5 ISO-8859-5"
+	echo "ISO8859-7 ISO-8859-7"
+	echo "ISO_8859-7 ISO-8859-7"
+	echo "ISO8859-9 ISO-8859-9"
+	echo "ISO_8859-9 ISO-8859-9"
+	echo "ISO8859-13 ISO-8859-13"
+	echo "ISO_8859-13 ISO-8859-13"
+	echo "ISO8859-15 ISO-8859-15"
+	echo "ISO_8859-15 ISO-8859-15"
+	echo "eucCN GB2312"
+	echo "eucJP EUC-JP"
+	echo "eucKR EUC-KR"
+	echo "Big5 BIG5"
+	echo "Big5HKSCS BIG5-HKSCS"
+	echo "SJIS SHIFT_JIS"
+        ;;
   netbsd*)
     echo "646 ASCII"
     echo "ISO8859-1 ISO-8859-1"

