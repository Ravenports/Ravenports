# Buildsheet autogenerated by ravenadm tool -- Do not edit.

NAMEBASE=		libiconv
VERSION=		1.18
KEYWORDS=		converters devel
VARIANTS=		std
SDESC[std]=		Character set conversion library
HOMEPAGE=		http://www.gnu.org/software/libiconv/
CONTACT=		nobody

DOWNLOAD_GROUPS=	main
SITES[main]=		GNU/libiconv
DISTFILE[1]=		libiconv-1.18.tar.gz:main
DF_INDEX=		1
SPKGS[std]=		set
			primary
			dev
			man

OPTIONS_AVAILABLE=	ENCODINGS
OPTIONS_STANDARD=	ENCODINGS
OPT_ON[all]=		ENCODINGS

USES=			libtool

LICENSE=		GPLv3+:primary
LICENSE_TERMS=		primary:{{WRKDIR}}/TERMS
LICENSE_FILE=		GPLv3+:{{WRKSRC}}/COPYING
LICENSE_AWK=		TERMS:"^\#include"
LICENSE_SOURCE=		TERMS:{{WRKSRC}}/src/iconv.c
LICENSE_SCHEME=		solo

FPC_EQUIVALENT=		converters/libiconv

MUST_CONFIGURE=		gnu
CONFIGURE_ARGS=		--enable-static
			--disable-nls
			--docdir={{STD_DOCDIR}}
			am_cv_func_iconv=no

SINGLE_JOB=		yes

INSTALL_TARGET=		install-strip
INSTALL_REQ_TOOLCHAIN=	yes
SOVERSION=		2.7.0

CFLAGS=			-std=gnu89

[ENCODINGS].DESCRIPTION=		Include extra character sets
[ENCODINGS].CONFIGURE_ENABLE_BOTH=	extra-encodings

post-install:
	${RM} -r ${STAGEDIR}${STD_DOCDIR}
	# install-strip doesn't seem to work
	${STRIP_CMD} ${STAGEDIR}${PREFIX}/lib/libcharset.${LIBEXT}
	${STRIP_CMD} ${STAGEDIR}${PREFIX}/lib/libiconv.${LIBEXT}
	# install our PIC library
	${INSTALL_DATA} ${WRKSRC}/lib/.libs/libiconv_pic.a \
		${STAGEDIR}${PREFIX}/lib/

post-build:
	# assemble PIC library
	(cd ${WRKSRC}/lib/.libs &&\
	 ${AR} -cq libiconv_pic.a *.o &&\
	 ranlib libiconv_pic.a)

pre-configure:
	${REINPLACE_CMD} -e 's:ei_ksc5601:ei_euc_kr:g' ${WRKSRC}/lib/aliases.h
	${REINPLACE_CMD} -e 's:gawk:awk:g' ${WRKSRC}/configure \
		${WRKSRC}/libcharset/configure

[FILE:564:descriptions/desc.primary]
This library provides an iconv() implementation, for use on systems which
don't have one, or whose implementation cannot convert from/to Unicode.

It can convert from any of these encodings to any other, through Unicode
conversion. It has also some limited support for transliteration, i.e.
when a character cannot be represented in the target character set, it can
be approximated through one or several similarly looking characters.

libiconv is for you if your application needs to support multiple character
encodings, but that support lacks from your system.


[FILE:99:distinfo]
3b08f5f4f9b4eb82f151a7040bfd6fe6c6fb922efe4b1659c66ea933276965e8      5822590 libiconv-1.18.tar.gz


[FILE:105:manifests/plist.primary]
bin/iconv
lib/
 libcharset.so.1
 libcharset.so.1.0.0
 libiconv.so.%%SOMAJOR%%
 libiconv.so.%%SOVERSION%%


[FILE:123:manifests/plist.dev]
include/
 iconv.h
 libcharset.h
 localcharset.h
lib/
 libcharset.a
 libcharset.so
 libiconv.a
 libiconv.so
 libiconv_pic.a


[FILE:108:manifests/plist.man]
share/man/man1/iconv.1
share/man/man3/
 iconv.3
 iconv_close.3
 iconv_open.3
 iconv_open_into.3
 iconvctl.3


[FILE:1996:patches/patch-include_iconv.h.in]
--- include/iconv.h.in.orig	2024-12-15 12:23:08 UTC
+++ include/iconv.h.in
@@ -24,8 +24,10 @@
 extern "C" {
 #endif
 
+#ifndef LIBICONV_PLUG
 #define _LIBICONV_VERSION 0x0112    /* version number: (major<<8) + minor */
 extern @DLL_VARIABLE@ int _libiconv_version; /* Likewise */
+#endif
 
 #ifdef __cplusplus
 }
@@ -121,12 +123,16 @@ typedef struct {
 /* Allocates descriptor for code conversion from encoding ‘fromcode’ to
    encoding ‘tocode’ into preallocated memory. Returns an error indicator
    (0 or -1 with errno set). */
+#ifndef LIBICONV_PLUG
 #define iconv_open_into libiconv_open_into
+#endif
 extern int iconv_open_into (const char* tocode, const char* fromcode,
                             iconv_allocation_t* resultp);
 
 /* Control of attributes. */
+#ifndef LIBICONV_PLUG
 #define iconvctl libiconvctl
+#endif
 extern int iconvctl (iconv_t cd, int request, void* argument);
 
 /* Hook performed after every successful conversion of a Unicode character. */
@@ -215,7 +221,9 @@ struct iconv_fallbacks {
 #define ICONV_SET_DISCARD_NON_IDENTICAL  14  /* const int *argument */
 
 /* Listing of locale independent encodings. */
+#ifndef LIBICONV_PLUG
 #define iconvlist libiconvlist
+#endif
 extern void iconvlist (int (*do_one) (unsigned int namescount,
                                       const char * const * names,
                                       void* data),
@@ -227,6 +235,7 @@ extern const char * iconv_canonicalize (
 
 /* Support for relocatable packages.  */
 
+#ifndef LIBICONV_PLUG
 /* Sets the original and the current installation prefix of the package.
    Relocation simply replaces a pathname starting with the original prefix
    by the corresponding pathname with the current prefix instead.  Both
@@ -235,6 +244,8 @@ extern const char * iconv_canonicalize (
 extern void libiconv_set_relocation_prefix (const char *orig_prefix,
                                             const char *curr_prefix);
 
+#endif
+
 #ifdef __cplusplus
 }
 #endif


[FILE:1359:patches/patch-src_Makefile.in]
--- src/Makefile.in.orig	2023-05-12 20:45:58 UTC
+++ src/Makefile.in
@@ -71,7 +71,6 @@ OBJECTS_RES_no =
 # without internationalization and not linked with libintl.
 
 all : iconv_no_i18n$(EXEEXT) iconv.@OBJEXT@ $(OBJECTS_RES_@WOE32@)
-	test `ls -ld . | sed -e 's/^d\(.........\).*/\1/'` = rwxrwxrwx || chmod 777 .
 
 # This is the temporary iconv executable, without internationalization.
 iconv_no_i18n$(EXEEXT) : iconv_no_i18n.@OBJEXT@ ../lib/libiconv.la $(OBJECTS_RES_@WOE32@)
@@ -113,7 +112,7 @@ install : all force
 	if [ ! -d $(DESTDIR)$(bindir) ] ; then $(mkinstalldirs) $(DESTDIR)$(bindir) ; fi
 	case "@host_os@" in \
 	  hpux*) $(CC) $(LDFLAGS) $(CFLAGS) $(iconv_LDFLAGS) iconv.@OBJEXT@ ../srclib/libicrt.a -L$(DESTDIR)$(libdir) -liconv @LIBINTL@ $(OBJECTS_RES_@WOE32@) `if test -n '$(DESTDIR)'; then echo " -Wl,+b -Wl,$(libdir)"; fi` -o iconv$(EXEEXT);; \
-	  *) $(LIBTOOL_LINK) $(CC) $(LDFLAGS) $(CFLAGS) $(iconv_LDFLAGS) iconv.@OBJEXT@ ../srclib/libicrt.a @LTLIBINTL@ $(DESTDIR)$(libdir)/libiconv.la $(OBJECTS_RES_@WOE32@) -o iconv$(EXEEXT);; \
+	  *) $(LIBTOOL_LINK) $(CC) $(LDFLAGS) $(CFLAGS) $(iconv_LDFLAGS) iconv.@OBJEXT@ ../srclib/libicrt.a @LTLIBINTL@ ../lib/libiconv.la $(OBJECTS_RES_@WOE32@) -o iconv$(EXEEXT);; \
 	esac
 	$(INSTALL_PROGRAM_ENV) $(LIBTOOL_INSTALL) $(INSTALL_PROGRAM) iconv$(EXEEXT) $(DESTDIR)$(bindir)/iconv$(EXEEXT)
 

