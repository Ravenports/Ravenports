# Buildsheet autogenerated by ravenadm tool -- Do not edit.

NAMEBASE=		apq-odbc
VERSION=		3.2.0
KEYWORDS=		databases ada
VARIANTS=		standard
SDESC[standard]=	APQ Ada95 ODBC database driver
HOMEPAGE=		none
CONTACT=		John_Marino[draco@marino.st]

DOWNLOAD_GROUPS=	main
SITES[main]=		FREELOCAL/marino
DISTFILE[1]=		apq-odbc-3.2.0.tar.bz2:main
DF_INDEX=		1
SPKGS[standard]=	single

OPTIONS_AVAILABLE=	none
OPTIONS_STANDARD=	none

BUILD_DEPENDS=		bash:primary:standard
BUILDRUN_DEPENDS=	apq-base:single:standard
			unixODBC:primary:standard

USES=			gprbuild

LICENSE=		GMGPL:single
LICENSE_TERMS=		single:{{WRKDIR}}/TERMS
LICENSE_FILE=		GMGPL:stock
LICENSE_AWK=		TERMS:"^$$"
LICENSE_SOURCE=		TERMS:{{WRKSRC}}/src/apq-odbc.ads
LICENSE_SCHEME=		solo

FPC_EQUIVALENT=		databases/apq-odbc

INVALID_RPATH=		yes
MUST_CONFIGURE=		yes
CONFIGURE_ARGS=		--prefix={{PREFIX}}
			--disable-relocatable
			--work-path={{WRKDIR}}/build
			--processors={{MAKE_JOBS_NUMBER}}

post-patch:
	${RM} ${WRKSRC}/src/*.orig
	${REINPLACE_CMD} -e 's|"-march=x86-64",||g' -e '/for Object_Dir/d' \
		${WRKSRC}/gnat/apq-odbc.gpr.in
	${REINPLACE_CMD} -e 's|processors=2|gprbuild_params="--autoconf=apq.cgpr"|' \
		${WRKSRC}/configure
	${REINPLACE_CMD} -e 's|-ws|-ws --autoconf=dummy.cgpr|' \
		${WRKSRC}/scripts/buildutil.sh

post-extract:
	${RM} ${WRKSRC}/src/test.adb
	${ECHO} 3.2.0 > ${WRKSRC}/version

do-install:
	${MKDIR} ${STAGEDIR}${PREFIX}/lib/gnat \
		${STAGEDIR}${PREFIX}/lib/apq-odbc/static \
		${STAGEDIR}${PREFIX}/include/apq-odbc
	${INSTALL_DATA} ${WRKDIR}/build/src/apq-odbc/* \
		${STAGEDIR}${PREFIX}/include/apq-odbc
	${INSTALL_DATA} ${WRKDIR}/build/lib/apq-odbc/static/*.a* \
		${STAGEDIR}${PREFIX}/lib/apq-odbc/static
	${INSTALL_DATA} ${WRKDIR}/build/lib/gnat/apq-odbc.gpr \
		${STAGEDIR}${PREFIX}/lib/gnat

[FILE:118:descriptions/desc.single]
APQ is a database interface library written in Ada95, and this package
contains the ODBC driver that is used with it.


[FILE:101:distinfo]
abdcb427d194a75eb8631ea1ff9d8d78a913cc6373971fffdd59d111bc66a808        18781 apq-odbc-3.2.0.tar.bz2


[FILE:205:manifests/plist.single]
include/apq-odbc/
 apq-odbc-client.adb
 apq-odbc-client.ads
 apq-odbc.adb
 apq-odbc.ads
 odbc_lib.c
 odbc_lib.h
lib/apq-odbc/static/
 apq-odbc-client.ali
 apq-odbc.ali
 libapq-odbc.a
lib/gnat/apq-odbc.gpr


[FILE:2032:patches/patch-src_odbc__lib.c]
--- src/odbc_lib.c.orig	2012-01-10 14:17:05.000000000 -0500
+++ src/odbc_lib.c
@@ -1,3 +1,5 @@
+#include <stdlib.h>
+#include <string.h>
 #include "odbc_lib.h"
 
 
@@ -43,10 +45,10 @@ void login_Information_Set_Up (ODBC_Logi
 
 int get_Login_String_Size (ODBC_Login_Information* login_Information) {
 
+  int total_Size = 0;
   if (!is_Ready(login_Information))
     return(-1);
 
-  int total_Size = 0;
   total_Size += strlen(login_Information->p_Formatted_User_Name);
   total_Size += strlen(login_Information->p_Formatted_Password);
   total_Size += strlen(login_Information->p_Formatted_Data_Source);
@@ -75,6 +77,7 @@ int print_Login_String (ODBC_Login_Infor
   strcat(destiny, login_Information->p_Formatted_User_Name);
   strcat(destiny, login_Information->p_Formatted_Password);
   strcat(destiny, login_Information->p_Formatted_Data_Source);
+  return(0);
 }
 
 void reset_Login_Information (ODBC_Login_Information* login_Information) {
@@ -241,7 +244,7 @@ void connect_With_Data_Source (ODBC_Faca
 		     + 1);
 
   if (SQL_SUCCEEDED(SQLDriverConnect(odbc_Facade->connection_Handle, NULL,
-				     login_String, SQL_NTS, NULL, 0, NULL,
+                           (SQLCHAR*)login_String, SQL_NTS, NULL, 0, NULL,
 				     SQL_DRIVER_NOPROMPT)))
     switch_On_Connection(odbc_Facade);
 
@@ -273,14 +276,14 @@ ODBC_Query_Results* create_And_Run_SQL_S
 //TODO: Return error string instead of printing it?
 void p_Print_Error_Information (ODBC_Facade* odbc_Facade) {
 
-  char ercode[6];
+  SQLCHAR     ercode[6];
   SQLINTEGER  err;
-  char error[250];
+  SQLCHAR     error[250];
   SQLSMALLINT size;
 
   SQLGetDiagRec(SQL_HANDLE_DBC, odbc_Facade->environment_Handle, 1, ercode,
 		&err, error, 250, &size);
-  printf ("\n%d, %s - %s\n", err, ercode, error);
+  printf ("\n%d, %s - %s\n", (int)err, ercode, error);
 }
 
 
@@ -289,4 +292,5 @@ void p_Print_Error_Information (ODBC_Fac
 char* alloc_String (int size) {
   char* return_Value = malloc(sizeof(char) * size);
   *return_Value = '\0';
+  return return_Value;
 }


[FILE:621:patches/patch-src_odbc__lib.h]
--- src/odbc_lib.h.orig	2012-01-10 14:17:05.000000000 -0500
+++ src/odbc_lib.h
@@ -43,7 +43,7 @@ struct odbc_login_information {
 };
 
 //Public methods for ODBC_Login_Information.
-ODBC_Login_Information* new_ODBC_Login_Information ();
+ODBC_Login_Information* new_ODBC_Login_Information (void);
 
 void set_User_Name (ODBC_Login_Information* login_Information,
 		    char* new_User_Name);
@@ -126,7 +126,7 @@ struct odbc_facade {
   ODBC_Login_Information* login_Information;
 };
 
-ODBC_Facade* new_ODBC_Facade ();
+ODBC_Facade* new_ODBC_Facade (void);
 
 void set_Up_Environment_Handle (ODBC_Facade* odbc_Facade);
 

