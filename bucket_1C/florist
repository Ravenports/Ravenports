# Buildsheet autogenerated by ravenadm tool -- Do not edit.

NAMEBASE=		florist
VERSION=		22.0.0
KEYWORDS=		devel ada
VARIANTS=		std
SDESC[std]=		POSIX Ada binding, IEEE Standards 1003.5(b,c)
HOMEPAGE=		none
CONTACT=		John_Marino[draco@marino.st]

DOWNLOAD_GROUPS=	main
SITES[main]=		GITHUB/AdaCore:florist:8ab2d57
DISTFILE[1]=		generated:main
DF_INDEX=		1
SPKGS[std]=		set
			primary
			dev

OPTIONS_AVAILABLE=	none
OPTIONS_STANDARD=	none

USES=			gprbuild gmake ada:primary

LICENSE=		GPLv2+:primary
LICENSE_TERMS=		primary:{{WRKDIR}}/TERMS
LICENSE_FILE=		GPLv2+:{{WRKSRC}}/COPYING
LICENSE_AWK=		TERMS:"^$$"
LICENSE_SOURCE=		TERMS:{{WRKSRC}}/libsrc/posix.adb
LICENSE_SCHEME=		solo

MUST_CONFIGURE=		gnu
CONFIGURE_ARGS=		--enable-shared

SINGLE_JOB=		yes

INSTALL_REQ_TOOLCHAIN=	yes

post-extract-midnightbsd:
	${CP} ${WRKSRC}/configs/pconfig.FreeBSD ${WRKSRC}/configs/pconfig.${OPSYS}

post-install:
	${STRIP_CMD} ${STAGEDIR}${PREFIX}/lib/libflorist.so

post-extract-dragonfly:
	${CP} ${WRKSRC}/configs/pconfig.FreeBSD ${WRKSRC}/configs/pconfig.${OPSYS}

post-extract-netbsd:
	${CP} ${WRKSRC}/configs/pconfig.FreeBSD ${WRKSRC}/configs/pconfig.${OPSYS}

[FILE:597:descriptions/desc.primary]
Florist was produced by students and faculty of the Florida State University
Department of Computer Science, under contract to the US Department of
Defense, Defense Information Systems Agency, as a product of the POSIX Ada
Real-Time (PART) Project. When the contract was completed, in 1999, FSU turned
maintenance of Florist over to Ada Core Technologies, Inc.). The latest and
most complete free version is available from Adacore.

FLORIST is an implementation of the IEEE Standards 1003.5: 1992,
IEEE STD 1003.5b: 1996, and parts of IEEE STD 1003.5c: 1998, also known as
the POSIX Ada Bindings.


[FILE:109:distinfo]
672ab04fcf7c3077d3b2715638b25b8889ee6ead61ed061000962bb40a457908       404736 AdaCore-florist-8ab2d57.tar.gz


[FILE:48:manifests/plist.primary]
lib/libflorist.so.1
lib/florist/libflorist.so.1


[FILE:5268:manifests/plist.dev]
include/florist/
 ada_streams.ads
 ada_task_identification.ads
 config.h
 pconfig.h
 posix-asynchronous_io.adb
 posix-asynchronous_io.ads
 posix-c.adb
 posix-c.ads
 posix-calendar.adb
 posix-calendar.ads
 posix-condition_variables.adb
 posix-condition_variables.ads
 posix-configurable_file_limits.adb
 posix-configurable_file_limits.ads
 posix-configurable_system_limits.adb
 posix-configurable_system_limits.ads
 posix-error_codes.ads
 posix-file_locking.adb
 posix-file_locking.ads
 posix-file_status-extensions.adb
 posix-file_status-extensions.ads
 posix-file_status.adb
 posix-file_status.ads
 posix-files.adb
 posix-files.ads
 posix-generic_shared_memory.adb
 posix-generic_shared_memory.ads
 posix-group_database.adb
 posix-group_database.ads
 posix-implementation-ok_signals.ads
 posix-implementation.adb
 posix-implementation.ads
 posix-io.adb
 posix-io.ads
 posix-limits.ads
 posix-macros-sockets.c
 posix-macros.c
 posix-memory_locking.adb
 posix-memory_locking.ads
 posix-memory_mapping.adb
 posix-memory_mapping.ads
 posix-memory_range_locking.adb
 posix-memory_range_locking.ads
 posix-message_queues.adb
 posix-message_queues.ads
 posix-mutexes.adb
 posix-mutexes.ads
 posix-options.ads
 posix-page_alignment.adb
 posix-page_alignment.ads
 posix-permissions-implementation.adb
 posix-permissions-implementation.ads
 posix-permissions.adb
 posix-permissions.ads
 posix-process_environment.adb
 posix-process_environment.ads
 posix-process_identification.adb
 posix-process_identification.ads
 posix-process_primitives.adb
 posix-process_primitives.ads
 posix-process_scheduling.adb
 posix-process_scheduling.ads
 posix-process_times.adb
 posix-process_times.ads
 posix-semaphores.adb
 posix-semaphores.ads
 posix-shared_memory_objects.adb
 posix-shared_memory_objects.ads
 posix-signals.adb
 posix-signals.ads
 posix-supplement_to_ada_io.adb
 posix-supplement_to_ada_io.ads
 posix-terminal_functions.adb
 posix-terminal_functions.ads
 posix-timers-extensions.adb
 posix-timers-extensions.ads
 posix-timers.adb
 posix-timers.ads
 posix-unsafe_process_primitives.adb
 posix-unsafe_process_primitives.ads
 posix-user_database.adb
 posix-user_database.ads
 posix.adb
 posix.ads
 posix_asynchronous_io.ads
 posix_c.ads
 posix_calendar.ads
 posix_condition_variables.ads
 posix_configurable_file_limits.ads
 posix_configurable_system_limits.ads
 posix_error_codes.ads
 posix_file_locking.ads
 posix_file_status.ads
 posix_files.ads
 posix_generic_shared_memory.ads
 posix_group_database.ads
 posix_io.ads
 posix_limits.ads
 posix_memory_locking.ads
 posix_memory_mapping.ads
 posix_memory_range_locking.ads
 posix_message_queues.ads
 posix_mutexes.ads
 posix_options.ads
 posix_page_alignment.ads
 posix_permissions.ads
 posix_process_environment.ads
 posix_process_identification.ads
 posix_process_primitives.ads
 posix_process_scheduling.ads
 posix_process_times.ads
 posix_semaphores.ads
 posix_shared_memory_objects.ads
 posix_signals.ads
 posix_supplement_to_ada_io.ads
 posix_terminal_functions.ads
 posix_timers.ads
 posix_unsafe_process_primitives.ads
 posix_user_database.ads
 system_storage_elements.ads
lib/libflorist.so
lib/florist/
 ada_streams.ali
 ada_task_identification.ali
 libflorist.a
 libflorist.so
 posix-asynchronous_io.ali
 posix-c.ali
 posix-calendar.ali
 posix-condition_variables.ali
 posix-configurable_file_limits.ali
 posix-configurable_system_limits.ali
 posix-error_codes.ali
 posix-file_locking.ali
 posix-file_status-extensions.ali
 posix-file_status.ali
 posix-files.ali
 posix-generic_shared_memory.ali
 posix-group_database.ali
 posix-implementation-ok_signals.ali
 posix-implementation.ali
 posix-io.ali
 posix-limits.ali
 posix-memory_locking.ali
 posix-memory_mapping.ali
 posix-memory_range_locking.ali
 posix-message_queues.ali
 posix-mutexes.ali
 posix-options.ali
 posix-page_alignment.ali
 posix-permissions-implementation.ali
 posix-permissions.ali
 posix-process_environment.ali
 posix-process_identification.ali
 posix-process_primitives.ali
 posix-process_scheduling.ali
 posix-process_times.ali
 posix-semaphores.ali
 posix-shared_memory_objects.ali
 posix-signals.ali
 posix-supplement_to_ada_io.ali
 posix-terminal_functions.ali
 posix-timers-extensions.ali
 posix-timers.ali
 posix-unsafe_process_primitives.ali
 posix-user_database.ali
 posix.ali
 posix_asynchronous_io.ali
 posix_c.ali
 posix_calendar.ali
 posix_condition_variables.ali
 posix_configurable_file_limits.ali
 posix_configurable_system_limits.ali
 posix_error_codes.ali
 posix_file_locking.ali
 posix_file_status.ali
 posix_files.ali
 posix_generic_shared_memory.ali
 posix_group_database.ali
 posix_io.ali
 posix_limits.ali
 posix_memory_locking.ali
 posix_memory_mapping.ali
 posix_memory_range_locking.ali
 posix_message_queues.ali
 posix_mutexes.ali
 posix_options.ali
 posix_page_alignment.ali
 posix_permissions.ali
 posix_process_environment.ali
 posix_process_identification.ali
 posix_process_primitives.ali
 posix_process_scheduling.ali
 posix_process_times.ali
 posix_semaphores.ali
 posix_shared_memory_objects.ali
 posix_signals.ali
 posix_supplement_to_ada_io.ali
 posix_terminal_functions.ali
 posix_timers.ali
 posix_unsafe_process_primitives.ali
 posix_user_database.ali
 system_storage_elements.ali
share/gpr/florist.gpr


[FILE:628:patches/patch-Makefile.in]
--- Makefile.in.orig	2023-03-02 16:00:46 UTC
+++ Makefile.in
@@ -189,9 +189,11 @@ distclean: clean
 # make all files read-only to prevent recompilation
 install-%:
 	gprinstall -Pflorist $(PROJECT_FLAGS) -XLIBRARY_TYPE=$* -a -p -f   \
-		--prefix=$(PREFIX) --sources-subdir=floristlib             \
-		--lib-subdir=floristlib --link-lib-subdir=floristlib       \
+		--no-manifests \
+		--prefix=$(DESTDIR)$(PREFIX) \
+		--sources-subdir=include/florist \
+		--lib-subdir=lib/florist \
+		--link-lib-subdir=lib \
 		--build-name=$*
-	chmod a-w $(PREFIX)/floristlib/*
 
 .PHONY: all install clean distclean regen floristlib force


[FILE:678:patches/patch-c-posix-signals.c]
--- c-posix-signals.c.orig	2023-03-02 16:00:46 UTC
+++ c-posix-signals.c
@@ -468,9 +468,9 @@ int guess_nsigs () {
  */
 
 #if defined(__APPLE__)
-# define BADSIG (0)
+# define FLOR_BADSIG (0)
 #else
-# define BADSIG (-1)
+# define FLOR_BADSIG (-1)
 #endif
 
    sigset_t set;
@@ -484,7 +484,7 @@ int guess_nsigs () {
       result = sigismember (&set, sig);
       if (result == 1) {
          last_good = sig;
-      } else if ((result == BADSIG) && (first_bad == -1)) {
+      } else if ((result == FLOR_BADSIG) && (first_bad == -1)) {
          if (sig == 0) {
             fprintf (stderr, "WARNING: C library problem? "
              "sigfillset does not include zero\n");


[FILE:1704:patches/patch-c-posix.c]
--- c-posix.c.orig	2023-03-02 16:00:46 UTC
+++ c-posix.c
@@ -59,6 +59,7 @@
 #include <stdarg.h>
 #include <string.h>
 #include <stdlib.h>
+#include <ctype.h>
 #include "confsrc/config.h"
 
 #ifdef __hpux__
@@ -722,6 +723,25 @@ typedef struct siginfo {
 
 /* sigevent must precede aiocb
  */
+#if defined(__DragonFly__)
+/*
+ * union _sigev_info {
+ *  int   sigev_signo;
+ *  int   sigev_notify_kqueue;
+ *  void *sigev_notify_attributes;
+ * };
+ * sizeof(union _sigev_info) = sizeof(int)
+ * Use "int" rather than fooling with union
+ * For simplicity, The Ada part is only going to list sigev_signo
+ * as the other two elements of the union are unused.
+ */
+  GT1(sigevent, 1)
+  GT2(sigev_notify, int)
+  GT2(sigev_signo, int)
+  GT2(sigev_value, union sigval)
+  GT2(sigev_notify_function, void (*)(union sigval))
+  GT3
+#else  /* __DragonFly__ */
 #ifdef HAVE_struct_sigevent
   GT1(sigevent, 1)
 #else
@@ -744,6 +764,7 @@ struct sigevent {
   GT2(sigev_notify_attributes,pthread_attr_t *)
 #endif
   GT3
+#endif /* __DragonFly__ */
 
 #ifdef HAVE_struct_aiocb
   GT1(aiocb, 1)
@@ -5206,9 +5227,9 @@ void create_c() {
  */
 
 #if defined(__APPLE__)
-# define BADSIG 0
+# define FLOR_BADSIG 0
 #else
-# define BADSIG (-1)
+# define FLOR_BADSIG (-1)
 #endif
 {sigset_t set;
   int sig;
@@ -5219,7 +5240,7 @@ void create_c() {
   for (sig = 0; sig < 1024; sig++) {
     result = sigismember (&set, sig);
     if (result == 1) last_good = sig;
-    else if ((result == BADSIG) && (first_bad = -1)) first_bad = sig;
+    else if ((result == FLOR_BADSIG) && (first_bad = -1)) first_bad = sig;
   }
   if (last_good == 1023)
     printf("c-posix: WARNING: signal range estimate probably too small\n");


[FILE:425:patches/patch-configure]
--- configure.orig	2023-03-02 16:00:46 UTC
+++ configure
@@ -2797,7 +2797,7 @@ UNAME_VERSION=`(uname -v) 2>/dev/null`
 
 echo ${UNAME_SYSTEM} ${UNAME_MACHINE} ${UNAME_RELEASE} ${UNAME_VERSION}
 echo "Using Configuration for" ${UNAME_SYSTEM} ${UNAME_RELEASE};
-cp ./configs/pconfig.Linux ./pconfig.h.in;
+cp ./configs/pconfig.${UNAME_SYSTEM} ./pconfig.h.in;
 
 if test "x$safe_errno" = "xTrue" ; then
   safe_errno_msg="safe"


[FILE:996:patches/patch-florist.gpr]
--- florist.gpr.orig	2023-03-02 16:00:46 UTC
+++ florist.gpr
@@ -21,7 +21,7 @@ library project Florist is
    Version := "1";
    for Library_version use "libflorist.so." & Version;
 
-   type Library_Type_Type is ("relocatable", "static");
+   type Library_Type_Type is ("relocatable", "static", "static-pic");
    Library_Type : Library_Type_Type := external ("LIBRARY_TYPE", "static");
    for Library_Kind use Library_Type;
 
@@ -31,14 +31,14 @@ library project Florist is
    package Compiler is
 
       Ada_Flags  := ("-O2", "-gnatp", "-gnat95");
-      GNAT_Flags := Ada_Flags & ("-gnatg");
+      GNAT_Flags := Ada_Flags;
 
       case Build is
          when "Production" =>
             --  Use above defaults
          when "Debug" =>
             Ada_Flags  := ("-g", "-O2", "-gnatwae", "-gnatyg", "-gnatw.Z");
-            GNAT_Flags := ("-g", "-O2", "-gnatpg");
+            GNAT_Flags := ("-g", "-O2");
       end case;
 
       for Switches ("posix-signals.adb") use GNAT_Flags;

