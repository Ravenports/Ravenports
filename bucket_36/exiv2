# Buildsheet autogenerated by ravenadm tool -- Do not edit.

NAMEBASE=		exiv2
VERSION=		0.27.5
REVISION=		1
KEYWORDS=		graphics
VARIANTS=		standard
SDESC[standard]=	Exif and Iptc metadata manipulation library
HOMEPAGE=		https://exiv2.org/
CONTACT=		nobody

DOWNLOAD_GROUPS=	main
SITES[main]=		GITHUB/Exiv2:exiv2:v0.27.5
DISTFILE[1]=		generated:main
DF_INDEX=		1
SPKGS[standard]=	complete
			primary
			examples
			nls

OPTIONS_AVAILABLE=	none
OPTIONS_STANDARD=	none

USES=			cpe cmake iconv zlib c++:primary,examples expat
			gettext-runtime gettext-tools

LICENSE=		GPLv2+:primary
LICENSE_TERMS=		primary:{{WRKDIR}}/TERMS
LICENSE_FILE=		GPLv2+:{{WRKSRC}}/COPYING
LICENSE_AWK=		TERMS:"Abstract:"
LICENSE_SOURCE=		TERMS:{{WRKSRC}}/src/exiv2.cpp
LICENSE_SCHEME=		solo

FPC_EQUIVALENT=		graphics/exiv2

PLIST_SUB=		SOVERSION=0.27.5
			SOMAJOR=27

CXXFLAGS=		-Wno-deprecated-declarations
CMAKE_ARGS=		-DEXIV2_ENABLE_VIDEO:BOOL=ON
			-DEXIV2_BUILD_PO:BOOL=ON
			-DEXIV2_BUILD_DOC:BOOL=OFF
			-DEXIV2_BUILD_SAMPLES:BOOL=ON
			-DEXIV2_ENABLE_EXTERNAL_XMP:BOOL=OFF
			-DEXIV2_ENABLE_WEBREADY:BOOL=OFF
			-DEXIV2_ENABLE_NLS:BOOL=ON

post-install:
	${STRIP_CMD} ${STAGEDIR}${PREFIX}/bin/*
	${STRIP_CMD} ${STAGEDIR}${PREFIX}/lib/libexiv2.so

[FILE:287:descriptions/desc.primary]
Exiv2 is a C++ library and a command line utility to manage image metadata.
It provides fast and easy read and write access to the Exif, IPTC, and XMP
metadata of images in various formats. Exiv2 is available as free software
and with a commercial license, and is used in many projects.


[FILE:104:distinfo]
1da1721f84809e4d37b3f106adb18b70b1b0441c860746ce6812bb3df184ed6c     32407707 Exiv2-exiv2-0.27.5.tar.gz


[FILE:934:manifests/plist.primary]
bin/exiv2
include/exiv2/
 asfvideo.hpp
 basicio.hpp
 bmffimage.hpp
 bmpimage.hpp
 config.h
 convert.hpp
 cr2image.hpp
 crwimage.hpp
 datasets.hpp
 easyaccess.hpp
 epsimage.hpp
 error.hpp
 exif.hpp
 exiv2.hpp
 exiv2lib_export.h
 exv_conf.h
 futils.hpp
 gifimage.hpp
 http.hpp
 image.hpp
 ini.hpp
 iptc.hpp
 jp2image.hpp
 jpgimage.hpp
 matroskavideo.hpp
 metadatum.hpp
 mrwimage.hpp
 orfimage.hpp
 pgfimage.hpp
 pngimage.hpp
 preview.hpp
 properties.hpp
 psdimage.hpp
 quicktimevideo.hpp
 rafimage.hpp
 riffvideo.hpp
 rw2image.hpp
 rwlock.hpp
 slice.hpp
 ssh.hpp
 tags.hpp
 tgaimage.hpp
 tiffimage.hpp
 types.hpp
 utilsvideo.hpp
 value.hpp
 version.hpp
 webpimage.hpp
 xmp_exiv2.hpp
 xmpsidecar.hpp
lib/
 libexiv2-xmp.a
 libexiv2.so
 libexiv2.so.%%SOMAJOR%%
 libexiv2.so.%%SOVERSION%%
lib/cmake/exiv2/
 exiv2Config-%%CMAKE_BUILD_TYPE%%.cmake
 exiv2Config.cmake
 exiv2ConfigVersion.cmake
lib/pkgconfig/exiv2.pc
share/man/man1/exiv2.1.gz


[FILE:170:manifests/plist.examples]
bin/
 addmoddel
 exifcomment
 exifdata
 exifprint
 exifvalue
 exiv2json
 geotag
 iptceasy
 iptcprint
 metacopy
 mrwthumb
 taglist
 xmpdump
 xmpparse
 xmpprint
 xmpsample


[FILE:629:manifests/plist.nls]
share/locale/bs/LC_MESSAGES/exiv2.mo
share/locale/ca/LC_MESSAGES/exiv2.mo
share/locale/de/LC_MESSAGES/exiv2.mo
share/locale/es/LC_MESSAGES/exiv2.mo
share/locale/fi/LC_MESSAGES/exiv2.mo
share/locale/fr/LC_MESSAGES/exiv2.mo
share/locale/gl/LC_MESSAGES/exiv2.mo
share/locale/ms/LC_MESSAGES/exiv2.mo
share/locale/nl/LC_MESSAGES/exiv2.mo
share/locale/pl/LC_MESSAGES/exiv2.mo
share/locale/pt/LC_MESSAGES/exiv2.mo
share/locale/ru/LC_MESSAGES/exiv2.mo
share/locale/sk/LC_MESSAGES/exiv2.mo
share/locale/sv/LC_MESSAGES/exiv2.mo
share/locale/ug/LC_MESSAGES/exiv2.mo
share/locale/uk/LC_MESSAGES/exiv2.mo
share/locale/vi/LC_MESSAGES/exiv2.mo


[FILE:680:patches/patch-cmake_config.h.cmake]
$NetBSD: patch-cmake_config.h.cmake,v 1.1 2019/10/25 09:44:26 kamil Exp $

--- cmake/config.h.cmake.orig	2021-06-15 14:08:36 UTC
+++ cmake/config.h.cmake
@@ -35,7 +35,17 @@
 
 /* Define to `const' or to empty, depending on the second argument of `iconv'. */
 #cmakedefine ICONV_ACCEPTS_CONST_INPUT
-#if defined(ICONV_ACCEPTS_CONST_INPUT) || defined(__NetBSD__)
+
+#if defined(__NetBSD__)
+#include <sys/param.h>
+#if __NetBSD_Prereq__(9,99,17)
+#define NETBSD_POSIX_ICONV 1
+#else
+#define NETBSD_POSIX_ICONV 0
+#endif
+#endif
+
+#if defined(ICONV_ACCEPTS_CONST_INPUT) || (defined(__NetBSD__) && !NETBSD_POSIX_ICONV)
 #define EXV_ICONV_CONST const
 #else
 #define EXV_ICONV_CONST


[FILE:448:patches/patch-include_exiv2_types.hpp]
$NetBSD: patch-include_exiv2_types.hpp,v 1.1 2018/01/29 09:58:34 jperkin Exp $

Remove bogus forward declaration.

--- include/exiv2/types.hpp.orig	2021-06-15 14:08:36 UTC
+++ include/exiv2/types.hpp
@@ -81,7 +81,6 @@
 
 // *****************************************************************************
 // forward declarations
-struct tm;
 
 // *****************************************************************************
 // namespace extensions


[FILE:1014:patches/patch-src_convert.cpp]
$NetBSD: patch-src_convert.cpp,v 1.2 2019/10/25 09:44:26 kamil Exp $

Support NetBSD and SunOS iconv being special.

--- src/convert.cpp.orig	2021-06-15 14:08:36 UTC
+++ src/convert.cpp
@@ -1545,11 +1545,19 @@ namespace {
             char outbuf[256];
             char* outptr = outbuf;
             size_t outbytesleft = sizeof(outbuf);
+#if (defined(__NetBSD__) && !NETBSD_POSIX_ICONV) || defined(__sun)
+            size_t rc = iconv(cd,
+                              const_cast<char **>(&inptr),
+                              &inbytesleft,
+                              &outptr,
+                              &outbytesleft);
+#else
             size_t rc = iconv(cd,
                               &inptr,
                               &inbytesleft,
                               &outptr,
                               &outbytesleft);
+#endif
             const size_t outbytesProduced = sizeof(outbuf) - outbytesleft;
             if (rc == size_t(-1) && errno != E2BIG) {
 #ifndef SUPPRESS_WARNINGS

