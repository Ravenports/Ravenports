# Buildsheet autogenerated by ravenadm tool -- Do not edit.

NAMEBASE=		mbedtls
VERSION=		4.0.0
KEYWORDS=		security devel
VARIANTS=		std
SDESC[std]=		Light-weight cryptographic and SSL/TLS library
HOMEPAGE=		https://www.trustedfirmware.org/projects/mbed-tls/
CONTACT=		nobody

DOWNLOAD_GROUPS=	main crypto framework subframe
SITES[main]=		GITHUB/ARMmbed:mbedtls:v4.0.0
SITES[crypto]=		GITHUB/Mbed-TLS:TF-PSA-Crypto:cb9d0ed:tf-psa-crypto
SITES[framework]=	GITHUB/Mbed-TLS:mbedtls-framework:f58263d:framework
SITES[subframe]=	GITHUB/Mbed-TLS:mbedtls-framework:1726775:tf-psa-crypto/framework
DISTFILE[1]=		generated:main
DISTFILE[2]=		generated:framework
DISTFILE[3]=		generated:crypto
DISTFILE[4]=		generated:subframe
DF_INDEX=		1 2 3 4
SPKGS[std]=		set
			primary
			tools
			dev

OPTIONS_AVAILABLE=	none
OPTIONS_STANDARD=	none

BUILD_DEPENDS=		python-Jinja2:single:python_used
			python-jsonschema:single:python_used
EXRUN[tools]=		mbedtls:primary:std

USES=			cpe cmake perl:build python:build

LICENSE=		APACHE20:primary GPLv2+:primary
LICENSE_TERMS=		primary:{{WRKDIR}}/TERMS
LICENSE_FILE=		APACHE20:stock
			GPLv2+:stock
LICENSE_AWK=		TERMS:"^The full text of each"
LICENSE_SOURCE=		TERMS:{{WRKSRC}}/LICENSE
LICENSE_SCHEME=		dual

CPE_PRODUCT=		mbed_tls
CPE_VENDOR=		arm
FPC_EQUIVALENT=		security/mbedtls3

SOVERSION=		4.0.0
PLIST_SUB=		SO_TLS=22
			SO_509=8
			SO_CRYPTO=17
			SO_TFPSA=1.0.0
			SO_TFPSAMAJ=1

CMAKE_ARGS=		-DENABLE_TESTING:BOOL=OFF
			-DUSE_SHARED_MBEDTLS_LIBRARY:BOOL=ON
VAR_OPSYS[sunos]=	LDFLAGS=-lsocket

post-install:
	# correct obvious bug in CMakeList.txt wrt DESTDIR
	${MV} ${PREFIX}/lib/libmbedcrypto.so ${STAGEDIR}${PREFIX}/lib/
	${MV} ${PREFIX}/lib/libmbedcrypto.so.17 ${STAGEDIR}${PREFIX}/lib/
	${STRIP_CMD} ${STAGEDIR}${PREFIX}/lib/lib*.so
	${FIND} ${STAGEDIR}${PREFIX}/bin -type f | while read f; \
	do \
	  check=$$(file "$$f" | grep "dynamically linked"); \
	  if [ -n "$$check" ]; then \
	    ${STRIP_CMD} "$$f"; \
	  fi; \
	done

[FILE:273:descriptions/desc.primary]
Mbed TLS is a C library that implements cryptographic primitives, X.509
certificate manipulation and the SSL/TLS and DTLS protocols. Its small
code footprint makes it suitable for embedded systems.

Mbed TLS includes a reference implementation of the PSA Cryptography API.


[FILE:58:descriptions/desc.tools]
This packages contains tools powered by Mbed TLS library.


[FILE:463:distinfo]
f4460881faaa71bc573f473bb5c4493af28bbdb84b281d119ef8978184c3d291      1212283 ARMmbed-mbedtls-4.0.0.tar.gz
83a73488651dfbb462877277f14b29b943ec80251963c69bf57e0a33a19c9f57       955089 Mbed-TLS-mbedtls-framework-f58263d.tar.gz
fe12d7f9f6192c5fa53819196630e60d4c6a2e7fc4388a8eb7c18b6d2bec85c4      3544216 Mbed-TLS-TF-PSA-Crypto-cb9d0ed.tar.gz
9887b7a5fc7dfe13dd8d088c70e97df43acf0badd490b24ad86f7837d7a556f8       952660 Mbed-TLS-mbedtls-framework-1726775.tar.gz


[FILE:248:manifests/plist.primary]
lib/
 libmbedcrypto.so.%%SOVERSION%%
 libmbedcrypto.so.%%SO_CRYPTO%%
 libmbedtls.so.%%SOVERSION%%
 libmbedtls.so.%%SO_TLS%%
 libmbedx509.so.%%SOVERSION%%
 libmbedx509.so.%%SO_509%%
 libtfpsacrypto.so.%%SO_TFPSA%%
 libtfpsacrypto.so.%%SO_TFPSAMAJ%%


[FILE:445:manifests/plist.tools]
bin/
 aead_demo
 cert_app
 cert_req
 cert_write
 crl_app
 crypto_examples
 dtls_client
 dtls_server
 hmac_demo
 key_ladder_demo
 key_ladder_demo.sh
 load_roots
 metatest
 mini_client
 pem2der
 psa_constant_names
 psa_hash
 query_compile_time_config
 query_included_headers
 req_app
 selftest
 ssl_client1
 ssl_client2
 ssl_context_info
 ssl_fork_server
 ssl_mail_client
 ssl_pthread_server
 ssl_server
 ssl_server2
 strerror
 udp_proxy
 zeroize


[FILE:2608:manifests/plist.dev]
include/mbedtls/
 asn1.h
 asn1write.h
 base64.h
 build_info.h
 compat-3-crypto.h
 constant_time.h
 debug.h
 error.h
 lms.h
 mbedtls_config.h
 md.h
 memory_buffer_alloc.h
 net_sockets.h
 nist_kw.h
 oid.h
 pem.h
 pk.h
 pkcs7.h
 platform.h
 platform_time.h
 platform_util.h
 private_access.h
 psa_util.h
 ssl.h
 ssl_cache.h
 ssl_ciphersuites.h
 ssl_cookie.h
 ssl_ticket.h
 threading.h
 timing.h
 version.h
 x509.h
 x509_crl.h
 x509_crt.h
 x509_csr.h
include/mbedtls/private/
 aes.h
 aria.h
 bignum.h
 block_cipher.h
 camellia.h
 ccm.h
 chacha20.h
 chachapoly.h
 cipher.h
 cmac.h
 config_adjust_ssl.h
 config_adjust_test_accelerators.h
 config_adjust_x509.h
 crypto_adjust_config_enable_builtins.h
 crypto_adjust_config_tweak_builtins.h
 ctr_drbg.h
 ecdh.h
 ecdsa.h
 ecjpake.h
 ecp.h
 entropy.h
 error_common.h
 gcm.h
 hmac_drbg.h
 md5.h
 pk_private.h
 pkcs5.h
 poly1305.h
 ripemd160.h
 rsa.h
 sha1.h
 sha256.h
 sha3.h
 sha512.h
include/psa/
 crypto.h
 crypto_builtin_composites.h
 crypto_builtin_key_derivation.h
 crypto_builtin_primitives.h
 crypto_compat.h
 crypto_config.h
 crypto_driver_common.h
 crypto_driver_contexts_composites.h
 crypto_driver_contexts_key_derivation.h
 crypto_driver_contexts_primitives.h
 crypto_driver_random.h
 crypto_extra.h
 crypto_platform.h
 crypto_sizes.h
 crypto_struct.h
 crypto_types.h
 crypto_values.h
include/tf-psa-crypto/
 build_info.h
 version.h
include/tf-psa-crypto/private/
 crypto_adjust_config_auto_enabled.h
 crypto_adjust_config_dependencies.h
 crypto_adjust_config_derived.h
 crypto_adjust_config_key_pair_types.h
 crypto_adjust_config_support.h
 crypto_adjust_config_synonyms.h
include/tf-psa-crypto/private/everest/everest/
 Hacl_Curve25519.h
 everest.h
 kremlib.h
 x25519.h
include/tf-psa-crypto/private/everest/everest/kremlib/
 FStar_UInt128.h
 FStar_UInt64_FStar_UInt32_FStar_UInt16_FStar_UInt8.h
include/tf-psa-crypto/private/everest/everest/kremlin/c_endianness.h
include/tf-psa-crypto/private/everest/everest/kremlin/internal/
 builtin.h
 callconv.h
 compat.h
 debug.h
 target.h
 types.h
 wasmsupport.h
include/tf-psa-crypto/private/everest/everest/vs2013/Hacl_Curve25519.h
lib/
 libmbedcrypto.a
 libmbedcrypto.so
 libmbedtls.a
 libmbedtls.so
 libmbedx509.a
 libmbedx509.so
 libtfpsacrypto.a
 libtfpsacrypto.so
lib/cmake/MbedTLS/
 MbedTLSConfig.cmake
 MbedTLSConfigVersion.cmake
 MbedTLSTargets-release.cmake
 MbedTLSTargets.cmake
lib/cmake/TF-PSA-Crypto/
 TF-PSA-CryptoConfig.cmake
 TF-PSA-CryptoConfigVersion.cmake
 TF-PSA-CryptoTargets-release.cmake
 TF-PSA-CryptoTargets.cmake
lib/pkgconfig/
 mbedcrypto.pc
 mbedtls.pc
 mbedx509.pc
 tfpsacrypto.pc


[FILE:1675:patches/patch-0001]
From 0ff335d715540a164c906a58f850f00c79627b51 Mon Sep 17 00:00:00 2001
From: Ben Taylor <ben.taylor@linaro.org>
Date: Mon, 13 Oct 2025 15:17:44 +0100
Subject: [PATCH] Remove uses of mbedtls_pk_verify_new

Signed-off-by: Ben Taylor <ben.taylor@linaro.org>
---
 library/ssl_tls12_client.c  | 2 +-
 library/ssl_tls13_generic.c | 4 ++--
 2 files changed, 3 insertions(+), 3 deletions(-)

--- library/ssl_tls12_client.c.orig
+++ library/ssl_tls12_client.c
@@ -1995,7 +1995,7 @@ static int ssl_parse_server_key_exchange(mbedtls_ssl_context *ssl)
 
 #if defined(MBEDTLS_X509_RSASSA_PSS_SUPPORT)
         if (pk_alg == MBEDTLS_PK_RSASSA_PSS) {
-            ret = mbedtls_pk_verify_new(pk_alg, peer_pk,
+            ret = mbedtls_pk_verify_ext((mbedtls_pk_sigalg_t) pk_alg, peer_pk,
                                         md_alg, hash, hashlen,
                                         p, sig_len);
         } else
--- library/ssl_tls13_generic.c.orig
+++ library/ssl_tls13_generic.c
@@ -300,13 +300,13 @@ static int ssl_tls13_parse_certificate_verify(mbedtls_ssl_context *ssl,
 
     MBEDTLS_SSL_DEBUG_BUF(3, "verify hash", verify_hash, verify_hash_len);
 
-    if ((ret = mbedtls_pk_verify_new(sig_alg,
+    if ((ret = mbedtls_pk_verify_ext((mbedtls_pk_sigalg_t) sig_alg,
                                      &ssl->session_negotiate->peer_cert->pk,
                                      md_alg, verify_hash, verify_hash_len,
                                      p, signature_len)) == 0) {
         return 0;
     }
-    MBEDTLS_SSL_DEBUG_RET(1, "mbedtls_pk_verify_new", ret);
+    MBEDTLS_SSL_DEBUG_RET(1, "mbedtls_pk_verify_ext", ret);
 
 error:
     /* RFC 8446 section 4.4.3

