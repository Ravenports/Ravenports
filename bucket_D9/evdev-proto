# Buildsheet autogenerated by ravenadm tool -- Do not edit.

NAMEBASE=		evdev-proto
VERSION=		6.1
KEYWORDS=		devel
VARIANTS=		standard
SDESC[standard]=	Input event device header files
HOMEPAGE=		https://github.com/torvalds/linux/
CONTACT=		nobody

DOWNLOAD_GROUPS=	main
SITES[main]=		https://github.com/torvalds/linux/raw/v6.1/include/uapi/linux/
DISTFILE[1]=		input.h:main
DISTFILE[2]=		input-event-codes.h:main
DISTFILE[3]=		uinput.h:main
DISTFILE[4]=		v4l2-common.h:main
DISTFILE[5]=		v4l2-controls.h:main
DISTFILE[6]=		videodev2.h:main
DISTFILE[7]=		joystick.h:main
DISTFILE[8]=		const.h:main
DIST_SUBDIR=		evdev-proto-6.1
DF_INDEX=		1 2 3 4 5 6 7 8
SPKGS[standard]=	single

OPTIONS_AVAILABLE=	none
OPTIONS_STANDARD=	none

NOT_FOR_OPSYS=		darwin

USES=			cpe

LICENSE=		GPLv2:single
LICENSE_TERMS=		single:{{WRKDIR}}/TERMS
LICENSE_FILE=		GPLv2:stock
LICENSE_AWK=		TERMS:"^\#ifndef"
LICENSE_SOURCE=		TERMS:{{WRKSRC}}/input.h
LICENSE_SCHEME=		solo

CPE_PRODUCT=		linux_kernel
CPE_VENDOR=		linux
FPC_EQUIVALENT=		devel/evdev-proto

SKIP_BUILD=		yes

post-patch:
	# fix header for linux too
	${REINPLACE_CMD} -e 's|__user|__attribute__((noderef, address_space(1)))|g' \
		-e '/#include <linux.compiler.h>/d' \
		${WRKSRC}/input.h ${WRKSRC}/videodev2.h
	# create derived headers
	${SED} -E -e \
		's/__u([[:digit:]]+)/uint\1_t/g ; \
		s/__s([[:digit:]]+)/int\1_t/g ; \
		/# *include/ s|<sys/ioctl.h>|<sys/ioccom.h>| ; \
		/# *include[[:space:]]+<linux\/types.h>/d ; \
		/EVIOC(RMFF|GRAB|REVOKE)/ s/_IOW(.*), *int/_IOWINT\1/ ; \
		/EVIOCGKEYCODE/ s/_IOR/_IOWR/ ; \
		/EVIOCGMASK/ s/_IOR/_IOW/ ; \
		/EVIOCGMTSLOTS/ s/_IOC_READ/IOC_INOUT/ ; \
		/#define/ s/_IOC_READ/IOC_OUT/ ; \
		/#define/ s/_IOC_WRITE/IOC_IN/ ; \
		s/[[:space:]]+__user[[:space:]]+/ / ; \
		/__USE_TIME_BITS64/ s|^#if (.*)$$|#if 1 /* \1 */|' \
		${WRKSRC}/input.h > ${WRKDIR}/.headers/input.h.freebsd
.for FF in uinput.h joystick.h
	${SED} -E -e \
		's/__u([[:digit:]]+)/uint\1_t/g ; \
		s/__s([[:digit:]]+)/int\1_t/g ; \
		/# *include/s|<linux/types.h>|<sys/types.h>| ; \
		/#define/ s/_IOW(.*), *int/_IOWINT\1/ ; \
		/#define/ s/_IOW(.*), *char\*/_IO\1/ ; \
		/#define/ s/_IOC_READ/IOC_OUT/' \
		${WRKSRC}/${FF} > ${WRKDIR}/.headers/${FF}.freebsd
.endfor
	${SED} -E -e \
		's/__u([[:digit:]]+)/uint\1_t/g ; \
		s/__s([[:digit:]]+)/int\1_t/g ; \
		/# *include/s|<linux/types.h>|<sys/types.h>|' \
		${WRKSRC}/v4l2-controls.h > ${WRKDIR}/.headers/v4l2-controls.h.freebsd
	${SED} -E -e \
		's/__u([[:digit:]]+)/uint\1_t/g ; \
		/# *include/s|<linux/types.h>|<sys/types.h>|' \
		${WRKSRC}/v4l2-common.h > ${WRKDIR}/.headers/v4l2-common.h.freebsd
	${SED} -E -e \
		's/__u([[:digit:]]+)/uint\1_t/g ; \
		s/__s([[:digit:]]+)/int\1_t/g ; \
		s/__le([[:digit:]]+)/uint\1_t/g ; \
		/#include <linux.compiler.h>/d ; \
		/# *include/ s|<linux/ioctl.h>|<sys/ioccom.h>| ; \
		/# *include/s|<linux/types.h>|<sys/types.h>|' \
		${WRKSRC}/videodev2.h > ${WRKDIR}/.headers/videodev2.h.freebsd

do-extract:
	${MKDIR} ${WRKSRC} ${WRKDIR}/.headers
	${INSTALL_DATA} ${DISTDIR}/${DIST_SUBDIR}/* ${WRKSRC}/

do-install-netbsd:
.for HH in input.h uinput.h v4l2-controls.h v4l2-common.h videodev2.h joystick.h
	${INSTALL_DATA} ${WRKDIR}/.headers/${HH}.freebsd \
		${STAGEDIR}${PREFIX}/include/linux/${HH}
.endfor
	${INSTALL_DATA} \
		${WRKSRC}/input-event-codes.h \
		${WRKSRC}/const.h \
		${STAGEDIR}${PREFIX}/include/linux/

do-install-sunos:
.for HH in input.h uinput.h v4l2-controls.h v4l2-common.h videodev2.h joystick.h
	${INSTALL_DATA} ${WRKDIR}/.headers/${HH}.freebsd \
		${STAGEDIR}${PREFIX}/include/linux/${HH}
.endfor
	${INSTALL_DATA} \
		${WRKSRC}/input-event-codes.h \
		${WRKSRC}/const.h \
		${STAGEDIR}${PREFIX}/include/linux/

do-install-freebsd:
.for HH in input.h uinput.h v4l2-controls.h v4l2-common.h videodev2.h joystick.h
	${INSTALL_DATA} ${WRKDIR}/.headers/${HH}.freebsd \
		${STAGEDIR}${PREFIX}/include/linux/${HH}
.endfor
	${INSTALL_DATA} \
		${WRKSRC}/input-event-codes.h \
		${WRKSRC}/const.h \
		${STAGEDIR}${PREFIX}/include/linux/

do-install-linux:
	${INSTALL_DATA} ${WRKSRC}/*.h ${STAGEDIR}${PREFIX}/include/linux/

do-install-midnightbsd:
.for HH in input.h uinput.h v4l2-controls.h v4l2-common.h videodev2.h joystick.h
	${INSTALL_DATA} ${WRKDIR}/.headers/${HH}.freebsd \
		${STAGEDIR}${PREFIX}/include/linux/${HH}
.endfor
	${INSTALL_DATA} \
		${WRKSRC}/input-event-codes.h \
		${WRKSRC}/const.h \
		${STAGEDIR}${PREFIX}/include/linux/

do-install:
	${MKDIR} ${STAGEDIR}${PREFIX}/include/linux/

do-install-dragonfly:
.for HH in uinput.h v4l2-controls.h v4l2-common.h videodev2.h joystick.h
	${INSTALL_DATA} ${WRKDIR}/.headers/${HH}.freebsd \
		${STAGEDIR}${PREFIX}/include/linux/${HH}
.endfor
	${INSTALL_DATA} \
		/usr/include/compat/linux/input.h \
		/usr/include/compat/linux/input-event-codes.h \
		${WRKSRC}/const.h \
		${STAGEDIR}${PREFIX}/include/linux/
	# additional updates
	(cd ${STAGEDIR}${PREFIX}/include/linux && \
		${PATCH} --backup --forward --quiet -E -p0 --batch \
		< ${FILESDIR}/dfly-input-event-codes.h)
	${RM} ${STAGEDIR}${PREFIX}/include/linux/*.orig

[FILE:101:descriptions/desc.single]
This package contains input event device header files from
linux.  It's used by non-Linux platforms.


[FILE:850:distinfo]
0a5f1fff18970a9e535eacad80677bb4b06e90cec4fc6eb0894d5d5ced51301b        16265 evdev-proto-6.1/input.h
dde1d3ea45cd7f42e643cd9ccd5663156b7c19ba5a1b6ad16a457847fd350b13        29626 evdev-proto-6.1/input-event-codes.h
9123b078f13047c34797332c4f835e5f1e418387e9a950024920faa5a1186974         9276 evdev-proto-6.1/uinput.h
e83918121c875b16eb13946718e34e899b42e99d3805da713c62341a585c54a3         4203 evdev-proto-6.1/v4l2-common.h
61ae00271c4d520ee480749c9894ecf3dd73fc011c8f2e5a4373a2e084e274a3       120516 evdev-proto-6.1/v4l2-controls.h
5256d81005e44c99e1a0e08c751f48ebb59cec4cc44666a9adf9ec68c5378ff7        99195 evdev-proto-6.1/videodev2.h
2e0173c796da0d7537115afae6901e80f5aad6726921afd5a3d2fcdd6ae70a39         3449 evdev-proto-6.1/joystick.h
935dd317c1206d3258c5f8cdddc6552f2377811b0c999e82b5f10b8be3c41cd1         1002 evdev-proto-6.1/const.h


[FILE:121:manifests/plist.single]
include/linux/
 const.h
 input-event-codes.h
 input.h
 joystick.h
 uinput.h
 v4l2-common.h
 v4l2-controls.h
 videodev2.h


[FILE:241:patches/patch-input.h]
--- input.h.orig	2023-01-22 21:02:06 UTC
+++ input.h
@@ -17,6 +17,10 @@
 #include <linux/types.h>
 #endif
 
+#if defined(__NetBSD__)
+#define	_IOWINT(g,n)	_IOC(IOC_VOID, (g), (n), sizeof(int))
+#endif
+
 #include "input-event-codes.h"
 
 /*


[FILE:313:patches/patch-videodev2.h]
--- videodev2.h.orig	2023-01-22 21:02:06 UTC
+++ videodev2.h
@@ -66,6 +66,10 @@
 #include <linux/v4l2-common.h>
 #include <linux/v4l2-controls.h>
 
+#if defined(__NetBSD__)
+#define	_IOWINT(g,n)	_IOC(IOC_VOID, (g), (n), sizeof(int))
+#endif
+
 /*
  * Common stuff for both V4L1 and V4L2
  * Moved from videodev.h


[FILE:659:files/dfly-input-event-codes.h]
--- input-event-codes.h.orig	2021-03-28 18:59:39 UTC
+++ input-event-codes.h
@@ -758,6 +758,15 @@
 
 #define	ABS_MISC		0x28
 
+/*
+ * 0x2e is reserved and should not be used in input drivers.
+ * It was used by HID as ABS_MISC+6 and userspace needs to detect if
+ * the next ABS_* event is correct or is just ABS_MISC + n.
+ * We define here ABS_RESERVED so userspace can rely on it and detect
+ * the situation described above.
+ */
+#define ABS_RESERVED		0x2e
+
 #define	ABS_MT_SLOT		0x2f	/* MT slot being modified */
 #define	ABS_MT_TOUCH_MAJOR	0x30	/* Major axis of touching ellipse */
 #define	ABS_MT_TOUCH_MINOR	0x31	/* Minor axis (omit if circular) */

