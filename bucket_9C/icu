# Buildsheet autogenerated by ravenadm tool -- Do not edit.

NAMEBASE=		icu
VERSION=		60.2
REVISION=		1
KEYWORDS=		devel
VARIANTS=		standard
SDESC[standard]=	International Components for Unicode (from IBM)
HOMEPAGE=		http://site.icu-project.org/
CONTACT=		nobody

DOWNLOAD_GROUPS=	main
SITES[main]=		http://download.icu-project.org/files/icu4c/60.2/
DISTFILE[1]=		icu4c-60_2-src.tgz:main
DF_INDEX=		1
SPKGS[standard]=	single

OPTIONS_AVAILABLE=	none
OPTIONS_STANDARD=	none

USES=			gmake c++:single

DISTNAME=		icu/source

LICENSE=		CUSTOM1:single
LICENSE_NAME=		CUSTOM1:"ICU License"
LICENSE_SCHEME=		solo
LICENSE_FILE=		CUSTOM1:{{WRKDIR}}/icu/LICENSE

FPC_EQUIVALENT=		devel/icu

MUST_CONFIGURE=		gnu
CONFIGURE_ARGS=		--enable-static
			--with-data-packaging=archive
			--disable-renaming
			--disable-samples
			--disable-layoutex

MAKE_ARGS=		VERBOSE=1

PLIST_SUB=		ICUMAJOR=60
			ICUVER=60.2
			ENDIAN="l"

CPPFLAGS=		-DICU_NO_USER_DATA_OVERRIDE
TEST_TARGET=		check

post-install:
	@${STRIP_CMD} ${STAGEDIR}${PREFIX}/bin/g* \
		${STAGEDIR}${PREFIX}/bin/*conv \
		${STAGEDIR}${PREFIX}/bin/icuinfo \
		${STAGEDIR}${PREFIX}/bin/derb \
		${STAGEDIR}${PREFIX}/bin/pkgdata \
		${STAGEDIR}${PREFIX}/sbin/*
	${RM} ${STAGEDIR}${PREFIX}/share/icu/60.2/LICENSE

[FILE:292:descriptions/desc.single]
The International Components for Unicode (ICU) is a mature, widely used
set of C/C++ and Java libraries providing Unicode and Globalization
support for software applications. ICU is widely portable and gives
applications the same results on all platforms and between C/C++ and
Java software.


[FILE:97:distinfo]
f073ea8f35b926d70bb33e6577508aa642a8b316a803f11be20af384811db418     23317835 icu4c-60_2-src.tgz


[FILE:3337:manifests/plist.single]
%%ONLY-DRAGONFLY%%share/icu/%%ICUVER%%/config/mh-bsd-gcc
%%ONLY-FREEBSD%%share/icu/%%ICUVER%%/config/mh-bsd-gcc
%%ONLY-LINUX%%share/icu/%%ICUVER%%/config/mh-linux
bin/
 derb
 genbrk
 gencfu
 gencnval
 gendict
 genrb
 icu-config
 icuinfo
 makeconv
 pkgdata
 uconv
include/unicode/
 alphaindex.h
 appendable.h
 basictz.h
 brkiter.h
 bytestream.h
 bytestrie.h
 bytestriebuilder.h
 calendar.h
 caniter.h
 casemap.h
 char16ptr.h
 chariter.h
 choicfmt.h
 coleitr.h
 coll.h
 compactdecimalformat.h
 curramt.h
 currpinf.h
 currunit.h
 datefmt.h
 dbbi.h
 dcfmtsym.h
 decimfmt.h
 docmain.h
 dtfmtsym.h
 dtintrv.h
 dtitvfmt.h
 dtitvinf.h
 dtptngen.h
 dtrule.h
 edits.h
 enumset.h
 errorcode.h
 fieldpos.h
 filteredbrk.h
 fmtable.h
 format.h
 fpositer.h
 gender.h
 gregocal.h
 icudataver.h
 icuplug.h
 idna.h
 listformatter.h
 localpointer.h
 locdspnm.h
 locid.h
 measfmt.h
 measunit.h
 measure.h
 messagepattern.h
 msgfmt.h
 normalizer2.h
 normlzr.h
 nounit.h
 numberformatter.h
 numfmt.h
 numsys.h
 parseerr.h
 parsepos.h
 platform.h
 plurfmt.h
 plurrule.h
 ptypes.h
 putil.h
 rbbi.h
 rbnf.h
 rbtz.h
 regex.h
 region.h
 reldatefmt.h
 rep.h
 resbund.h
 schriter.h
 scientificnumberformatter.h
 search.h
 selfmt.h
 simpleformatter.h
 simpletz.h
 smpdtfmt.h
 sortkey.h
 std_string.h
 strenum.h
 stringoptions.h
 stringpiece.h
 stringtriebuilder.h
 stsearch.h
 symtable.h
 tblcoll.h
 timezone.h
 tmunit.h
 tmutamt.h
 tmutfmt.h
 translit.h
 tzfmt.h
 tznames.h
 tzrule.h
 tztrans.h
 ubidi.h
 ubiditransform.h
 ubrk.h
 ucal.h
 ucasemap.h
 ucat.h
 uchar.h
 ucharstrie.h
 ucharstriebuilder.h
 uchriter.h
 uclean.h
 ucnv.h
 ucnv_cb.h
 ucnv_err.h
 ucnvsel.h
 ucol.h
 ucoleitr.h
 uconfig.h
 ucsdet.h
 ucurr.h
 udat.h
 udata.h
 udateintervalformat.h
 udatpg.h
 udisplaycontext.h
 uenum.h
 ufieldpositer.h
 uformattable.h
 ugender.h
 uidna.h
 uiter.h
 uldnames.h
 ulistformatter.h
 uloc.h
 ulocdata.h
 umachine.h
 umisc.h
 umsg.h
 unifilt.h
 unifunct.h
 unimatch.h
 unirepl.h
 uniset.h
 unistr.h
 unorm.h
 unorm2.h
 unum.h
 unumsys.h
 uobject.h
 upluralrules.h
 uregex.h
 uregion.h
 ureldatefmt.h
 urename.h
 urep.h
 ures.h
 uscript.h
 usearch.h
 uset.h
 usetiter.h
 ushape.h
 uspoof.h
 usprep.h
 ustdio.h
 ustream.h
 ustring.h
 ustringtrie.h
 utext.h
 utf.h
 utf16.h
 utf32.h
 utf8.h
 utf_old.h
 utmscale.h
 utrace.h
 utrans.h
 utypes.h
 uvernum.h
 uversion.h
 vtzone.h
lib/icu/%%ICUVER%%/
 Makefile.inc
 pkgdata.inc
lib/icu/
 Makefile.inc
 current
 pkgdata.inc
lib/
 libicudata.a
 libicudata.so
 libicudata.so.%%ICUMAJOR%%
 libicudata.so.%%ICUVER%%
 libicui18n.a
 libicui18n.so
 libicui18n.so.%%ICUMAJOR%%
 libicui18n.so.%%ICUVER%%
 libicuio.a
 libicuio.so
 libicuio.so.%%ICUMAJOR%%
 libicuio.so.%%ICUVER%%
 libicutest.a
 libicutest.so
 libicutest.so.%%ICUMAJOR%%
 libicutest.so.%%ICUVER%%
 libicutu.a
 libicutu.so
 libicutu.so.%%ICUMAJOR%%
 libicutu.so.%%ICUVER%%
 libicuuc.a
 libicuuc.so
 libicuuc.so.%%ICUMAJOR%%
 libicuuc.so.%%ICUVER%%
lib/pkgconfig/
 icu-i18n.pc
 icu-io.pc
 icu-uc.pc
sbin/
 escapesrc
 genccode
 gencmn
 gennorm2
 gensprep
 icupkg
share/icu/%%ICUVER%%/
 icudt%%ICUMAJOR%%%%ENDIAN%%.dat
 install-sh
 mkinstalldirs
share/man/man1/
 derb.1.gz
 genbrk.1.gz
 gencfu.1.gz
 gencnval.1.gz
 gendict.1.gz
 genrb.1.gz
 icu-config.1.gz
 makeconv.1.gz
 pkgdata.1.gz
 uconv.1.gz
share/man/man8/
 genccode.8.gz
 gencmn.8.gz
 gensprep.8.gz
 icupkg.8.gz


[FILE:411:patches/patch-common_Makefile.in]
--- common/Makefile.in.orig	2016-03-23 20:50:12 UTC
+++ common/Makefile.in
@@ -146,7 +146,7 @@ install-local: install-headers install-l
 install-library: all-local
 	$(MKINSTALLDIRS) $(DESTDIR)$(libdir)
 ifneq ($(ENABLE_STATIC),)
-	$(INSTALL-L) $(TARGET) $(DESTDIR)$(libdir)
+	$(INSTALL_DATA) $(TARGET) $(DESTDIR)$(libdir)
 endif
 ifneq ($(ENABLE_SHARED),)
 	$(INSTALL-L) $(FINAL_SO_TARGET) $(DESTDIR)$(libdir)


[FILE:1392:patches/patch-common_putil.cpp]
--- common/putil.cpp.orig	2016-10-19 17:20:56 UTC
+++ common/putil.cpp
@@ -1789,7 +1789,7 @@ remapPlatformDependentCodepage(const cha
          */
         name = "ISO-8859-1";
     }
-#elif U_PLATFORM_IS_DARWIN_BASED
+#elif U_PLATFORM_IS_DARWIN_BASED || U_PLATFORM == U_PF_BSD
     if (locale == NULL && *name == 0) {
         /*
         No locale was specified, and an empty name was passed in.
@@ -1808,11 +1808,6 @@ remapPlatformDependentCodepage(const cha
          */
         name = "UTF-8";
     }
-#elif U_PLATFORM == U_PF_BSD
-    if (uprv_strcmp(name, "CP949") == 0) {
-        /* Remap CP949 to a similar codepage to avoid issues with backslash and won symbol. */
-        name = "EUC-KR";
-    }
 #elif U_PLATFORM == U_PF_HPUX
     if (locale != NULL && uprv_strcmp(locale, "zh_HK") == 0 && uprv_strcmp(name, "big5") == 0) {
         /* HP decided to extend big5 as hkbig5 even though it's not compatible :-( */
@@ -1942,7 +1937,7 @@ int_getDefaultCodepage()
        nl_langinfo may use the same buffer as setlocale. */
     {
         const char *codeset = nl_langinfo(U_NL_LANGINFO_CODESET);
-#if U_PLATFORM_IS_DARWIN_BASED || U_PLATFORM_IS_LINUX_BASED
+#if U_PLATFORM_IS_DARWIN_BASED || U_PLATFORM_IS_LINUX_BASED || U_PLATFORM == U_PF_BSD
         /*
          * On Linux and MacOSX, ensure that default codepage for non C/POSIX locale is UTF-8
          * instead of ASCII.


[FILE:956:patches/patch-common_umutex.cpp]
--- common/umutex.cpp.orig	2016-03-23 20:50:10 UTC
+++ common/umutex.cpp
@@ -264,19 +264,19 @@ static pthread_cond_t initCondition = PT
 U_COMMON_API UBool U_EXPORT2
 umtx_initImplPreInit(UInitOnce &uio) {
     pthread_mutex_lock(&initMutex);
-    int32_t state = uio.fState;
+    int32_t state = umtx_loadAcquire(uio.fState);
     if (state == 0) {
         umtx_storeRelease(uio.fState, 1);
         pthread_mutex_unlock(&initMutex);
         return TRUE;   // Caller will next call the init function.
     } else {
-        while (uio.fState == 1) {
+        while (umtx_loadAcquire(uio.fState) == 1) {
             // Another thread is currently running the initialization.
             // Wait until it completes.
             pthread_cond_wait(&initCondition, &initMutex);
         }
         pthread_mutex_unlock(&initMutex);
-        U_ASSERT(uio.fState == 2);
+        U_ASSERT(umtx_loadAcquire(uio.fState) == 2);
         return FALSE;
     }
 }


[FILE:537:patches/patch-common_unicode_platform.h]
--- common/unicode/platform.h.orig	2016-03-23 20:49:58 UTC
+++ common/unicode/platform.h
@@ -379,8 +379,8 @@
  */
 #ifdef U_IS_BIG_ENDIAN
     /* Use the predefined value. */
-#elif defined(BYTE_ORDER) && defined(BIG_ENDIAN)
-#   define U_IS_BIG_ENDIAN (BYTE_ORDER == BIG_ENDIAN)
+#elif defined(_BYTE_ORDER) && defined(_BIG_ENDIAN)
+#   define U_IS_BIG_ENDIAN (_BYTE_ORDER == _BIG_ENDIAN)
 #elif defined(__BYTE_ORDER__) && defined(__ORDER_BIG_ENDIAN__)
     /* gcc */
 #   define U_IS_BIG_ENDIAN (__BYTE_ORDER__ == __ORDER_BIG_ENDIAN__)


[FILE:227:patches/patch-common_unicode_uconfig.h]
--- common/unicode/uconfig.h.orig	2016-03-23 20:49:54 UTC
+++ common/unicode/uconfig.h
@@ -87,7 +87,7 @@
  * @internal
  */
 #ifndef U_DISABLE_RENAMING
-#define U_DISABLE_RENAMING 0
+#define U_DISABLE_RENAMING 1
 #endif
 
 /**


[FILE:407:patches/patch-i18n_Makefile.in]
--- i18n/Makefile.in.orig	2016-03-23 20:49:38 UTC
+++ i18n/Makefile.in
@@ -135,7 +135,7 @@ install-local: install-headers install-l
 install-library: all-local
 	$(MKINSTALLDIRS) $(DESTDIR)$(libdir)
 ifneq ($(ENABLE_STATIC),)
-	$(INSTALL-L) $(TARGET) $(DESTDIR)$(libdir)
+	$(INSTALL_DATA) $(TARGET) $(DESTDIR)$(libdir)
 endif
 ifneq ($(ENABLE_SHARED),)
 	$(INSTALL-L) $(FINAL_SO_TARGET) $(DESTDIR)$(libdir)


[FILE:401:patches/patch-io_Makefile.in]
--- io/Makefile.in.orig	2016-03-23 20:50:52 UTC
+++ io/Makefile.in
@@ -96,7 +96,7 @@ install-local: install-headers install-l
 install-library: all-local
 	$(MKINSTALLDIRS) $(DESTDIR)$(libdir)
 ifneq ($(ENABLE_STATIC),)
-	$(INSTALL-L) $(TARGET) $(DESTDIR)$(libdir)
+	$(INSTALL_DATA) $(TARGET) $(DESTDIR)$(libdir)
 endif
 ifneq ($(ENABLE_SHARED),)
 	$(INSTALL-L) $(FINAL_SO_TARGET) $(DESTDIR)$(libdir)


[FILE:380:patches/patch-layoutex_Makefile.in]
--- layoutex/Makefile.in.orig	2016-03-23 20:56:38 UTC
+++ layoutex/Makefile.in
@@ -109,7 +109,7 @@ endif
 install-library: all-local
 	$(MKINSTALLDIRS) $(DESTDIR)$(libdir)
 ifneq ($(ENABLE_STATIC),)
-	$(INSTALL-L) $(TARGET) $(DESTDIR)$(libdir)
+	$(INSTALL_DATA) $(TARGET) $(DESTDIR)$(libdir)
 endif
 ifneq ($(ENABLE_SHARED),)
 	$(INSTALL-L) $(FINAL_SO_TARGET) $(DESTDIR)$(libdir)


[FILE:403:patches/patch-stubdata_Makefile.in]
--- stubdata/Makefile.in.orig	2016-03-23 20:50:52 UTC
+++ stubdata/Makefile.in
@@ -82,7 +82,7 @@ install-local: install-library
 install-library: all-local
 	$(MKINSTALLDIRS) $(DESTDIR)$(libdir)
 ifneq ($(ENABLE_STATIC),)
-	$(INSTALL-L) $(TARGET) $(DESTDIR)$(libdir)
+	$(INSTALL_DATA) $(TARGET) $(DESTDIR)$(libdir)
 endif
 ifneq ($(ENABLE_SHARED),)
 	$(INSTALL-L) $(FINAL_SO_TARGET) $(DESTDIR)$(libdir)


[FILE:413:patches/patch-tools_ctestfw_Makefile.in]
--- tools/ctestfw/Makefile.in.orig	2016-03-23 20:50:16 UTC
+++ tools/ctestfw/Makefile.in
@@ -78,7 +78,7 @@ install-local: install-library
 install-library: all-local
 	$(MKINSTALLDIRS) $(DESTDIR)$(libdir)
 ifneq ($(ENABLE_STATIC),)
-	$(INSTALL-L) $(TARGET) $(DESTDIR)$(libdir)
+	$(INSTALL_DATA) $(TARGET) $(DESTDIR)$(libdir)
 endif
 ifneq ($(ENABLE_SHARED),)
 	$(INSTALL-L) $(FINAL_SO_TARGET) $(DESTDIR)$(libdir)


[FILE:415:patches/patch-tools_toolutil_Makefile.in]
--- tools/toolutil/Makefile.in.orig	2016-03-23 20:50:26 UTC
+++ tools/toolutil/Makefile.in
@@ -89,7 +89,7 @@ install-local: install-library
 install-library: all-local
 	$(MKINSTALLDIRS) $(DESTDIR)$(libdir)
 ifneq ($(ENABLE_STATIC),)
-	$(INSTALL-L) $(TARGET) $(DESTDIR)$(libdir)
+	$(INSTALL_DATA) $(TARGET) $(DESTDIR)$(libdir)
 endif
 ifneq ($(ENABLE_SHARED),)
 	$(INSTALL-L) $(FINAL_SO_TARGET) $(DESTDIR)$(libdir)


[FILE:653:dragonfly/patch-common_unicode_platform.h]
--- common/unicode/platform.h.orig	2016-09-30 03:57:59 UTC
+++ common/unicode/platform.h
@@ -159,8 +159,10 @@
 #   else
 #       define U_PLATFORM U_PF_DARWIN
 #   endif
-#elif defined(BSD) || defined(__FreeBSD__) || defined(__FreeBSD_kernel__) || defined(__NetBSD__) || defined(__OpenBSD__) || defined(__MirBSD__)
-#   if defined(__FreeBSD__)
+#elif defined(BSD) || defined(__FreeBSD__) || defined(__FreeBSD_kernel__) \
+ || defined(__NetBSD__) || defined(__OpenBSD__) || defined(__MirBSD__) \
+ || defined(__DragonFly__)
+#   if defined(__FreeBSD__) || defined(__DragonFly__)
 #       include <sys/endian.h>
 #   endif
 #   define U_PLATFORM U_PF_BSD


[FILE:365:dragonfly/patch-runConfigureICU]
$NetBSD: patch-af,v 1.12 2012/11/07 20:59:51 adam Exp $

--- runConfigureICU.orig	2011-07-19 21:19:38.000000000 +0000
+++ runConfigureICU
@@ -284,7 +284,7 @@ case $platform in
         RELEASE_CFLAGS='-O3'
         RELEASE_CXXFLAGS='-O3'
         ;;
-    *BSD)
+    *BSD | DragonFly)
         THE_OS="BSD"
         THE_COMP="the GNU C++"
         CC=gcc; export CC

