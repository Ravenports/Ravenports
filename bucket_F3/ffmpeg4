# Buildsheet autogenerated by ravenadm tool -- Do not edit.

NAMEBASE=		ffmpeg4
VERSION=		4.4.4
KEYWORDS=		multimedia audio net
VARIANTS=		standard
SDESC[standard]=	Legacy stream audio and video library
HOMEPAGE=		https://www.ffmpeg.org/
CONTACT=		nobody

DOWNLOAD_GROUPS=	main
SITES[main]=		https://ffmpeg.org/releases/
DISTFILE[1]=		ffmpeg-4.4.4.tar.xz:main
DF_INDEX=		1
SPKGS[standard]=	complete
			primary
			tools
			dev
			examples
			man
			docs

OPTIONS_AVAILABLE=	none
OPTIONS_STANDARD=	none

BUILD_DEPENDS=		gettext:solinks:standard
			gmp:static:standard
			gnutls:dev:standard
			harfbuzz:dev:standard
			libdrm:dev:standard
			libgcrypt:dev:standard
			libvpx:dev:standard
			nasm:primary:standard
			x265:dev:standard
			libass:dev:standard
			libva:dev:standard
			libvorbis:dev:standard
			WebP:dev:standard
			frei0r:dev:standard
BUILDRUN_DEPENDS=	gmp:shared:standard
			libass:primary:standard
			frei0r:primary:standard
			fribidi:single:standard
			libgcrypt:primary:standard
			gnutls:primary:standard
			rtmpdump:library:standard
			libtheora:single:standard
			libva:primary:standard
			libvdpau:single:standard
			libvorbis:primary:standard
			libvpx:primary:standard
			libdrm:primary:standard
			WebP:primary:standard
			x264:library:standard
			x265:primary:standard
			xvid:single:standard
EXRUN[tools]=		ffmpeg4:primary:standard

USES=			cpe gmake iconv zlib perl:build fontconfig pkgconfig
			shebangfix gettext:build
GNOME_COMPONENTS=	libxml2 librsvg
SDL_COMPONENTS=		sdl2

DISTNAME=		ffmpeg-4.4.4

LICENSE=		LGPL3+:primary GPLv3+:primary
LICENSE_TERMS=		primary:{{WRKSRC}}/LICENSE.md
LICENSE_FILE=		LGPL3+:{{WRKSRC}}/COPYING.LGPLv3
			GPLv3+:{{WRKSRC}}/COPYING.GPLv3
LICENSE_SCHEME=		multi

CPE_PRODUCT=		ffmpeg
CPE_VENDOR=		ffmpeg
FPC_EQUIVALENT=		multimedia/ffmpeg4
SHEBANG_ADD_SH=		ffbuild/libversion.sh
SHEBANG_FILES=		doc/texi2pod.pl

MUST_CONFIGURE=		yes
CONFIGURE_ARGS=		--cc="{{CC}}"
			--prefix="{{PREFIX}}"
			--mandir="{{MANPREFIX}}/man"
			--datadir="{{PREFIX}}/share/ffmpeg"
			--pkgconfigdir="{{PREFIX}}/lib/pkgconfig"
			--enable-shared
			--enable-pic
			--enable-gpl
			--enable-version3
			--enable-postproc
			--enable-avfilter
			--enable-avresample
			--enable-pthreads
			--disable-alsa
			--disable-libopencore-amrnb
			--disable-libopencore-amrwb
			--disable-libbs2b
			--disable-libcaca
			--disable-libcdio
			--disable-libcelt
			--disable-chromaprint
			--disable-libdc1394
			--disable-debug
			--disable-htmlpages
			--disable-libfdk-aac
			--disable-libflite
			--disable-libgme
			--disable-libgsm
			--disable-libilbc
			--disable-libkvazaar
			--disable-ladspa
			--disable-libmp3lame
			--disable-libbluray
			--disable-libmodplug
			--disable-openal
			--disable-opencl
			--disable-opengl
			--disable-libopenh264
			--disable-libopenjpeg
			--disable-openssl
			--disable-libopus
			--disable-libpulse
			--disable-librubberband
			--disable-libsmbclient
			--disable-libsnappy
			--disable-sndio
			--disable-libsoxr
			--disable-libspeex
			--disable-libssh
			--disable-libtesseract
			--disable-libtwolame
			--disable-libvo-amrwbenc
			--disable-libvidstab
			--disable-libxcb
			--disable-outdev=xv
			--disable-libzimg
			--disable-libzmq
			--disable-libzvbi
			--disable-libmysofa
			--disable-libv4l2
			--disable-indev=v4l2
			--disable-outdev=v4l2
			--enable-libass
			--enable-fontconfig
			--enable-libfreetype
			--enable-frei0r
			--enable-libfribidi
			--enable-gcrypt
			--enable-gnutls
			--enable-gmp
			--enable-iconv
			--enable-optimizations
			--enable-runtime-cpudetect
			--enable-librtmp
			--enable-sdl2
			--enable-libtheora
			--enable-vaapi
			--enable-vdpau
			--enable-libvorbis
			--enable-libvpx
			--enable-libwebp
			--enable-libx264
			--enable-libx265
			--enable-libxvid
			--enable-libdrm
			--enable-librsvg
			--enable-libxml2

INSTALL_TARGET=		install-progs install-doc install-data install-libs
			install-headers install-examples
PLIST_SUB=		AVCODEC_SO=58.134.100
			AVCODEC_MAJOR=58
			AVDEVICE_SO=58.13.100
			AVDEVICE_MAJOR=58
			AVFILTER_SO=7.110.100
			AVFILTER_MAJOR=7
			AVFORMAT_SO=58.76.100
			AVFORMAT_MAJOR=58
			AVRESAMPLE_SO=4.0.0
			AVRESAMPLE_MAJOR=4
			AVUTIL_SO=56.70.100
			AVUTIL_MAJOR=56
			POSTPROC_SO=55.9.100
			POSTPROC_MAJOR=55
			SWRESAMPLE_SO=3.9.100
			SWRESAMPLE_MAJOR=3
			SCALE_SO=5.9.100
			SCALE_MAJOR=5
RC_SUBR=		ffserver:primary

post-install:
	@${MKDIR} ${STAGEDIR}${STD_DOCDIR}
.for DF in CREDITS LICENSE.md MAINTAINERS README.md RELEASE_NOTES
	${INSTALL_DATA} ${WRKSRC}/${DF} ${STAGEDIR}${STD_DOCDIR}
.endfor
	${INSTALL_DATA} ${WRKSRC}/doc/APIchanges ${STAGEDIR}${STD_DOCDIR}
	${INSTALL_DATA} ${WRKSRC}/doc/*.txt ${STAGEDIR}${STD_DOCDIR}

post-patch-sunos:
	${REINPLACE_CMD} -e '/^enabled libxvid/ s/$$/ -lrt/' \
		-e '/append SHFLAGS.*version_script/d' \
		${WRKSRC}/configure

[FILE:843:descriptions/desc.primary]
FFmpeg is the leading multimedia framework, able to decode, encode,
transcode, mux, demux, stream, filter and play pretty much anything that
humans and machines have created. It supports the most obscure ancient
formats up to the cutting edge. No matter if they were designed by some
standards committee, the community or a corporation. It is also highly
portable: FFmpeg compiles, runs, and passes our testing infrastructure
FATE across Linux, Mac OS X, Microsoft Windows, the BSDs, Solaris, etc.
under a wide variety of build environments, machine architectures, and
configurations.

It contains libavcodec, libavutil, libavformat, libavfilter, libavdevice,
libswscale and libswresample which can be used by applications. As well
as ffmpeg, ffserver, ffplay and ffprobe which can be used by end users
for transcoding, streaming and playing.


[FILE:42:descriptions/desc.tools]
This packages contains the ffpmeg4 tools.


[FILE:98:distinfo]
e80b380d595c809060f66f96a5d849511ef4a76a26b76eacf5778b94c3570309      9565584 ffmpeg-4.4.4.tar.xz


[FILE:604:manifests/plist.primary]
lib/
 libavcodec.so.%%AVCODEC_MAJOR%%
 libavcodec.so.%%AVCODEC_SO%%
 libavdevice.so.%%AVDEVICE_MAJOR%%
 libavdevice.so.%%AVDEVICE_SO%%
 libavfilter.so.%%AVFILTER_MAJOR%%
 libavfilter.so.%%AVFILTER_SO%%
 libavformat.so.%%AVFORMAT_MAJOR%%
 libavformat.so.%%AVFORMAT_SO%%
 libavresample.so.%%AVRESAMPLE_MAJOR%%
 libavresample.so.%%AVRESAMPLE_SO%%
 libavutil.so.%%AVUTIL_MAJOR%%
 libavutil.so.%%AVUTIL_SO%%
 libpostproc.so.%%POSTPROC_MAJOR%%
 libpostproc.so.%%POSTPROC_SO%%
 libswresample.so.%%SWRESAMPLE_MAJOR%%
 libswresample.so.%%SWRESAMPLE_SO%%
 libswscale.so.%%SCALE_MAJOR%%
 libswscale.so.%%SCALE_SO%%


[FILE:30:manifests/plist.tools]
bin/
 ffmpeg
 ffplay
 ffprobe


[FILE:2335:manifests/plist.dev]
include/libavcodec/
 ac3_parser.h
 adts_parser.h
 avcodec.h
 avdct.h
 avfft.h
 bsf.h
 codec.h
 codec_desc.h
 codec_id.h
 codec_par.h
 d3d11va.h
 dirac.h
 dv_profile.h
 dxva2.h
 jni.h
 mediacodec.h
 packet.h
 qsv.h
 vaapi.h
 vdpau.h
 version.h
 videotoolbox.h
 vorbis_parser.h
 xvmc.h
include/libavdevice/
 avdevice.h
 version.h
include/libavfilter/
 avfilter.h
 buffersink.h
 buffersrc.h
 version.h
include/libavformat/
 avformat.h
 avio.h
 version.h
include/libavresample/
 avresample.h
 version.h
include/libavutil/
 adler32.h
 aes.h
 aes_ctr.h
 attributes.h
 audio_fifo.h
 avassert.h
 avconfig.h
 avstring.h
 avutil.h
 base64.h
 blowfish.h
 bprint.h
 bswap.h
 buffer.h
 camellia.h
 cast5.h
 channel_layout.h
 common.h
 cpu.h
 crc.h
 des.h
 dict.h
 display.h
 dovi_meta.h
 downmix_info.h
 encryption_info.h
 error.h
 eval.h
 ffversion.h
 fifo.h
 file.h
 film_grain_params.h
 frame.h
 hash.h
 hdr_dynamic_metadata.h
 hmac.h
 hwcontext.h
 hwcontext_cuda.h
 hwcontext_d3d11va.h
 hwcontext_drm.h
 hwcontext_dxva2.h
 hwcontext_mediacodec.h
 hwcontext_opencl.h
 hwcontext_qsv.h
 hwcontext_vaapi.h
 hwcontext_vdpau.h
 hwcontext_videotoolbox.h
 hwcontext_vulkan.h
 imgutils.h
 intfloat.h
 intreadwrite.h
 lfg.h
 log.h
 lzo.h
 macros.h
 mastering_display_metadata.h
 mathematics.h
 md5.h
 mem.h
 motion_vector.h
 murmur3.h
 opt.h
 parseutils.h
 pixdesc.h
 pixelutils.h
 pixfmt.h
 random_seed.h
 rational.h
 rc4.h
 replaygain.h
 ripemd.h
 samplefmt.h
 sha.h
 sha512.h
 spherical.h
 stereo3d.h
 tea.h
 threadmessage.h
 time.h
 timecode.h
 timestamp.h
 tree.h
 twofish.h
 tx.h
 version.h
 video_enc_params.h
 xtea.h
include/libpostproc/
 postprocess.h
 version.h
include/libswresample/
 swresample.h
 version.h
include/libswscale/
 swscale.h
 version.h
lib/
 libavcodec.a
 libavcodec.so
 libavdevice.a
 libavdevice.so
 libavfilter.a
 libavfilter.so
 libavformat.a
 libavformat.so
 libavresample.a
 libavresample.so
 libavutil.a
 libavutil.so
 libpostproc.a
 libpostproc.so
 libswresample.a
 libswresample.so
 libswscale.a
 libswscale.so
lib/pkgconfig/
 libavcodec.pc
 libavdevice.pc
 libavfilter.pc
 libavformat.pc
 libavresample.pc
 libavutil.pc
 libpostproc.pc
 libswresample.pc
 libswscale.pc
share/ffmpeg/
 ffprobe.xsd
 libvpx-1080p.ffpreset
 libvpx-1080p50_60.ffpreset
 libvpx-360p.ffpreset
 libvpx-720p.ffpreset
 libvpx-720p50_60.ffpreset


[FILE:409:manifests/plist.examples]
share/ffmpeg/examples/
 Makefile
 README
 avio_list_dir.c
 avio_reading.c
 decode_audio.c
 decode_video.c
 demuxing_decoding.c
 encode_audio.c
 encode_video.c
 extract_mvs.c
 filter_audio.c
 filtering_audio.c
 filtering_video.c
 http_multiclient.c
 hw_decode.c
 metadata.c
 muxing.c
 qsvdec.c
 remuxing.c
 resampling_audio.c
 scaling_video.c
 transcode_aac.c
 transcoding.c
 vaapi_encode.c
 vaapi_transcode.c


[FILE:447:manifests/plist.man]
share/man/man1/
 ffmpeg-all.1.gz
 ffmpeg-bitstream-filters.1.gz
 ffmpeg-codecs.1.gz
 ffmpeg-devices.1.gz
 ffmpeg-filters.1.gz
 ffmpeg-formats.1.gz
 ffmpeg-protocols.1.gz
 ffmpeg-resampler.1.gz
 ffmpeg-scaler.1.gz
 ffmpeg-utils.1.gz
 ffmpeg.1.gz
 ffplay-all.1.gz
 ffplay.1.gz
 ffprobe-all.1.gz
 ffprobe.1.gz
share/man/man3/
 libavcodec.3.gz
 libavdevice.3.gz
 libavfilter.3.gz
 libavformat.3.gz
 libavutil.3.gz
 libswresample.3.gz
 libswscale.3.gz


[FILE:2056:patches/patch-assy-with-bu241]
From effadce6c756247ea8bae32dc13bb3e6f464f0eb Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?R=C3=A9mi=20Denis-Courmont?= <remi@remlab.net>
Date: Sun, 16 Jul 2023 18:18:02 +0300
Subject: [PATCH] avcodec/x86/mathops: clip constants used with shift
 instructions within inline assembly

Fixes assembling with binutil as >= 2.41

Signed-off-by: James Almer <jamrial@gmail.com>
---
 libavcodec/x86/mathops.h | 26 +++++++++++++++++++++++---
 1 file changed, 23 insertions(+), 3 deletions(-)

--- libavcodec/x86/mathops.h.orig	2020-04-27 21:48:15 UTC
+++ libavcodec/x86/mathops.h
@@ -35,12 +35,20 @@
 static av_always_inline av_const int MULL(int a, int b, unsigned shift)
 {
     int rt, dummy;
+    if (__builtin_constant_p(shift))
     __asm__ (
         "imull %3               \n\t"
         "shrdl %4, %%edx, %%eax \n\t"
         :"=a"(rt), "=d"(dummy)
-        :"a"(a), "rm"(b), "ci"((uint8_t)shift)
+        :"a"(a), "rm"(b), "i"(shift & 0x1F)
     );
+    else
+        __asm__ (
+            "imull %3               \n\t"
+            "shrdl %4, %%edx, %%eax \n\t"
+            :"=a"(rt), "=d"(dummy)
+            :"a"(a), "rm"(b), "c"((uint8_t)shift)
+        );
     return rt;
 }
 
@@ -113,19 +121,31 @@ __asm__ volatile(\
 // avoid +32 for shift optimization (gcc should do that ...)
 #define NEG_SSR32 NEG_SSR32
 static inline  int32_t NEG_SSR32( int32_t a, int8_t s){
+    if (__builtin_constant_p(s))
     __asm__ ("sarl %1, %0\n\t"
          : "+r" (a)
-         : "ic" ((uint8_t)(-s))
+         : "i" (-s & 0x1F)
     );
+    else
+        __asm__ ("sarl %1, %0\n\t"
+               : "+r" (a)
+               : "c" ((uint8_t)(-s))
+        );
     return a;
 }
 
 #define NEG_USR32 NEG_USR32
 static inline uint32_t NEG_USR32(uint32_t a, int8_t s){
+    if (__builtin_constant_p(s))
     __asm__ ("shrl %1, %0\n\t"
          : "+r" (a)
-         : "ic" ((uint8_t)(-s))
+         : "i" (-s & 0x1F)
     );
+    else
+        __asm__ ("shrl %1, %0\n\t"
+               : "+r" (a)
+               : "c" ((uint8_t)(-s))
+        );
     return a;
 }
 


[FILE:603:patches/patch-configure]
--- configure.orig	2023-04-12 18:52:51 UTC
+++ configure
@@ -3784,13 +3784,7 @@ target_os_default=$(tolower $(uname -s))
 host_os=$target_os_default
 
 # machine
-if test "$target_os_default" = aix; then
-    arch_default=$(uname -p)
-    strip_default="strip -X32_64"
-    nm_default="nm -g -X32_64"
-else
-    arch_default=$(uname -m)
-fi
+arch_default=$(uname -p)
 cpu="generic"
 intrinsics="none"
 
@@ -5386,7 +5380,7 @@ case $target_os in
     dragonfly)
         disable symver
         ;;
-    freebsd)
+    freebsd|midnightbsd)
         ;;
     bsd/os)
         add_extralibs -lpoll -lgnugetopt


[FILE:287:patches/patch-doc_Makefile]
--- doc/Makefile.orig	2023-04-12 18:01:50 UTC
+++ doc/Makefile
@@ -119,7 +119,7 @@ install-html: $(HTMLPAGES)
 endif
 
 ifdef CONFIG_MANPAGES
-install-progs-$(CONFIG_DOC): install-man
+#install-progs-$(CONFIG_DOC): install-man
 
 install-man: $(MANPAGES)
 	$(Q)mkdir -p "$(MANDIR)/man1"


[FILE:1842:patches/patch-libavformat_rtsp.c]
--- libavformat/rtsp.c.orig	2023-04-12 18:01:50 UTC
+++ libavformat/rtsp.c
@@ -1666,7 +1666,12 @@ int ff_rtsp_make_setup_request(AVFormatC
             }
             if (ttl > 0)
                 snprintf(optbuf, sizeof(optbuf), "?ttl=%d", ttl);
-            getnameinfo((struct sockaddr*) &addr, sizeof(addr),
+            getnameinfo((struct sockaddr*) &addr,
+#if HAVE_STRUCT_SOCKADDR_SA_LEN
+                        ((struct sockaddr*) &addr)->sa_len,
+#else
+                        sizeof(addr),
+#endif
                         namebuf, sizeof(namebuf), NULL, 0, NI_NUMERICHOST);
             ff_url_join(url, sizeof(url), "rtp", NULL, namebuf,
                         port, "%s", optbuf);
@@ -1900,8 +1905,13 @@ redirect:
         goto fail;
     }
     if (!getpeername(tcp_fd, (struct sockaddr*) &peer, &peer_len)) {
-        getnameinfo((struct sockaddr*) &peer, peer_len, host, sizeof(host),
-                    NULL, 0, NI_NUMERICHOST);
+        getnameinfo((struct sockaddr*) &peer,
+#if HAVE_STRUCT_SOCKADDR_SA_LEN
+                    ((struct sockaddr*) &peer)->sa_len,
+#else
+                    peer_len,
+#endif
+                    host, sizeof(host), NULL, 0, NI_NUMERICHOST);
     }
 
     /* request options supported by the server; this also detects server
@@ -2419,7 +2429,11 @@ static int sdp_read_header(AVFormatConte
             AVDictionary *opts = map_to_opts(rt);
 
             err = getnameinfo((struct sockaddr*) &rtsp_st->sdp_ip,
+#if HAVE_STRUCT_SOCKADDR_SA_LEN
+                              ((struct sockaddr*) &rtsp_st->sdp_ip)->sa_len,
+#else
                               sizeof(rtsp_st->sdp_ip),
+#endif
                               namebuf, sizeof(namebuf), NULL, 0, NI_NUMERICHOST);
             if (err) {
                 av_log(s, AV_LOG_ERROR, "getnameinfo: %s\n", gai_strerror(err));


[FILE:331:patches/patch-libavutil_common.h]
--- libavutil/common.h.orig	2023-04-12 18:01:50 UTC
+++ libavutil/common.h
@@ -50,6 +50,10 @@
 #   define AV_NE(be, le) (le)
 #endif
 
+#ifndef	UINT64_C
+#define	UINT64_C(c)	(c ## UL)
+#endif
+
 //rounded division & shift
 #define RSHIFT(a,b) ((a) > 0 ? ((a) + ((1<<(b))>>1))>>(b) : ((a) + ((1<<(b))>>1)-1)>>(b))
 /* assume b>0 */


[FILE:398:files/ffserver.in]
#!/bin/sh
#
# PROVIDE: ffserver
# REQUIRE: NETWORKING
# KEYWORD: shutdown

#
# Add the following lines to /etc/rc.conf to enable ffserver:
#
#ffserver_enable="YES"
#
ffserver_enable="${ffserver_enable-NO}"

. /etc/rc.subr

name=ffserver
rcvar=ffserver_enable

command="%%PREFIX%%/bin/${name}"
command_args="&"
required_files=%%PREFIX%%/etc/ffserver.conf

load_rc_config ${name}
run_rc_command "$1"

