# Buildsheet autogenerated by ravenadm tool -- Do not edit.

NAMEBASE=		aria2
VERSION=		1.34.0
KEYWORDS=		ftp net www
VARIANTS=		standard
SDESC[standard]=	CLI download for HTTP/S, FTP, BitTorrent, Metalink
HOMEPAGE=		https://aria2.github.io/
CONTACT=		nobody

DOWNLOAD_GROUPS=	main
SITES[main]=		https://github.com/aria2/aria2/releases/download/release-1.34.0/
DISTFILE[1]=		aria2-1.34.0.tar.xz:main
DF_INDEX=		1
SPKGS[standard]=	complete
			primary
			docs

OPTIONS_AVAILABLE=	none
OPTIONS_STANDARD=	none

RUN_DEPENDS=		nss:caroot:standard

USES=			libtool pkgconfig ssl sqlite zlib c++:primary
GNOME_COMPONENTS=	libxml2

LICENSE=		GPLv2+:primary
LICENSE_TERMS=		primary:{{WRKDIR}}/TERMS
LICENSE_FILE=		GPLv2+:{{WRKSRC}}/COPYING
LICENSE_AWK=		TERMS:"copyright -->"
LICENSE_SOURCE=		TERMS:{{WRKSRC}}/src/main.cc
LICENSE_SCHEME=		solo

FPC_EQUIVALENT=		www/aria2

MUST_CONFIGURE=		gnu
CONFIGURE_ARGS=		--disable-epoll
			--disable-nls
			--enable-bittorrent
			--enable-libaria2
			--enable-metalink
			--enable-shared
			--enable-ssl
			--enable-static
			--enable-threads=posix
			--enable-websocket
			--with-disk-cache=16M
			--with-libxml2
			--with-libz
			--with-openssl
			--with-sqlite3
			--with-ca-bundle={{LOCALBASE}}/share/certs/ca-root-nss.crt
			--without-appletls
			--without-gnutls
			--without-libexpat
			--without-libgcrypt
			--without-libgmp
			--without-libnettle
			--without-libuv
			--without-libcares
			--without-libintl-prefix
			--without-libssh2
CONFIGURE_ENV=		OPENSSL_CFLAGS=-I{{OPENSSLINC}}
			OPENSSL_LIBS="-L{{OPENSSLLIB}} -lcrypto -lssl"
			ac_cv_path_RST2HTML=no

INSTALL_TARGET=		install-strip
RC_SUBR=		aria2:primary

post-patch:
	${REINPLACE_CMD} -e '/GAI_STRERROR/d' ${WRKSRC}/src/Makefile.in

post-install:
	${MKDIR} ${STAGEDIR}${PREFIX}/etc/bash_completion.d/
	${INSTALL_DATA} ${WRKSRC}/doc/bash_completion/aria2c \
		${STAGEDIR}${PREFIX}/etc/bash_completion.d/

[FILE:1298:descriptions/desc.primary]
aria2 is a lightweight multi-protocol & multi-source command-line download
utility. It supports HTTP/HTTPS, FTP, BitTorrent and Metalink. aria2 can
be manipulated via built-in JSON-RPC and XML-RPC interfaces. Its features
include:

 - Multi-Connection Download.
   aria2 can download a file from multiple sources/protocols and tries to
   utilize your maximum download bandwidth. Really speeds up downloads
 - Lightweight.
   aria2 doesn't require much memory and CPU time. The physical memory
   usage is typically 4MiB (normal HTTP/FTP downloads) to 9MiB (BitTorrent
   downloads). CPU usage in BitTorrent with download speed of 2.8MiB/sec
   is around 6%.
 - Fully Featured BitTorrent Client.
   All features you want in BitTorrent client are available: DHT, PEX,
   Encryption, Magnet URI, Web-Seeding, Selective Downloads and Local Peer
   Discovery.
 - Metalink Enabled.
   aria2 supports The Metalink Download Description Format (aka Metalink
   v4), Metalink version 3 and Metalink/HTTP. Metalink offers the file
   verification, HTTP/FTP/BitTorrent integration and the various
   configurations for language, location, OS, etc.
 - Remote Control.
   aria2 supports RPC interface to control the aria2 process. The supported
   interfaces are JSON-RPC (over HTTP and WebSocket) and XML-RPC.


[FILE:98:distinfo]
3a44a802631606e138a9e172a3e9f5bcbaac43ce2895c1d8e2b46f30487e77a3      1525908 aria2-1.34.0.tar.xz


[FILE:239:manifests/plist.primary]
bin/aria2c
etc/bash_completion.d/aria2c
include/aria2/aria2.h
lib/
 libaria2.a
 libaria2.so
 libaria2.so.0
 libaria2.so.0.0.0
lib/pkgconfig/libaria2.pc
share/man/man1/aria2c.1.gz
share/man/pt/man1/aria2c.1.gz
share/man/ru/man1/aria2c.1.gz


[FILE:159:manifests/plist.docs]
share/doc/aria2/
 README
 README.html
 README.rst
share/doc/aria2/bash_completion/
 README.txt
 aria2c
share/doc/aria2/xmlrpc/
 README.txt
 aria2mon
 aria2rpc


[FILE:223:patches/patch-src-DownloadEngine.cc]
--- src/DownloadEngine.cc.orig	2014-07-22 14:33:38 UTC
+++ src/DownloadEngine.cc
@@ -37,6 +37,7 @@
 #include <signal.h>
 
 #include <cstring>
+#include <cstdlib>
 #include <cerrno>
 #include <algorithm>
 #include <numeric>


[FILE:597:patches/patch-src-LibsslTLSContext.cc]
--- src/LibsslTLSContext.cc.orig	2015-02-23 14:34:01 UTC
+++ src/LibsslTLSContext.cc
@@ -112,14 +112,20 @@ OpenSSLTLSContext::OpenSSLTLSContext(TLS
 
   long ver_opts = 0;
   switch (minVer) {
+#ifdef SSL_OP_NO_TLSv1_1
   case TLS_PROTO_TLS12:
     ver_opts |= SSL_OP_NO_TLSv1_1;
+#endif // SSL_OP_NO_TLSv1_1
   // fall through
+#ifdef SSL_OP_NO_TLSv1
   case TLS_PROTO_TLS11:
     ver_opts |= SSL_OP_NO_TLSv1;
+#endif // SSL_OP_NO_TLSv1
   // fall through
+#ifdef SSL_OP_NO_SSLv3
   case TLS_PROTO_TLS10:
     ver_opts |= SSL_OP_NO_SSLv3;
+#endif // SSL_OP_NO_SSLv3
   default:
     break;
   };


[FILE:349:patches/patch-src-libssl_compat.h]
--- src/libssl_compat.h.orig	2017-11-08 12:43:40 UTC
+++ src/libssl_compat.h
@@ -37,7 +37,7 @@
 
 #include <openssl/opensslv.h>
 
-#if defined(LIBRESSL_VERSION_NUMBER)
+#if (defined(LIBRESSL_VERSION_NUMBER) && LIBRESSL_VERSION_NUMBER >= 0x20700000fL)
 #define LIBRESSL_IN_USE 1
 #else // !defined(LIBRESSL_VERSION_NUMBER)
 #define LIBRESSL_IN_USE 0


[FILE:677:files/aria2.in]
#!/bin/sh
#
# PROVIDE: aria2
# REQUIRE: NETWORKING
# KEYWORD: shutdown

#
# Add the following lines to /etc/rc.conf to enable aria2:
#
# aria2_enable="YES"
#
# You can define flags for aria2 running. See aria2c(1) for details.
#

. /etc/rc.subr

name=aria2
rcvar=aria2_enable

command=%%PREFIX%%/bin/aria2c

# read configuration and set defaults
load_rc_config $name
aria2_enable=${aria2_enable:-"NO"}
aria2_config=${aria2_config:-"%%PREFIX%%/etc/aria2.conf"}
aria2_flags=${aria2_flags:-""}
aria2_user=${aria2_user:-"nobody"}
aria2_group=${aria2_group:-"nobody"}

required_files=${aria2_config}
command_args="-D --conf-path=${aria2_config} ${aria2_flags}"

run_rc_command "$1"

